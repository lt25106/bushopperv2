import{A as Zm,B as Wm,C as Rn,D as ac,E as ev,F as tv,G as Hm,H as Fu,I as Km,J as Xm,L as iv,M as rv,a as U0,b as j0,c as V0,d as $0,e as $m,f as Zd,g as G0,h as q0,i as Ar,j as Z0,k as W0,l as H0,m as K0,n as X0,o as Wd,p as Hd,q as Y0,r as Kd,s as rc,t as nc,u as oc,v as J0,w as La,x as Gm,y as qm,z as Q0}from"./chunk-RDGRUNCC.js";var ov=U0((Ym,Jm)=>{(function(s,i){typeof Ym=="object"&&typeof Jm<"u"?Jm.exports=i():typeof define=="function"&&define.amd?define(i):(s=typeof globalThis<"u"?globalThis:s||self,s.maplibregl=i())})(Ym,(function(){"use strict";var s={},i={};function l(p,a,b){if(i[p]=b,p==="index"){var P="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",M={};return i.shared(M),i.index(s,M),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),s}}l("shared",["exports"],(function(p){"use strict";function a(n,t,r,c){return new(r||(r=Promise))((function(h,y){function _(I){try{w(c.next(I))}catch(A){y(A)}}function x(I){try{w(c.throw(I))}catch(A){y(A)}}function w(I){var A;I.done?h(I.value):(A=I.value,A instanceof r?A:new r((function(k){k(A)}))).then(_,x)}w((c=c.apply(n,t||[])).next())}))}function b(n,t){this.x=n,this.y=t}function P(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var M,D;typeof SuppressedError=="function"&&SuppressedError,b.prototype={clone(){return new b(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){let t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){let t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){let n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){let t=Math.cos(n),r=Math.sin(n),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround(n,t){let r=Math.cos(n),c=Math.sin(n),h=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:b},b.convert=function(n){if(n instanceof b)return n;if(Array.isArray(n))return new b(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new b(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var B=(function(){if(D)return M;function n(t,r,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=h}return D=1,M=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var y=this.sampleCurveX(c)-t;if(Math.abs(y)<r)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=y/_}var x=0,w=1;for(c=t,h=0;h<20&&(y=this.sampleCurveX(c),!(Math.abs(y-t)<r));h++)t>y?x=c:w=c,c=.5*(w-x)+x;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},M})(),U=P(B);let oe,le;function me(){return oe==null&&(oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oe}function xe(){if(le==null&&(le=!1,me())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<25;c++){let h=4*c;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&r[c]!==c){le=!0;break}}}return le||!1}var Ce=1e-6,ke=typeof Float32Array<"u"?Float32Array:Array;function Re(){var n=new ke(9);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function We(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function rt(){var n=new ke(3);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function qe(n){return Math.hypot(n[0],n[1],n[2])}function lt(n,t,r){var c=new ke(3);return c[0]=n,c[1]=t,c[2]=r,c}function Vi(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function zi(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function pr(n,t,r){var c=t[0],h=t[1],y=t[2],_=r[0],x=r[1],w=r[2];return n[0]=h*w-y*x,n[1]=y*_-c*w,n[2]=c*x-h*_,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Xi,Qr=qe;function mo(n,t,r){var c=t[0],h=t[1],y=t[2],_=t[3];return n[0]=r[0]*c+r[4]*h+r[8]*y+r[12]*_,n[1]=r[1]*c+r[5]*h+r[9]*y+r[13]*_,n[2]=r[2]*c+r[6]*h+r[10]*y+r[14]*_,n[3]=r[3]*c+r[7]*h+r[11]*y+r[15]*_,n}function _n(){var n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function vn(n,t,r,c){var h=.5*Math.PI/180;t*=h,r*=h,c*=h;var y=Math.sin(t),_=Math.cos(t),x=Math.sin(r),w=Math.cos(r),I=Math.sin(c),A=Math.cos(c);return n[0]=y*w*A-_*x*I,n[1]=_*x*A+y*w*I,n[2]=_*w*I-y*x*A,n[3]=_*w*A+y*x*I,n}function xn(){var n=new ke(2);return ke!=Float32Array&&(n[0]=0,n[1]=0),n}function Jo(n,t){var r=new ke(2);return r[0]=n,r[1]=t,r}rt(),Xi=new ke(4),ke!=Float32Array&&(Xi[0]=0,Xi[1]=0,Xi[2]=0,Xi[3]=0),rt(),lt(1,0,0),lt(0,1,0),_n(),_n(),Re(),xn();let Ot=8192;function bn(n,t,r){return t*(Ot/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function $i(n,t){return(n%t+t)%t}function go(n,t,r){return n*(1-r)+t*r}function en(n){if(n<=0)return 0;if(n>=1)return 1;let t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function Bn(n,t,r,c){let h=new U(n,t,r,c);return y=>h.solve(y)}let yo=Bn(.25,.1,.25,1);function ar(n,t,r){return Math.min(r,Math.max(t,n))}function Qo(n,t,r){let c=r-t,h=((n-t)%c+c)%c+t;return h===t?r:h}function Tr(n,...t){for(let r of t)for(let c in r)n[c]=r[c];return n}let Mr=1;function ea(n,t,r){let c={};for(let h in n)c[h]=t.call(this,n[h],h,n);return c}function ta(n,t,r){let c={};for(let h in n)t.call(this,n[h],h,n)&&(c[h]=n[h]);return c}function fr(n){return Array.isArray(n)?n.map(fr):typeof n=="object"&&n?ea(n,fr):n}let ni={};function ui(n){ni[n]||(typeof console<"u"&&console.warn(n),ni[n]=!0)}function kr(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function tn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let _o=null;function rn(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}let nn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ia(n,t,r,c,h){return a(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let y=new VideoFrame(n,{timestamp:0});try{let _=y?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);let x=_.startsWith("BGR"),w=new Uint8ClampedArray(c*h*4);if(yield y.copyTo(w,(function(I,A,k,z,F){let N=4*Math.max(-A,0),$=(Math.max(0,k)-k)*z*4+N,Z=4*z,X=Math.max(0,A),ce=Math.max(0,k);return{rect:{x:X,y:ce,width:Math.min(I.width,A+z)-X,height:Math.min(I.height,k+F)-ce},layout:[{offset:$,stride:Z}]}})(n,t,r,c,h)),x)for(let I=0;I<w.length;I+=4){let A=w[I];w[I]=w[I+2],w[I+2]=A}return w}finally{y.close()}}))}let Un,jn;function Vn(n,t,r,c){return n.addEventListener(t,r,c),{unsubscribe:()=>{n.removeEventListener(t,r,c)}}}function vo(n){return n*Math.PI/180}function $n(n){return n/Math.PI*180}let Gn={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},qn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ra="AbortError";function ue(){return new Error(ra)}let V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(n){return V.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}let q="global-dispatcher";class ee extends Error{constructor(t,r,c,h){super(`AJAXError: ${r} (${t}): ${c}`),this.status=t,this.statusText=r,this.url=c,this.body=h}}let se=()=>tn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,he=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){let c=G(n.url);if(c)return c(n,t);if(tn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:q},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(se())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(c,h){return a(this,void 0,void 0,(function*(){let y=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:se(),signal:h.signal}),_,x;c.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{_=yield fetch(y)}catch(I){throw new ee(0,I.message,c.url,new Blob)}if(!_.ok){let I=yield _.blob();throw new ee(_.status,_.statusText,c.url,I)}x=c.type==="arrayBuffer"||c.type==="image"?_.arrayBuffer():c.type==="json"?_.json():_.text();let w=yield x;if(h.signal.aborted)throw ue();return{data:w,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(n,t);if(tn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:q},t)}var r;return(function(c,h){return new Promise(((y,_)=>{var x;let w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(let I in c.headers)w.setRequestHeader(I,c.headers[I]);c.type==="json"&&(w.responseType="text",!((x=c.headers)===null||x===void 0)&&x.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{_(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let I=w.response;if(c.type==="json")try{I=JSON.parse(w.response)}catch(A){return void _(A)}y({data:I,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{let I=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});_(new ee(w.status,w.statusText,c.url,I))}},h.signal.addEventListener("abort",(()=>{w.abort(),_(ue())})),w.send(c.body)}))})(n,t)};function ve(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;let t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function pe(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Se(n,t,r){if(r&&r[n]){let c=r[n].indexOf(t);c!==-1&&r[n].splice(c,1)}}class Me{constructor(t,r={}){Tr(this,r),this.type=t}}class Pe extends Me{constructor(t,r={}){super("error",Tr({error:t},r))}}class Xe{on(t,r){return this._listeners=this._listeners||{},pe(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Se(t,r,this._listeners),Se(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},pe(t,r,this._oneTimeListeners),this):new Promise((c=>this.once(t,c)))}fire(t,r){typeof t=="string"&&(t=new Me(t,r||{}));let c=t.type;if(this.listens(c)){t.target=this;let h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(let x of h)x.call(this,t);let y=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(let x of y)Se(c,x,this._oneTimeListeners),x.call(this,t);let _=this._eventedParent;_&&(Tr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function vt(n,t){let r={};for(let c in n)c!=="ref"&&(r[c]=n[c]);return ut.forEach((c=>{c in t&&(r[c]=t[c])})),r}function Qe(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Qe(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(let r in n)if(!Qe(n[r],t[r]))return!1;return!0}return n===t}function pt(n,t){n.push(t)}function qt(n,t,r){pt(r,{command:"addSource",args:[n,t[n]]})}function xi(n,t,r){pt(t,{command:"removeSource",args:[n]}),r[n]=!0}function bi(n,t,r,c){xi(n,r,c),qt(n,t,r)}function hi(n,t,r){let c;for(c in n[r])if(Object.prototype.hasOwnProperty.call(n[r],c)&&c!=="data"&&!Qe(n[r][c],t[r][c]))return!1;for(c in t[r])if(Object.prototype.hasOwnProperty.call(t[r],c)&&c!=="data"&&!Qe(n[r][c],t[r][c]))return!1;return!0}function St(n,t,r,c,h,y){n=n||{},t=t||{};for(let _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(Qe(n[_],t[_])||r.push({command:y,args:[c,_,t[_],h]}));for(let _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(n,_)&&(Qe(n[_],t[_])||r.push({command:y,args:[c,_,t[_],h]}))}function Mt(n){return n.id}function pi(n,t){return n[t.id]=t,n}class De{constructor(t,r,c,h){this.message=(t?`${t}: `:"")+c,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function Gi(n,...t){for(let r of t)for(let c in r)n[c]=r[c];return n}class Qt extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Zn{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[c,h]of r)this.bindings[c]=h}concat(t){return new Zn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let na={kind:"null"},Ve={kind:"number"},xt={kind:"string"},yt={kind:"boolean"},Oi={kind:"color"},xo={kind:"projectionDefinition"},Wn={kind:"object"},mt={kind:"value"},il={kind:"collator"},Hn={kind:"formatted"},rl={kind:"padding"},on={kind:"colorArray"},oa={kind:"numberArray"},oi={kind:"resolvedImage"},nl={kind:"variableAnchorOffsetCollection"};function sr(n,t){return{kind:"array",itemType:n,N:t}}function Vt(n){if(n.kind==="array"){let t=Vt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}let Oh=[na,Ve,xt,yt,Oi,xo,Hn,Wn,sr(mt),rl,oa,on,oi,nl];function qa(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!qa(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(let r of Oh)if(!qa(r,t))return null}}return`Expected ${Vt(n)} but found ${Vt(t)} instead.`}function Ec(n,t){return t.some((r=>r.kind===n.kind))}function Kn(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function Xn(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}let Ac=.96422,Fh=.82521,Nh=4/29,aa=6/29,Bh=3*aa*aa,Cf=aa*aa*aa,Mf=Math.PI/180,kf=180/Math.PI;function Cc(n){return(n%=360)<0&&(n+=360),n}function sa([n,t,r,c]){let h,y,_=kc((.2225045*(n=Mc(n))+.7168786*(t=Mc(t))+.0606169*(r=Mc(r)))/1);n===t&&t===r?h=y=_:(h=kc((.4360747*n+.3850649*t+.1430804*r)/Ac),y=kc((.0139322*n+.0971045*t+.7141733*r)/Fh));let x=116*_-16;return[x<0?0:x,500*(h-_),200*(_-y),c]}function Mc(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kc(n){return n>Cf?Math.pow(n,1/3):n/Bh+Nh}function la([n,t,r,c]){let h=(n+16)/116,y=isNaN(t)?h:h+t/500,_=isNaN(r)?h:h-r/200;return h=1*Lc(h),y=Ac*Lc(y),_=Fh*Lc(_),[Rc(3.1338561*y-1.6168667*h-.4906146*_),Rc(-.9787684*y+1.9161415*h+.033454*_),Rc(.0719453*y-.2289914*h+1.4052427*_),c]}function Rc(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Lc(n){return n>aa?n*n*n:Bh*(n-Nh)}let Rf=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function ca(n,t){return Rf(n,t)?n[t]:void 0}function Za(n){return parseInt(n.padEnd(2,n),16)/255}function Rr(n,t){return bt(t?n/100:n,0,1)}function bt(n,t,r){return Math.min(Math.max(t,n),r)}function bo(n){return!n.some(Number.isNaN)}let Yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function wn(n,t,r){return n+r*(t-n)}function wo(n,t,r){return n.map(((c,h)=>wn(c,t[h],r)))}class wt{constructor(t,r,c,h=1,y=!0){this.r=t,this.g=r,this.b=c,this.a=h,y||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,r,c,h]))}static parse(t){if(t instanceof wt)return t;if(typeof t!="string")return;let r=(function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];let h=ca(Yn,c);if(h){let[_,x,w]=h;return[_/255,x/255,w/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){let _=c.length<6?1:2,x=1;return[Za(c.slice(x,x+=_)),Za(c.slice(x,x+=_)),Za(c.slice(x,x+=_)),Za(c.slice(x,x+_)||"ff")]}if(c.startsWith("rgb")){let _=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[x,w,I,A,k,z,F,N,$,Z,X,ce]=_,ie=[A||" ",F||" ",Z].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){let ne=[I,z,$].join(""),_e=ne==="%%%"?100:ne===""?255:0;if(_e){let Te=[bt(+w/_e,0,1),bt(+k/_e,0,1),bt(+N/_e,0,1),X?Rr(+X,ce):1];if(bo(Te))return Te}}return}}let y=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[_,x,w,I,A,k,z,F,N]=y,$=[w||" ",A||" ",z].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){let Z=[+x,bt(+I,0,100),bt(+k,0,100),F?Rr(+F,N):1];if(bo(Z))return(function([X,ce,ie,ne]){function _e(Te){let Ae=(Te+X/30)%12,je=ce*Math.min(ie,1-ie);return ie-je*Math.max(-1,Math.min(Ae-3,9-Ae,1))}return X=Cc(X),ce/=100,ie/=100,[_e(0),_e(8),_e(4),ne]})(Z)}}})(t);return r?new wt(...r,!1):void 0}get rgb(){let{r:t,g:r,b:c,a:h}=this,y=h||1/0;return this.overwriteGetter("rgb",[t/y,r/y,c/y,h])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[r,c,h,y]=sa(t),_=Math.sqrt(c*c+h*h);return[Math.round(1e4*_)?Cc(Math.atan2(h,c)*kf):NaN,_,r,y]})(this.rgb))}get lab(){return this.overwriteGetter("lab",sa(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,c,h]=this.rgb;return`rgba(${[t,r,c].map((y=>Math.round(255*y))).join(",")},${h})`}static interpolate(t,r,c,h="rgb"){switch(h){case"rgb":{let[y,_,x,w]=wo(t.rgb,r.rgb,c);return new wt(y,_,x,w,!1)}case"hcl":{let[y,_,x,w]=t.hcl,[I,A,k,z]=r.hcl,F,N;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?F=NaN:(F=I,x!==1&&x!==0||(N=A)):(F=y,k!==1&&k!==0||(N=_));else{let ie=I-y;I>y&&ie>180?ie-=360:I<y&&y-I>180&&(ie+=360),F=y+c*ie}let[$,Z,X,ce]=(function([ie,ne,_e,Te]){return ie=isNaN(ie)?0:ie*Mf,la([_e,Math.cos(ie)*ne,Math.sin(ie)*ne,Te])})([F,N??wn(_,A,c),wn(x,k,c),wn(w,z,c)]);return new wt($,Z,X,ce,!1)}case"lab":{let[y,_,x,w]=la(wo(t.lab,r.lab,c));return new wt(y,_,x,w,!1)}}}}wt.black=new wt(0,0,0,1),wt.white=new wt(1,1,1,1),wt.transparent=new wt(0,0,0,0),wt.red=new wt(1,0,0,1);class To{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let ol=["bottom","center","top"];class al{constructor(t,r,c,h,y,_){this.text=t,this.image=r,this.scale=c,this.fontStack=h,this.textColor=y,this.verticalAlign=_}}class Yi{constructor(t){this.sections=t}static fromString(t){return new Yi([new al(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Yi?t:Yi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pi)return t;if(typeof t=="number")return new Pi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Pi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){return new Pi(wo(t.values,r.values,c))}}class Ji{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ji)return t;if(typeof t=="number")return new Ji([t]);if(Array.isArray(t)){for(let r of t)if(typeof r!="number")return;return new Ji(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){return new Ji(wo(t.values,r.values,c))}}class fi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof fi)return t;if(typeof t=="string"){let c=wt.parse(t);return c?new fi([c]):void 0}if(!Array.isArray(t))return;let r=[];for(let c of t){if(typeof c!="string")return;let h=wt.parse(c);if(!h)return;r.push(h)}return new fi(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c,h="rgb"){let y=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)y.push(wt.interpolate(t.values[_],r.values[_],c,h));return new fi(y)}}class $t extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Uh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Qi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let c=t[r],h=t[r+1];if(typeof c!="string"||!Uh.has(c)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Qi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,c){let h=t.values,y=r.values;if(h.length!==y.length)throw new $t(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);let _=[];for(let x=0;x<h.length;x+=2){if(h[x]!==y[x])throw new $t(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${y[x]}`);_.push(h[x]);let[w,I]=h[x+1],[A,k]=y[x+1];_.push([wn(w,A,c),wn(I,k,c)])}return new Qi(_)}}class mr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new mr({name:t,available:!1}):null}}class qi{constructor(t,r,c){this.from=t,this.to=r,this.transition=c}static interpolate(t,r,c){return new qi(t,r,c)}static parse(t){return t instanceof qi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new qi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new qi(t.from,t.to,t.transition):typeof t=="string"?new qi(t,t,1):void 0}}function Zt(n,t,r,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,r,c]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function So(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof qi||n instanceof wt||n instanceof To||n instanceof Yi||n instanceof Pi||n instanceof Ji||n instanceof fi||n instanceof Qi||n instanceof mr)return!0;if(Array.isArray(n)){for(let t of n)if(!So(t))return!1;return!0}if(typeof n=="object"){for(let t in n)if(!So(n[t]))return!1;return!0}return!1}function at(n){if(n===null)return na;if(typeof n=="string")return xt;if(typeof n=="boolean")return yt;if(typeof n=="number")return Ve;if(n instanceof wt)return Oi;if(n instanceof qi)return xo;if(n instanceof To)return il;if(n instanceof Yi)return Hn;if(n instanceof Pi)return rl;if(n instanceof Ji)return oa;if(n instanceof fi)return on;if(n instanceof Qi)return nl;if(n instanceof mr)return oi;if(Array.isArray(n)){let t=n.length,r;for(let c of n){let h=at(c);if(r){if(r===h)continue;r=mt;break}r=h}return sr(r||mt,t)}return Wn}function dt(n){let t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof wt||n instanceof qi||n instanceof Yi||n instanceof Pi||n instanceof Ji||n instanceof fi||n instanceof Qi||n instanceof mr?n.toString():JSON.stringify(n)}class Tn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!So(t[1]))return r.error("invalid value");let c=t[1],h=at(c),y=r.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new Tn(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let kt={string:xt,number:Ve,boolean:yt,object:Wn};class gr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,h=1,y=t[0];if(y==="array"){let x,w;if(t.length>2){let I=t[1];if(typeof I!="string"||!(I in kt)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=kt[I],h++}else x=mt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}c=sr(x,w)}else{if(!kt[y])throw new Error(`Types doesn't contain name = ${y}`);c=kt[y]}let _=[];for(;h<t.length;h++){let x=r.parse(t[h],h,mt);if(!x)return null;_.push(x)}return new gr(c,_)}evaluate(t){for(let r=0;r<this.args.length;r++){let c=this.args[r].evaluate(t);if(!qa(this.type,at(c)))return c;if(r===this.args.length-1)throw new $t(`Expected value to be of type ${Vt(this.type)}, but found ${Vt(at(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let an={"to-boolean":yt,"to-color":Oi,"to-number":Ve,"to-string":xt};class sn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c=t[0];if(!an[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");let h=an[c],y=[];for(let _=1;_<t.length;_++){let x=r.parse(t[_],_,mt);if(!x)return null;y.push(x)}return new sn(h,y)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,c;for(let h of this.args){if(r=h.evaluate(t),c=null,r instanceof wt)return r;if(typeof r=="string"){let y=t.parseColor(r);if(y)return y}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Zt(r[0],r[1],r[2],r[3]),!c))return new wt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new $t(c||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let c of this.args){r=c.evaluate(t);let h=Pi.parse(r);if(h)return h}throw new $t(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(let c of this.args){r=c.evaluate(t);let h=Ji.parse(r);if(h)return h}throw new $t(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(let c of this.args){r=c.evaluate(t);let h=fi.parse(r);if(h)return h}throw new $t(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let c of this.args){r=c.evaluate(t);let h=Qi.parse(r);if(h)return h}throw new $t(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let c of this.args){if(r=c.evaluate(t),r===null)return 0;let h=Number(r);if(!isNaN(h))return h}throw new $t(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Yi.fromString(dt(this.args[0].evaluate(t)));case"resolvedImage":return mr.fromString(dt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return dt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}let sl=["Unknown","Point","LineString","Polygon"];class Dc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=wt.parse(t),this._parseColorCache.set(t,r)),r}}class ua{constructor(t,r,c=[],h,y=new Zn,_=[]){this.registry=t,this.path=c,this.key=c.map((x=>`[${x}]`)).join(""),this.scope=y,this.errors=_,this.expectedType=h,this._isConstant=r}parse(t,r,c,h,y={}){return r?this.concat(r,c,h)._parse(t,y):this._parse(t,y)}_parse(t,r){function c(h,y,_){return _==="assert"?new gr(y,[h]):_==="coerce"?new sn(y,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let y=this.registry[h];if(y){let _=y.parse(t,this);if(!_)return null;if(this.expectedType){let x=this.expectedType,w=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(w.kind)||x.kind==="colorArray"&&["value","string","array"].includes(w.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))_=c(_,x,r.typeAnnotation||"coerce");else if(this.checkSubtype(x,w))return null}else _=c(_,x,r.typeAnnotation||"assert")}if(!(_ instanceof Tn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){let x=new Dc;try{_=new Tn(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c){let h=typeof t=="number"?this.path.concat(t):this.path,y=c?this.scope.concat(c):this.scope;return new ua(this.registry,this._isConstant,h,r||null,y,this.errors)}error(t,...r){let c=`${this.key}${r.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Qt(c,t))}checkSubtype(t,r){let c=qa(t,r);return c&&this.error(c),c}}class Wa{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let c=[];for(let y=1;y<t.length-1;y+=2){let _=t[y];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",y);let x=r.parse(t[y+1],y+1);if(!x)return null;c.push([_,x])}let h=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return h?new Wa(c,h):null}outputDefined(){return this.result.outputDefined()}}class ll{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let c=t[1];return r.scope.has(c)?new ll(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class cl{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let c=r.parse(t[1],1,Ve),h=r.parse(t[2],2,sr(r.expectedType||mt));return c&&h?new cl(h.type.itemType,c,h):null}evaluate(t){let r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new $t(`Array index out of bounds: ${r} < 0.`);if(r>=c.length)throw new $t(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r!==Math.floor(r))throw new $t(`Array index must be an integer, but found ${r} instead.`);return c[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ul{constructor(t,r){this.type=yt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let c=r.parse(t[1],1,mt),h=r.parse(t[2],2,mt);return c&&h?Ec(c.type,[yt,xt,Ve,na,mt])?new ul(c,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(c.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!Kn(r,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(at(r))} instead.`);if(!Kn(c,["string","array"]))throw new $t(`Expected second argument to be of type array or string, but found ${Vt(at(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Lr{constructor(t,r,c){this.type=Ve,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let c=r.parse(t[1],1,mt),h=r.parse(t[2],2,mt);if(!c||!h)return null;if(!Ec(c.type,[yt,xt,Ve,na,mt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(c.type)} instead`);if(t.length===4){let y=r.parse(t[3],3,Ve);return y?new Lr(c,h,y):null}return new Lr(c,h)}evaluate(t){let r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Kn(r,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(at(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),Kn(c,["string"])){let y=c.indexOf(r,h);return y===-1?-1:[...c.slice(0,y)].length}if(Kn(c,["array"]))return c.indexOf(r,h);throw new $t(`Expected second argument to be of type array or string, but found ${Vt(at(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ei{constructor(t,r,c,h,y,_){this.inputType=t,this.type=r,this.input=c,this.cases=h,this.outputs=y,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);let y={},_=[];for(let I=2;I<t.length-1;I+=2){let A=t[I],k=t[I+1];Array.isArray(A)||(A=[A]);let z=r.concat(I);if(A.length===0)return z.error("Expected at least one branch label.");for(let N of A){if(typeof N!="number"&&typeof N!="string")return z.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,at(N)))return null}else c=at(N);if(y[String(N)]!==void 0)return z.error("Branch labels must be unique.");y[String(N)]=_.length}let F=r.parse(k,I,h);if(!F)return null;h=h||F.type,_.push(F)}let x=r.parse(t[1],1,mt);if(!x)return null;let w=r.parse(t[t.length-1],t.length-1,h);return w?x.type.kind!=="value"&&r.concat(1).checkSubtype(c,x.type)?null:new Ei(c,h,x,y,_,w):null}evaluate(t){let r=this.input.evaluate(t);return(at(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ha{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);let h=[];for(let _=1;_<t.length-1;_+=2){let x=r.parse(t[_],_,yt);if(!x)return null;let w=r.parse(t[_+1],_+1,c);if(!w)return null;h.push([x,w]),c=c||w.type}let y=r.parse(t[t.length-1],t.length-1,c);if(!y)return null;if(!c)throw new Error("Can't infer output type");return new ha(c,h,y)}evaluate(t){for(let[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ha{constructor(t,r,c,h){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let c=r.parse(t[1],1,mt),h=r.parse(t[2],2,Ve);if(!c||!h)return null;if(!Ec(c.type,[sr(mt),xt,mt]))return r.error(`Expected first argument to be of type array or string, but found ${Vt(c.type)} instead`);if(t.length===4){let y=r.parse(t[3],3,Ve);return y?new Ha(c.type,c,h,y):null}return new Ha(c.type,c,h)}evaluate(t){let r=this.input.evaluate(t),c=this.beginIndex.evaluate(t),h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),Kn(r,["string"]))return[...r].slice(c,h).join("");if(Kn(r,["array"]))return r.slice(c,h);throw new $t(`Expected first argument to be of type array or string, but found ${Vt(at(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Io(n,t){let r=n.length-1,c,h,y=0,_=r,x=0;for(;y<=_;)if(x=Math.floor((y+_)/2),c=n[x],h=n[x+1],c<=t){if(x===r||t<h)return x;y=x+1}else{if(!(c>t))throw new $t("Input is not a number.");_=x-1}return 0}class ai{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[h,y]of c)this.labels.push(h),this.outputs.push(y)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let c=r.parse(t[1],1,Ve);if(!c)return null;let h=[],y=null;r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let _=1;_<t.length;_+=2){let x=_===1?-1/0:t[_],w=t[_+1],I=_,A=_+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);let k=r.parse(w,A,y);if(!k)return null;y=y||k.type,h.push([x,k])}return new ai(y,c,h)}evaluate(t){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);let h=this.input.evaluate(t);if(h<=r[0])return c[0].evaluate(t);let y=r.length;return h>=r[y-1]?c[y-1].evaluate(t):c[Io(r,h)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function jh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ka,zc,Lf=(function(){if(zc)return Ka;function n(t,r,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=h}return zc=1,Ka=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var y=this.sampleCurveX(c)-t;if(Math.abs(y)<r)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=y/_}var x=0,w=1;for(c=t,h=0;h<20&&(y=this.sampleCurveX(c),!(Math.abs(y-t)<r));h++)t>y?x=c:w=c,c=.5*(w-x)+x;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Ka})(),da=jh(Lf);class Fi{constructor(t,r,c,h,y){this.type=t,this.operator=r,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(let[_,x]of y)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(t,r,c,h){let y=0;if(t.name==="exponential")y=Xa(r,t.base,c,h);else if(t.name==="linear")y=Xa(r,1,c,h);else if(t.name==="cubic-bezier"){let _=t.controlPoints;y=new da(_[0],_[1],_[2],_[3]).solve(Xa(r,1,c,h))}return y}static parse(t,r){let[c,h,y,..._]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let I=h[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let I=h.slice(1);if(I.length!==4||I.some((A=>typeof A!="number"||A<0||A>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(y=r.parse(y,2,Ve),!y)return null;let x=[],w=null;c!=="interpolate-hcl"&&c!=="interpolate-lab"||r.expectedType==on?r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType):w=Oi;for(let I=0;I<_.length;I+=2){let A=_[I],k=_[I+1],z=I+3,F=I+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(x.length&&x[x.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);let N=r.parse(k,F,w);if(!N)return null;w=w||N.type,x.push([A,N])}return Xn(w,Ve)||Xn(w,xo)||Xn(w,Oi)||Xn(w,rl)||Xn(w,oa)||Xn(w,on)||Xn(w,nl)||Xn(w,sr(Ve))?new Fi(w,c,h,y,x):r.error(`Type ${Vt(w)} is not interpolatable.`)}evaluate(t){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);let h=this.input.evaluate(t);if(h<=r[0])return c[0].evaluate(t);let y=r.length;if(h>=r[y-1])return c[y-1].evaluate(t);let _=Io(r,h),x=Fi.interpolationFactor(this.interpolation,h,r[_],r[_+1]),w=c[_].evaluate(t),I=c[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return wn(w,I,x);case"color":return wt.interpolate(w,I,x);case"padding":return Pi.interpolate(w,I,x);case"colorArray":return fi.interpolate(w,I,x);case"numberArray":return Ji.interpolate(w,I,x);case"variableAnchorOffsetCollection":return Qi.interpolate(w,I,x);case"array":return wo(w,I,x);case"projectionDefinition":return qi.interpolate(w,I,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return wt.interpolate(w,I,x,"hcl");case"colorArray":return fi.interpolate(w,I,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return wt.interpolate(w,I,x,"lab");case"colorArray":return fi.interpolate(w,I,x,"lab")}}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Xa(n,t,r,c){let h=c-r,y=n-r;return h===0?0:t===1?y/h:(Math.pow(t,y)-1)/(Math.pow(t,h)-1)}let ln={color:wt.interpolate,number:wn,padding:Pi.interpolate,numberArray:Ji.interpolate,colorArray:fi.interpolate,variableAnchorOffsetCollection:Qi.interpolate,array:wo};class Ya{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c=null,h=r.expectedType;h&&h.kind!=="value"&&(c=h);let y=[];for(let x of t.slice(1)){let w=r.parse(x,1+y.length,c,void 0,{typeAnnotation:"omit"});if(!w)return null;c=c||w.type,y.push(w)}if(!c)throw new Error("No output type");let _=h&&y.some((x=>qa(h,x.type)));return new Ya(_?mt:c,y)}evaluate(t){let r,c=null,h=0;for(let y of this.args)if(h++,c=y.evaluate(t),c&&c instanceof mr&&!c.available&&(r||(r=c.name),c=null,h===this.args.length&&(c=r)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Ja(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Qa(n,t,r,c){return c.compare(t,r)===0}function Zi(n,t,r){let c=n!=="=="&&n!=="!=";return class nv{constructor(y,_,x){this.type=yt,this.lhs=y,this.rhs=_,this.collator=x,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");let x=y[0],w=_.parse(y[1],1,mt);if(!w)return null;if(!Ja(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Vt(w.type)}'.`);let I=_.parse(y[2],2,mt);if(!I)return null;if(!Ja(x,I.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Vt(I.type)}'.`);if(w.type.kind!==I.type.kind&&w.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${Vt(w.type)}' and '${Vt(I.type)}'.`);c&&(w.type.kind==="value"&&I.type.kind!=="value"?w=new gr(I.type,[w]):w.type.kind!=="value"&&I.type.kind==="value"&&(I=new gr(w.type,[I])));let A=null;if(y.length===4){if(w.type.kind!=="string"&&I.type.kind!=="string"&&w.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(A=_.parse(y[3],3,il),!A)return null}return new nv(w,I,A)}evaluate(y){let _=this.lhs.evaluate(y),x=this.rhs.evaluate(y);if(c&&this.hasUntypedArgument){let w=at(_),I=at(x);if(w.kind!==I.kind||w.kind!=="string"&&w.kind!=="number")throw new $t(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let w=at(_),I=at(x);if(w.kind!=="string"||I.kind!=="string")return t(y,_,x)}return this.collator?r(y,_,x,this.collator.evaluate(y)):t(y,_,x)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}let Vh=Zi("==",(function(n,t,r){return t===r}),Qa),hl=Zi("!=",(function(n,t,r){return t!==r}),(function(n,t,r,c){return!Qa(0,t,r,c)})),Df=Zi("<",(function(n,t,r){return t<r}),(function(n,t,r,c){return c.compare(t,r)<0})),Oc=Zi(">",(function(n,t,r){return t>r}),(function(n,t,r,c){return c.compare(t,r)>0})),zf=Zi("<=",(function(n,t,r){return t<=r}),(function(n,t,r,c){return c.compare(t,r)<=0})),Of=Zi(">=",(function(n,t,r){return t>=r}),(function(n,t,r,c){return c.compare(t,r)>=0}));class dl{constructor(t,r,c){this.type=il,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");let h=r.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,yt);if(!h)return null;let y=r.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,yt);if(!y)return null;let _=null;return c.locale&&(_=r.parse(c.locale,1,xt),!_)?null:new dl(h,y,_)}evaluate(t){return new To(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Fc{constructor(t,r,c,h,y){this.type=xt,this.number=t,this.locale=r,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=y}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let c=r.parse(t[1],1,Ve);if(!c)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let y=null;if(h.locale&&(y=r.parse(h.locale,1,xt),!y))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,xt),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=r.parse(h["min-fraction-digits"],1,Ve),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=r.parse(h["max-fraction-digits"],1,Ve),!w)?null:new Fc(c,y,_,x,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Po{constructor(t){this.type=Hn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");let h=[],y=!1;for(let _=1;_<=t.length-1;++_){let x=t[_];if(y&&typeof x=="object"&&!Array.isArray(x)){y=!1;let w=null;if(x["font-scale"]&&(w=r.parse(x["font-scale"],1,Ve),!w))return null;let I=null;if(x["text-font"]&&(I=r.parse(x["text-font"],1,sr(xt)),!I))return null;let A=null;if(x["text-color"]&&(A=r.parse(x["text-color"],1,Oi),!A))return null;let k=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!ol.includes(x["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(k=r.parse(x["vertical-align"],1,xt),!k)return null}let z=h[h.length-1];z.scale=w,z.font=I,z.textColor=A,z.verticalAlign=k}else{let w=r.parse(t[_],1,mt);if(!w)return null;let I=w.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Po(h)}evaluate(t){return new Yi(this.sections.map((r=>{let c=r.content.evaluate(t);return at(c)===oi?new al("",c,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new al(dt(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Nc{constructor(t){this.type=oi,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let c=r.parse(t[1],1,xt);return c?new Nc(c):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),c=mr.fromString(r);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(r)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class pl{constructor(t){this.type=Ve,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Vt(c.type)} instead.`):new pl(c):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new $t(`Expected value to be of type string or array, but found ${Vt(at(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Dr=8192;function Ff(n,t){let r=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*Dr),Math.round(c*h*Dr)]}function fl(n,t){let r=Math.pow(2,t.z);return[(h=(n[0]/Dr+t.x)/r,360*h-180),(c=(n[1]/Dr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,h}function es(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ts(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Nf(n,t,r){let c=n[0]-t[0],h=n[1]-t[1],y=n[0]-r[0],_=n[1]-r[1];return c*_-y*h==0&&c*y<=0&&h*_<=0}function ml(n,t,r,c){return(h=[c[0]-r[0],c[1]-r[1]])[0]*(y=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*y[0]!=0&&!(!Gh(n,t,r,c)||!Gh(r,c,n,t));var h,y}function Bf(n,t,r){for(let c of r)for(let h=0;h<c.length-1;++h)if(ml(n,t,c[h],c[h+1]))return!0;return!1}function Eo(n,t,r=!1){let c=!1;for(let x of t)for(let w=0;w<x.length-1;w++){if(Nf(n,x[w],x[w+1]))return r;(y=x[w])[1]>(h=n)[1]!=(_=x[w+1])[1]>h[1]&&h[0]<(_[0]-y[0])*(h[1]-y[1])/(_[1]-y[1])+y[0]&&(c=!c)}var h,y,_;return c}function $h(n,t){for(let r of t)if(Eo(n,r))return!0;return!1}function Bc(n,t){for(let r of n)if(!Eo(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Bf(n[r],n[r+1],t))return!1;return!0}function Uf(n,t){for(let r of t)if(Bc(n,r))return!0;return!1}function Gh(n,t,r,c){let h=c[0]-r[0],y=c[1]-r[1],_=(n[0]-r[0])*y-h*(n[1]-r[1]),x=(t[0]-r[0])*y-h*(t[1]-r[1]);return _>0&&x<0||_<0&&x>0}function Uc(n,t,r){let c=[];for(let h=0;h<n.length;h++){let y=[];for(let _=0;_<n[h].length;_++){let x=Ff(n[h][_],r);es(t,x),y.push(x)}c.push(y)}return c}function qh(n,t,r){let c=[];for(let h=0;h<n.length;h++){let y=Uc(n[h],t,r);c.push(y)}return c}function gl(n,t,r,c){if(n[0]<r[0]||n[0]>r[2]){let h=.5*c,y=n[0]-r[0]>h?-c:r[0]-n[0]>h?c:0;y===0&&(y=n[0]-r[2]>h?-c:r[2]-n[0]>h?c:0),n[0]+=y}es(t,n)}function Zh(n,t,r,c){let h=Math.pow(2,c.z)*Dr,y=[c.x*Dr,c.y*Dr],_=[];for(let x of n)for(let w of x){let I=[w.x+y[0],w.y+y[1]];gl(I,t,r,h),_.push(I)}return _}function Wh(n,t,r,c){let h=Math.pow(2,c.z)*Dr,y=[c.x*Dr,c.y*Dr],_=[];for(let w of n){let I=[];for(let A of w){let k=[A.x+y[0],A.y+y[1]];es(t,k),I.push(k)}_.push(I)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(let w of _)for(let I of w)gl(I,t,r,h)}var x;return _}class Ao{constructor(t,r){this.type=yt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(So(t[1])){let c=t[1];if(c.type==="FeatureCollection"){let h=[];for(let y of c.features){let{type:_,coordinates:x}=y.geometry;_==="Polygon"&&h.push(x),_==="MultiPolygon"&&h.push(...x)}if(h.length)return new Ao(c,{type:"MultiPolygon",coordinates:h})}else if(c.type==="Feature"){let h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ao(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ao(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){let h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(c.type==="Polygon"){let x=Uc(c.coordinates,y,_),w=Zh(r.geometry(),h,y,_);if(!ts(h,y))return!1;for(let I of w)if(!Eo(I,x))return!1}if(c.type==="MultiPolygon"){let x=qh(c.coordinates,y,_),w=Zh(r.geometry(),h,y,_);if(!ts(h,y))return!1;for(let I of w)if(!$h(I,x))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){let h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(c.type==="Polygon"){let x=Uc(c.coordinates,y,_),w=Wh(r.geometry(),h,y,_);if(!ts(h,y))return!1;for(let I of w)if(!Bc(I,x))return!1}if(c.type==="MultiPolygon"){let x=qh(c.coordinates,y,_),w=Wh(r.geometry(),h,y,_);if(!ts(h,y))return!1;for(let I of w)if(!Uf(I,x))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let jc=class{constructor(n=[],t=(r,c)=>r<c?-1:r>c?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:t,compare:r}=this,c=t[n];for(;n>0;){let h=n-1>>1,y=t[h];if(r(c,y)>=0)break;t[n]=y,n=h}t[n]=c}_down(n){let{data:t,compare:r}=this,c=this.length>>1,h=t[n];for(;n<c;){let y=1+(n<<1),_=y+1;if(_<this.length&&r(t[_],t[y])<0&&(y=_),r(t[y],h)>=0)break;t[n]=t[y],n=y}t[n]=h}};function Vc(n,t,r=0,c=n.length-1,h=jf){for(;c>r;){if(c-r>600){let w=c-r+1,I=t-r+1,A=Math.log(w),k=.5*Math.exp(2*A/3),z=.5*Math.sqrt(A*k*(w-k)/w)*(I-w/2<0?-1:1);Vc(n,t,Math.max(r,Math.floor(t-I*k/w+z)),Math.min(c,Math.floor(t+(w-I)*k/w+z)),h)}let y=n[t],_=r,x=c;for(is(n,r,t),h(n[c],y)>0&&is(n,r,c);_<x;){for(is(n,_,x),_++,x--;h(n[_],y)<0;)_++;for(;h(n[x],y)>0;)x--}h(n[r],y)===0?is(n,r,x):(x++,is(n,x,c)),x<=t&&(r=x+1),t<=x&&(c=x-1)}}function is(n,t,r){let c=n[t];n[t]=n[r],n[r]=c}function jf(n,t){return n<t?-1:n>t?1:0}function rs(n,t){if(n.length<=1)return[n];let r=[],c,h;for(let y of n){let _=Vf(y);_!==0&&(y.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(c&&r.push(c),c=[y]):c.push(y))}if(c&&r.push(c),t>1)for(let y=0;y<r.length;y++)r[y].length<=t||(Vc(r[y],t,1,r[y].length-1,Hh),r[y]=r[y].slice(0,t));return r}function Hh(n,t){return t.area-n.area}function Vf(n){let t=0;for(let r,c,h=0,y=n.length,_=y-1;h<y;_=h++)r=n[h],c=n[_],t+=(c.x-r.x)*(r.y+c.y);return t}let Kh=1/298.257223563,Xh=Kh*(2-Kh),$c=Math.PI/180;class Gc{constructor(t){let r=6378.137*$c*1e3,c=Math.cos(t*$c),h=1/(1-Xh*(1-c*c)),y=Math.sqrt(h);this.kx=r*y*c,this.ky=r*y*h*(1-Xh)}distance(t,r){let c=this.wrap(t[0]-r[0])*this.kx,h=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+h*h)}pointOnLine(t,r){let c,h,y,_,x=1/0;for(let w=0;w<t.length-1;w++){let I=t[w][0],A=t[w][1],k=this.wrap(t[w+1][0]-I)*this.kx,z=(t[w+1][1]-A)*this.ky,F=0;k===0&&z===0||(F=(this.wrap(r[0]-I)*this.kx*k+(r[1]-A)*this.ky*z)/(k*k+z*z),F>1?(I=t[w+1][0],A=t[w+1][1]):F>0&&(I+=k/this.kx*F,A+=z/this.ky*F)),k=this.wrap(r[0]-I)*this.kx,z=(r[1]-A)*this.ky;let N=k*k+z*z;N<x&&(x=N,c=I,h=A,y=w,_=F)}return{point:[c,h],index:y,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Yh(n,t){return t[0]-n[0]}function yl(n){return n[1]-n[0]+1}function Sn(n,t){return n[1]>=n[0]&&n[1]<t}function Lt(n,t){if(n[0]>n[1])return[null,null];let r=yl(n);if(t){if(r===2)return[n,null];let h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];let c=Math.floor(r/2)-1;return[[n[0],n[0]+c],[n[0]+c+1,n[1]]]}function qc(n,t){if(!Sn(t,n.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)es(r,n[c]);return r}function Zc(n){let t=[1/0,1/0,-1/0,-1/0];for(let r of n)for(let c of r)es(t,c);return t}function Jh(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Wc(n,t,r){if(!Jh(n)||!Jh(t))return NaN;let c=0,h=0;return n[2]<t[0]&&(c=t[0]-n[2]),n[0]>t[2]&&(c=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),r.distance([0,0],[c,h])}function Co(n,t,r){let c=r.pointOnLine(t,n);return r.distance(n,c.point)}function Hc(n,t,r,c,h){let y=Math.min(Co(n,[r,c],h),Co(t,[r,c],h)),_=Math.min(Co(r,[n,t],h),Co(c,[n,t],h));return Math.min(y,_)}function $f(n,t,r,c,h){if(!Sn(t,n.length)||!Sn(c,r.length))return 1/0;let y=1/0;for(let _=t[0];_<t[1];++_){let x=n[_],w=n[_+1];for(let I=c[0];I<c[1];++I){let A=r[I],k=r[I+1];if(ml(x,w,A,k))return 0;y=Math.min(y,Hc(x,w,A,k,h))}}return y}function Gf(n,t,r,c,h){if(!Sn(t,n.length)||!Sn(c,r.length))return NaN;let y=1/0;for(let _=t[0];_<=t[1];++_)for(let x=c[0];x<=c[1];++x)if(y=Math.min(y,h.distance(n[_],r[x])),y===0)return y;return y}function qf(n,t,r){if(Eo(n,t,!0))return 0;let c=1/0;for(let h of t){let y=h[0],_=h[h.length-1];if(y!==_&&(c=Math.min(c,Co(n,[_,y],r)),c===0))return c;let x=r.pointOnLine(h,n);if(c=Math.min(c,r.distance(n,x.point)),c===0)return c}return c}function Zf(n,t,r,c){if(!Sn(t,n.length))return NaN;for(let y=t[0];y<=t[1];++y)if(Eo(n[y],r,!0))return 0;let h=1/0;for(let y=t[0];y<t[1];++y){let _=n[y],x=n[y+1];for(let w of r)for(let I=0,A=w.length,k=A-1;I<A;k=I++){let z=w[k],F=w[I];if(ml(_,x,z,F))return 0;h=Math.min(h,Hc(_,x,z,F,c))}}return h}function Qh(n,t){for(let r of n)for(let c of r)if(Eo(c,t,!0))return!0;return!1}function Wf(n,t,r,c=1/0){let h=Zc(n),y=Zc(t);if(c!==1/0&&Wc(h,y,r)>=c)return c;if(ts(h,y)){if(Qh(n,t))return 0}else if(Qh(t,n))return 0;let _=1/0;for(let x of n)for(let w=0,I=x.length,A=I-1;w<I;A=w++){let k=x[A],z=x[w];for(let F of t)for(let N=0,$=F.length,Z=$-1;N<$;Z=N++){let X=F[Z],ce=F[N];if(ml(k,z,X,ce))return 0;_=Math.min(_,Hc(k,z,X,ce,r))}}return _}function ed(n,t,r,c,h,y){if(!y)return;let _=Wc(qc(c,y),h,r);_<t&&n.push([_,y,[0,0]])}function _l(n,t,r,c,h,y,_){if(!y||!_)return;let x=Wc(qc(c,y),qc(h,_),r);x<t&&n.push([x,y,_])}function vl(n,t,r,c,h=1/0){let y=Math.min(c.distance(n[0],r[0][0]),h);if(y===0)return y;let _=new jc([[0,[0,n.length-1],[0,0]]],Yh),x=Zc(r);for(;_.length>0;){let w=_.pop();if(w[0]>=y)continue;let I=w[1],A=t?50:100;if(yl(I)<=A){if(!Sn(I,n.length))return NaN;if(t){let k=Zf(n,I,r,c);if(isNaN(k)||k===0)return k;y=Math.min(y,k)}else for(let k=I[0];k<=I[1];++k){let z=qf(n[k],r,c);if(y=Math.min(y,z),y===0)return 0}}else{let k=Lt(I,t);ed(_,y,c,n,x,k[0]),ed(_,y,c,n,x,k[1])}}return y}function xl(n,t,r,c,h,y=1/0){let _=Math.min(y,h.distance(n[0],r[0]));if(_===0)return _;let x=new jc([[0,[0,n.length-1],[0,r.length-1]]],Yh);for(;x.length>0;){let w=x.pop();if(w[0]>=_)continue;let I=w[1],A=w[2],k=t?50:100,z=c?50:100;if(yl(I)<=k&&yl(A)<=z){if(!Sn(I,n.length)&&Sn(A,r.length))return NaN;let F;if(t&&c)F=$f(n,I,r,A,h),_=Math.min(_,F);else if(t&&!c){let N=n.slice(I[0],I[1]+1);for(let $=A[0];$<=A[1];++$)if(F=Co(r[$],N,h),_=Math.min(_,F),_===0)return _}else if(!t&&c){let N=r.slice(A[0],A[1]+1);for(let $=I[0];$<=I[1];++$)if(F=Co(n[$],N,h),_=Math.min(_,F),_===0)return _}else F=Gf(n,I,r,A,h),_=Math.min(_,F)}else{let F=Lt(I,t),N=Lt(A,c);_l(x,_,h,n,r,F[0],N[0]),_l(x,_,h,n,r,F[0],N[1]),_l(x,_,h,n,r,F[1],N[0]),_l(x,_,h,n,r,F[1],N[1])}}return _}function Kc(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Mo{constructor(t,r){this.type=Ve,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(So(t[1])){let c=t[1];if(c.type==="FeatureCollection")return new Mo(c,c.features.map((h=>Kc(h.geometry))).flat());if(c.type==="Feature")return new Mo(c,Kc(c.geometry));if("type"in c&&"coordinates"in c)return new Mo(c,Kc(c))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,c){let h=r.geometry(),y=h.flat().map((w=>fl([w.x,w.y],r.canonical)));if(h.length===0)return NaN;let _=new Gc(y[0][1]),x=1/0;for(let w of c){switch(w.type){case"Point":x=Math.min(x,xl(y,!1,[w.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,xl(y,!1,w.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,vl(y,!1,w.coordinates,_,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,c){let h=r.geometry(),y=h.flat().map((w=>fl([w.x,w.y],r.canonical)));if(h.length===0)return NaN;let _=new Gc(y[0][1]),x=1/0;for(let w of c){switch(w.type){case"Point":x=Math.min(x,xl(y,!0,[w.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,xl(y,!0,w.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,vl(y,!0,w.coordinates,_,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,c){let h=r.geometry();if(h.length===0||h[0].length===0)return NaN;let y=rs(h,0).map((w=>w.map((I=>I.map((A=>fl([A.x,A.y],r.canonical))))))),_=new Gc(y[0][0][0][1]),x=1/0;for(let w of c)for(let I of y){switch(w.type){case"Point":x=Math.min(x,vl([w.coordinates],!1,I,_,x));break;case"LineString":x=Math.min(x,vl(w.coordinates,!0,I,_,x));break;case"Polygon":x=Math.min(x,Wf(I,w.coordinates,_,x))}if(x===0)return x}return x})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ns{constructor(t){this.type=mt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let c=t[1];return c==null?r.error("Global state property must be defined."):typeof c!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ns(c)}evaluate(t){var r;let c=(r=t.globals)===null||r===void 0?void 0:r.globalState;return c&&Object.keys(c).length!==0?ca(c,this.key):null}eachChild(){}outputDefined(){return!1}}let pa={"==":Vh,"!=":hl,">":Oc,"<":Df,">=":Of,"<=":zf,array:gr,at:cl,boolean:gr,case:ha,coalesce:Ya,collator:dl,format:Po,image:Nc,in:ul,"index-of":Lr,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:pl,let:Wa,literal:Tn,match:Ei,number:gr,"number-format":Fc,object:gr,slice:Ha,step:ai,string:gr,"to-boolean":sn,"to-color":sn,"to-number":sn,"to-string":sn,var:ll,within:Ao,distance:Mo,"global-state":ns};class Sr{constructor(t,r,c,h){this.name=t,this.type=r,this._evaluate=c,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let c=t[0],h=Sr.definitions[c];if(!h)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let y=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter((([I])=>!Array.isArray(I)||I.length===t.length-1)),w=null;for(let[I,A]of x){w=new ua(r.registry,bl,r.path,null,r.scope);let k=[],z=!1;for(let F=1;F<t.length;F++){let N=t[F],$=Array.isArray(I)?I[F-1]:I.type,Z=w.parse(N,1+k.length,$);if(!Z){z=!0;break}k.push(Z)}if(!z)if(Array.isArray(I)&&I.length!==k.length)w.error(`Expected ${I.length} arguments, but found ${k.length} instead.`);else{for(let F=0;F<k.length;F++){let N=Array.isArray(I)?I[F]:I.type,$=k[F];w.concat(F+1).checkSubtype(N,$.type)}if(w.errors.length===0)return new Sr(c,y,A,k)}}if(x.length===1)r.errors.push(...w.errors);else{let I=(x.length?x:_).map((([k])=>{return z=k,Array.isArray(z)?`(${z.map(Vt).join(", ")})`:`(${Vt(z.type)}...)`;var z})).join(" | "),A=[];for(let k=1;k<t.length;k++){let z=r.parse(t[k],1+A.length);if(!z)return null;A.push(Vt(z.type))}r.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){Sr.definitions=r;for(let c in r)t[c]=Sr}}function td(n,[t,r,c,h]){t=t.evaluate(n),r=r.evaluate(n),c=c.evaluate(n);let y=h?h.evaluate(n):1,_=Zt(t,r,c,y);if(_)throw new $t(_);return new wt(t/255,r/255,c/255,y,!1)}function id(n,t){return n in t}function Xc(n,t){let r=t[n];return r===void 0?null:r}function ko(n){return{type:n}}function bl(n){if(n instanceof ll)return bl(n.boundExpression);if(n instanceof Sr&&n.name==="error"||n instanceof dl||n instanceof Ao||n instanceof Mo||n instanceof ns)return!1;let t=n instanceof sn||n instanceof gr,r=!0;return n.eachChild((c=>{r=t?r&&bl(c):r&&c instanceof Tn})),!!r&&wl(n)&&Tl(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function wl(n){if(n instanceof Sr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ao||n instanceof Mo)return!1;let t=!0;return n.eachChild((r=>{t&&!wl(r)&&(t=!1)})),t}function os(n){if(n instanceof Sr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!os(r)&&(t=!1)})),t}function Tl(n,t){if(n instanceof Sr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((c=>{r&&!Tl(c,t)&&(r=!1)})),r}function rd(n){return{result:"success",value:n}}function fa(n){return{result:"error",value:n}}function Jn(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function nd(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Yc(n){return!!n.expression&&n.expression.interpolated}function It(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function as(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&at(n)===Wn}function Hf(n){return n}function od(n,t){let r=n.stops&&typeof n.stops[0][0]=="object",c=r||!(r||n.property!==void 0),h=n.type||(Yc(t)?"exponential":"interval"),y=(function(A){switch(A.type){case"color":return wt.parse;case"padding":return Pi.parse;case"numberArray":return Ji.parse;case"colorArray":return fi.parse;default:return null}})(t);if(y&&((n=Gi({},n)).stops&&(n.stops=n.stops.map((A=>[A[0],y(A[1])]))),n.default=y(n.default?n.default:t.default)),n.colorSpace&&(_=n.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var _;let x=(function(A){switch(A){case"exponential":return sd;case"interval":return Kf;case"categorical":return ad;case"identity":return Xf;default:throw new Error(`Unknown function type "${A}"`)}})(h),w,I;if(h==="categorical"){w=Object.create(null);for(let A of n.stops)w[A[0]]=A[1];I=typeof n.stops[0][0]}if(r){let A={},k=[];for(let N=0;N<n.stops.length;N++){let $=n.stops[N],Z=$[0].zoom;A[Z]===void 0&&(A[Z]={zoom:Z,type:n.type,property:n.property,default:n.default,stops:[]},k.push(Z)),A[Z].stops.push([$[0].value,$[1]])}let z=[];for(let N of k)z.push([A[N].zoom,od(A[N],t)]);let F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Fi.interpolationFactor.bind(void 0,F),zoomStops:z.map((N=>N[0])),evaluate:({zoom:N},$)=>sd({stops:z,base:n.base},t,N).evaluate(N,$)}}if(c){let A=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Fi.interpolationFactor.bind(void 0,A),zoomStops:n.stops.map((k=>k[0])),evaluate:({zoom:k})=>x(n,t,k,w,I)}}return{kind:"source",evaluate(A,k){let z=k&&k.properties?k.properties[n.property]:void 0;return z===void 0?Qn(n.default,t.default):x(n,t,z,w,I)}}}function Qn(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function ad(n,t,r,c,h){return Qn(typeof r===h?c[r]:void 0,n.default,t.default)}function Kf(n,t,r){if(It(r)!=="number")return Qn(n.default,t.default);let c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];let h=Io(n.stops.map((y=>y[0])),r);return n.stops[h][1]}function sd(n,t,r){let c=n.base!==void 0?n.base:1;if(It(r)!=="number")return Qn(n.default,t.default);let h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];let y=Io(n.stops.map((A=>A[0])),r),_=(function(A,k,z,F){let N=F-z,$=A-z;return N===0?0:k===1?$/N:(Math.pow(k,$)-1)/(Math.pow(k,N)-1)})(r,c,n.stops[y][0],n.stops[y+1][0]),x=n.stops[y][1],w=n.stops[y+1][1],I=ln[t.type]||Hf;return typeof x.evaluate=="function"?{evaluate(...A){let k=x.evaluate.apply(void 0,A),z=w.evaluate.apply(void 0,A);if(k!==void 0&&z!==void 0)return I(k,z,_,n.colorSpace)}}:I(x,w,_,n.colorSpace)}function Xf(n,t,r){switch(t.type){case"color":r=wt.parse(r);break;case"formatted":r=Yi.fromString(r.toString());break;case"resolvedImage":r=mr.fromString(r.toString());break;case"padding":r=Pi.parse(r);break;case"colorArray":r=fi.parse(r);break;case"numberArray":r=Ji.parse(r);break;default:It(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Qn(r,n.default,t.default)}Sr.register(pa,{error:[{kind:"error"},[xt],(n,[t])=>{throw new $t(t.evaluate(n))}],typeof:[xt,[mt],(n,[t])=>Vt(at(t.evaluate(n)))],"to-rgba":[sr(Ve,4),[Oi],(n,[t])=>{let[r,c,h,y]=t.evaluate(n).rgb;return[255*r,255*c,255*h,y]}],rgb:[Oi,[Ve,Ve,Ve],td],rgba:[Oi,[Ve,Ve,Ve,Ve],td],has:{type:yt,overloads:[[[xt],(n,[t])=>id(t.evaluate(n),n.properties())],[[xt,Wn],(n,[t,r])=>id(t.evaluate(n),r.evaluate(n))]]},get:{type:mt,overloads:[[[xt],(n,[t])=>Xc(t.evaluate(n),n.properties())],[[xt,Wn],(n,[t,r])=>Xc(t.evaluate(n),r.evaluate(n))]]},"feature-state":[mt,[xt],(n,[t])=>Xc(t.evaluate(n),n.featureState||{})],properties:[Wn,[],n=>n.properties()],"geometry-type":[xt,[],n=>n.geometryType()],id:[mt,[],n=>n.id()],zoom:[Ve,[],n=>n.globals.zoom],"heatmap-density":[Ve,[],n=>n.globals.heatmapDensity||0],elevation:[Ve,[],n=>n.globals.elevation||0],"line-progress":[Ve,[],n=>n.globals.lineProgress||0],accumulated:[mt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ve,ko(Ve),(n,t)=>{let r=0;for(let c of t)r+=c.evaluate(n);return r}],"*":[Ve,ko(Ve),(n,t)=>{let r=1;for(let c of t)r*=c.evaluate(n);return r}],"-":{type:Ve,overloads:[[[Ve,Ve],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Ve],(n,[t])=>-t.evaluate(n)]]},"/":[Ve,[Ve,Ve],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Ve,[Ve,Ve],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Ve,[Ve],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Ve,[Ve],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Ve,[Ve],(n,[t])=>Math.log(t.evaluate(n))],log2:[Ve,[Ve],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Ve,[Ve],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Ve,[Ve],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Ve,[Ve],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Ve,[Ve],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Ve,[Ve],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Ve,[Ve],(n,[t])=>Math.atan(t.evaluate(n))],min:[Ve,ko(Ve),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[Ve,ko(Ve),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[Ve,[Ve],(n,[t])=>Math.abs(t.evaluate(n))],round:[Ve,[Ve],(n,[t])=>{let r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ve,[Ve],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Ve,[Ve],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[yt,[xt,mt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[yt,[mt],(n,[t])=>n.id()===t.value],"filter-type-==":[yt,[xt],(n,[t])=>n.geometryType()===t.value],"filter-<":[yt,[xt,mt],(n,[t,r])=>{let c=n.properties()[t.value],h=r.value;return typeof c==typeof h&&c<h}],"filter-id-<":[yt,[mt],(n,[t])=>{let r=n.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[yt,[xt,mt],(n,[t,r])=>{let c=n.properties()[t.value],h=r.value;return typeof c==typeof h&&c>h}],"filter-id->":[yt,[mt],(n,[t])=>{let r=n.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[yt,[xt,mt],(n,[t,r])=>{let c=n.properties()[t.value],h=r.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[yt,[mt],(n,[t])=>{let r=n.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[yt,[xt,mt],(n,[t,r])=>{let c=n.properties()[t.value],h=r.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[yt,[mt],(n,[t])=>{let r=n.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[yt,[mt],(n,[t])=>t.value in n.properties()],"filter-has-id":[yt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[yt,[sr(xt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[yt,[sr(mt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[yt,[xt,sr(mt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[yt,[xt,sr(mt)],(n,[t,r])=>(function(c,h,y,_){for(;y<=_;){let x=y+_>>1;if(h[x]===c)return!0;h[x]>c?_=x-1:y=x+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[ko(yt),(n,t)=>{for(let r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[ko(yt),(n,t)=>{for(let r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[yt,[yt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[yt,[xt],(n,[t])=>{let r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[xt,[xt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[xt,[xt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[xt,ko(mt),(n,t)=>t.map((r=>dt(r.evaluate(n)))).join("")],"resolved-locale":[xt,[il],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Jc{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new Dc,this._defaultValue=r?(function(c){if(c.type==="color"&&as(c.default))return new wt(0,0,0,0);switch(c.type){case"color":return wt.parse(c.default)||null;case"padding":return Pi.parse(c.default)||null;case"numberArray":return Ji.parse(c.default)||null;case"colorArray":return fi.parse(c.default)||null;case"variableAnchorOffsetCollection":return Qi.parse(c.default)||null;case"projectionDefinition":return qi.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,c,h,y,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,h,y,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new $t(`Expected value to be one of ${Object.keys(this._enumValues).map((w=>JSON.stringify(w))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Sl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in pa}function ss(n,t){let r=new ua(pa,bl,[],t?(function(h){let y={color:Oi,string:xt,number:Ve,enum:xt,boolean:yt,formatted:Hn,padding:rl,numberArray:oa,colorArray:on,projectionDefinition:xo,resolvedImage:oi,variableAnchorOffsetCollection:nl};return h.type==="array"?sr(y[h.value]||mt,h.length):y[h.type]})(t):void 0),c=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?rd(new Jc(c,t)):fa(r.errors)}class ls{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!os(r.expression),this.globalStateRefs=hs(r.expression)}evaluateWithoutErrorHandling(t,r,c,h,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,h,y,_)}evaluate(t,r,c,h,y,_){return this._styleExpression.evaluate(t,r,c,h,y,_)}}class Qc{constructor(t,r,c,h){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!os(r.expression),this.globalStateRefs=hs(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,r,c,h,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,h,y,_)}evaluate(t,r,c,h,y,_){return this._styleExpression.evaluate(t,r,c,h,y,_)}interpolationFactor(t,r,c){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,t,r,c):0}}function ld(n,t){let r=ss(n,t);if(r.result==="error")return r;let c=r.value.expression,h=wl(c);if(!h&&!Jn(t))return fa([new Qt("","data expressions not supported")]);let y=Tl(c,["zoom"]);if(!y&&!nd(t))return fa([new Qt("","zoom expressions not supported")]);let _=us(c);return _||y?_ instanceof Qt?fa([_]):_ instanceof Fi&&!Yc(t)?fa([new Qt("",'"interpolate" expressions cannot be used with this property')]):rd(_?new Qc(h?"camera":"composite",r.value,_.labels,_ instanceof Fi?_.interpolation:void 0):new ls(h?"constant":"source",r.value)):fa([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cs{constructor(t,r){this._parameters=t,this._specification=r,Gi(this,od(this._parameters,this._specification))}static deserialize(t){return new cs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function us(n){let t=null;if(n instanceof Wa)t=us(n.result);else if(n instanceof Ya){for(let r of n.args)if(t=us(r),t)break}else(n instanceof ai||n instanceof Fi)&&n.input instanceof Sr&&n.input.name==="zoom"&&(t=n);return t instanceof Qt||n.eachChild((r=>{let c=us(r);c instanceof Qt?t=c:!t&&c?t=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function hs(n,t=new Set){return n instanceof ns&&t.add(n.key),n.eachChild((r=>{hs(r,t)})),t}function Il(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(let t of n.slice(1))if(!Il(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let eu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ro(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Il(n)||(n=Lo(n));let t=ss(n,eu);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,c,h)=>t.value.evaluate(r,c,{},h),needGeometry:Pl(n),getGlobalStateRefs:()=>hs(t.value.expression)}}function tu(n,t){return n<t?-1:n>t?1:0}function Pl(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Pl(n[t]))return!0;return!1}function Lo(n){if(!n)return!0;let t=n[0];return n.length<=1?t!=="any":t==="=="?iu(n[1],n[2],"=="):t==="!="?El(iu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?iu(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Lo))):t==="all"?["all"].concat(n.slice(1).map(Lo)):t==="none"?["all"].concat(n.slice(1).map(Lo).map(El)):t==="in"?cd(n[1],n.slice(2)):t==="!in"?El(cd(n[1],n.slice(2))):t==="has"?ud(n[1]):t!=="!has"||El(ud(n[1]));var r}function iu(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function cd(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(tu)]]:["filter-in-small",n,["literal",t]]}}function ud(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function El(n){return["!",n]}function ru(n){let t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(let y of n)h+=`${ru(y)},`;return`${h}]`}let r=Object.keys(n).sort(),c="{";for(let h=0;h<r.length;h++)c+=`${JSON.stringify(r[h])}:${ru(n[r[h]])},`;return`${c}}`}function Yf(n){let t="";for(let r of ut)t+=`/${ru(n[r])}`;return t}function nu(n){let t=n.value;return t?[new De(n.key,t,"constants have been deprecated as of v8")]:[]}function ei(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function cn(n){if(Array.isArray(n))return n.map(cn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){let t={};for(let r in n)t[r]=cn(n[r]);return t}return ei(n)}function Ir(n){let t=n.key,r=n.value,c=n.valueSpec||{},h=n.objectElementValidators||{},y=n.style,_=n.styleSpec,x=n.validateSpec,w=[],I=It(r);if(I!=="object")return[new De(t,r,`object expected, ${I} found`)];for(let A in r){let k=A.split(".")[0],z=ca(c,k)||c["*"],F;if(ca(h,k))F=h[k];else if(ca(c,k))F=x;else if(h["*"])F=h["*"];else{if(!c["*"]){w.push(new De(t,r[A],`unknown property "${A}"`));continue}F=x}w=w.concat(F({key:(t&&`${t}.`)+A,value:r[A],valueSpec:z,style:y,styleSpec:_,object:r,objectKey:A,validateSpec:x},r))}for(let A in c)h[A]||c[A].required&&c[A].default===void 0&&r[A]===void 0&&w.push(new De(t,r,`missing required property "${A}"`));return w}function Al(n){let t=n.value,r=n.valueSpec,c=n.style,h=n.styleSpec,y=n.key,_=n.arrayElementValidator||n.validateSpec;if(It(t)!=="array")return[new De(y,t,`array expected, ${It(t)} found`)];if(r.length&&t.length!==r.length)return[new De(y,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new De(y,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let x={type:r.value,values:r.values};h.$version<7&&(x.function=r.function),It(r.value)==="object"&&(x=r.value);let w=[];for(let I=0;I<t.length;I++)w=w.concat(_({array:t,arrayIndex:I,value:t[I],valueSpec:x,validateSpec:n.validateSpec,style:c,styleSpec:h,key:`${y}[${I}]`}));return w}function ds(n){let t=n.key,r=n.value,c=n.valueSpec,h=It(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new De(t,r,`number expected, ${h} found`)]:"minimum"in c&&r<c.minimum?[new De(t,r,`${r} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&r>c.maximum?[new De(t,r,`${r} is greater than the maximum value ${c.maximum}`)]:[]}function hd(n){let t=n.valueSpec,r=ei(n.value.type),c,h,y,_={},x=r!=="categorical"&&n.value.property===void 0,w=!x,I=It(n.value.stops)==="array"&&It(n.value.stops[0])==="array"&&It(n.value.stops[0][0])==="object",A=Ir({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new De(F.key,F.value,'identity function may not have a "stops" property')];let N=[],$=F.value;return N=N.concat(Al({key:F.key,value:$,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),It($)==="array"&&$.length===0&&N.push(new De(F.key,$,"array must have at least one stop")),N},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&x&&A.push(new De(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||A.push(new De(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Yc(n.valueSpec)&&A.push(new De(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!Jn(n.valueSpec)?A.push(new De(n.key,n.value,"property functions not supported")):x&&!nd(n.valueSpec)&&A.push(new De(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!I||n.value.property!==void 0||A.push(new De(n.key,n.value,'"property" property is required')),A;function k(F){let N=[],$=F.value,Z=F.key;if(It($)!=="array")return[new De(Z,$,`array expected, ${It($)} found`)];if($.length!==2)return[new De(Z,$,`array length 2 expected, length ${$.length} found`)];if(I){if(It($[0])!=="object")return[new De(Z,$,`object expected, ${It($[0])} found`)];if($[0].zoom===void 0)return[new De(Z,$,"object stop key must have zoom")];if($[0].value===void 0)return[new De(Z,$,"object stop key must have value")];if(y&&y>ei($[0].zoom))return[new De(Z,$[0].zoom,"stop zoom values must appear in ascending order")];ei($[0].zoom)!==y&&(y=ei($[0].zoom),h=void 0,_={}),N=N.concat(Ir({key:`${Z}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:ds,value:z}}))}else N=N.concat(z({key:`${Z}[0]`,value:$[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},$));return Sl(cn($[1]))?N.concat([new De(`${Z}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(F.validateSpec({key:`${Z}[1]`,value:$[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function z(F,N){let $=It(F.value),Z=ei(F.value),X=F.value!==null?F.value:N;if(c){if($!==c)return[new De(F.key,X,`${$} stop domain type must match previous stop domain type ${c}`)]}else c=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new De(F.key,X,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let ce=`number expected, ${$} found`;return Jn(t)&&r===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(F.key,X,ce)]}return r!=="categorical"||$!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&$==="number"&&h!==void 0&&Z<h?[new De(F.key,X,"stop domain values must appear in ascending order")]:(h=Z,r==="categorical"&&Z in _?[new De(F.key,X,"stop domain values must be unique")]:(_[Z]=!0,[])):[new De(F.key,X,`integer expected, found ${Z}`)]}}function Do(n){let t=(n.expressionContext==="property"?ld:ss)(cn(n.value),n.valueSpec);if(t.result==="error")return t.value.map((c=>new De(`${n.key}${c.key}`,n.value,c.message)));let r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new De(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!os(r))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!os(r))return[new De(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Tl(r,["zoom","feature-state"]))return[new De(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!wl(r))return[new De(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cl(n){let t=n.key,r=n.value,c=It(r);return c!=="string"?[new De(t,r,`color expected, ${c} found`)]:wt.parse(String(r))?[]:[new De(t,r,`color expected, "${r}" found`)]}function In(n){let t=n.key,r=n.value,c=n.valueSpec,h=[];return Array.isArray(c.values)?c.values.indexOf(ei(r))===-1&&h.push(new De(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(ei(r))===-1&&h.push(new De(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function ou(n){return Il(cn(n.value))?Do(Gi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):dd(n)}function dd(n){let t=n.value,r=n.key;if(It(t)!=="array")return[new De(r,t,`array expected, ${It(t)} found`)];let c=n.styleSpec,h,y=[];if(t.length<1)return[new De(r,t,"filter array must have at least 1 element")];switch(y=y.concat(In({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),ei(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ei(t[1])==="$type"&&y.push(new De(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new De(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=It(t[1]),h!=="string"&&y.push(new De(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=It(t[_]),ei(t[1])==="$type"?y=y.concat(In({key:`${r}[${_}]`,value:t[_],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&y.push(new De(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)y=y.concat(dd({key:`${r}[${_}]`,value:t[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=It(t[1]),t.length!==2?y.push(new De(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&y.push(new De(`${r}[1]`,t[1],`string expected, ${h} found`))}return y}function pd(n,t){let r=n.key,c=n.validateSpec,h=n.style,y=n.styleSpec,_=n.value,x=n.objectKey,w=y[`${t}_${n.layerType}`];if(!w)return[];let I=x.match(/^(.*)-transition$/);if(t==="paint"&&I&&w[I[1]]&&w[I[1]].transition)return c({key:r,value:_,valueSpec:y.transition,style:h,styleSpec:y});let A=n.valueSpec||w[x];if(!A)return[new De(r,_,`unknown property "${x}"`)];let k;if(It(_)==="string"&&Jn(A)&&!A.tokens&&(k=/^{([^}]+)}$/.exec(_)))return[new De(r,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];let z=[];return n.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&z.push(new De(r,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&as(cn(_))&&ei(_.type)==="identity"&&z.push(new De(r,_,'"text-font" does not support identity functions'))),z.concat(c({key:n.key,value:_,valueSpec:A,style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:x}))}function fd(n){return pd(n,"paint")}function md(n){return pd(n,"layout")}function gd(n){let t=[],r=n.value,c=n.key,h=n.style,y=n.styleSpec;if(It(r)!=="object")return[new De(c,r,`object expected, ${It(r)} found`)];r.type||r.ref||t.push(new De(c,r,'either "type" or "ref" is required'));let _=ei(r.type),x=ei(r.ref);if(r.id){let w=ei(r.id);for(let I=0;I<n.arrayIndex;I++){let A=h.layers[I];ei(A.id)===w&&t.push(new De(c,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach((I=>{I in r&&t.push(new De(c,r[I],`"${I}" is prohibited for ref layers`))})),h.layers.forEach((I=>{ei(I.id)===x&&(w=I)})),w?w.ref?t.push(new De(c,r.ref,"ref cannot reference another ref layer")):_=ei(w.type):t.push(new De(c,r.ref,`ref layer "${x}" not found`))}else if(_!=="background")if(r.source){let w=h.sources&&h.sources[r.source],I=w&&ei(w.type);w?I==="vector"&&_==="raster"?t.push(new De(c,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"||I!=="raster-dem"&&_==="color-relief"?t.push(new De(c,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?t.push(new De(c,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new De(c,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&w.lineMetrics||t.push(new De(c,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new De(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new De(c,r.source,`source "${r.source}" not found`))}else t.push(new De(c,r,'missing required property "source"'));return t=t.concat(Ir({key:c,value:r,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:r.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:ou,layout:w=>Ir({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":I=>md(Gi({layerType:_},I))}}),paint:w=>Ir({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":I=>fd(Gi({layerType:_},I))}})}})),t}function zr(n){let t=n.value,r=n.key,c=It(t);return c!=="string"?[new De(r,t,`string expected, ${c} found`)]:[]}let ma={promoteId:function({key:n,value:t}){if(It(t)==="string")return zr({key:n,value:t});{let r=[];for(let c in t)r.push(...zr({key:`${n}.${c}`,value:t[c]}));return r}}};function lr(n){let t=n.value,r=n.key,c=n.styleSpec,h=n.style,y=n.validateSpec;if(!t.type)return[new De(r,t,'"type" is required')];let _=ei(t.type),x;switch(_){case"vector":case"raster":return x=Ir({key:r,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:ma,validateSpec:y}),x;case"raster-dem":return x=(function(w){var I;let A=(I=w.sourceName)!==null&&I!==void 0?I:"",k=w.value,z=w.styleSpec,F=z.source_raster_dem,N=w.style,$=[],Z=It(k);if(k===void 0)return $;if(Z!=="object")return $.push(new De("source_raster_dem",k,`object expected, ${Z} found`)),$;let X=ei(k.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],ie=w.value.encoding?`"${w.value.encoding}"`:"Default";for(let ne in k)!X&&ce.includes(ne)?$.push(new De(ne,k[ne],`In "${A}": "${ne}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):F[ne]?$=$.concat(w.validateSpec({key:ne,value:k[ne],valueSpec:F[ne],validateSpec:w.validateSpec,style:N,styleSpec:z})):$.push(new De(ne,k[ne],`unknown property "${ne}"`));return $})({sourceName:r,value:t,style:n.style,styleSpec:c,validateSpec:y}),x;case"geojson":if(x=Ir({key:r,value:t,valueSpec:c.source_geojson,style:h,styleSpec:c,validateSpec:y,objectElementValidators:ma}),t.cluster)for(let w in t.clusterProperties){let[I,A]=t.clusterProperties[w],k=typeof I=="string"?[I,["accumulated"],["get",w]]:I;x.push(...Do({key:`${r}.${w}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Do({key:`${r}.${w}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return x;case"video":return Ir({key:r,value:t,valueSpec:c.source_video,style:h,validateSpec:y,styleSpec:c});case"image":return Ir({key:r,value:t,valueSpec:c.source_image,style:h,validateSpec:y,styleSpec:c});case"canvas":return[new De(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ga(n){let t=n.value,r=n.styleSpec,c=r.light,h=n.style,y=[],_=It(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new De("light",t,`object expected, ${_} found`)]),y;for(let x in t){let w=x.match(/^(.*)-transition$/);y=y.concat(w&&c[w[1]]&&c[w[1]].transition?n.validateSpec({key:x,value:t[x],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new De(x,t[x],`unknown property "${x}"`)])}return y}function au(n){let t=n.value,r=n.styleSpec,c=r.sky,h=n.style,y=It(t);if(t===void 0)return[];if(y!=="object")return[new De("sky",t,`object expected, ${y} found`)];let _=[];for(let x in t)_=_.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],style:h,styleSpec:r}):[new De(x,t[x],`unknown property "${x}"`)]);return _}function yd(n){let t=n.value,r=n.styleSpec,c=r.terrain,h=n.style,y=[],_=It(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new De("terrain",t,`object expected, ${_} found`)]),y;for(let x in t)y=y.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new De(x,t[x],`unknown property "${x}"`)]);return y}function _d(n){let t=[],r=n.value,c=n.key;if(Array.isArray(r)){let h=[],y=[];for(let _ in r)r[_].id&&h.includes(r[_].id)&&t.push(new De(c,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),h.push(r[_].id),r[_].url&&y.includes(r[_].url)&&t.push(new De(c,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),y.push(r[_].url),t=t.concat(Ir({key:`${c}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return zr({key:c,value:r})}function ya(n){return t=n.value,t&&t.constructor===Object?[]:[new De(n.key,n.value,`object expected, ${It(n.value)} found`)];var t}let su={"*":()=>[],array:Al,boolean:function(n){let t=n.value,r=n.key,c=It(t);return c!=="boolean"?[new De(r,t,`boolean expected, ${c} found`)]:[]},number:ds,color:Cl,constants:nu,enum:In,filter:ou,function:hd,layer:gd,object:Ir,source:lr,light:ga,sky:au,terrain:yd,projection:function(n){let t=n.value,r=n.styleSpec,c=r.projection,h=n.style,y=It(t);if(t===void 0)return[];if(y!=="object")return[new De("projection",t,`object expected, ${y} found`)];let _=[];for(let x in t)_=_.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],style:h,styleSpec:r}):[new De(x,t[x],`unknown property "${x}"`)]);return _},projectionDefinition:function(n){let t=n.key,r=n.value;r=r instanceof String?r.valueOf():r;let c=It(r);return c!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(r)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(r)?["array","string"].includes(c)?[]:[new De(t,r,`projection expected, invalid type "${c}" found`)]:[new De(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:zr,formatted:function(n){return zr(n).length===0?[]:Do(n)},resolvedImage:function(n){return zr(n).length===0?[]:Do(n)},padding:function(n){let t=n.key,r=n.value;if(It(r)==="array"){if(r.length<1||r.length>4)return[new De(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let c={type:"number"},h=[];for(let y=0;y<r.length;y++)h=h.concat(n.validateSpec({key:`${t}[${y}]`,value:r[y],validateSpec:n.validateSpec,valueSpec:c}));return h}return ds({key:t,value:r,valueSpec:{}})},numberArray:function(n){let t=n.key,r=n.value;if(It(r)==="array"){let c={type:"number"};if(r.length<1)return[new De(t,r,"array length at least 1 expected, length 0 found")];let h=[];for(let y=0;y<r.length;y++)h=h.concat(n.validateSpec({key:`${t}[${y}]`,value:r[y],validateSpec:n.validateSpec,valueSpec:c}));return h}return ds({key:t,value:r,valueSpec:{}})},colorArray:function(n){let t=n.key,r=n.value;if(It(r)==="array"){if(r.length<1)return[new De(t,r,"array length at least 1 expected, length 0 found")];let c=[];for(let h=0;h<r.length;h++)c=c.concat(Cl({key:`${t}[${h}]`,value:r[h]}));return c}return Cl({key:t,value:r})},variableAnchorOffsetCollection:function(n){let t=n.key,r=n.value,c=It(r),h=n.styleSpec;if(c!=="array"||r.length<1||r.length%2!=0)return[new De(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let _=0;_<r.length;_+=2)y=y.concat(In({key:`${t}[${_}]`,value:r[_],valueSpec:h.layout_symbol["text-anchor"]})),y=y.concat(Al({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return y},sprite:_d,state:ya};function _a(n){let t=n.value,r=n.valueSpec,c=n.styleSpec;return n.validateSpec=_a,r.expression&&as(ei(t))?hd(n):r.expression&&Sl(cn(t))?Do(n):r.type&&su[r.type]?su[r.type](n):Ir(Gi({},n,{valueSpec:r.type?c[r.type]:r}))}function vd(n){let t=n.value,r=n.key,c=zr(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{range}" token'))),c}function cr(n,t=fe){let r=[];return r=r.concat(_a({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:_a,objectElementValidators:{glyphs:vd,"*":()=>[]}})),n.constants&&(r=r.concat(nu({key:"constants",value:n.constants}))),va(r)}function Or(n){return function(t){return n({...t,validateSpec:_a})}}function va(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function Fr(n){return function(...t){return va(n.apply(this,t))}}cr.source=Fr(Or(lr)),cr.sprite=Fr(Or(_d)),cr.glyphs=Fr(Or(vd)),cr.light=Fr(Or(ga)),cr.sky=Fr(Or(au)),cr.terrain=Fr(Or(yd)),cr.state=Fr(Or(ya)),cr.layer=Fr(Or(gd)),cr.filter=Fr(Or(ou)),cr.paintProperty=Fr(Or(fd)),cr.layoutProperty=Fr(Or(md));let xa=cr,Jf=xa.light,ps=xa.sky,Qf=xa.paintProperty,em=xa.layoutProperty;function fs(n,t){let r=!1;if(t&&t.length)for(let c of t)n.fire(new Pe(new Error(c.message))),r=!0;return r}class ms{constructor(t,r,c){let h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(c=_[2]);for(let w=0;w<this.d*this.d;w++){let I=_[3+w],A=_[3+w+1];h.push(I===A?null:_.subarray(I,A))}let x=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=r+2*c;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=c,this.scale=r/t,this.uid=0;let y=c/r*t;this.min=-y,this.max=t+y}insert(t,r,c,h,y){this._forEachCell(r,c,h,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,c,h,y,_){this.cells[y].push(_)}query(t,r,c,h,y){let _=this.min,x=this.max;if(t<=_&&r<=_&&x<=c&&x<=h&&!y)return Array.prototype.slice.call(this.keys);{let w=[];return this._forEachCell(t,r,c,h,this._queryCell,w,{},y),w}}_queryCell(t,r,c,h,y,_,x,w){let I=this.cells[y];if(I!==null){let A=this.keys,k=this.bboxes;for(let z=0;z<I.length;z++){let F=I[z];if(x[F]===void 0){let N=4*F;(w?w(k[N+0],k[N+1],k[N+2],k[N+3]):t<=k[N+2]&&r<=k[N+3]&&c>=k[N+0]&&h>=k[N+1])?(x[F]=!0,_.push(A[F])):x[F]=!1}}}}_forEachCell(t,r,c,h,y,_,x,w){let I=this._convertToCellCoord(t),A=this._convertToCellCoord(r),k=this._convertToCellCoord(c),z=this._convertToCellCoord(h);for(let F=I;F<=k;F++)for(let N=A;N<=z;N++){let $=this.d*N+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(N),this._convertFromCellCoord(F+1),this._convertFromCellCoord(N+1)))&&y.call(this,t,r,c,h,$,_,x,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,c=0;for(let _=0;_<this.cells.length;_++)c+=this.cells[_].length;let h=new Int32Array(r+c+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let y=r;for(let _=0;_<t.length;_++){let x=t[_];h[3+_]=y,h.set(x,y),y+=x.length}return h[3+t.length]=y,h.set(this.keys,y),y+=this.keys.length,h[3+t.length+1]=y,h.set(this.bboxes,y),y+=this.bboxes.length,h.buffer}static serialize(t,r){let c=t.toArrayBuffer();return r&&r.push(c),{buffer:c}}static deserialize(t){return new ms(t.buffer)}}let Nr={};function Ge(n,t,r={}){if(Nr[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Nr[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Ge("Object",Object),Ge("Set",Set),Ge("TransferableGridIndex",ms),Ge("Color",wt),Ge("Error",Error),Ge("AJAXError",ee),Ge("ResolvedImage",mr),Ge("StylePropertyFunction",cs),Ge("StyleExpression",Jc,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",Qc),Ge("ZoomConstantExpression",ls),Ge("CompoundExpression",Sr,{omit:["_evaluate"]});for(let n in pa)pa[n]._classRegistryKey||Ge(`Expression_${n}`,pa[n]);function lu(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ml(n){return n.$name||n.constructor._classRegistryKey}function cu(n){return!(function(t){if(t===null||typeof t!="object")return!1;let r=Ml(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||lu(n)||rn(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function ba(n,t){if(cu(n))return(lu(n)||rn(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){let y=[];for(let _ of n)y.push(ba(_,t));return y}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);let r=Ml(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Nr[r])throw new Error(`${r} is not registered.`);let{klass:c}=Nr[r],h=c.serialize?c.serialize(n,t):{};if(c.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let y in n){if(!n.hasOwnProperty(y)||Nr[r].omit.indexOf(y)>=0)continue;let _=n[y];h[y]=Nr[r].shallow.indexOf(y)>=0?_:ba(_,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function zo(n){if(cu(n))return n;if(Array.isArray(n))return n.map(zo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);let t=Ml(n)||"Object";if(!Nr[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=Nr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);let c=Object.create(r.prototype);for(let h of Object.keys(n)){if(h==="$name")continue;let y=n[h];c[h]=Nr[t].shallow.indexOf(h)>=0?y:zo(y)}return c}class kl{constructor(){this.first=!0}update(t,r){let c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}let Et={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Rl(n){for(let t of n)if(hu(t.charCodeAt(0)))return!0;return!1}function tm(n){for(let t of n)if(!xd(t.charCodeAt(0)))return!1;return!0}function Ll(n){let t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}let im=Ll(["Arab","Dupl","Mong","Ougr","Syrc"]);function xd(n){return!im.test(String.fromCodePoint(n))}let uu=Ll(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function hu(n){return!(n!==746&&n!==747&&(n<4352||!(Et["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Et["CJK Compatibility"](n)||Et["CJK Strokes"](n)||!(!Et["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Et["Enclosed CJK Letters and Months"](n)||Et["Ideographic Description Characters"](n)||Et.Kanbun(n)||Et.Katakana(n)&&n!==12540||!(!Et["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Et["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Et["Vertical Forms"](n)||Et["Yijing Hexagram Symbols"](n)||/\p{sc=Cans}/u.test(String.fromCodePoint(n))||/\p{sc=Hang}/u.test(String.fromCodePoint(n))||uu.test(String.fromCodePoint(n)))))}function bd(n){return!(hu(n)||(function(t){return!!(Et["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Et["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Et["Letterlike Symbols"](t)||Et["Number Forms"](t)||Et["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Et["Control Pictures"](t)&&t!==9251||Et["Optical Character Recognition"](t)||Et["Enclosed Alphanumerics"](t)||Et["Geometric Shapes"](t)||Et["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Et["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Et["CJK Symbols and Punctuation"](t)||Et.Katakana(t)||Et["Private Use Area"](t)||Et["CJK Compatibility Forms"](t)||Et["Small Form Variants"](t)||Et["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}let wd=Ll(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function du(n){return wd.test(String.fromCodePoint(n))}function Td(n,t){return!(!t&&du(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Et.Khmer(n))}function Sd(n){for(let t of n)if(du(t.charCodeAt(0)))return!0;return!1}let Br=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Br.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return a(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;let r=n.pluginURL,c=new Promise((y=>{this.loadScriptResolve=y}));t(r);let h=new Promise((y=>setTimeout((()=>y()),this.TIMEOUT)));if(yield Promise.race([c,h]),this.isParsed()){let y={pluginStatus:"loaded",pluginURL:r};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Kt{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new kl,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kl,this.transition={},this.globalState={})}isSupportedScript(t){return(function(r,c){for(let h of r)if(!Td(h.charCodeAt(0),c))return!1;return!0})(t,Br.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*r}}}class wa{constructor(t,r){this.property=t,this.value=r,this.expression=(function(c,h){if(as(c))return new cs(c,h);if(Sl(c)){let y=ld(c,h);if(y.result==="error")throw new Error(y.value.map((_=>`${_.key}: ${_.message}`)).join(", "));return y.value}{let y=c;return h.type==="color"&&typeof c=="string"?y=wt.parse(c):h.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?h.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?h.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?y=Qi.parse(c):h.type==="projectionDefinition"&&typeof c=="string"&&(y=qi.parse(c)):y=fi.parse(c):y=Ji.parse(c):y=Pi.parse(c),{globalStateRefs:new Set,kind:"constant",evaluate:()=>y}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,c){return this.property.possiblyEvaluate(this,t,r,c)}}class pu{constructor(t){this.property=t,this.value=new wa(t,void 0)}transitioned(t,r){return new fu(this.property,this.value,r,Tr({},t.transition,this.transition),t.now)}untransitioned(){return new fu(this.property,this.value,null,{},0)}}class Id{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return fr(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new pu(this._values[t].property)),this._values[t].value=new wa(this._values[t].property,r===null?void 0:fr(r))}getTransition(t){return fr(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new pu(this._values[t].property)),this._values[t].transition=fr(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(t[r]=c);let h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){let c=new mu(this._properties);for(let h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(t,r._values[h]);return c}untransitioned(){let t=new mu(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class fu{constructor(t,r,c,h,y){this.property=t,this.value=r,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){let h=t.now||0,y=this.value.possiblyEvaluate(t,r,c),_=this.prior;if(_){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return _.possiblyEvaluate(t,r,c);{let x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,c),y,en(x))}}return y}}class mu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){let h=new Dl(this._properties);for(let y of Object.keys(this._values))h._values[y]=this._values[y].possiblyEvaluate(t,r,c);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Pd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return fr(this._values[t].value)}setValue(t,r){this._values[t]=new wa(this._values[t].property,r===null?void 0:fr(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c){let h=new Dl(this._properties);for(let y of Object.keys(this._values))h._values[y]=this._values[y].possiblyEvaluate(t,r,c);return h}}class un{constructor(t,r,c){this.property=t,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,h){return this.property.evaluate(this.value,this.parameters,t,r,c,h)}}class Dl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ye{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,c){let h=ln[this.specification.type];return h?h(t,r,c):t}}class ot{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,h){return new un(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},c,h)}:t.expression,r)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new un(this,{kind:"constant",value:void 0},t.parameters);let h=ln[this.specification.type];if(h){let y=h(t.value.value,r.value.value,c);return new un(this,{kind:"constant",value:y},t.parameters)}return t}evaluate(t,r,c,h,y,_){return t.kind==="constant"?t.value:t.evaluate(r,c,h,y,_)}}class zl extends ot{possiblyEvaluate(t,r,c,h){if(t.value===void 0)return new un(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let y=t.expression.evaluate(r,null,{},c,h),_=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,x=this._calculate(_,_,_,r);return new un(this,{kind:"constant",value:x},r)}if(t.expression.kind==="camera"){let y=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new un(this,{kind:"constant",value:y},r)}return new un(this,t.expression,r)}evaluate(t,r,c,h,y,_){if(t.kind==="source"){let x=t.evaluate(r,c,h,y,_);return this._calculate(x,x,x,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},c,h),t.evaluate({zoom:Math.floor(r.zoom)},c,h),t.evaluate({zoom:Math.floor(r.zoom)+1},c,h),r):t.value}_calculate(t,r,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class eo{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,h){if(t.value!==void 0){if(t.expression.kind==="constant"){let y=t.expression.evaluate(r,null,{},c,h);return this._calculate(y,y,y,r)}return this._calculate(t.expression.evaluate(new Kt(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Kt(Math.floor(r.zoom),r)),t.expression.evaluate(new Kt(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class Ol{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,h){return!!t.expression.evaluate(r,null,{},c,h)}interpolate(){return!1}}class er{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let c=t[r];c.specification.overridable&&this.overridableProperties.push(r);let h=this.defaultPropertyValues[r]=new wa(c,void 0),y=this.defaultTransitionablePropertyValues[r]=new pu(c);this.defaultTransitioningPropertyValues[r]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}Ge("DataDrivenProperty",ot),Ge("DataConstantProperty",Ye),Ge("CrossFadedDataDrivenProperty",zl),Ge("CrossFadedProperty",eo),Ge("ColorRampProperty",Ol);let Ed="-transition";class Pr extends Xe{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Ro(t.filter)),r.layout&&(this._unevaluatedLayout=new Pd(r.layout)),r.paint)){this._transitionablePaint=new Id(r.paint);for(let c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(let c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dl(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=Ro(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let r in this._unevaluatedLayout._values){let c=this._unevaluatedLayout._values[r];for(let h of c.getGlobalStateRefs())t.add(h)}for(let r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,c={}){r!=null&&this._validate(em,`layers.${this.id}.layout.${t}`,t,r,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(Ed)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,c={}){if(r!=null&&this._validate(Qf,`layers.${this.id}.paint.${t}`,t,r,c))return!1;if(t.endsWith(Ed))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let h=this._transitionablePaint._values[t],y=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let w=this._transitionablePaint._values[t].value;return w.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(t,x,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ta(t,((r,c)=>!(r===void 0||c==="layout"&&!Object.keys(r).length||c==="paint"&&!Object.keys(r).length)))}_validate(t,r,c,h,y={}){return(!y||y.validate!==!1)&&fs(this,t.call(xa,{key:r,layerType:this.type,objectKey:c,value:h,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof un&&Jn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let rm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gs{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function si(n,t=1){let r=0,c=0;return{members:n.map((h=>{let y=rm[h.type].BYTES_PER_ELEMENT,_=r=Fl(r,Math.max(t,y)),x=h.components||1;return c=Math.max(c,y),r+=y*x,{name:h.name,type:h.type,components:x,offset:_}})),size:Fl(r,Math.max(c,t)),alignment:t}}function Fl(n,t){return Math.ceil(n/t)*t}class Ta extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){let h=2*t;return this.int16[h+0]=r,this.int16[h+1]=c,t}}Ta.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",Ta);class Sa extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,c)}emplace(t,r,c,h){let y=3*t;return this.int16[y+0]=r,this.int16[y+1]=c,this.int16[y+2]=h,t}}Sa.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",Sa);class gu extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h){let y=this.length;return this.resize(y+1),this.emplace(y,t,r,c,h)}emplace(t,r,c,h,y){let _=4*t;return this.int16[_+0]=r,this.int16[_+1]=c,this.int16[_+2]=h,this.int16[_+3]=y,t}}gu.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",gu);class Ia extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,h,y,_)}emplace(t,r,c,h,y,_,x){let w=6*t;return this.int16[w+0]=r,this.int16[w+1]=c,this.int16[w+2]=h,this.int16[w+3]=y,this.int16[w+4]=_,this.int16[w+5]=x,t}}Ia.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",Ia);class Oo extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,h,y,_)}emplace(t,r,c,h,y,_,x){let w=4*t,I=8*t;return this.int16[w+0]=r,this.int16[w+1]=c,this.uint8[I+4]=h,this.uint8[I+5]=y,this.uint8[I+6]=_,this.uint8[I+7]=x,t}}Oo.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",Oo);class ys extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){let h=2*t;return this.float32[h+0]=r,this.float32[h+1]=c,t}}ys.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",ys);class Nl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_,x,w,I,A){let k=this.length;return this.resize(k+1),this.emplace(k,t,r,c,h,y,_,x,w,I,A)}emplace(t,r,c,h,y,_,x,w,I,A,k){let z=10*t;return this.uint16[z+0]=r,this.uint16[z+1]=c,this.uint16[z+2]=h,this.uint16[z+3]=y,this.uint16[z+4]=_,this.uint16[z+5]=x,this.uint16[z+6]=w,this.uint16[z+7]=I,this.uint16[z+8]=A,this.uint16[z+9]=k,t}}Nl.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",Nl);class Fo extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_,x,w,I,A,k,z){let F=this.length;return this.resize(F+1),this.emplace(F,t,r,c,h,y,_,x,w,I,A,k,z)}emplace(t,r,c,h,y,_,x,w,I,A,k,z,F){let N=12*t;return this.int16[N+0]=r,this.int16[N+1]=c,this.int16[N+2]=h,this.int16[N+3]=y,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=w,this.uint16[N+7]=I,this.int16[N+8]=A,this.int16[N+9]=k,this.int16[N+10]=z,this.int16[N+11]=F,t}}Fo.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",Fo);class yu extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,c)}emplace(t,r,c,h){let y=3*t;return this.float32[y+0]=r,this.float32[y+1]=c,this.float32[y+2]=h,t}}yu.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",yu);class _u extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}_u.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",_u);class Bl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_,x,w,I){let A=this.length;return this.resize(A+1),this.emplace(A,t,r,c,h,y,_,x,w,I)}emplace(t,r,c,h,y,_,x,w,I,A){let k=10*t,z=5*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=h,this.int16[k+3]=y,this.int16[k+4]=_,this.int16[k+5]=x,this.uint32[z+3]=w,this.uint16[k+8]=I,this.uint16[k+9]=A,t}}Bl.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",Bl);class vu extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,h,y,_)}emplace(t,r,c,h,y,_,x){let w=6*t;return this.int16[w+0]=r,this.int16[w+1]=c,this.int16[w+2]=h,this.int16[w+3]=y,this.int16[w+4]=_,this.int16[w+5]=x,t}}vu.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",vu);class m extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y){let _=this.length;return this.resize(_+1),this.emplace(_,t,r,c,h,y)}emplace(t,r,c,h,y,_){let x=4*t,w=8*t;return this.float32[x+0]=r,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[w+6]=y,this.int16[w+7]=_,t}}m.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",m);class e extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,h,y,_)}emplace(t,r,c,h,y,_,x){let w=16*t,I=4*t,A=8*t;return this.uint8[w+0]=r,this.uint8[w+1]=c,this.float32[I+1]=h,this.float32[I+2]=y,this.int16[A+6]=_,this.int16[A+7]=x,t}}e.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",e);class o extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,c)}emplace(t,r,c,h){let y=3*t;return this.uint16[y+0]=r,this.uint16[y+1]=c,this.uint16[y+2]=h,t}}o.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",o);class u extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X){let ce=this.length;return this.resize(ce+1),this.emplace(ce,t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X)}emplace(t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X,ce){let ie=24*t,ne=12*t,_e=48*t;return this.int16[ie+0]=r,this.int16[ie+1]=c,this.uint16[ie+2]=h,this.uint16[ie+3]=y,this.uint32[ne+2]=_,this.uint32[ne+3]=x,this.uint32[ne+4]=w,this.uint16[ie+10]=I,this.uint16[ie+11]=A,this.uint16[ie+12]=k,this.float32[ne+7]=z,this.float32[ne+8]=F,this.uint8[_e+36]=N,this.uint8[_e+37]=$,this.uint8[_e+38]=Z,this.uint32[ne+10]=X,this.int16[ie+22]=ce,t}}u.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",u);class d extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X,ce,ie,ne,_e,Te,Ae,je,ze,Be,Je,Ne){let Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X,ce,ie,ne,_e,Te,Ae,je,ze,Be,Je,Ne)}emplace(t,r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X,ce,ie,ne,_e,Te,Ae,je,ze,Be,Je,Ne,Ue){let Ie=32*t,st=16*t;return this.int16[Ie+0]=r,this.int16[Ie+1]=c,this.int16[Ie+2]=h,this.int16[Ie+3]=y,this.int16[Ie+4]=_,this.int16[Ie+5]=x,this.int16[Ie+6]=w,this.int16[Ie+7]=I,this.uint16[Ie+8]=A,this.uint16[Ie+9]=k,this.uint16[Ie+10]=z,this.uint16[Ie+11]=F,this.uint16[Ie+12]=N,this.uint16[Ie+13]=$,this.uint16[Ie+14]=Z,this.uint16[Ie+15]=X,this.uint16[Ie+16]=ce,this.uint16[Ie+17]=ie,this.uint16[Ie+18]=ne,this.uint16[Ie+19]=_e,this.uint16[Ie+20]=Te,this.uint16[Ie+21]=Ae,this.uint16[Ie+22]=je,this.uint32[st+12]=ze,this.float32[st+13]=Be,this.float32[st+14]=Je,this.uint16[Ie+30]=Ne,this.uint16[Ie+31]=Ue,t}}d.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",d);class g extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}g.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",g);class v extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,c)}emplace(t,r,c,h){let y=3*t;return this.uint16[6*t+0]=r,this.float32[y+1]=c,this.float32[y+2]=h,t}}v.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",v);class T extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){let h=this.length;return this.resize(h+1),this.emplace(h,t,r,c)}emplace(t,r,c,h){let y=4*t;return this.uint32[2*t+0]=r,this.uint16[y+2]=c,this.uint16[y+3]=h,t}}T.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",T);class S extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){let h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=c,t}}S.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",S);class E extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}E.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",E);class C extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,h){let y=this.length;return this.resize(y+1),this.emplace(y,t,r,c,h)}emplace(t,r,c,h,y){let _=4*t;return this.float32[_+0]=r,this.float32[_+1]=c,this.float32[_+2]=h,this.float32[_+3]=y,t}}C.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",C);class L extends gs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new b(this.anchorPointX,this.anchorPointY)}}L.prototype.size=20;class R extends Bl{get(t){return new L(this,t)}}Ge("CollisionBoxArray",R);class O extends gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class j extends u{get(t){return new O(this,t)}}Ge("PlacedSymbolArray",j);class H extends gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}H.prototype.size=64;class W extends d{get(t){return new H(this,t)}}Ge("SymbolInstanceArray",W);class K extends g{getoffsetX(t){return this.float32[1*t+0]}}Ge("GlyphOffsetArray",K);class Y extends Sa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ge("SymbolLineVertexArray",Y);class te extends gs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}te.prototype.size=12;class J extends v{get(t){return new te(this,t)}}Ge("TextAnchorOffsetArray",J);class re extends gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}re.prototype.size=8;class ae extends T{get(t){return new re(this,t)}}Ge("FeatureIndexArray",ae);class Q extends Ta{}class de extends Ta{}class we extends Ta{}class ge extends Ia{}class ye extends Oo{}class be extends ys{}class Le extends Nl{}class Oe extends Fo{}class Ee extends yu{}class He extends _u{}class gt extends vu{}class Dt extends e{}class Bt extends o{}class Ft extends S{}let Yt=si([{name:"a_pos",components:2,type:"Int16"}],4),{members:ti}=Yt;class ft{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,c,h){let y=this.segments[this.segments.length-1];return t>ft.MAX_VERTEX_ARRAY_LENGTH&&ui(`Max vertices per segment is ${ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ft.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+t>ft.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h?this.createNewSegment(r,c,h):y}createNewSegment(t,r,c){let h={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(h.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,r,c){return this.prepareSegment(0,t,r,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,h){return new ft([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function Ut(n,t){return 256*(n=ar(Math.floor(n),0,255))+ar(Math.floor(t),0,255)}ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",ft);let mi=si([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var wi,Ai,tr,Ur={exports:{}},to={exports:{}},io={exports:{}},Pa=(function(){if(tr)return Ur.exports;tr=1;var n=(wi||(wi=1,to.exports=function(r,c){var h,y,_,x,w,I,A,k;for(y=r.length-(h=3&r.length),_=c,w=3432918353,I=461845907,k=0;k<y;)A=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,_=27492+(65535&(x=5*(65535&(_=(_^=A=(65535&(A=(A=(65535&A)*w+(((A>>>16)*w&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(A=0,h){case 3:A^=(255&r.charCodeAt(k+2))<<16;case 2:A^=(255&r.charCodeAt(k+1))<<8;case 1:_^=A=(65535&(A=(A=(65535&(A^=255&r.charCodeAt(k)))*w+(((A>>>16)*w&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),to.exports),t=(Ai||(Ai=1,io.exports=function(r,c){for(var h,y=r.length,_=c^y,x=0;y>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++x;switch(y){case 3:_^=(255&r.charCodeAt(x+2))<<16;case 2:_^=(255&r.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),io.exports);return Ur.exports=n,Ur.exports.murmur3=n,Ur.exports.murmur2=t,Ur.exports})(),Ea=P(Pa);class No{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,c,h){this.ids.push(Bo(t)),this.positions.push(r,c,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Bo(t),c=0,h=this.ids.length-1;for(;c<h;){let _=c+h>>1;this.ids[_]>=r?h=_:c=_+1}let y=[];for(;this.ids[c]===r;)y.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return y}static serialize(t,r){let c=new Float64Array(t.ids),h=new Uint32Array(t.positions);return ur(c,h,0,c.length-1),r&&r.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(t){let r=new No;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Bo(n){let t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ea(String(n))}function ur(n,t,r,c){for(;r<c;){let h=n[r+c>>1],y=r-1,_=c+1;for(;;){do y++;while(n[y]<h);do _--;while(n[_]>h);if(y>=_)break;jr(n,y,_),jr(t,3*y,3*_),jr(t,3*y+1,3*_+1),jr(t,3*y+2,3*_+2)}_-r<c-_?(ur(n,t,r,_),r=_+1):(ur(n,t,_+1,c),c=_)}}function jr(n,t,r){let c=n[t];n[t]=n[r],n[r]=c}Ge("FeaturePositionMap",No);class ir{constructor(t,r){this.gl=t.gl,this.location=r}}class ro extends ir{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class gi extends ir{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ti extends ir{constructor(t,r){super(t,r),this.current=wt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Er=new Float32Array(16);function yi(n){return[Ut(255*n.r,255*n.g),Ut(255*n.b,255*n.a)]}class _s{constructor(t,r,c){this.value=t,this.uniformNames=r.map((h=>`u_${h}`)),this.type=c}setUniform(t,r,c){t.set(c.constantOr(this.value))}getBinding(t,r,c){return this.type==="color"?new Ti(t,r):new ro(t,r)}}class Aa{constructor(t,r){this.uniformNames=r.map((c=>`u_${c}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,c,h){let y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,r,c){return c.substr(0,9)==="u_pattern"?new gi(t,r):new ro(t,r)}}class Pn{constructor(t,r,c,h){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map((y=>({name:`a_${y}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(t,r,c,h,y){let _=this.paintVertexArray.length,x=this.expression.evaluate(new Kt(0),r,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(_,t,x)}updatePaintArray(t,r,c,h){let y=this.expression.evaluate({zoom:0},c,h);this._setPaintValue(t,r,y)}_setPaintValue(t,r,c){if(this.type==="color"){let h=yi(c);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vr{constructor(t,r,c,h,y,_){this.expression=t,this.uniformNames=r.map((x=>`u_${x}_t`)),this.type=c,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=r.map((x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,r,c,h,y){let _=this.expression.evaluate(new Kt(this.zoom),r,{},h,[],y),x=this.expression.evaluate(new Kt(this.zoom+1),r,{},h,[],y),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,_,x)}updatePaintArray(t,r,c,h){let y=this.expression.evaluate({zoom:this.zoom},c,h),_=this.expression.evaluate({zoom:this.zoom+1},c,h);this._setPaintValue(t,r,y,_)}_setPaintValue(t,r,c,h){if(this.type==="color"){let y=yi(c),_=yi(h);for(let x=t;x<r;x++)this.paintVertexArray.emplace(x,y[0],y[1],_[0],_[1])}else{for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let c=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=ar(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,c){return new ro(t,r)}}class no{constructor(t,r,c,h,y,_){this.expression=t,this.type=r,this.useIntegerZoom=c,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,r,c){let h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(t,r,c,h,y){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(t,r,c,h){if(!h||!c)return;let{min:y,mid:_,max:x}=c,w=h[y],I=h[_],A=h[x];if(w&&I&&A)for(let k=t;k<r;k++)this.zoomInPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],I.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,mi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,mi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ad{constructor(t,r,c){this.binders={},this._buffers=[];let h=[];for(let y in t.paint._values){if(!c(y))continue;let _=t.paint.get(y);if(!(_ instanceof un&&Jn(_.property.specification)))continue;let x=Cd(y,t.type),w=_.value,I=_.property.specification.type,A=_.property.useIntegerZoom,k=_.property.specification["property-type"],z=k==="cross-faded"||k==="cross-faded-data-driven";if(w.kind==="constant")this.binders[y]=z?new Aa(w.value,x):new _s(w.value,x,I),h.push(`/u_${y}`);else if(w.kind==="source"||z){let F=xu(y,I,"source");this.binders[y]=z?new no(w,I,A,r,F,t.id):new Pn(w,x,I,F),h.push(`/a_${y}`)}else{let F=xu(y,I,"composite");this.binders[y]=new Vr(w,x,I,A,r,F),h.push(`/z_${y}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof Pn||r instanceof Vr?r.maxValue:0}populatePaintArrays(t,r,c,h,y){for(let _ in this.binders){let x=this.binders[_];(x instanceof Pn||x instanceof Vr||x instanceof no)&&x.populatePaintArray(t,r,c,h,y)}}setConstantPatternPositions(t,r){for(let c in this.binders){let h=this.binders[c];h instanceof Aa&&h.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,c,h,y){let _=!1;for(let x in t){let w=r.getPositions(x);for(let I of w){let A=c.feature(I.index);for(let k in this.binders){let z=this.binders[k];if((z instanceof Pn||z instanceof Vr||z instanceof no)&&z.expression.isStateDependent===!0){let F=h.paint.get(k);z.expression=F.value,z.updatePaintArray(I.start,I.end,A,t[x],y),_=!0}}}}return _}defines(){let t=[];for(let r in this.binders){let c=this.binders[r];(c instanceof _s||c instanceof Aa)&&t.push(...c.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof Pn||c instanceof Vr)for(let h=0;h<c.paintVertexAttributes.length;h++)t.push(c.paintVertexAttributes[h].name);else if(c instanceof no)for(let h=0;h<mi.members.length;h++)t.push(mi.members[h].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof _s||c instanceof Aa||c instanceof Vr)for(let h of c.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let c=[];for(let h in this.binders){let y=this.binders[h];if(y instanceof _s||y instanceof Aa||y instanceof Vr){for(let _ of y.uniformNames)if(r[_]){let x=y.getBinding(t,r[_],_);c.push({name:_,property:h,binding:x})}}}return c}setUniforms(t,r,c,h){for(let{name:y,property:_,binding:x}of r)this.binders[_].setUniform(x,h,c.get(_),y)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let c=this.binders[r];if(t&&c instanceof no){let h=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof Pn||c instanceof Vr)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(let r in this.binders){let c=this.binders[r];(c instanceof Pn||c instanceof Vr||c instanceof no)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof Pn||r instanceof Vr||r instanceof no)&&r.destroy()}}}class yr{constructor(t,r,c=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new Ad(h,r,c);this.needsUpload=!1,this._featureMap=new No,this._bufferOffset=0}populatePaintArrays(t,r,c,h,y,_){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,r,h,y,_);r.id!==void 0&&this._featureMap.add(r.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,h){for(let y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,r,y,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cd(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function xu(n,t,r){let c={color:{source:ys,composite:C},number:{source:g,composite:ys}},h=(function(y){return{"line-pattern":{source:Le,composite:Le},"fill-pattern":{source:Le,composite:Le},"fill-extrusion-pattern":{source:Le,composite:Le}}[y]})(n);return h&&h[r]||c[t][r]}Ge("ConstantBinder",_s),Ge("CrossFadedConstantBinder",Aa),Ge("SourceExpressionBinder",Pn),Ge("CrossFadedCompositeBinder",no),Ge("CompositeExpressionBinder",Vr),Ge("ProgramConfiguration",Ad,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",yr);let Ul=Math.pow(2,14)-1,jl=-Ul-1;function oo(n){let t=Ot/n.extent,r=n.loadGeometry();for(let c=0;c<r.length;c++){let h=r[c];for(let y=0;y<h.length;y++){let _=h[y],x=Math.round(_.x*t),w=Math.round(_.y*t);_.x=ar(x,jl,Ul),_.y=ar(w,jl,Ul),(x<_.x||x>_.x+1||w<_.y||w>_.y+1)&&ui("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function En(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?oo(n):[]}}let a_=-32768;function dw(n,t,r,c,h){n.emplaceBack(a_+8*t+c,a_+8*r+h)}class nm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.indexArray=new Bt,this.segments=new ft,this.programConfigurations=new yr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){let h=this.layers[0],y=[],_=null,x=!1,w=h.type==="heatmap";if(h.type==="circle"){let A=h;_=A.layout.get("circle-sort-key"),x=!_.isConstant(),w=w||A.paint.get("circle-pitch-alignment")==="map"}let I=w?r.subdivisionGranularity.circle:1;for(let{feature:A,id:k,index:z,sourceLayerIndex:F}of t){let N=this.layers[0]._featureFilter.needGeometry,$=En(A,N);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom,{globalState:this.globalState}),$,c))continue;let Z=x?_.evaluate($,{},c):void 0,X={id:k,properties:A.properties,type:A.type,sourceLayerIndex:F,index:z,geometry:N?$.geometry:oo(A),patterns:{},sortKey:Z};y.push(X)}x&&y.sort(((A,k)=>A.sortKey-k.sortKey));for(let A of y){let{geometry:k,index:z,sourceLayerIndex:F}=A,N=t[z].feature;this.addFeature(A,k,z,c,I),r.featureIndex.insert(N,k,z,F,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ti),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,h,y=1){let _;switch(y){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}let x=_.length;for(let w of r)for(let I of w){let A=I.x,k=I.y;if(A<0||A>=Ot||k<0||k>=Ot)continue;let z=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,t.sortKey),F=z.vertexLength;for(let N=0;N<x;N++)for(let $=0;$<x;$++)dw(this.layoutVertexArray,A,k,_[$],_[N]);for(let N=0;N<x-1;N++)for(let $=0;$<x-1;$++){let Z=F+N*x+$,X=F+(N+1)*x+$;this.indexArray.emplaceBack(Z,X+1,Z+1),this.indexArray.emplaceBack(Z,X,X+1)}z.vertexLength+=x*x,z.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},h)}}function s_(n,t){for(let r=0;r<n.length;r++)if(Vl(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Vl(n,t[r]))return!0;return!!om(n,t)}function pw(n,t,r){return!!Vl(n,t)||!!am(t,n,r)}function l_(n,t){if(n.length===1)return u_(t,n[0]);for(let r=0;r<t.length;r++){let c=t[r];for(let h=0;h<c.length;h++)if(Vl(n,c[h]))return!0}for(let r=0;r<n.length;r++)if(u_(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(om(n,t[r]))return!0;return!1}function fw(n,t,r){if(n.length>1){if(om(n,t))return!0;for(let c=0;c<t.length;c++)if(am(t[c],n,r))return!0}for(let c=0;c<n.length;c++)if(am(n[c],t,r))return!0;return!1}function om(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){let c=n[r],h=n[r+1];for(let y=0;y<t.length-1;y++)if(mw(c,h,t[y],t[y+1]))return!0}return!1}function mw(n,t,r,c){return kr(n,r,c)!==kr(t,r,c)&&kr(n,t,r)!==kr(n,t,c)}function am(n,t,r){let c=r*r;if(t.length===1)return n.distSqr(t[0])<c;for(let h=1;h<t.length;h++)if(c_(n,t[h-1],t[h])<c)return!0;return!1}function c_(n,t,r){let c=t.distSqr(r);if(c===0)return n.distSqr(t);let h=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/c;return n.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function u_(n,t){let r,c,h,y=!1;for(let _=0;_<n.length;_++){r=n[_];for(let x=0,w=r.length-1;x<r.length;w=x++)c=r[x],h=r[w],c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(y=!y)}return y}function Vl(n,t){let r=!1;for(let c=0,h=n.length-1;c<n.length;h=c++){let y=n[c],_=n[h];y.y>t.y!=_.y>t.y&&t.x<(_.x-y.x)*(t.y-y.y)/(_.y-y.y)+y.x&&(r=!r)}return r}function gw(n,t,r){let c=r[0],h=r[2];if(n.x<c.x&&t.x<c.x||n.x>h.x&&t.x>h.x||n.y<c.y&&t.y<c.y||n.y>h.y&&t.y>h.y)return!1;let y=kr(n,t,r[0]);return y!==kr(n,t,r[1])||y!==kr(n,t,r[2])||y!==kr(n,t,r[3])}function bu(n,t,r){let c=t.paint.get(n).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Md(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function kd(n,t,r,c,h){if(!t[0]&&!t[1])return n;let y=b.convert(t)._mult(h);r==="viewport"&&y._rotate(-c);let _=[];for(let x=0;x<n.length;x++)_.push(n[x].sub(y));return _}let h_,d_;Ge("CircleBucket",nm,{omit:["layers"]});var yw={get paint(){return d_=d_||new er({"circle-radius":new ot(fe.paint_circle["circle-radius"]),"circle-color":new ot(fe.paint_circle["circle-color"]),"circle-blur":new ot(fe.paint_circle["circle-blur"]),"circle-opacity":new ot(fe.paint_circle["circle-opacity"]),"circle-translate":new Ye(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(fe.paint_circle["circle-stroke-opacity"])})},get layout(){return h_=h_||new er({"circle-sort-key":new ot(fe.layout_circle["circle-sort-key"])})}};class _w extends Pr{constructor(t){super(t,yw)}createBucket(t){return new nm(t)}queryRadius(t){let r=t;return bu("circle-radius",this,r)+bu("circle-stroke-width",this,r)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:h,transform:y,pixelsToTileUnits:_,unwrappedTileID:x,getElevation:w}){let I=kd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,_),A=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c),k=this.paint.get("circle-pitch-alignment")==="map",z=k?I:(function(N,$,Z,X){return N.map((ce=>p_(ce,$,Z,X)))})(I,y,x,w),F=k?A*_:A;for(let N of h)for(let $ of N){let Z=k?$:p_($,y,x,w),X=F,ce=y.projectTileCoordinates($.x,$.y,x,w).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=ce/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=y.cameraToCenterDistance/ce),pw(z,Z,X))return!0}return!1}}function p_(n,t,r,c){let h=t.projectTileCoordinates(n.x,n.y,r,c).point;return new b((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class f_ extends nm{}let m_;Ge("HeatmapBucket",f_,{omit:["layers"]});var vw={get paint(){return m_=m_||new er({"heatmap-radius":new ot(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ol(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(fe.paint_heatmap["heatmap-opacity"])})}};function sm(n,{width:t,height:r},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*c)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*r*c}`)}else h=new Uint8Array(t*r*c);return n.width=t,n.height=r,n.data=h,n}function g_(n,{width:t,height:r},c){if(t===n.width&&r===n.height)return;let h=sm({},{width:t,height:r},c);lm(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},c),n.width=t,n.height=r,n.data=h.data}function lm(n,t,r,c,h,y){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||c.x>t.width-h.width||c.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let _=n.data,x=t.data;if(_===x)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){let I=((r.y+w)*n.width+r.x)*y,A=((c.y+w)*t.width+c.x)*y;for(let k=0;k<h.width*y;k++)x[A+k]=_[I+k]}return t}class wu{constructor(t,r){sm(this,t,1,r)}resize(t){g_(this,t,1)}clone(){return new wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,h,y){lm(t,r,c,h,y,1)}}class _r{constructor(t,r){sm(this,t,4,r)}resize(t){g_(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new _r({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,h,y){lm(t,r,c,h,y,4)}setPixel(t,r,c){let h=4*(t*this.width+r);this.data[h+0]=Math.round(255*c.r/c.a),this.data[h+1]=Math.round(255*c.g/c.a),this.data[h+2]=Math.round(255*c.b/c.a),this.data[h+3]=Math.round(255*c.a)}}function y_(n){let t={},r=n.resolution||256,c=n.clips?n.clips.length:1,h=n.image||new _r({width:r,height:c});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let y=(_,x,w)=>{t[n.evaluationKey]=w;let I=n.expression.evaluate(t);h.setPixel(_/4/r,x/4,I)};if(n.clips)for(let _=0,x=0;_<c;++_,x+=4*r)for(let w=0,I=0;w<r;w++,I+=4){let A=w/(r-1),{start:k,end:z}=n.clips[_];y(x,I,k*(1-A)+z*A)}else for(let _=0,x=0;_<r;_++,x+=4)y(0,x,_/(r-1));return h}Ge("AlphaImage",wu),Ge("RGBAImage",_r);let cm="big-fb";class xw extends Pr{createBucket(t){return new f_(t)}constructor(t){super(t,vw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=y_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(cm)&&this.heatmapFbos.delete(cm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let __;var bw={get paint(){return __=__||new er({"hillshade-illumination-direction":new Ye(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ye(fe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ye(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(fe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ye(fe.paint_hillshade["hillshade-method"])})}};class ww extends Pr{constructor(t){super(t,bw),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values,y=Math.max(t.length,r.length,c.length,h.length);t=t.concat(Array(y-t.length).fill(t.at(-1))),r=r.concat(Array(y-r.length).fill(r.at(-1))),c=c.concat(Array(y-c.length).fill(c.at(-1))),h=h.concat(Array(y-h.length).fill(h.at(-1)));let _=r.map(vo);return{directionRadians:t.map(vo),altitudeRadians:_,shadowColor:h,highlightColor:c}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let v_;var Tw={get paint(){return v_=v_||new er({"color-relief-opacity":new Ye(fe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Ol(fe["paint_color-relief"]["color-relief-color"])})}};class um{constructor(t,r,c,h){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(r,h)}update(t,r,c){let{width:h,height:y}=t,_=!(this.size&&this.size[0]===h&&this.size[1]===y||c),{context:x}=this,{gl:w}=x;if(this.useMipmap=!!(r&&r.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[h,y],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||rn(t)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,t):w.texImage2D(w.TEXTURE_2D,0,this.format,h,y,0,this.format,w.UNSIGNED_BYTE,t.data);else{let{x:I,y:A}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||rn(t)?w.texSubImage2D(w.TEXTURE_2D,0,I,A,w.RGBA,w.UNSIGNED_BYTE,t):w.texSubImage2D(w.TEXTURE_2D,0,I,A,h,y,w.RGBA,w.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,c){let{context:h}=this,{gl:y}=h;y.bindTexture(y.TEXTURE_2D,this.texture),c!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=y.LINEAR),t!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,t),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,c||t),this.filter=t),r!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class x_{constructor(t,r,c,h=1,y=1,_=1,x=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void ui(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=y,this.blueFactor=_,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<w;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(w,I)]=this.data[this._idx(w-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,w)]=this.data[this._idx(I,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<w;I++)for(let A=0;A<w;A++){let k=this.get(I,A);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,r){let c=new Uint8Array(this.data.buffer),h=4*this._idx(t,r);return this.unpack(c[h],c[h+1],c[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,c){return t*this.redFactor+r*this.greenFactor+c*this.blueFactor-this.baseShift}pack(t){return b_(t,this.getUnpackVector())}getPixels(){return new _r({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,y=r*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(r){case-1:h=y-1;break;case 1:y=h+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}let w=-r*this.dim,I=-c*this.dim;for(let A=_;A<x;A++)for(let k=h;k<y;k++)this.data[this._idx(k,A)]=t.data[this._idx(k+w,A+I)]}}function b_(n,t){let r=t[0],c=t[1],h=t[2],y=t[3],_=Math.min(r,c,h),x=Math.round((n+y)/_);return{r:Math.floor(x*_/r)%256,g:Math.floor(x*_/c)%256,b:Math.floor(x*_/h)%256}}Ge("DEMData",x_);class Sw extends Pr{constructor(t){super(t,Tw)}_createColorRamp(t){let r={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof ls&&c._styleExpression.expression instanceof Fi){this.colorRampExpression=c;let _=c._styleExpression.expression;r.elevationStops=_.labels,r.colorStops=[];for(let x of r.elevationStops)r.colorStops.push(_.evaluate({globals:{elevation:x}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[wt.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;let h={elevationStops:[],colorStops:[]},y=(r.elevationStops.length-1)/(t-1);for(let _=0;_<r.elevationStops.length-.5;_+=y)h.elevationStops.push(r.elevationStops[Math.round(_)]),h.colorStops.push(r.colorStops[Math.round(_)]);return ui(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let h=this._createColorRamp(r),y=new _r({width:h.colorStops.length,height:1}),_=new _r({width:h.colorStops.length,height:1});for(let x=0;x<h.elevationStops.length;x++){let w=b_(h.elevationStops[x],c);_.setPixel(0,x,new wt(w.r/255,w.g/255,w.b/255,1)),y.setPixel(0,x,h.colorStops[x])}return this.colorRampTextures={elevationTexture:new um(t,_,t.gl.RGBA),colorTexture:new um(t,y,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let Iw=si([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pw}=Iw;function hm(n,t,r){let c=r.patternDependencies,h=!1;for(let y of t){let _=y.paint.get(`${n}-pattern`);_.isConstant()||(h=!0);let x=_.constantOr(null);x&&(h=!0,c[x.to]=!0,c[x.from]=!0)}return h}function dm(n,t,r,c,h){let y=h.patternDependencies;for(let _ of t){let x=_.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:c-1},r,{},h.availableImages),I=x.evaluate({zoom:c},r,{},h.availableImages),A=x.evaluate({zoom:c+1},r,{},h.availableImages);w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,y[w]=!0,y[I]=!0,y[A]=!0,r.patterns[_.id]={min:w,mid:I,max:A}}}return r}function w_(n,t,r,c,h){let y;if(h===(function(_,x,w,I){let A=0;for(let k=x,z=w-I;k<w;k+=I)A+=(_[z]-_[k])*(_[k+1]+_[z+1]),z=k;return A})(n,t,r,c)>0)for(let _=t;_<r;_+=c)y=P_(_/c|0,n[_],n[_+1],y);else for(let _=r-c;_>=t;_-=c)y=P_(_/c|0,n[_],n[_+1],y);return y&&$l(y,y.next)&&(Pu(y),y=y.next),y}function vs(n,t){if(!n)return n;t||(t=n);let r,c=n;do if(r=!1,c.steiner||!$l(c,c.next)&&di(c.prev,c,c.next)!==0)c=c.next;else{if(Pu(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function Tu(n,t,r,c,h,y,_){if(!n)return;!_&&y&&(function(w,I,A,k){let z=w;do z.z===0&&(z.z=pm(z.x,z.y,I,A,k)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==w);z.prevZ.nextZ=null,z.prevZ=null,(function(F){let N,$=1;do{let Z,X=F;F=null;let ce=null;for(N=0;X;){N++;let ie=X,ne=0;for(let Te=0;Te<$&&(ne++,ie=ie.nextZ,ie);Te++);let _e=$;for(;ne>0||_e>0&&ie;)ne!==0&&(_e===0||!ie||X.z<=ie.z)?(Z=X,X=X.nextZ,ne--):(Z=ie,ie=ie.nextZ,_e--),ce?ce.nextZ=Z:F=Z,Z.prevZ=ce,ce=Z;X=ie}ce.nextZ=null,$*=2}while(N>1)})(z)})(n,c,h,y);let x=n;for(;n.prev!==n.next;){let w=n.prev,I=n.next;if(y?Aw(n,c,h,y):Ew(n))t.push(w.i,n.i,I.i),Pu(n),n=I.next,x=I.next;else if((n=I)===x){_?_===1?Tu(n=Cw(vs(n),t),t,r,c,h,y,2):_===2&&Mw(n,t,r,c,h,y):Tu(vs(n),t,r,c,h,y,1);break}}}function Ew(n){let t=n.prev,r=n,c=n.next;if(di(t,r,c)>=0)return!1;let h=t.x,y=r.x,_=c.x,x=t.y,w=r.y,I=c.y,A=Math.min(h,y,_),k=Math.min(x,w,I),z=Math.max(h,y,_),F=Math.max(x,w,I),N=c.next;for(;N!==t;){if(N.x>=A&&N.x<=z&&N.y>=k&&N.y<=F&&Su(h,x,y,w,_,I,N.x,N.y)&&di(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function Aw(n,t,r,c){let h=n.prev,y=n,_=n.next;if(di(h,y,_)>=0)return!1;let x=h.x,w=y.x,I=_.x,A=h.y,k=y.y,z=_.y,F=Math.min(x,w,I),N=Math.min(A,k,z),$=Math.max(x,w,I),Z=Math.max(A,k,z),X=pm(F,N,t,r,c),ce=pm($,Z,t,r,c),ie=n.prevZ,ne=n.nextZ;for(;ie&&ie.z>=X&&ne&&ne.z<=ce;){if(ie.x>=F&&ie.x<=$&&ie.y>=N&&ie.y<=Z&&ie!==h&&ie!==_&&Su(x,A,w,k,I,z,ie.x,ie.y)&&di(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ne.x>=F&&ne.x<=$&&ne.y>=N&&ne.y<=Z&&ne!==h&&ne!==_&&Su(x,A,w,k,I,z,ne.x,ne.y)&&di(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;ie&&ie.z>=X;){if(ie.x>=F&&ie.x<=$&&ie.y>=N&&ie.y<=Z&&ie!==h&&ie!==_&&Su(x,A,w,k,I,z,ie.x,ie.y)&&di(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ne&&ne.z<=ce;){if(ne.x>=F&&ne.x<=$&&ne.y>=N&&ne.y<=Z&&ne!==h&&ne!==_&&Su(x,A,w,k,I,z,ne.x,ne.y)&&di(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function Cw(n,t){let r=n;do{let c=r.prev,h=r.next.next;!$l(c,h)&&S_(c,r,r.next,h)&&Iu(c,h)&&Iu(h,c)&&(t.push(c.i,r.i,h.i),Pu(r),Pu(r.next),r=n=h),r=r.next}while(r!==n);return vs(r)}function Mw(n,t,r,c,h,y){let _=n;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&zw(_,x)){let w=I_(_,x);return _=vs(_,_.next),w=vs(w,w.next),Tu(_,t,r,c,h,y,0),void Tu(w,t,r,c,h,y,0)}x=x.next}_=_.next}while(_!==n)}function kw(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Rw(n,t){let r=(function(h,y){let _=y,x=h.x,w=h.y,I,A=-1/0;if($l(h,_))return _;do{if($l(h,_.next))return _.next;if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){let $=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=x&&$>A&&(A=$,I=_.x<_.next.x?_:_.next,$===x))return I}_=_.next}while(_!==y);if(!I)return null;let k=I,z=I.x,F=I.y,N=1/0;_=I;do{if(x>=_.x&&_.x>=z&&x!==_.x&&T_(w<F?x:A,w,z,F,w<F?A:x,w,_.x,_.y)){let $=Math.abs(w-_.y)/(x-_.x);Iu(_,h)&&($<N||$===N&&(_.x>I.x||_.x===I.x&&Lw(I,_)))&&(I=_,N=$)}_=_.next}while(_!==k);return I})(n,t);if(!r)return t;let c=I_(r,n);return vs(c,c.next),vs(r,r.next)}function Lw(n,t){return di(n.prev,n,t.prev)<0&&di(t.next,n,n.next)<0}function pm(n,t,r,c,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dw(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function T_(n,t,r,c,h,y,_,x){return(h-_)*(t-x)>=(n-_)*(y-x)&&(n-_)*(c-x)>=(r-_)*(t-x)&&(r-_)*(y-x)>=(h-_)*(c-x)}function Su(n,t,r,c,h,y,_,x){return!(n===_&&t===x)&&T_(n,t,r,c,h,y,_,x)}function zw(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,c){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==c.i&&h.next.i!==c.i&&S_(h,h.next,r,c))return!0;h=h.next}while(h!==r);return!1})(n,t)&&(Iu(n,t)&&Iu(t,n)&&(function(r,c){let h=r,y=!1,_=(r.x+c.x)/2,x=(r.y+c.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(y=!y),h=h.next;while(h!==r);return y})(n,t)&&(di(n.prev,n,t.prev)||di(n,t.prev,t))||$l(n,t)&&di(n.prev,n,n.next)>0&&di(t.prev,t,t.next)>0)}function di(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function $l(n,t){return n.x===t.x&&n.y===t.y}function S_(n,t,r,c){let h=Ld(di(n,t,r)),y=Ld(di(n,t,c)),_=Ld(di(r,c,n)),x=Ld(di(r,c,t));return h!==y&&_!==x||!(h!==0||!Rd(n,r,t))||!(y!==0||!Rd(n,c,t))||!(_!==0||!Rd(r,n,c))||!(x!==0||!Rd(r,t,c))}function Rd(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Ld(n){return n>0?1:n<0?-1:0}function Iu(n,t){return di(n.prev,n,n.next)<0?di(n,t,n.next)>=0&&di(n,n.prev,t)>=0:di(n,t,n.prev)<0||di(n,n.next,t)<0}function I_(n,t){let r=fm(n.i,n.x,n.y),c=fm(t.i,t.x,t.y),h=n.next,y=t.prev;return n.next=t,t.prev=n,r.next=h,h.prev=r,c.next=r,r.prev=c,y.next=c,c.prev=y,c}function P_(n,t,r,c){let h=fm(n,t,r);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Pu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function fm(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Gl{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Dd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Dd.noSubdivision=new Dd({fill:new Gl(0,0),line:new Gl(0,0),tile:new Gl(0,0),stencil:new Gl(0,0),circle:1}),Ge("SubdivisionGranularityExpression",Gl),Ge("SubdivisionGranularitySetting",Dd);let ql=-32768,Eu=32767;class Ow{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Ot/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let c=0|Math.round(t),h=0|Math.round(r),y=this._getKey(c,h);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);let _=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,_),this._vertexBuffer.push(c,h),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(h,y){let _=[];for(let x=0;x<y.length;x+=3){let w=y[x],I=y[x+1],A=y[x+2],k=h[2*w],z=h[2*w+1];(h[2*I]-k)*(h[2*A+1]-z)-(h[2*I+1]-z)*(h[2*A]-k)>0?(_.push(w),_.push(A),_.push(I)):(_.push(w),_.push(I),_.push(A))}return _})(this._vertexBuffer,t);let r=[],c=t.length;for(let h=0;h<c;h+=3){let y=[t[h+0],t[h+1],t[h+2]],_=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]],x=1/0,w=1/0,I=-1/0,A=-1/0;for(let $=0;$<3;$++){let Z=_[2*$],X=_[2*$+1];x=Math.min(x,Z),I=Math.max(I,Z),w=Math.min(w,X),A=Math.max(A,X)}if(x===I||w===A)continue;let k=Math.floor(x/this._granularityCellSize),z=Math.ceil(I/this._granularityCellSize),F=Math.floor(w/this._granularityCellSize),N=Math.ceil(A/this._granularityCellSize);if(k!==z||F!==N)for(let $=F;$<N;$++){let Z=this._scanlineGenerateVertexRingForCellRow($,_,y);Fw(this._vertexBuffer,Z,r)}else r.push(...y)}return r}_scanlineGenerateVertexRingForCellRow(t,r,c){let h=t*this._granularityCellSize,y=h+this._granularityCellSize,_=[];for(let x=0;x<3;x++){let w=r[2*x],I=r[2*x+1],A=r[2*(x+1)%6],k=r[(2*(x+1)+1)%6],z=r[2*(x+2)%6],F=r[(2*(x+2)+1)%6],N=A-w,$=k-I,Z=N===0,X=$===0,ce=(h-I)/$,ie=(y-I)/$,ne=Math.min(ce,ie),_e=Math.max(ce,ie);if(!X&&(ne>=1||_e<=0)||X&&(I<h||I>y)){k>=h&&k<=y&&_.push(c[(x+1)%3]);continue}!X&&ne>0&&_.push(this._vertexToIndex(w+N*ne,I+$*ne));let Te=w+N*Math.max(ne,0),Ae=w+N*Math.min(_e,1);Z||this._generateIntraEdgeVertices(_,w,I,A,k,Te,Ae),!X&&_e<1&&_.push(this._vertexToIndex(w+N*_e,I+$*_e)),(X||k>=h&&k<=y)&&_.push(c[(x+1)%3]),!X&&(k<=h||k>=y)&&this._generateInterEdgeVertices(_,w,I,A,k,z,F,Ae,h,y)}return _}_generateIntraEdgeVertices(t,r,c,h,y,_,x){let w=h-r,I=y-c,A=I===0,k=A?Math.min(r,h):Math.min(_,x),z=A?Math.max(r,h):Math.max(_,x),F=Math.floor(k/this._granularityCellSize)+1,N=Math.ceil(z/this._granularityCellSize)-1;if(A?r<h:_<x)for(let $=F;$<=N;$++){let Z=$*this._granularityCellSize;t.push(this._vertexToIndex(Z,c+I*(Z-r)/w))}else for(let $=N;$>=F;$--){let Z=$*this._granularityCellSize;t.push(this._vertexToIndex(Z,c+I*(Z-r)/w))}}_generateInterEdgeVertices(t,r,c,h,y,_,x,w,I,A){let k=y-c,z=_-h,F=x-y,N=(I-y)/F,$=(A-y)/F,Z=Math.min(N,$),X=Math.max(N,$),ce=h+z*Z,ie=Math.floor(Math.min(ce,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(ce,w)/this._granularityCellSize)-1,_e=w<ce,Te=F===0;if(Te&&(x===I||x===A))return;if(Te||Z>=1||X<=0){let je=c-x,ze=_+(r-_)*Math.min((I-x)/je,(A-x)/je);ie=Math.floor(Math.min(ze,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(ze,w)/this._granularityCellSize)-1,_e=w<ze}let Ae=k>0?A:I;if(_e)for(let je=ie;je<=ne;je++)t.push(this._vertexToIndex(je*this._granularityCellSize,Ae));else for(let je=ne;je>=ie;je--)t.push(this._vertexToIndex(je*this._granularityCellSize,Ae))}_generateOutline(t){let r=[];for(let c of t){let h=xs(c,this._granularity,!0),y=this._pointArrayToIndices(h),_=[];for(let x=1;x<y.length;x++)_.push(y[x-1]),_.push(y[x]);r.push(_)}return r}_handlePoles(t){let r=!1,c=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(r||c)&&this._fillPoles(t,r,c)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){let c=t[r+1];c===ql&&(t[r+1]=-32767),c===Eu&&(t[r+1]=32766)}}_generatePoleQuad(t,r,c,h,y,_){h>y!=(_===ql)?(t.push(r),t.push(c),t.push(this._vertexToIndex(h,_)),t.push(c),t.push(this._vertexToIndex(y,_)),t.push(this._vertexToIndex(h,_))):(t.push(c),t.push(r),t.push(this._vertexToIndex(h,_)),t.push(this._vertexToIndex(y,_)),t.push(c),t.push(this._vertexToIndex(h,_)))}_fillPoles(t,r,c){let h=this._vertexBuffer,y=Ot,_=t.length;for(let x=2;x<_;x+=3){let w=t[x-2],I=t[x-1],A=t[x],k=h[2*w],z=h[2*w+1],F=h[2*I],N=h[2*I+1],$=h[2*A],Z=h[2*A+1];r&&(z===0&&N===0&&this._generatePoleQuad(t,w,I,k,F,ql),N===0&&Z===0&&this._generatePoleQuad(t,I,A,F,$,ql),Z===0&&z===0&&this._generatePoleQuad(t,A,w,$,k,ql)),c&&(z===y&&N===y&&this._generatePoleQuad(t,w,I,k,F,Eu),N===y&&Z===y&&this._generatePoleQuad(t,I,A,F,$,Eu),Z===y&&z===y&&this._generatePoleQuad(t,A,w,$,k,Eu))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:c,holeIndices:h}=(function(x){let w=[],I=[];for(let A of x)if(A.length!==0){A!==x[0]&&w.push(I.length/2);for(let k=0;k<A.length;k++)I.push(A[k].x),I.push(A[k].y)}return{flattened:I,holeIndices:w}})(t),y;this._initializeVertices(c);try{let x=(function(I,A,k=2){let z=A&&A.length,F=z?A[0]*k:I.length,N=w_(I,0,F,k,!0),$=[];if(!N||N.next===N.prev)return $;let Z,X,ce;if(z&&(N=(function(ie,ne,_e,Te){let Ae=[];for(let je=0,ze=ne.length;je<ze;je++){let Be=w_(ie,ne[je]*Te,je<ze-1?ne[je+1]*Te:ie.length,Te,!1);Be===Be.next&&(Be.steiner=!0),Ae.push(Dw(Be))}Ae.sort(kw);for(let je=0;je<Ae.length;je++)_e=Rw(Ae[je],_e);return _e})(I,A,N,k)),I.length>80*k){Z=I[0],X=I[1];let ie=Z,ne=X;for(let _e=k;_e<F;_e+=k){let Te=I[_e],Ae=I[_e+1];Te<Z&&(Z=Te),Ae<X&&(X=Ae),Te>ie&&(ie=Te),Ae>ne&&(ne=Ae)}ce=Math.max(ie-Z,ne-X),ce=ce!==0?32767/ce:0}return Tu(N,$,k,Z,X,ce,0),$})(c,h),w=this._convertIndices(c,x);y=this._subdivideTrianglesScanline(w)}catch(x){console.error(x)}let _=[];return r&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:_}}_convertIndices(t,r){let c=[];for(let h=0;h<r.length;h++)c.push(this._vertexToIndex(t[2*r[h]],t[2*r[h]+1]));return c}_pointArrayToIndices(t){let r=[];for(let c=0;c<t.length;c++){let h=t[c];r.push(this._vertexToIndex(h.x,h.y))}return r}}function E_(n,t,r,c=!0){return new Ow(r,t).subdividePolygonInternal(n,c)}function xs(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];let c=n[0],h=n[n.length-1],y=r&&(c.x!==h.x||c.y!==h.y);if(t<2)return y?[...n,n[0]]:[...n];let _=Math.floor(Ot/t),x=[];x.push(new b(n[0].x,n[0].y));let w=n.length,I=y?w:w-1;for(let A=0;A<I;A++){let k=n[A],z=A<w-1?n[A+1]:n[0],F=k.x,N=k.y,$=z.x,Z=z.y,X=F!==$,ce=N!==Z;if(!X&&!ce)continue;let ie=$-F,ne=Z-N,_e=Math.abs(ie),Te=Math.abs(ne),Ae=F,je=N;for(;;){let Be=ie>0?(Math.floor(Ae/_)+1)*_:(Math.ceil(Ae/_)-1)*_,Je=ne>0?(Math.floor(je/_)+1)*_:(Math.ceil(je/_)-1)*_,Ne=Math.abs(Ae-Be),Ue=Math.abs(je-Je),Ie=Math.abs(Ae-$),st=Math.abs(je-Z),ct=X?Ne/_e:Number.POSITIVE_INFINITY,tt=ce?Ue/Te:Number.POSITIVE_INFINITY;if((Ie<=Ne||!X)&&(st<=Ue||!ce))break;if(ct<tt&&X||!ce){Ae=Be,je+=ne*ct;let Ke=new b(Ae,Math.round(je));x[x.length-1].x===Ke.x&&x[x.length-1].y===Ke.y||x.push(Ke)}else{Ae+=ie*tt,je=Je;let Ke=new b(Math.round(Ae),je);x[x.length-1].x===Ke.x&&x[x.length-1].y===Ke.y||x.push(Ke)}}let ze=new b($,Z);x[x.length-1].x===ze.x&&x[x.length-1].y===ze.y||x.push(ze)}return x}function Fw(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,h=n[2*t[0]];for(let w=1;w<t.length;w++){let I=n[2*t[w]];I<h&&(h=I,c=w)}let y=t.length,_=c,x=(_+1)%y;for(;;){let w=_-1>=0?_-1:y-1,I=(x+1)%y,A=n[2*t[w]],k=n[2*t[I]],z=n[2*t[_]],F=n[2*t[_]+1],N=n[2*t[x]+1],$=!1;if(A<k)$=!0;else if(A>k)$=!1;else{let Z=N-F,X=-(n[2*t[x]]-z),ce=F<N?1:-1;((A-z)*Z+(n[2*t[w]+1]-F)*X)*ce>((k-z)*Z+(n[2*t[I]+1]-F)*X)*ce&&($=!0)}if($){let Z=t[w],X=t[_],ce=t[x];Z!==X&&Z!==ce&&X!==ce&&r.push(ce,X,Z),_--,_<0&&(_=y-1)}else{let Z=t[I],X=t[_],ce=t[x];Z!==X&&Z!==ce&&X!==ce&&r.push(ce,X,Z),x++,x>=y&&(x=0)}if(w===I)break}}function A_(n,t,r,c,h,y,_,x,w){let I=h.length/2,A=_&&x&&w;if(I<ft.MAX_VERTEX_ARRAY_LENGTH){let k=t.prepareSegment(I,r,c),z=k.vertexLength;for(let $=0;$<y.length;$+=3)c.emplaceBack(z+y[$],z+y[$+1],z+y[$+2]);let F,N;k.vertexLength+=I,k.primitiveLength+=y.length/3,A&&(N=_.prepareSegment(I,r,x),F=N.vertexLength,N.vertexLength+=I);for(let $=0;$<h.length;$+=2)n(h[$],h[$+1]);if(A)for(let $=0;$<w.length;$++){let Z=w[$];for(let X=1;X<Z.length;X+=2)x.emplaceBack(F+Z[X-1],F+Z[X]);N.primitiveLength+=Z.length/2}}else(function(k,z,F,N,$,Z){let X=[];for(let Te=0;Te<N.length/2;Te++)X.push(-1);let ce={count:0},ie=0,ne=k.getOrCreateLatestSegment(z,F),_e=ne.vertexLength;for(let Te=2;Te<$.length;Te+=3){let Ae=$[Te-2],je=$[Te-1],ze=$[Te],Be=X[Ae]<ie,Je=X[je]<ie,Ne=X[ze]<ie;ne.vertexLength+((Be?1:0)+(Je?1:0)+(Ne?1:0))>ft.MAX_VERTEX_ARRAY_LENGTH&&(ne=k.createNewSegment(z,F),ie=ce.count,Be=!0,Je=!0,Ne=!0,_e=0);let Ue=Au(X,N,Z,ce,Ae,Be,ne),Ie=Au(X,N,Z,ce,je,Je,ne),st=Au(X,N,Z,ce,ze,Ne,ne);F.emplaceBack(_e+Ue-ie,_e+Ie-ie,_e+st-ie),ne.primitiveLength++}})(t,r,c,h,y,n),A&&(function(k,z,F,N,$,Z){let X=[];for(let Te=0;Te<N.length/2;Te++)X.push(-1);let ce={count:0},ie=0,ne=k.getOrCreateLatestSegment(z,F),_e=ne.vertexLength;for(let Te=0;Te<$.length;Te++){let Ae=$[Te];for(let je=1;je<$[Te].length;je+=2){let ze=Ae[je-1],Be=Ae[je],Je=X[ze]<ie,Ne=X[Be]<ie;ne.vertexLength+((Je?1:0)+(Ne?1:0))>ft.MAX_VERTEX_ARRAY_LENGTH&&(ne=k.createNewSegment(z,F),ie=ce.count,Je=!0,Ne=!0,_e=0);let Ue=Au(X,N,Z,ce,ze,Je,ne),Ie=Au(X,N,Z,ce,Be,Ne,ne);F.emplaceBack(_e+Ue-ie,_e+Ie-ie),ne.primitiveLength++}}})(_,r,x,h,w,n),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function Au(n,t,r,c,h,y,_){if(y){let x=c.count;return r(t[2*h],t[2*h+1]),n[h]=c.count,c.count++,_.vertexLength++,x}return n[h]}class mm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new we,this.indexArray=new Bt,this.indexArray2=new Ft,this.programConfigurations=new yr(t.layers,t.zoom),this.segments=new ft,this.segments2=new ft,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.hasPattern=hm("fill",this.layers,r);let h=this.layers[0].layout.get("fill-sort-key"),y=!h.isConstant(),_=[];for(let{feature:x,id:w,index:I,sourceLayerIndex:A}of t){let k=this.layers[0]._featureFilter.needGeometry,z=En(x,k);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom,{globalState:this.globalState}),z,c))continue;let F=y?h.evaluate(z,{},c,r.availableImages):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:k?z.geometry:oo(x),patterns:{},sortKey:F};_.push(N)}y&&_.sort(((x,w)=>x.sortKey-w.sortKey));for(let x of _){let{geometry:w,index:I,sourceLayerIndex:A}=x;if(this.hasPattern){let k=dm("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(x,w,I,c,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,w,I,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}addFeatures(t,r,c){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,c,h,y,_){for(let x of rs(r,500)){let w=E_(x,h,_.fill.getGranularityForZoomLevel(h.z)),I=this.layoutVertexArray;A_(((A,k)=>{I.emplaceBack(A,k)}),this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,y,h)}}let C_,M_;Ge("FillBucket",mm,{omit:["layers","patternFeatures"]});var Nw={get paint(){return M_=M_||new er({"fill-antialias":new Ye(fe.paint_fill["fill-antialias"]),"fill-opacity":new ot(fe.paint_fill["fill-opacity"]),"fill-color":new ot(fe.paint_fill["fill-color"]),"fill-outline-color":new ot(fe.paint_fill["fill-outline-color"]),"fill-translate":new Ye(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new zl(fe.paint_fill["fill-pattern"])})},get layout(){return C_=C_||new er({"fill-sort-key":new ot(fe.layout_fill["fill-sort-key"])})}};class Bw extends Pr{constructor(t){super(t,Nw)}recalculate(t,r){super.recalculate(t,r);let c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new mm(t)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:c,pixelsToTileUnits:h}){return l_(kd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,h),r)}isTileClipped(){return!0}}let Uw=si([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),jw=si([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vw}=Uw;class Zl{constructor(t,r,c,h,y){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields($w,this,r)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,c=[],h,y=1,_=0,x=0,w=0;for(;t.pos<r;){if(_<=0){let I=t.readVarint();y=7&I,_=I>>3}if(_--,y===1||y===2)x+=t.readSVarint(),w+=t.readSVarint(),y===1&&(h&&c.push(h),h=[]),h&&h.push(new b(x,w));else{if(y!==7)throw new Error(`unknown command ${y}`);h&&h.push(h[0].clone())}}return h&&c.push(h),c}bbox(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,c=1,h=0,y=0,_=0,x=1/0,w=-1/0,I=1/0,A=-1/0;for(;t.pos<r;){if(h<=0){let k=t.readVarint();c=7&k,h=k>>3}if(h--,c===1||c===2)y+=t.readSVarint(),_+=t.readSVarint(),y<x&&(x=y),y>w&&(w=y),_<I&&(I=_),_>A&&(A=_);else if(c!==7)throw new Error(`unknown command ${c}`)}return[x,I,w,A]}toGeoJSON(t,r,c){let h=this.extent*Math.pow(2,c),y=this.extent*t,_=this.extent*r,x=this.loadGeometry();function w(z){return[360*(z.x+y)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+_)/h)*Math.PI))-90]}function I(z){return z.map(w)}let A;if(this.type===1){let z=[];for(let N of x)z.push(N[0]);let F=I(z);A=z.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){let z=x.map(I);A=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{let z=(function(N){let $=N.length;if($<=1)return[N];let Z=[],X,ce;for(let ie=0;ie<$;ie++){let ne=Gw(N[ie]);ne!==0&&(ce===void 0&&(ce=ne<0),ce===ne<0?(X&&Z.push(X),X=[N[ie]]):X&&X.push(N[ie]))}return X&&Z.push(X),Z})(x),F=[];for(let N of z)F.push(N.map(I));A=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}let k={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function $w(n,t,r){n===1?t.id=r.readVarint():n===2?(function(c,h){let y=c.readVarint()+c.pos;for(;c.pos<y;){let _=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[_]=x}})(r,t):n===3?t.type=r.readVarint():n===4&&(t._geometry=r.pos)}function Gw(n){let t=0;for(let r,c,h=0,y=n.length,_=y-1;h<y;_=h++)r=n[h],c=n[_],t+=(c.x-r.x)*(r.y+c.y);return t}Zl.types=["Unknown","Point","LineString","Polygon"];class k_{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(qw,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let r=this._pbf.readVarint()+this._pbf.pos;return new Zl(this._pbf,r,this.extent,this._keys,this._values)}}function qw(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(c){let h=null,y=c.readVarint()+c.pos;for(;c.pos<y;){let _=c.readVarint()>>3;h=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(r))}class R_{constructor(t,r){this.layers=t.readFields(Zw,{},r)}}function Zw(n,t,r){if(n===3){let c=new k_(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}let gm=Math.pow(2,13);function Cu(n,t,r,c,h,y,_,x){n.emplaceBack(t,r,2*Math.floor(c*gm)+_,h*gm*2,y*gm*2,Math.round(x))}class ym{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.centroidVertexArray=new Q,this.indexArray=new Bt,this.programConfigurations=new yr(t.layers,t.zoom),this.segments=new ft,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.features=[],this.hasPattern=hm("fill-extrusion",this.layers,r);for(let{feature:h,id:y,index:_,sourceLayerIndex:x}of t){let w=this.layers[0]._featureFilter.needGeometry,I=En(h,w);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom,{globalState:this.globalState}),I,c))continue;let A={id:y,sourceLayerIndex:x,index:_,geometry:w?I.geometry:oo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(dm("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,_,c,{},r.subdivisionGranularity),r.featureIndex.insert(h,A.geometry,_,x,this.index,!0)}}addFeatures(t,r,c){for(let h of this.features){let{geometry:y}=h;this.addFeature(h,y,h.index,r,c,t.subdivisionGranularity)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,jw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,c,h,y,_){for(let x of rs(r,500)){let w={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(w,h,t,x,_);let A=this.layoutVertexArray.length-I,k=Math.floor(w.x/w.sampleCount),z=Math.floor(w.y/w.sampleCount);for(let F=0;F<A;F++)this.centroidVertexArray.emplaceBack(k,z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,y,h)}processPolygon(t,r,c,h,y){if(h.length<1||L_(h[0]))return;for(let k of h)k.length!==0&&Ww(t,k);let _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=y.fill.getGranularityForZoomLevel(r.z),w=Zl.types[c.type]==="Polygon";for(let k of h){if(k.length===0||L_(k))continue;let z=xs(k,x,w);this._generateSideFaces(z,_)}if(!w)return;let I=E_(h,r,x,!1),A=this.layoutVertexArray;A_(((k,z)=>{Cu(A,k,z,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,r){let c=0;for(let h=1;h<t.length;h++){let y=t[h],_=t[h-1];if(Hw(y,_))continue;r.segment.vertexLength+4>ft.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let x=y.sub(_)._perp()._unit(),w=_.dist(y);c+w>32768&&(c=0),Cu(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,0,c),Cu(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,1,c),c+=w,Cu(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,0,c),Cu(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,1,c);let I=r.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Ww(n,t){for(let r=0;r<t.length;r++){let c=t[r];r===t.length-1&&t[0].x===c.x&&t[0].y===c.y||(n.x+=c.x,n.y+=c.y,n.sampleCount++)}}function Hw(n,t){return n.x===t.x&&(n.x<0||n.x>Ot)||n.y===t.y&&(n.y<0||n.y>Ot)}function L_(n){return n.every((t=>t.x<0))||n.every((t=>t.x>Ot))||n.every((t=>t.y<0))||n.every((t=>t.y>Ot))}let D_;Ge("FillExtrusionBucket",ym,{omit:["layers","features"]});var Kw={get paint(){return D_=D_||new er({"fill-extrusion-opacity":new Ye(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zl(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Xw extends Pr{constructor(t){super(t,Kw)}createBucket(t){return new ym(t)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:h,transform:y,pixelsToTileUnits:_,pixelPosMatrix:x}){let w=kd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,_),I=this.paint.get("fill-extrusion-height").evaluate(r,c),A=this.paint.get("fill-extrusion-base").evaluate(r,c),k=(function(F,N){let $=[];for(let Z of F){let X=[Z.x,Z.y,0,1];mo(X,X,N),$.push(new b(X[0]/X[3],X[1]/X[3]))}return $})(w,x),z=(function(F,N,$,Z){let X=[],ce=[],ie=Z[8]*N,ne=Z[9]*N,_e=Z[10]*N,Te=Z[11]*N,Ae=Z[8]*$,je=Z[9]*$,ze=Z[10]*$,Be=Z[11]*$;for(let Je of F){let Ne=[],Ue=[];for(let Ie of Je){let st=Ie.x,ct=Ie.y,tt=Z[0]*st+Z[4]*ct+Z[12],Ke=Z[1]*st+Z[5]*ct+Z[13],At=Z[2]*st+Z[6]*ct+Z[14],ii=Z[3]*st+Z[7]*ct+Z[15],Si=At+_e,Hi=ii+Te,Gr=tt+Ae,vr=Ke+je,Ni=At+ze,Jt=ii+Be,Mi=new b((tt+ie)/Hi,(Ke+ne)/Hi);Mi.z=Si/Hi,Ne.push(Mi);let Bi=new b(Gr/Jt,vr/Jt);Bi.z=Ni/Jt,Ue.push(Bi)}X.push(Ne),ce.push(Ue)}return[X,ce]})(h,A,I,x);return(function(F,N,$){let Z=1/0;l_($,N)&&(Z=z_($,N[0]));for(let X=0;X<N.length;X++){let ce=N[X],ie=F[X];for(let ne=0;ne<ce.length-1;ne++){let _e=ce[ne],Te=[_e,ce[ne+1],ie[ne+1],ie[ne],_e];s_($,Te)&&(Z=Math.min(Z,z_($,Te)))}}return Z!==1/0&&Z})(z[0],z[1],k)}}function Mu(n,t){return n.x*t.x+n.y*t.y}function z_(n,t){if(n.length===1){let r=0,c=t[r++],h;for(;!h||c.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){let y=t[r],_=n[0],x=h.sub(c),w=y.sub(c),I=_.sub(c),A=Mu(x,x),k=Mu(x,w),z=Mu(w,w),F=Mu(I,x),N=Mu(I,w),$=A*z-k*k,Z=(z*F-k*N)/$,X=(A*N-k*F)/$,ce=c.z*(1-Z-X)+h.z*Z+y.z*X;if(isFinite(ce))return ce}return 1/0}{let r=1/0;for(let c of t)r=Math.min(r,c.z);return r}}let Yw=si([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Jw}=Yw,Qw=si([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:e2}=Qw,t2=Math.cos(Math.PI/180*37.5),O_=Math.pow(2,14)/.5;class _m{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new ye,this.layoutVertexArray2=new be,this.indexArray=new Bt,this.programConfigurations=new yr(t.layers,t.zoom),this.segments=new ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,c){this.hasPattern=hm("line",this.layers,r);let h=this.layers[0].layout.get("line-sort-key"),y=!h.isConstant(),_=[];for(let{feature:x,id:w,index:I,sourceLayerIndex:A}of t){let k=this.layers[0]._featureFilter.needGeometry,z=En(x,k);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom,{globalState:this.globalState}),z,c))continue;let F=y?h.evaluate(z,{},c):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:k?z.geometry:oo(x),patterns:{},sortKey:F};_.push(N)}y&&_.sort(((x,w)=>x.sortKey-w.sortKey));for(let x of _){let{geometry:w,index:I,sourceLayerIndex:A}=x;if(this.hasPattern){let k=dm("line",this.layers,x,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(x,w,I,c,{},r.subdivisionGranularity);r.featureIndex.insert(t[I].feature,w,I,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}addFeatures(t,r,c){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,e2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jw),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,c,h,y,_){let x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),I=x.get("line-cap"),A=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let z of r)this.addLine(z,t,w,I,A,k,h,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,y,h)}addLine(t,r,c,h,y,_,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=xs(t,x?w.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=Zl.types[r.type]==="Polygon",A=t.length;for(;A>=2&&t[A-1].equals(t[A-2]);)A--;let k=0;for(;k<A-1&&t[k].equals(t[k+1]);)k++;if(A<(I?3:2))return;c==="bevel"&&(y=1.05);let z=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray),N,$,Z,X,ce;this.e1=this.e2=-1,I&&(N=t[A-2],ce=t[k].sub(N)._unit()._perp());for(let ie=k;ie<A;ie++){if(Z=ie===A-1?I?t[k+1]:void 0:t[ie+1],Z&&t[ie].equals(Z))continue;ce&&(X=ce),N&&($=N),N=t[ie],ce=Z?Z.sub(N)._unit()._perp():X,X=X||ce;let ne=X.add(ce);ne.x===0&&ne.y===0||ne._unit();let _e=X.x*ce.x+X.y*ce.y,Te=ne.x*ce.x+ne.y*ce.y,Ae=Te!==0?1/Te:1/0,je=2*Math.sqrt(2-2*Te),ze=Te<t2&&$&&Z,Be=X.x*ce.y-X.y*ce.x>0;if(ze&&ie>k){let Ue=N.dist($);if(Ue>2*z){let Ie=N.sub(N.sub($)._mult(z/Ue)._round());this.updateDistance($,Ie),this.addCurrentVertex(Ie,X,0,0,F),$=Ie}}let Je=$&&Z,Ne=Je?c:I?"butt":h;if(Je&&Ne==="round"&&(Ae<_?Ne="miter":Ae<=2&&(Ne="fakeround")),Ne==="miter"&&Ae>y&&(Ne="bevel"),Ne==="bevel"&&(Ae>2&&(Ne="flipbevel"),Ae<y&&(Ne="miter")),$&&this.updateDistance($,N),Ne==="miter")ne._mult(Ae),this.addCurrentVertex(N,ne,0,0,F);else if(Ne==="flipbevel"){if(Ae>100)ne=ce.mult(-1);else{let Ue=Ae*X.add(ce).mag()/X.sub(ce).mag();ne._perp()._mult(Ue*(Be?-1:1))}this.addCurrentVertex(N,ne,0,0,F),this.addCurrentVertex(N,ne.mult(-1),0,0,F)}else if(Ne==="bevel"||Ne==="fakeround"){let Ue=-Math.sqrt(Ae*Ae-1),Ie=Be?Ue:0,st=Be?0:Ue;if($&&this.addCurrentVertex(N,X,Ie,st,F),Ne==="fakeround"){let ct=Math.round(180*je/Math.PI/20);for(let tt=1;tt<ct;tt++){let Ke=tt/ct;if(Ke!==.5){let ii=Ke-.5;Ke+=Ke*ii*(Ke-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*ii*ii+(.848013+_e*(.215638*_e-1.06021)))}let At=ce.sub(X)._mult(Ke)._add(X)._unit()._mult(Be?-1:1);this.addHalfVertex(N,At.x,At.y,!1,Be,0,F)}}Z&&this.addCurrentVertex(N,ce,-Ie,-st,F)}else if(Ne==="butt")this.addCurrentVertex(N,ne,0,0,F);else if(Ne==="square"){let Ue=$?1:-1;this.addCurrentVertex(N,ne,Ue,Ue,F)}else Ne==="round"&&($&&(this.addCurrentVertex(N,X,0,0,F),this.addCurrentVertex(N,X,1,1,F,!0)),Z&&(this.addCurrentVertex(N,ce,-1,-1,F,!0),this.addCurrentVertex(N,ce,0,0,F)));if(ze&&ie<A-1){let Ue=N.dist(Z);if(Ue>2*z){let Ie=N.add(Z.sub(N)._mult(z/Ue)._round());this.updateDistance(N,Ie),this.addCurrentVertex(Ie,ce,0,0,F),N=Ie}}}}addCurrentVertex(t,r,c,h,y,_=!1){let x=r.y*h-r.x,w=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*c,r.y-r.x*c,_,!1,c,y),this.addHalfVertex(t,x,w,_,!0,-h,y),this.distance>O_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,c,h,y,_))}addHalfVertex({x:t,y:r},c,h,y,_,x,w){let I=.5*(this.lineClips?this.scaledDistance*(O_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(r<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let A=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),w.primitiveLength++),_?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let F_,N_;Ge("LineBucket",_m,{omit:["layers","patternFeatures"]});var B_={get paint(){return N_=N_||new er({"line-opacity":new ot(fe.paint_line["line-opacity"]),"line-color":new ot(fe.paint_line["line-color"]),"line-translate":new Ye(fe.paint_line["line-translate"]),"line-translate-anchor":new Ye(fe.paint_line["line-translate-anchor"]),"line-width":new ot(fe.paint_line["line-width"]),"line-gap-width":new ot(fe.paint_line["line-gap-width"]),"line-offset":new ot(fe.paint_line["line-offset"]),"line-blur":new ot(fe.paint_line["line-blur"]),"line-dasharray":new eo(fe.paint_line["line-dasharray"]),"line-pattern":new zl(fe.paint_line["line-pattern"]),"line-gradient":new Ol(fe.paint_line["line-gradient"])})},get layout(){return F_=F_||new er({"line-cap":new Ye(fe.layout_line["line-cap"]),"line-join":new ot(fe.layout_line["line-join"]),"line-miter-limit":new Ye(fe.layout_line["line-miter-limit"]),"line-round-limit":new Ye(fe.layout_line["line-round-limit"]),"line-sort-key":new ot(fe.layout_line["line-sort-key"])})}};class i2 extends ot{possiblyEvaluate(t,r){return r=new Kt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,h){return r=Tr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,h)}}let zd;class r2 extends Pr{constructor(t){super(t,B_),this.gradientVersion=0,zd||(zd=new i2(B_.paint.properties["line-width"].specification),zd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!(function(c){return c._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof ai,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=zd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new _m(t)}queryRadius(t){let r=t,c=U_(bu("line-width",this,r),bu("line-gap-width",this,r)),h=bu("line-offset",this,r);return c/2+Math.abs(h)+Md(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:c,geometry:h,transform:y,pixelsToTileUnits:_}){let x=kd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,_),w=_/2*U_(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),I=this.paint.get("line-offset").evaluate(r,c);return I&&(h=(function(A,k){let z=[];for(let F=0;F<A.length;F++){let N=A[F],$=[];for(let Z=0;Z<N.length;Z++){let X=N[Z-1],ce=N[Z],ie=N[Z+1],ne=Z===0?new b(0,0):ce.sub(X)._unit()._perp(),_e=Z===N.length-1?new b(0,0):ie.sub(ce)._unit()._perp(),Te=ne._add(_e)._unit(),Ae=Te.x*_e.x+Te.y*_e.y;Ae!==0&&Te._mult(1/Ae),$.push(Te._mult(k)._add(ce))}z.push($)}return z})(h,I*_)),(function(A,k,z){for(let F=0;F<k.length;F++){let N=k[F];if(A.length>=3){for(let $=0;$<N.length;$++)if(Vl(A,N[$]))return!0}if(fw(A,N,z))return!0}return!1})(x,h,w)}isTileClipped(){return!0}}function U_(n,t){return t>0?t+2*n:n}let n2=si([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),o2=si([{name:"a_projected_pos",components:3,type:"Float32"}],4);si([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let a2=si([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);si([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let j_=si([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),s2=si([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function l2(n,t,r){return n.sections.forEach((c=>{c.text=(function(h,y,_){let x=y.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Br.applyArabicShaping&&(h=Br.applyArabicShaping(h)),h})(c.text,t,r)})),n}si([{name:"triangle",components:3,type:"Uint16"}]),si([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),si([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),si([{type:"Float32",name:"offsetX"}]),si([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),si([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let ku={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Ci=24;let vm=4294967296,V_=1/vm,$_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class xm{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,c=this.length){for(;this.pos<c;){let h=this.readVarint(),y=h>>3,_=this.pos;this.type=7&h,t(y,r,this),this.pos===_&&this.skip(h)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vm;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vm;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let r=this.buf,c,h;return h=r[this.pos++],c=127&h,h<128?c:(h=r[this.pos++],c|=(127&h)<<7,h<128?c:(h=r[this.pos++],c|=(127&h)<<14,h<128?c:(h=r[this.pos++],c|=(127&h)<<21,h<128?c:(h=r[this.pos],c|=(15&h)<<28,(function(y,_,x){let w=x.buf,I,A;if(A=w[x.pos++],I=(112&A)>>4,A<128||(A=w[x.pos++],I|=(127&A)<<3,A<128)||(A=w[x.pos++],I|=(127&A)<<10,A<128)||(A=w[x.pos++],I|=(127&A)<<17,A<128)||(A=w[x.pos++],I|=(127&A)<<24,A<128)||(A=w[x.pos++],I|=(1&A)<<31,A<128))return Wl(y,I,_);throw new Error("Expected varint not more than 10 bytes")})(c,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&$_?$_.decode(this.buf.subarray(r,t)):(function(c,h,y){let _="",x=h;for(;x<y;){let w=c[x],I,A,k,z=null,F=w>239?4:w>223?3:w>191?2:1;if(x+F>y)break;F===1?w<128&&(z=w):F===2?(I=c[x+1],(192&I)==128&&(z=(31&w)<<6|63&I,z<=127&&(z=null))):F===3?(I=c[x+1],A=c[x+2],(192&I)==128&&(192&A)==128&&(z=(15&w)<<12|(63&I)<<6|63&A,(z<=2047||z>=55296&&z<=57343)&&(z=null))):F===4&&(I=c[x+1],A=c[x+2],k=c[x+3],(192&I)==128&&(192&A)==128&&(192&k)==128&&(z=(15&w)<<18|(63&I)<<12|(63&A)<<6|63&k,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,F=1):z>65535&&(z-=65536,_+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),_+=String.fromCharCode(z),x+=F}return _})(this.buf,r,t)}readBytes(){let t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){let c=this.readPackedEnd();for(;this.pos<c;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){let c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*V_),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*V_),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,c){let h,y;if(r>=0?(h=r%4294967296|0,y=r/4294967296|0):(h=~(-r%4294967296),y=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,y=y+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),(function(_,x,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)})(h,0,c),(function(_,x){let w=(7&_)<<4;x.buf[x.pos++]|=w|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))})(y,c)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let r=this.pos;this.pos=(function(h,y,_){for(let x,w,I=0;I<y.length;I++){if(x=y.charCodeAt(I),x>55295&&x<57344){if(!w){x>56319||I+1===y.length?(h[_++]=239,h[_++]=191,h[_++]=189):w=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(h[_++]=239,h[_++]=191,h[_++]=189,w=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _})(this.buf,t,this.pos);let c=this.pos-r;c>=128&&G_(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let r=t.length;this.writeVarint(r),this.realloc(r);for(let c=0;c<r;c++)this.buf[this.pos++]=t[c]}writeRawMessage(t,r){this.pos++;let c=this.pos;t(r,this);let h=this.pos-c;h>=128&&G_(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h}writeMessage(t,r,c){this.writeTag(t,2),this.writeRawMessage(r,c)}writePackedVarint(t,r){r.length&&this.writeMessage(t,c2,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,u2,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,p2,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,h2,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,d2,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,f2,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,m2,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,g2,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,y2,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function Wl(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function G_(n,t,r){let c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(let h=r.pos-1;h>=n;h--)r.buf[h+c]=r.buf[h]}function c2(n,t){for(let r=0;r<n.length;r++)t.writeVarint(n[r])}function u2(n,t){for(let r=0;r<n.length;r++)t.writeSVarint(n[r])}function h2(n,t){for(let r=0;r<n.length;r++)t.writeFloat(n[r])}function d2(n,t){for(let r=0;r<n.length;r++)t.writeDouble(n[r])}function p2(n,t){for(let r=0;r<n.length;r++)t.writeBoolean(n[r])}function f2(n,t){for(let r=0;r<n.length;r++)t.writeFixed32(n[r])}function m2(n,t){for(let r=0;r<n.length;r++)t.writeSFixed32(n[r])}function g2(n,t){for(let r=0;r<n.length;r++)t.writeFixed64(n[r])}function y2(n,t){for(let r=0;r<n.length;r++)t.writeSFixed64(n[r])}function _2(n,t,r){n===1&&r.readMessage(v2,t)}function v2(n,t,r){if(n===3){let{id:c,bitmap:h,width:y,height:_,left:x,top:w,advance:I}=r.readMessage(x2,{});t.push({id:c,bitmap:new wu({width:y+6,height:_+6},h),metrics:{width:y,height:_,left:x,top:w,advance:I}})}}function x2(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function q_(n){let t=0,r=0;for(let _ of n)t+=_.w*_.h,r=Math.max(r,_.w);n.sort(((_,x)=>x.h-_.h));let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],h=0,y=0;for(let _ of n)for(let x=c.length-1;x>=0;x--){let w=c[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,y=Math.max(y,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){let I=c.pop();I&&x<c.length&&(c[x]=I)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(c.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:y,fill:t/(h*y)||0}}class bm{constructor(t,{pixelRatio:r,version:c,stretchX:h,stretchY:y,content:_,textFitWidth:x,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=y,this.content=_,this.version=c,this.textFitWidth=x,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Z_{constructor(t,r){let c={},h={};this.haveRenderCallbacks=[];let y=[];this.addImages(t,c,y),this.addImages(r,h,y);let{w:_,h:x}=q_(y),w=new _r({width:_||1,height:x||1});for(let I in t){let A=t[I],k=c[I].paddedRect;_r.copy(A.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},A.data)}for(let I in r){let A=r[I],k=h[I].paddedRect,z=k.x+1,F=k.y+1,N=A.data.width,$=A.data.height;_r.copy(A.data,w,{x:0,y:0},{x:z,y:F},A.data),_r.copy(A.data,w,{x:0,y:$-1},{x:z,y:F-1},{width:N,height:1}),_r.copy(A.data,w,{x:0,y:0},{x:z,y:F+$},{width:N,height:1}),_r.copy(A.data,w,{x:N-1,y:0},{x:z-1,y:F},{width:1,height:$}),_r.copy(A.data,w,{x:0,y:0},{x:z+N,y:F},{width:1,height:$})}this.image=w,this.iconPositions=c,this.patternPositions=h}addImages(t,r,c){for(let h in t){let y=t[h],_={x:0,y:0,w:y.data.width+2,h:y.data.height+2};c.push(_),r[h]=new bm(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),r),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),r)}patchUpdatedImage(t,r,c){if(!t||!r||t.version===r.version)return;t.version=r.version;let[h,y]=t.tl;c.update(r.data,void 0,{x:h,y})}}var Ca;Ge("ImagePosition",bm),Ge("ImageAtlas",Z_),p.ao=void 0,(Ca=p.ao||(p.ao={}))[Ca.none=0]="none",Ca[Ca.horizontal=1]="horizontal",Ca[Ca.vertical=2]="vertical",Ca[Ca.horizontalOnly=3]="horizontalOnly";class Ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,c){let h=new Ru;return h.scale=t||1,h.fontStack=r,h.verticalAlign=c||"bottom",h}static forImage(t,r){let c=new Ru;return c.imageName=t,c.verticalAlign=r||"bottom",c}}class Hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let c=new Hl;for(let h=0;h<t.sections.length;h++){let y=t.sections[h];y.image?c.addImageSection(y):c.addTextSection(y,r)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let c=0;c<t.length;c++){let h=t.charCodeAt(c+1)||null,y=t.charCodeAt(c-1)||null;r+=h&&bd(h)&&!ku[t[c+1]]||y&&bd(y)&&!ku[t[c-1]]||!ku[t[c]]?t[c]:ku[t[c]]}return r})(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&Fd[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Fd[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let c=new Hl;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,c=0;for(let h=0;h<this.length();h++){let y=this.getSection(h);if(y.imageName){let _=t[y.imageName];if(!_)continue;let x=_.displaySize;r=Math.max(r,x[0]),c=Math.max(c,x[1])}}return{maxImageWidth:r,maxImageHeight:c}}addTextSection(t,r){this.text+=t.text,this.sections.push(Ru.forText(t.scale,t.fontStack||r,t.verticalAlign));let c=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(c)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void ui("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Ru.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Od(n,t,r,c,h,y,_,x,w,I,A,k,z,F,N){let $=Hl.fromFeature(n,h),Z;k===p.ao.vertical&&$.verticalizePunctuation();let{processBidirectionalText:X,processStyledBidirectionalText:ce}=Br;if(X&&$.sections.length===1){Z=[];let _e=X($.toString(),wm($,I,y,t,c,F));for(let Te of _e){let Ae=new Hl;Ae.text=Te,Ae.sections=$.sections;for(let je=0;je<Te.length;je++)Ae.sectionIndex.push(0);Z.push(Ae)}}else if(ce){Z=[];let _e=ce($.text,$.sectionIndex,wm($,I,y,t,c,F));for(let Te of _e){let Ae=new Hl;Ae.text=Te[0],Ae.sectionIndex=Te[1],Ae.sections=$.sections,Z.push(Ae)}}else Z=(function(_e,Te){let Ae=[],je=_e.text,ze=0;for(let Be of Te)Ae.push(_e.substring(ze,Be)),ze=Be;return ze<je.length&&Ae.push(_e.substring(ze,je.length)),Ae})($,wm($,I,y,t,c,F));let ie=[],ne={positionedLines:ie,text:$.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1};return(function(_e,Te,Ae,je,ze,Be,Je,Ne,Ue,Ie,st,ct){let tt=0,Ke=0,At=0,ii=0,Si=Ne==="right"?1:Ne==="left"?0:.5,Hi=Ci/ct,Gr=0;for(let Jt of ze){Jt.trim();let Mi=Jt.getMaxScale(),Bi={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Gr]=Bi;let Ui=Bi.positionedGlyphs,hr=0;if(!Jt.length()){Ke+=Be,++Gr;continue}let qr=S2(je,Jt,Hi);for(let xr=0;xr<Jt.length();xr++){let Ii=Jt.getSection(xr),Ri=Jt.getSectionIndex(xr),Li=Jt.getCharCode(xr),_i=I2(Ue,st,Li),Wt;if(Ii.imageName){if(_e.iconsInText=!0,Ii.scale=Ii.scale*Hi,Wt=E2(Ii,_i,Mi,qr,je),!Wt)continue;hr=Math.max(hr,Wt.imageOffset)}else if(Wt=P2(Ii,Li,_i,qr,Te,Ae),!Wt)continue;let{rect:An,metrics:Jl,baselineOffset:Cn}=Wt;Ui.push({glyph:Li,imageName:Ii.imageName,x:tt,y:Ke+Cn+-17,vertical:_i,scale:Ii.scale,fontStack:Ii.fontStack,sectionIndex:Ri,metrics:Jl,rect:An}),_i?(_e.verticalizable=!0,tt+=(Ii.imageName?Jl.advance:Ci)*Ii.scale+Ie):tt+=Jl.advance*Ii.scale+Ie}Ui.length!==0&&(At=Math.max(tt-Ie,At),A2(Ui,0,Ui.length-1,Si)),tt=0,Bi.lineOffset=Math.max(hr,(Mi-1)*Ci);let ki=Be*Mi+hr;Ke+=ki,ii=Math.max(ki,ii),++Gr}let{horizontalAlign:vr,verticalAlign:Ni}=Tm(Je);(function(Jt,Mi,Bi,Ui,hr,qr,ki,xr,Ii){let Ri=(Mi-Bi)*hr,Li=0;Li=qr!==ki?-xr*Ui- -17:-Ui*Ii*ki+.5*ki;for(let _i of Jt)for(let Wt of _i.positionedGlyphs)Wt.x+=Ri,Wt.y+=Li})(_e.positionedLines,Si,vr,Ni,At,ii,Be,Ke,ze.length),_e.top+=-Ni*Ke,_e.bottom=_e.top+Ke,_e.left+=-vr*At,_e.right=_e.left+At})(ne,t,r,c,Z,_,x,w,k,I,z,N),!(function(_e){for(let Te of _e)if(Te.positionedGlyphs.length!==0)return!1;return!0})(ie)&&ne}let Fd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},b2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},w2={40:!0};function W_(n,t,r,c,h,y){if(t.imageName){let _=c[t.imageName];return _?_.displaySize[0]*t.scale*Ci/y+h:0}{let _=r[t.fontStack],x=_&&_[n];return x?x.metrics.advance*t.scale+h:0}}function H_(n,t,r,c){let h=Math.pow(n-t,2);return c?n<t?h/2:2*h:h+Math.abs(r)*r}function T2(n,t,r){let c=0;return n===10&&(c-=1e4),r&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function K_(n,t,r,c,h,y){let _=null,x=H_(t,r,h,y);for(let w of c){let I=H_(t-w.x,r,h,y)+w.badness;I<=x&&(_=w,x=I)}return{index:n,x:t,priorBreak:_,badness:x}}function X_(n){return n?X_(n.priorBreak).concat(n.index):[]}function wm(n,t,r,c,h,y){if(!n)return[];let _=[],x=(function(k,z,F,N,$,Z){let X=0;for(let ce=0;ce<k.length();ce++){let ie=k.getSection(ce);X+=W_(k.getCharCode(ce),ie,N,$,z,Z)}return X/Math.max(1,Math.ceil(X/F))})(n,t,r,c,h,y),w=n.text.indexOf("\u200B")>=0,I=0;for(let k=0;k<n.length();k++){let z=n.getSection(k),F=n.getCharCode(k);if(Fd[F]||(I+=W_(F,z,c,h,t,y)),k<n.length()-1){let N=!((A=F)<11904)&&(!!Et["CJK Compatibility Forms"](A)||!!Et["CJK Compatibility"](A)||!!Et["CJK Strokes"](A)||!!Et["CJK Symbols and Punctuation"](A)||!!Et["Enclosed CJK Letters and Months"](A)||!!Et["Halfwidth and Fullwidth Forms"](A)||!!Et["Ideographic Description Characters"](A)||!!Et["Vertical Forms"](A)||uu.test(String.fromCodePoint(A)));(b2[F]||N||z.imageName||k!==n.length()-2&&w2[n.getCharCode(k+1)])&&_.push(K_(k+1,I,x,_,T2(F,n.getCharCode(k+1),N&&w),!1))}}var A;return X_(K_(n.length(),I,x,_,0,!0))}function Tm(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function S2(n,t,r){let c=t.getMaxScale()*Ci,{maxImageWidth:h,maxImageHeight:y}=t.getMaxImageSize(n),_=Math.max(c,y*r);return{verticalLineContentWidth:Math.max(c,h*r),horizontalLineContentHeight:_}}function Y_(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function I2(n,t,r){return!(n===p.ao.horizontal||!t&&!hu(r)||t&&(Fd[r]||(c=r,/\p{sc=Arab}/u.test(String.fromCodePoint(c)))));var c}function P2(n,t,r,c,h,y){let _=y[n.fontStack],x=(function(I,A,k,z){if(I&&I.rect)return I;let F=A[k.fontStack],N=F&&F[z];return N?{rect:null,metrics:N.metrics}:null})(_&&_[t],h,n,t);if(x===null)return null;let w;if(r)w=c.verticalLineContentWidth-n.scale*Ci;else{let I=Y_(n.verticalAlign);w=(c.horizontalLineContentHeight-n.scale*Ci)*I}return{rect:x.rect,metrics:x.metrics,baselineOffset:w}}function E2(n,t,r,c,h){let y=h[n.imageName];if(!y)return null;let _=y.paddedRect,x=y.displaySize,w={width:x[0],height:x[1],left:1,top:-3,advance:t?x[1]:x[0]},I;if(t)I=c.verticalLineContentWidth-x[1]*n.scale;else{let A=Y_(n.verticalAlign);I=(c.horizontalLineContentHeight-x[1]*n.scale)*A}return{rect:_,metrics:w,baselineOffset:I,imageOffset:(t?x[0]:x[1])*n.scale-Ci*r}}function A2(n,t,r,c){if(c===0)return;let h=n[r],y=(n[r].x+h.metrics.advance*h.scale)*c;for(let _=t;_<=r;_++)n[_].x-=y}function C2(n,t,r){let{horizontalAlign:c,verticalAlign:h}=Tm(r),y=t[0]-n.displaySize[0]*c,_=t[1]-n.displaySize[1]*h;return{image:n,top:_,bottom:_+n.displaySize[1],left:y,right:y+n.displaySize[0]}}function J_(n){var t,r;let c=n.left,h=n.top,y=n.right-c,_=n.bottom-h,x=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(w==="proportional"){if(x==="stretchOnly"&&y/_<I||x==="proportional"){let A=Math.ceil(_*I);c*=A/y,y=A}}else if(x==="proportional"&&w==="stretchOnly"&&I!==0&&y/_>I){let A=Math.ceil(y/I);h*=A/_,_=A}return{x1:c,y1:h,x2:c+y,y2:h+_}}function Q_(n,t,r,c,h,y){let _=n.image,x;if(_.content){let Z=_.content,X=_.pixelRatio||1;x=[Z[0]/X,Z[1]/X,_.displaySize[0]-Z[2]/X,_.displaySize[1]-Z[3]/X]}let w=t.left*y,I=t.right*y,A,k,z,F;r==="width"||r==="both"?(F=h[0]+w-c[3],k=h[0]+I+c[1]):(F=h[0]+(w+I-_.displaySize[0])/2,k=F+_.displaySize[0]);let N=t.top*y,$=t.bottom*y;return r==="height"||r==="both"?(A=h[1]+N-c[0],z=h[1]+$+c[2]):(A=h[1]+(N+$-_.displaySize[1])/2,z=A+_.displaySize[1]),{image:_,top:A,right:k,bottom:z,left:F,collisionPadding:x}}let Uo=128,Ma=32640;function e0(n,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Kt(n+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:h}=r,y=0;for(;y<c.length&&c[y]<=n;)y++;y=Math.max(0,y-1);let _=y;for(;_<c.length&&c[_]<n+1;)_++;_=Math.min(c.length-1,_);let x=c[y],w=c[_];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:r.evaluate(new Kt(x)),maxSize:r.evaluate(new Kt(w)),interpolationType:h}}}function Sm(n,t,r){let c="never",h=n.get(t);return h?c=h:n.get(r)&&(c="always"),c}let M2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nd(n,t,r,c,h,y,_,x,w,I,A,k,z){let F=x?Math.min(Ma,Math.round(x[0])):0,N=x?Math.min(Ma,Math.round(x[1])):0;n.emplaceBack(t,r,Math.round(32*c),Math.round(32*h),y,_,(F<<1)+(w?1:0),N,16*I,16*A,256*k,256*z)}function Im(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function k2(n){for(let t of n.sections)if(Sd(t.text))return!0;return!1}class Pm{constructor(t){this.layoutVertexArray=new Oe,this.indexArray=new Bt,this.programConfigurations=t,this.segments=new ft,this.dynamicLayoutVertexArray=new Ee,this.opacityVertexArray=new He,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,n2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,o2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,M2,!0),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",Pm);class Em{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new ft,this.collisionVertexArray=new Dt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,a2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",Em);class Kl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=e0(this.zoom,r["text-size"]),this.iconSizeData=e0(this.zoom,r["icon-size"]);let c=this.layers[0].layout,h=c.get("symbol-sort-key"),y=c.get("symbol-z-order");this.canOverlap=Sm(c,"text-overlap","text-allow-overlap")!=="never"||Sm(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map((_=>p.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Pm(new yr(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Pm(new yr(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new K,this.lineVertexArray=new Y,this.symbolInstances=new W,this.textAnchorOffsets=new J}calculateGlyphDependencies(t,r,c,h,y){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(c||h)&&y){let x=ku[t.charAt(_)];x&&(r[x.charCodeAt(0)]=!0)}}populate(t,r,c){let h=this.layers[0],y=h.layout,_=y.get("text-font"),x=y.get("text-field"),w=y.get("icon-image"),I=(x.value.kind!=="constant"||x.value.value instanceof Yi&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),A=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,k=y.get("symbol-sort-key");if(this.features=[],!I&&!A)return;let z=r.iconDependencies,F=r.glyphDependencies,N=r.availableImages,$=new Kt(this.zoom,{globalState:this.globalState});for(let{feature:Z,id:X,index:ce,sourceLayerIndex:ie}of t){let ne=h._featureFilter.needGeometry,_e=En(Z,ne);if(!h._featureFilter.filter($,_e,c))continue;let Te,Ae;if(ne||(_e.geometry=oo(Z)),I){let ze=h.getValueAndResolveTokens("text-field",_e,c,N),Be=Yi.factory(ze),Je=this.hasRTLText=this.hasRTLText||k2(Be);(!Je||Br.getRTLTextPluginStatus()==="unavailable"||Je&&Br.isParsed())&&(Te=l2(Be,h,_e))}if(A){let ze=h.getValueAndResolveTokens("icon-image",_e,c,N);Ae=ze instanceof mr?ze:mr.fromString(ze)}if(!Te&&!Ae)continue;let je=this.sortFeaturesByKey?k.evaluate(_e,{},c):void 0;if(this.features.push({id:X,text:Te,icon:Ae,index:ce,sourceLayerIndex:ie,geometry:_e.geometry,properties:Z.properties,type:Zl.types[Z.type],sortKey:je}),Ae&&(z[Ae.name]=!0),Te){let ze=_.evaluate(_e,{},c).join(","),Be=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(p.ao.vertical)>=0;for(let Je of Te.sections)if(Je.image)z[Je.image.name]=!0;else{let Ne=Rl(Te.toString()),Ue=Je.fontStack||ze,Ie=F[Ue]=F[Ue]||{};this.calculateGlyphDependencies(Je.text,Ie,Be,this.allowVerticalPlacement,Ne)}}}y.get("symbol-placement")==="line"&&(this.features=(function(Z){let X={},ce={},ie=[],ne=0;function _e(ze){ie.push(Z[ze]),ne++}function Te(ze,Be,Je){let Ne=ce[ze];return delete ce[ze],ce[Be]=Ne,ie[Ne].geometry[0].pop(),ie[Ne].geometry[0]=ie[Ne].geometry[0].concat(Je[0]),Ne}function Ae(ze,Be,Je){let Ne=X[Be];return delete X[Be],X[ze]=Ne,ie[Ne].geometry[0].shift(),ie[Ne].geometry[0]=Je[0].concat(ie[Ne].geometry[0]),Ne}function je(ze,Be,Je){let Ne=Je?Be[0][Be[0].length-1]:Be[0][0];return`${ze}:${Ne.x}:${Ne.y}`}for(let ze=0;ze<Z.length;ze++){let Be=Z[ze],Je=Be.geometry,Ne=Be.text?Be.text.toString():null;if(!Ne){_e(ze);continue}let Ue=je(Ne,Je),Ie=je(Ne,Je,!0);if(Ue in ce&&Ie in X&&ce[Ue]!==X[Ie]){let st=Ae(Ue,Ie,Je),ct=Te(Ue,Ie,ie[st].geometry);delete X[Ue],delete ce[Ie],ce[je(Ne,ie[ct].geometry,!0)]=ct,ie[st].geometry=null}else Ue in ce?Te(Ue,Ie,Je):Ie in X?Ae(Ue,Ie,Je):(_e(ze),X[Ue]=ne-1,ce[Ie]=ne-1)}return ie.filter((ze=>ze.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Z,X)=>Z.sortKey-X.sortKey))}update(t,r,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let c=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(r[t.segment+1]),y=t.dist(r[t.segment]),_={};for(let x=t.segment+1;x<r.length;x++)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:h},x<r.length-1&&(h+=r[x+1].dist(r[x]));for(let x=t.segment||0;x>=0;x--)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:y},x>0&&(y+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){let w=_[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,h,y,_,x,w,I,A,k,z){let F=t.indexArray,N=t.layoutVertexArray,$=t.segments.prepareSegment(4*r.length,N,F,this.canOverlap?_.sortKey:void 0),Z=this.glyphOffsetArray.length,X=$.vertexLength,ce=this.allowVerticalPlacement&&x===p.ao.vertical?Math.PI/2:0,ie=_.text&&_.text.sections;for(let ne=0;ne<r.length;ne++){let{tl:_e,tr:Te,bl:Ae,br:je,tex:ze,pixelOffsetTL:Be,pixelOffsetBR:Je,minFontScaleX:Ne,minFontScaleY:Ue,glyphOffset:Ie,isSDF:st,sectionIndex:ct}=r[ne],tt=$.vertexLength,Ke=Ie[1];Nd(N,w.x,w.y,_e.x,Ke+_e.y,ze.x,ze.y,c,st,Be.x,Be.y,Ne,Ue),Nd(N,w.x,w.y,Te.x,Ke+Te.y,ze.x+ze.w,ze.y,c,st,Je.x,Be.y,Ne,Ue),Nd(N,w.x,w.y,Ae.x,Ke+Ae.y,ze.x,ze.y+ze.h,c,st,Be.x,Je.y,Ne,Ue),Nd(N,w.x,w.y,je.x,Ke+je.y,ze.x+ze.w,ze.y+ze.h,c,st,Je.x,Je.y,Ne,Ue),Im(t.dynamicLayoutVertexArray,w,ce),F.emplaceBack(tt,tt+2,tt+1),F.emplaceBack(tt+1,tt+2,tt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ie[0]),ne!==r.length-1&&ct===r[ne+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,_,_.index,{},z,ie&&ie[ct])}t.placedSymbolArray.emplaceBack(w.x,w.y,Z,this.glyphOffsetArray.length-Z,X,I,A,w.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,!1,0,k)}_addCollisionDebugVertex(t,r,c,h,y,_){return r.emplaceBack(0,0),t.emplaceBack(c.x,c.y,h,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,c,h,y,_,x){let w=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=w.vertexLength,A=y.layoutVertexArray,k=y.collisionVertexArray,z=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(A,k,_,z,F,new b(t,r)),this._addCollisionDebugVertex(A,k,_,z,F,new b(c,r)),this._addCollisionDebugVertex(A,k,_,z,F,new b(c,h)),this._addCollisionDebugVertex(A,k,_,z,F,new b(t,h)),w.vertexLength+=4;let N=y.indexArray;N.emplaceBack(I,I+1),N.emplaceBack(I+1,I+2),N.emplaceBack(I+2,I+3),N.emplaceBack(I+3,I),w.primitiveLength+=4}addDebugCollisionBoxes(t,r,c,h){for(let y=t;y<r;y++){let _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Em(gt,j_.members,Ft),this.iconCollisionBox=new Em(gt,j_.members,Ft);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,c,h,y,_,x,w,I){let A={};for(let k=r;k<c;k++){let z=t.get(k);A.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},A.textFeatureIndex=z.featureIndex;break}for(let k=h;k<y;k++){let z=t.get(k);A.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},A.verticalTextFeatureIndex=z.featureIndex;break}for(let k=_;k<x;k++){let z=t.get(k);A.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},A.iconFeatureIndex=z.featureIndex;break}for(let k=w;k<I;k++){let z=t.get(k);A.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},A.verticalIconFeatureIndex=z.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let c=t.placedSymbolArray.get(r),h=c.vertexStartIndex+4*c.numGlyphs;for(let y=c.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+2,y+1),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),c=Math.cos(t),h=[],y=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);let w=this.symbolInstances.get(x);h.push(0|Math.round(r*w.anchorX+c*w.anchorY)),y.push(w.featureIndex)}return _.sort(((x,w)=>h[x]-h[w]||y[w]-y[x])),_}addToSortKeyRanges(t,r){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach(((h,y,_)=>{h>=0&&_.indexOf(h)===y&&this.addIndicesForPlacedSymbol(this.text,h)})),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let t0,i0;Ge("SymbolBucket",Kl,{omit:["layers","collisionBoxArray","features","compareText"]}),Kl.MAX_GLYPHS=65535,Kl.addDynamicAttributes=Im;var Am={get paint(){return i0=i0||new er({"icon-opacity":new ot(fe.paint_symbol["icon-opacity"]),"icon-color":new ot(fe.paint_symbol["icon-color"]),"icon-halo-color":new ot(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(fe.paint_symbol["text-opacity"]),"text-color":new ot(fe.paint_symbol["text-color"],{runtimeType:Oi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ot(fe.paint_symbol["text-halo-color"]),"text-halo-width":new ot(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(fe.paint_symbol["text-halo-blur"]),"text-translate":new Ye(fe.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(fe.paint_symbol["text-translate-anchor"])})},get layout(){return t0=t0||new er({"symbol-placement":new Ye(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(fe.layout_symbol["icon-size"]),"icon-text-fit":new Ye(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(fe.layout_symbol["icon-image"]),"icon-rotate":new ot(fe.layout_symbol["icon-rotate"]),"icon-padding":new ot(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(fe.layout_symbol["icon-offset"]),"icon-anchor":new ot(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(fe.layout_symbol["text-rotation-alignment"]),"text-field":new ot(fe.layout_symbol["text-field"]),"text-font":new ot(fe.layout_symbol["text-font"]),"text-size":new ot(fe.layout_symbol["text-size"]),"text-max-width":new ot(fe.layout_symbol["text-max-width"]),"text-line-height":new Ye(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(fe.layout_symbol["text-letter-spacing"]),"text-justify":new ot(fe.layout_symbol["text-justify"]),"text-radial-offset":new ot(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(fe.layout_symbol["text-anchor"]),"text-max-angle":new Ye(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(fe.layout_symbol["text-writing-mode"]),"text-rotate":new ot(fe.layout_symbol["text-rotate"]),"text-padding":new Ye(fe.layout_symbol["text-padding"]),"text-keep-upright":new Ye(fe.layout_symbol["text-keep-upright"]),"text-transform":new ot(fe.layout_symbol["text-transform"]),"text-offset":new ot(fe.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(fe.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(fe.layout_symbol["text-optional"])})}};class r0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:na,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",r0,{omit:["defaultValue"]});class Bd extends Pr{constructor(t){super(t,Am)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let c=this.layout.get("text-writing-mode");if(c){let h=[];for(let y of c)h.indexOf(y)<0&&h.push(y);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,c,h){let y=this.layout.get(t).evaluate(r,{},c,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Sl(_.value)||!y?y:(function(x,w){return w.replace(/{([^{}]+)}/g,((I,A)=>x&&A in x?String(x[A]):""))})(r.properties,y)}createBucket(t){return new Kl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Am.paint.overridableProperties){if(!Bd.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),c=new r0(r),h=new Jc(c,r.property.specification),y=null;y=r.value.kind==="constant"||r.value.kind==="source"?new ls("source",h):new Qc("composite",h,r.value.zoomStops),this.paint._values[t]=new un(r.property,y,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&Bd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let c=t.get("text-field"),h=Am.paint.properties[r],y=!1,_=x=>{for(let w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(y=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Yi)_(c.value.value.sections);else if(c.value.kind==="source"){let x=I=>{y||(I instanceof Tn&&at(I.value)===Hn?_(I.value.sections):I instanceof Po?_(I.sections):I.eachChild(x))},w=c.value;w._styleExpression&&x(w._styleExpression.expression)}return y}}let n0;var R2={get paint(){return n0=n0||new er({"background-color":new Ye(fe.paint_background["background-color"]),"background-pattern":new eo(fe.paint_background["background-pattern"]),"background-opacity":new Ye(fe.paint_background["background-opacity"])})}};class L2 extends Pr{constructor(t){super(t,R2)}}let o0;var D2={get paint(){return o0=o0||new er({"raster-opacity":new Ye(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(fe.paint_raster["raster-saturation"]),"raster-contrast":new Ye(fe.paint_raster["raster-contrast"]),"raster-resampling":new Ye(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(fe.paint_raster["raster-fade-duration"])})}};class z2 extends Pr{constructor(t){super(t,D2)}}class O2 extends Pr{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class F2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let N2={once:!0},Cm=63710088e-1;class ka{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ka(Qo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,c=this.lat*r,h=t.lat*r,y=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return Cm*Math.acos(Math.min(y,1))}static convert(t){if(t instanceof ka)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ka(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ka(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let a0=2*Math.PI*Cm;function s0(n){return a0*Math.cos(n*Math.PI/180)}function l0(n){return(180+n)/360}function c0(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function u0(n,t){return n/s0(t)}function Mm(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function h0(n,t){return n*s0(Mm(t))}class Lu{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){let c=ka.convert(t);return new Lu(l0(c.lng),c0(c.lat),u0(r,c.lat))}toLngLat(){return new ka(360*this.x-180,Mm(this.y))}toAltitude(){return h0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/a0*(t=Mm(this.y),1/Math.cos(t*Math.PI/180));var t}}function d0(n,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class km{constructor(t,r,c){if(!(function(h,y,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||y<0||y>=Math.pow(2,h))})(t,r,c))throw new Error(`x=${r}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=c,this.key=Xl(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,c){let h=(_=this.y,x=this.z,w=d0(256*(y=this.x),256*(_=Math.pow(2,x)-_-1),x),I=d0(256*(y+1),256*(_+1),x),w[0]+","+w[1]+","+I[0]+","+I[1]);var y,_,x,w,I;let A=(function(k,z,F){let N,$="";for(let Z=k;Z>0;Z--)N=1<<Z-1,$+=(z&N?1:0)+(F&N?2:0);return $})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new b((t.x*r-this.x)*Ot,(t.y*r-this.y)*Ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p0{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Xl(t,r.z,r.z,r.x,r.y)}}class $r{constructor(t,r,c,h,y){if(this.terrainRttPosMatrix32f=null,t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=r,this.canonical=new km(c,+h,+y),this.key=Xl(r,t,c,h,y)}clone(){return new $r(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new $r(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $r(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let c=this.canonical.z-t;return t>this.canonical.z?Xl(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Xl(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new $r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new $r(r,this.wrap,r,c,h),new $r(r,this.wrap,r,c+1,h),new $r(r,this.wrap,r,c,h+1),new $r(r,this.wrap,r,c+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new $r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new $r(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Lu(t.x-this.wrap,t.y))}}function Xl(n,t,r,c,h){(n*=2)<0&&(n=-1*n-1);let y=1<<r;return(y*y*n+y*h+c).toString(36)+r.toString(36)+t.toString(36)}function Du(n,t){return t?n.properties[t]:n.id}Ge("CanonicalTileID",km),Ge("OverscaledTileID",$r,{omit:["terrainRttPosMatrix32f"]});class bs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let r=new bs;return r.extend(t(new b(this.minX,this.minY))),r.extend(t(new b(this.maxX,this.minY))),r.extend(t(new b(this.minX,this.maxY))),r.extend(t(new b(this.maxX,this.maxY))),r}static fromPoints(t){let r=new bs;for(let c of t)r.extend(c);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class f0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class m0{constructor(t,r,c,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=c,t._y=h,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class g0{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ms(Ot,16,0),this.grid3D=new ms(Ot,16,0),this.featureIndexArray=new ae,this.promoteId=r}insert(t,r,c,h,y,_){let x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,y);let w=_?this.grid3D:this.grid;for(let I=0;I<r.length;I++){let A=r[I],k=[1/0,1/0,-1/0,-1/0];for(let z=0;z<A.length;z++){let F=A[z];k[0]=Math.min(k[0],F.x),k[1]=Math.min(k[1],F.y),k[2]=Math.max(k[2],F.x),k[3]=Math.max(k[3],F.y)}k[0]<Ot&&k[1]<Ot&&k[2]>=0&&k[3]>=0&&w.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new R_(new xm(this.rawTileData)).layers,this.sourceLayerCoder=new f0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,c,h){this.loadVTLayers();let y=t.params,_=Ot/t.tileSize/t.scale,x=Ro(y.filter),w=t.queryGeometry,I=t.queryPadding*_,A=bs.fromPoints(w),k=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),z=bs.fromPoints(t.cameraQueryGeometry).expandBy(I),F=this.grid3D.query(z.minX,z.minY,z.maxX,z.maxY,((Z,X,ce,ie)=>(function(ne,_e,Te,Ae,je){for(let Be of ne)if(_e<=Be.x&&Te<=Be.y&&Ae>=Be.x&&je>=Be.y)return!0;let ze=[new b(_e,Te),new b(_e,je),new b(Ae,je),new b(Ae,Te)];if(ne.length>2){for(let Be of ze)if(Vl(ne,Be))return!0}for(let Be=0;Be<ne.length-1;Be++)if(gw(ne[Be],ne[Be+1],ze))return!0;return!1})(t.cameraQueryGeometry,Z-I,X-I,ce+I,ie+I)));for(let Z of F)k.push(Z);k.sort(B2);let N={},$;for(let Z=0;Z<k.length;Z++){let X=k[Z];if(X===$)continue;$=X;let ce=this.featureIndexArray.get(X),ie=null;this.loadMatchingFeature(N,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,x,y.layers,y.availableImages,r,c,h,((ne,_e,Te)=>(ie||(ie=oo(ne)),_e.queryIntersectsFeature({queryGeometry:w,feature:ne,featureState:Te,geometry:ie,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return N}loadMatchingFeature(t,r,c,h,y,_,x,w,I,A,k){let z=this.bucketLayerIDs[r];if(_&&!z.some((Z=>_.has(Z))))return;let F=this.sourceLayerCoder.decode(c),N=this.vtLayers[F].feature(h);if(y.needGeometry){let Z=En(N,!0);if(!y.filter(new Kt(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!y.filter(new Kt(this.tileID.overscaledZ),N))return;let $=this.getId(N,F);for(let Z=0;Z<z.length;Z++){let X=z[Z];if(_&&!_.has(X))continue;let ce=w[X];if(!ce)continue;let ie={};$&&A&&(ie=A.getState(ce.sourceLayer||"_geojsonTileLayer",$));let ne=Tr({},I[X]);ne.paint=y0(ne.paint,ce.paint,N,ie,x),ne.layout=y0(ne.layout,ce.layout,N,ie,x);let _e=!k||k(N,ce,ie);if(!_e)continue;let Te=new m0(N,this.z,this.x,this.y,$);Te.layer=ne;let Ae=t[X];Ae===void 0&&(Ae=t[X]=[]),Ae.push({featureIndex:h,feature:Te,intersectionZ:_e})}}lookupSymbolFeatures(t,r,c,h,y,_,x,w){let I={};this.loadVTLayers();let A=Ro(y);for(let k of t)this.loadMatchingFeature(I,c,h,k,A,_,x,w,r);return I}hasLayer(t){for(let r of this.bucketLayerIDs)for(let c of r)if(t===c)return!0;return!1}getId(t,r){var c;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((c=t.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function y0(n,t,r,c,h){return ea(n,((y,_)=>{let x=t instanceof Dl?t.get(_):null;return x&&x.evaluate?x.evaluate(r,c,h):x}))}function B2(n,t){return t-n}function _0(n,t,r,c,h){let y=[];for(let _=0;_<n.length;_++){let x=n[_],w;for(let I=0;I<x.length-1;I++){let A=x[I],k=x[I+1];A.x<t&&k.x<t||(A.x<t?A=new b(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<t&&(k=new b(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<r&&k.y<r||(A.y<r?A=new b(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round():k.y<r&&(k=new b(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round()),A.x>=c&&k.x>=c||(A.x>=c?A=new b(c,A.y+(c-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=c&&(k=new b(c,A.y+(c-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=h&&k.y>=h||(A.y>=h?A=new b(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round():k.y>=h&&(k=new b(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round()),w&&A.equals(w[w.length-1])||(w=[A],y.push(w)),w.push(k)))))}}return y}Ge("FeatureIndex",g0,{omit:["rawTileData","sourceLayerCoder"]});class Ra extends b{constructor(t,r,c,h){super(t,r),this.angle=c,h!==void 0&&(this.segment=h)}clone(){return new Ra(this.x,this.y,this.angle,this.segment)}}function v0(n,t,r,c,h){if(t.segment===void 0||r===0)return!0;let y=t,_=t.segment+1,x=0;for(;x>-r/2;){if(_--,_<0)return!1;x-=n[_].dist(y),y=n[_]}x+=n[_].dist(n[_+1]),_++;let w=[],I=0;for(;x<r/2;){let A=n[_],k=n[_+1];if(!k)return!1;let z=n[_-1].angleTo(A)-A.angleTo(k);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:z}),I+=z;x-w[0].distance>c;)I-=w.shift().angleDelta;if(I>h)return!1;_++,x+=A.dist(k)}return!0}function x0(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function b0(n,t,r){return n?.6*t*r:0}function w0(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function U2(n,t,r,c,h,y){let _=b0(r,h,y),x=w0(r,c)*y,w=0,I=x0(n)/2;for(let A=0;A<n.length-1;A++){let k=n[A],z=n[A+1],F=k.dist(z);if(w+F>I){let N=(I-w)/F,$=ln.number(k.x,z.x,N),Z=ln.number(k.y,z.y,N),X=new Ra($,Z,z.angleTo(k),A);return X._round(),!_||v0(n,X,x,_,t)?X:void 0}w+=F}}function j2(n,t,r,c,h,y,_,x,w){let I=b0(c,y,_),A=w0(c,h),k=A*_,z=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return t-k<t/4&&(t=k+t/4),T0(n,z?t/2*x%t:(A/2+2*y)*_*x%t,t,I,r,k,z,!1,w)}function T0(n,t,r,c,h,y,_,x,w){let I=y/2,A=x0(n),k=0,z=t-r,F=[];for(let N=0;N<n.length-1;N++){let $=n[N],Z=n[N+1],X=$.dist(Z),ce=Z.angleTo($);for(;z+r<k+X;){z+=r;let ie=(z-k)/X,ne=ln.number($.x,Z.x,ie),_e=ln.number($.y,Z.y,ie);if(ne>=0&&ne<w&&_e>=0&&_e<w&&z-I>=0&&z+I<=A){let Te=new Ra(ne,_e,ce,N);Te._round(),c&&!v0(n,Te,y,c,h)||F.push(Te)}}k+=X}return x||F.length||_||(F=T0(n,k/2,r,c,h,y,_,!0,w)),F}function S0(n,t,r,c){let h=[],y=n.image,_=y.pixelRatio,x=y.paddedRect.w-2,w=y.paddedRect.h-2,I={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom},A=y.stretchX||[[0,x]],k=y.stretchY||[[0,w]],z=(Ie,st)=>Ie+st[1]-st[0],F=A.reduce(z,0),N=k.reduce(z,0),$=x-F,Z=w-N,X=0,ce=F,ie=0,ne=N,_e=0,Te=$,Ae=0,je=Z;if(y.content&&c){let Ie=y.content,st=Ie[2]-Ie[0],ct=Ie[3]-Ie[1];(y.textFitWidth||y.textFitHeight)&&(I=J_(n)),X=Ud(A,0,Ie[0]),ie=Ud(k,0,Ie[1]),ce=Ud(A,Ie[0],Ie[2]),ne=Ud(k,Ie[1],Ie[3]),_e=Ie[0]-X,Ae=Ie[1]-ie,Te=st-ce,je=ct-ne}let ze=I.x1,Be=I.y1,Je=I.x2-ze,Ne=I.y2-Be,Ue=(Ie,st,ct,tt)=>{let Ke=jd(Ie.stretch-X,ce,Je,ze),At=Vd(Ie.fixed-_e,Te,Ie.stretch,F),ii=jd(st.stretch-ie,ne,Ne,Be),Si=Vd(st.fixed-Ae,je,st.stretch,N),Hi=jd(ct.stretch-X,ce,Je,ze),Gr=Vd(ct.fixed-_e,Te,ct.stretch,F),vr=jd(tt.stretch-ie,ne,Ne,Be),Ni=Vd(tt.fixed-Ae,je,tt.stretch,N),Jt=new b(Ke,ii),Mi=new b(Hi,ii),Bi=new b(Hi,vr),Ui=new b(Ke,vr),hr=new b(At/_,Si/_),qr=new b(Gr/_,Ni/_),ki=t*Math.PI/180;if(ki){let Ri=Math.sin(ki),Li=Math.cos(ki),_i=[Li,-Ri,Ri,Li];Jt._matMult(_i),Mi._matMult(_i),Ui._matMult(_i),Bi._matMult(_i)}let xr=Ie.stretch+Ie.fixed,Ii=st.stretch+st.fixed;return{tl:Jt,tr:Mi,bl:Ui,br:Bi,tex:{x:y.paddedRect.x+1+xr,y:y.paddedRect.y+1+Ii,w:ct.stretch+ct.fixed-xr,h:tt.stretch+tt.fixed-Ii},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:qr,minFontScaleX:Te/_/Je,minFontScaleY:je/_/Ne,isSDF:r}};if(c&&(y.stretchX||y.stretchY)){let Ie=I0(A,$,F),st=I0(k,Z,N);for(let ct=0;ct<Ie.length-1;ct++){let tt=Ie[ct],Ke=Ie[ct+1];for(let At=0;At<st.length-1;At++)h.push(Ue(tt,st[At],Ke,st[At+1]))}}else h.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function Ud(n,t,r){let c=0;for(let h of n)c+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return c}function I0(n,t,r){let c=[{fixed:-1,stretch:0}];for(let[h,y]of n){let _=c[c.length-1];c.push({fixed:h-_.stretch,stretch:_.stretch}),c.push({fixed:h-_.stretch,stretch:_.stretch+(y-h)})}return c.push({fixed:t+1,stretch:r}),c}function jd(n,t,r,c){return n/t*r+c}function Vd(n,t,r,c){return n-t*r/c}Ge("Anchor",Ra);class $d{constructor(t,r,c,h,y,_,x,w,I,A){var k;if(this.boxStartIndex=t.length,I){let z=_.top,F=_.bottom,N=_.collisionPadding;N&&(z-=N[1],F+=N[3]);let $=F-z;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let z=!((k=_.image)===null||k===void 0)&&k.content&&(_.image.textFitWidth||_.image.textFitHeight)?J_(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};z.y1=z.y1*x-w[0],z.y2=z.y2*x+w[2],z.x1=z.x1*x-w[3],z.x2=z.x2*x+w[1];let F=_.collisionPadding;if(F&&(z.x1-=F[0]*x,z.y1-=F[1]*x,z.x2+=F[2]*x,z.y2+=F[3]*x),A){let N=new b(z.x1,z.y1),$=new b(z.x2,z.y1),Z=new b(z.x1,z.y2),X=new b(z.x2,z.y2),ce=A*Math.PI/180;N._rotate(ce),$._rotate(ce),Z._rotate(ce),X._rotate(ce),z.x1=Math.min(N.x,$.x,Z.x,X.x),z.x2=Math.max(N.x,$.x,Z.x,X.x),z.y1=Math.min(N.y,$.y,Z.y,X.y),z.y2=Math.max(N.y,$.y,Z.y,X.y)}t.emplaceBack(r.x,r.y,z.x1,z.y1,z.x2,z.y2,c,h,y)}this.boxEndIndex=t.length}}class V2{constructor(t=[],r=(c,h)=>c<h?-1:c>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:c}=this,h=r[t];for(;t>0;){let y=t-1>>1,_=r[y];if(c(h,_)>=0)break;r[t]=_,t=y}r[t]=h}_down(t){let{data:r,compare:c}=this,h=this.length>>1,y=r[t];for(;t<h;){let _=1+(t<<1),x=_+1;if(x<this.length&&c(r[x],r[_])<0&&(_=x),c(r[_],y)>=0)break;r[t]=r[_],t=_}r[t]=y}}function $2(n,t=1,r=!1){let c=bs.fromPoints(n[0]),h=Math.min(c.width(),c.height()),y=h/2,_=new V2([],G2),{minX:x,minY:w,maxX:I,maxY:A}=c;if(h===0)return new b(x,w);for(let F=x;F<I;F+=h)for(let N=w;N<A;N+=h)_.push(new Yl(F+y,N+y,y,n));let k=(function(F){let N=0,$=0,Z=0,X=F[0];for(let ce=0,ie=X.length,ne=ie-1;ce<ie;ne=ce++){let _e=X[ce],Te=X[ne],Ae=_e.x*Te.y-Te.x*_e.y;$+=(_e.x+Te.x)*Ae,Z+=(_e.y+Te.y)*Ae,N+=3*Ae}return new Yl($/N,Z/N,0,F)})(n),z=_.length;for(;_.length;){let F=_.pop();(F.d>k.d||!k.d)&&(k=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,z)),F.max-k.d<=t||(y=F.h/2,_.push(new Yl(F.p.x-y,F.p.y-y,y,n)),_.push(new Yl(F.p.x+y,F.p.y-y,y,n)),_.push(new Yl(F.p.x-y,F.p.y+y,y,n)),_.push(new Yl(F.p.x+y,F.p.y+y,y,n)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${k.d}`)),k.p}function G2(n,t){return t.max-n.max}function Yl(n,t,r,c){this.p=new b(n,t),this.h=r,this.d=(function(h,y){let _=!1,x=1/0;for(let w=0;w<y.length;w++){let I=y[w];for(let A=0,k=I.length,z=k-1;A<k;z=A++){let F=I[A],N=I[z];F.y>h.y!=N.y>h.y&&h.x<(N.x-F.x)*(h.y-F.y)/(N.y-F.y)+F.x&&(_=!_),x=Math.min(x,c_(h,F,N))}}return(_?1:-1)*Math.sqrt(x)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Wi;p.aE=void 0,(Wi=p.aE||(p.aE={}))[Wi.center=1]="center",Wi[Wi.left=2]="left",Wi[Wi.right=3]="right",Wi[Wi.top=4]="top",Wi[Wi.bottom=5]="bottom",Wi[Wi["top-left"]=6]="top-left",Wi[Wi["top-right"]=7]="top-right",Wi[Wi["bottom-left"]=8]="bottom-left",Wi[Wi["bottom-right"]=9]="bottom-right";let Rm=Number.POSITIVE_INFINITY;function P0(n,t){return t[1]!==Rm?(function(r,c,h){let y=0,_=0;switch(c=Math.abs(c),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(r){case"top-right":case"bottom-right":case"right":y=-c;break;case"top-left":case"bottom-left":case"left":y=c}return[y,_]})(n,t[0],t[1]):(function(r,c){let h=0,y=0;c<0&&(c=0);let _=c/Math.SQRT2;switch(r){case"top-right":case"top-left":y=_-7;break;case"bottom-right":case"bottom-left":y=7-_;break;case"bottom":y=7-c;break;case"top":y=c-7}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=c;break;case"right":h=-c}return[h,y]})(n,t[0])}function E0(n,t,r){var c;let h=n.layout,y=(c=h.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},r);if(y){let x=y.values,w=[];for(let I=0;I<x.length;I+=2){let A=w[I]=x[I],k=x[I+1].map((z=>z*Ci));A.startsWith("top")?k[1]-=7:A.startsWith("bottom")&&(k[1]+=7),w[I+1]=k}return new Qi(w)}let _=h.get("text-variable-anchor");if(_){let x;x=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},r)*Ci,Rm]:h.get("text-offset").evaluate(t,{},r).map((I=>I*Ci));let w=[];for(let I of _)w.push(I,P0(I,x));return new Qi(w)}return null}function Lm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q2(n,t,r,c,h,y,_,x,w,I,A,k){let z=y.textMaxSize.evaluate(t,{});z===void 0&&(z=_);let F=n.layers[0].layout,N=F.get("icon-offset").evaluate(t,{},A),$=C0(r.horizontal),Z=_/24,X=n.tilePixelRatio*Z,ce=n.tilePixelRatio*z/24,ie=n.tilePixelRatio*x,ne=n.tilePixelRatio*F.get("symbol-spacing"),_e=F.get("text-padding")*n.tilePixelRatio,Te=(function(ct,tt,Ke,At=1){let ii=ct.get("icon-padding").evaluate(tt,{},Ke),Si=ii&&ii.values;return[Si[0]*At,Si[1]*At,Si[2]*At,Si[3]*At]})(F,t,A,n.tilePixelRatio),Ae=F.get("text-max-angle")/180*Math.PI,je=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",ze=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Be=F.get("symbol-placement"),Je=ne/2,Ne=F.get("icon-text-fit"),Ue;c&&Ne!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Ue=Q_(c,r.vertical,Ne,F.get("icon-text-fit-padding"),N,Z)),$&&(c=Q_(c,$,Ne,F.get("icon-text-fit-padding"),N,Z)));let Ie=A?k.line.getGranularityForZoomLevel(A.z):1,st=(ct,tt)=>{tt.x<0||tt.x>=Ot||tt.y<0||tt.y>=Ot||(function(Ke,At,ii,Si,Hi,Gr,vr,Ni,Jt,Mi,Bi,Ui,hr,qr,ki,xr,Ii,Ri,Li,_i,Wt,An,Jl,Cn,H2){let Ql=Ke.addToLineVertexArray(At,ii),ws,ec,tc,ic,L0=0,D0=0,z0=0,O0=0,jm=-1,Vm=-1,jo={},F0=Ea("");if(Ke.allowVerticalPlacement&&Si.vertical){let rr=Ni.layout.get("text-rotate").evaluate(Wt,{},Cn)+90;tc=new $d(Jt,At,Mi,Bi,Ui,Si.vertical,hr,qr,ki,rr),vr&&(ic=new $d(Jt,At,Mi,Bi,Ui,vr,Ii,Ri,ki,rr))}if(Hi){let rr=Ni.layout.get("icon-rotate").evaluate(Wt,{}),Zr=Ni.layout.get("icon-text-fit")!=="none",Ts=S0(Hi,rr,Jl,Zr),kn=vr?S0(vr,rr,Jl,Zr):void 0;ec=new $d(Jt,At,Mi,Bi,Ui,Hi,Ii,Ri,!1,rr),L0=4*Ts.length;let Ss=Ke.iconSizeData,ao=null;Ss.kind==="source"?(ao=[Uo*Ni.layout.get("icon-size").evaluate(Wt,{})],ao[0]>Ma&&ui(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ss.kind==="composite"&&(ao=[Uo*An.compositeIconSizes[0].evaluate(Wt,{},Cn),Uo*An.compositeIconSizes[1].evaluate(Wt,{},Cn)],(ao[0]>Ma||ao[1]>Ma)&&ui(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ke.addSymbols(Ke.icon,Ts,ao,_i,Li,Wt,p.ao.none,At,Ql.lineStartIndex,Ql.lineLength,-1,Cn),jm=Ke.icon.placedSymbolArray.length-1,kn&&(D0=4*kn.length,Ke.addSymbols(Ke.icon,kn,ao,_i,Li,Wt,p.ao.vertical,At,Ql.lineStartIndex,Ql.lineLength,-1,Cn),Vm=Ke.icon.placedSymbolArray.length-1)}let N0=Object.keys(Si.horizontal);for(let rr of N0){let Zr=Si.horizontal[rr];if(!ws){F0=Ea(Zr.text);let kn=Ni.layout.get("text-rotate").evaluate(Wt,{},Cn);ws=new $d(Jt,At,Mi,Bi,Ui,Zr,hr,qr,ki,kn)}let Ts=Zr.positionedLines.length===1;if(z0+=A0(Ke,At,Zr,Gr,Ni,ki,Wt,xr,Ql,Si.vertical?p.ao.horizontal:p.ao.horizontalOnly,Ts?N0:[rr],jo,jm,An,Cn),Ts)break}Si.vertical&&(O0+=A0(Ke,At,Si.vertical,Gr,Ni,ki,Wt,xr,Ql,p.ao.vertical,["vertical"],jo,Vm,An,Cn));let K2=ws?ws.boxStartIndex:Ke.collisionBoxArray.length,X2=ws?ws.boxEndIndex:Ke.collisionBoxArray.length,Y2=tc?tc.boxStartIndex:Ke.collisionBoxArray.length,J2=tc?tc.boxEndIndex:Ke.collisionBoxArray.length,Q2=ec?ec.boxStartIndex:Ke.collisionBoxArray.length,eT=ec?ec.boxEndIndex:Ke.collisionBoxArray.length,tT=ic?ic.boxStartIndex:Ke.collisionBoxArray.length,iT=ic?ic.boxEndIndex:Ke.collisionBoxArray.length,Mn=-1,qd=(rr,Zr)=>rr&&rr.circleDiameter?Math.max(rr.circleDiameter,Zr):Zr;Mn=qd(ws,Mn),Mn=qd(tc,Mn),Mn=qd(ec,Mn),Mn=qd(ic,Mn);let B0=Mn>-1?1:0;B0&&(Mn*=H2/Ci),Ke.glyphOffsetArray.length>=Kl.MAX_GLYPHS&&ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wt.sortKey!==void 0&&Ke.addToSortKeyRanges(Ke.symbolInstances.length,Wt.sortKey);let rT=E0(Ni,Wt,Cn),[nT,oT]=(function(rr,Zr){let Ts=rr.length,kn=Zr?.values;if(kn?.length>0)for(let Ss=0;Ss<kn.length;Ss+=2){let ao=kn[Ss+1];rr.emplaceBack(p.aE[kn[Ss]],ao[0],ao[1])}return[Ts,rr.length]})(Ke.textAnchorOffsets,rT);Ke.symbolInstances.emplaceBack(At.x,At.y,jo.right>=0?jo.right:-1,jo.center>=0?jo.center:-1,jo.left>=0?jo.left:-1,jo.vertical||-1,jm,Vm,F0,K2,X2,Y2,J2,Q2,eT,tT,iT,Mi,z0,O0,L0,D0,B0,0,hr,Mn,nT,oT)})(n,tt,ct,r,c,h,Ue,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,X,[_e,_e,_e,_e],je,w,ie,Te,ze,N,t,y,I,A,_)};if(Be==="line")for(let ct of _0(t.geometry,0,0,Ot,Ot)){let tt=xs(ct,Ie),Ke=j2(tt,ne,Ae,r.vertical||$,c,24,ce,n.overscaling,Ot);for(let At of Ke)$&&Z2(n,$.text,Je,At)||st(tt,At)}else if(Be==="line-center"){for(let ct of t.geometry)if(ct.length>1){let tt=xs(ct,Ie),Ke=U2(tt,Ae,r.vertical||$,c,24,ce);Ke&&st(tt,Ke)}}else if(t.type==="Polygon")for(let ct of rs(t.geometry,0)){let tt=$2(ct,16);st(xs(ct[0],Ie,!0),new Ra(tt.x,tt.y,0))}else if(t.type==="LineString")for(let ct of t.geometry){let tt=xs(ct,Ie);st(tt,new Ra(tt[0].x,tt[0].y,0))}else if(t.type==="Point")for(let ct of t.geometry)for(let tt of ct)st([tt],new Ra(tt.x,tt.y,0))}function A0(n,t,r,c,h,y,_,x,w,I,A,k,z,F,N){let $=(function(ce,ie,ne,_e,Te,Ae,je,ze){let Be=_e.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,Je=[];for(let Ne of ie.positionedLines)for(let Ue of Ne.positionedGlyphs){if(!Ue.rect)continue;let Ie=Ue.rect||{},st=4,ct=!0,tt=1,Ke=0,At=(Te||ze)&&Ue.vertical,ii=Ue.metrics.advance*Ue.scale/2;if(ze&&ie.verticalizable&&(Ke=Ne.lineOffset/2-(Ue.imageName?-(Ci-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*Ci)),Ue.imageName){let Ri=je[Ue.imageName];ct=Ri.sdf,tt=Ri.pixelRatio,st=1/tt}let Si=Te?[Ue.x+ii,Ue.y]:[0,0],Hi=Te?[0,0]:[Ue.x+ii+ne[0],Ue.y+ne[1]-Ke],Gr=[0,0];At&&(Gr=Hi,Hi=[0,0]);let vr=Ue.metrics.isDoubleResolution?2:1,Ni=(Ue.metrics.left-st)*Ue.scale-ii+Hi[0],Jt=(-Ue.metrics.top-st)*Ue.scale+Hi[1],Mi=Ni+Ie.w/vr*Ue.scale/tt,Bi=Jt+Ie.h/vr*Ue.scale/tt,Ui=new b(Ni,Jt),hr=new b(Mi,Jt),qr=new b(Ni,Bi),ki=new b(Mi,Bi);if(At){let Ri=new b(-ii,ii- -17),Li=-Math.PI/2,_i=12-ii,Wt=new b(22-_i,-(Ue.imageName?_i:0)),An=new b(...Gr);Ui._rotateAround(Li,Ri)._add(Wt)._add(An),hr._rotateAround(Li,Ri)._add(Wt)._add(An),qr._rotateAround(Li,Ri)._add(Wt)._add(An),ki._rotateAround(Li,Ri)._add(Wt)._add(An)}if(Be){let Ri=Math.sin(Be),Li=Math.cos(Be),_i=[Li,-Ri,Ri,Li];Ui._matMult(_i),hr._matMult(_i),qr._matMult(_i),ki._matMult(_i)}let xr=new b(0,0),Ii=new b(0,0);Je.push({tl:Ui,tr:hr,bl:qr,br:ki,tex:Ie,writingMode:ie.writingMode,glyphOffset:Si,sectionIndex:Ue.sectionIndex,isSDF:ct,pixelOffsetTL:xr,pixelOffsetBR:Ii,minFontScaleX:0,minFontScaleY:0})}return Je})(0,r,x,h,y,_,c,n.allowVerticalPlacement),Z=n.textSizeData,X=null;Z.kind==="source"?(X=[Uo*h.layout.get("text-size").evaluate(_,{})],X[0]>Ma&&ui(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(X=[Uo*F.compositeTextSizes[0].evaluate(_,{},N),Uo*F.compositeTextSizes[1].evaluate(_,{},N)],(X[0]>Ma||X[1]>Ma)&&ui(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,$,X,x,y,_,I,t,w.lineStartIndex,w.lineLength,z,N);for(let ce of A)k[ce]=n.text.placedSymbolArray.length-1;return 4*$.length}function C0(n){for(let t in n)return n[t];return null}function Z2(n,t,r,c){let h=n.compareText;if(t in h){let y=h[t];for(let _=y.length-1;_>=0;_--)if(c.dist(y[_])<r)return!0}else h[t]=[];return h[t].push(c),!1}let M0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let y=M0[15&c];if(!y)throw new Error("Unrecognized array type.");let[_]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Dm(x,_,y,t)}constructor(t,r=64,c=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let y=M0.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return zm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:y,coords:_,nodeSize:x}=this,w=[0,y.length-1,0],I=[];for(;w.length;){let A=w.pop()||0,k=w.pop()||0,z=w.pop()||0;if(k-z<=x){for(let Z=z;Z<=k;Z++){let X=_[2*Z],ce=_[2*Z+1];X>=t&&X<=c&&ce>=r&&ce<=h&&I.push(y[Z])}continue}let F=z+k>>1,N=_[2*F],$=_[2*F+1];N>=t&&N<=c&&$>=r&&$<=h&&I.push(y[F]),(A===0?t<=N:r<=$)&&(w.push(z),w.push(F-1),w.push(1-A)),(A===0?c>=N:h>=$)&&(w.push(F+1),w.push(k),w.push(1-A))}return I}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:y,nodeSize:_}=this,x=[0,h.length-1,0],w=[],I=c*c;for(;x.length;){let A=x.pop()||0,k=x.pop()||0,z=x.pop()||0;if(k-z<=_){for(let Z=z;Z<=k;Z++)R0(y[2*Z],y[2*Z+1],t,r)<=I&&w.push(h[Z]);continue}let F=z+k>>1,N=y[2*F],$=y[2*F+1];R0(N,$,t,r)<=I&&w.push(h[F]),(A===0?t-c<=N:r-c<=$)&&(x.push(z),x.push(F-1),x.push(1-A)),(A===0?t+c>=N:r+c>=$)&&(x.push(F+1),x.push(k),x.push(1-A))}return w}}function zm(n,t,r,c,h,y){if(h-c<=r)return;let _=c+h>>1;k0(n,t,_,c,h,y),zm(n,t,r,c,_-1,1-y),zm(n,t,r,_+1,h,1-y)}function k0(n,t,r,c,h,y){for(;h>c;){if(h-c>600){let I=h-c+1,A=r-c+1,k=Math.log(I),z=.5*Math.exp(2*k/3),F=.5*Math.sqrt(k*z*(I-z)/I)*(A-I/2<0?-1:1);k0(n,t,r,Math.max(c,Math.floor(r-A*z/I+F)),Math.min(h,Math.floor(r+(I-A)*z/I+F)),y)}let _=t[2*r+y],x=c,w=h;for(zu(n,t,c,r),t[2*h+y]>_&&zu(n,t,c,h);x<w;){for(zu(n,t,x,w),x++,w--;t[2*x+y]<_;)x++;for(;t[2*w+y]>_;)w--}t[2*c+y]===_?zu(n,t,c,w):(w++,zu(n,t,w,h)),w<=r&&(c=w+1),r<=w&&(h=w-1)}}function zu(n,t,r,c){Om(n,r,c),Om(t,2*r,2*c),Om(t,2*r+1,2*c+1)}function Om(n,t,r){let c=n[t];n[t]=n[r],n[r]=c}function R0(n,t,r,c){let h=n-r,y=t-c;return h*h+y*y}var Fm;p.cx=void 0,(Fm=p.cx||(p.cx={})).create="create",Fm.load="load",Fm.fullLoad="fullLoad";let Gd=null,Ou=[],Nm=1e3/60,Bm="loadTime",Um="fullLoadTime",W2={mark(n){performance.mark(n)},frame(n){let t=n;Gd!=null&&Ou.push(t-Gd),Gd=t},clearMetrics(){Gd=null,Ou=[],performance.clearMeasures(Bm),performance.clearMeasures(Um);for(let n in p.cx)performance.clearMarks(p.cx[n])},getPerformanceMetrics(){performance.measure(Bm,p.cx.create,p.cx.load),performance.measure(Um,p.cx.create,p.cx.fullLoad);let n=performance.getEntriesByName(Bm)[0].duration,t=performance.getEntriesByName(Um)[0].duration,r=Ou.length,c=1/(Ou.reduce(((y,_)=>y+_),0)/r/1e3),h=Ou.filter((y=>y>Nm)).reduce(((y,_)=>y+(_-Nm)/Nm),0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};p.$=Ot,p.A=ke,p.B=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},p.C=ln,p.D=Ye,p.E=Xe,p.F=Kt,p.G=ps,p.H=function(n){if(_o==null){let t=n.navigator?n.navigator.userAgent:null;_o=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _o},p.I=bm,p.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new F2((()=>this.process())),this.subscription=Vn(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=tn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,c)=>{let h=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=t?Vn(t.signal,"abort",(()=>{y?.unsubscribe(),delete this.resolveRejects[h];let w={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)}),N2):null;this.resolveRejects[h]={resolve:w=>{y?.unsubscribe(),r(w)},reject:w=>{y?.unsubscribe(),c(w)}};let _=[],x=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:ba(n.data,_)});this.target.postMessage(x,{transfer:_})}))}receive(n){let t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let c=this.abortControllers[r];return delete this.abortControllers[r],void(c&&c.abort())}if(tn(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return a(this,void 0,void 0,(function*(){if(t.type==="<response>"){let h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(zo(t.error)):h.resolve(zo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=zo(t.data),c=new AbortController;this.abortControllers[n]=c;try{let h=yield this.messageHandlers[t.type](t.sourceMapId,r,c);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}}))}completeTask(n,t,r){let c=[];delete this.abortControllers[n];let h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ba(t):null,data:ba(r,c)};this.target.postMessage(h,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},p.K=q,p.L=function(){var n=new ke(16);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},p.M=function(n,t,r){var c,h,y,_,x,w,I,A,k,z,F,N,$=r[0],Z=r[1],X=r[2];return t===n?(n[12]=t[0]*$+t[4]*Z+t[8]*X+t[12],n[13]=t[1]*$+t[5]*Z+t[9]*X+t[13],n[14]=t[2]*$+t[6]*Z+t[10]*X+t[14],n[15]=t[3]*$+t[7]*Z+t[11]*X+t[15]):(h=t[1],y=t[2],_=t[3],x=t[4],w=t[5],I=t[6],A=t[7],k=t[8],z=t[9],F=t[10],N=t[11],n[0]=c=t[0],n[1]=h,n[2]=y,n[3]=_,n[4]=x,n[5]=w,n[6]=I,n[7]=A,n[8]=k,n[9]=z,n[10]=F,n[11]=N,n[12]=c*$+x*Z+k*X+t[12],n[13]=h*$+w*Z+z*X+t[13],n[14]=y*$+I*Z+F*X+t[14],n[15]=_*$+A*Z+N*X+t[15]),n},p.N=function(n,t,r){var c=r[0],h=r[1],y=r[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*y,n[9]=t[9]*y,n[10]=t[10]*y,n[11]=t[11]*y,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},p.O=function(n,t,r){var c=t[0],h=t[1],y=t[2],_=t[3],x=t[4],w=t[5],I=t[6],A=t[7],k=t[8],z=t[9],F=t[10],N=t[11],$=t[12],Z=t[13],X=t[14],ce=t[15],ie=r[0],ne=r[1],_e=r[2],Te=r[3];return n[0]=ie*c+ne*x+_e*k+Te*$,n[1]=ie*h+ne*w+_e*z+Te*Z,n[2]=ie*y+ne*I+_e*F+Te*X,n[3]=ie*_+ne*A+_e*N+Te*ce,n[4]=(ie=r[4])*c+(ne=r[5])*x+(_e=r[6])*k+(Te=r[7])*$,n[5]=ie*h+ne*w+_e*z+Te*Z,n[6]=ie*y+ne*I+_e*F+Te*X,n[7]=ie*_+ne*A+_e*N+Te*ce,n[8]=(ie=r[8])*c+(ne=r[9])*x+(_e=r[10])*k+(Te=r[11])*$,n[9]=ie*h+ne*w+_e*z+Te*Z,n[10]=ie*y+ne*I+_e*F+Te*X,n[11]=ie*_+ne*A+_e*N+Te*ce,n[12]=(ie=r[12])*c+(ne=r[13])*x+(_e=r[14])*k+(Te=r[15])*$,n[13]=ie*h+ne*w+_e*z+Te*Z,n[14]=ie*y+ne*I+_e*F+Te*X,n[15]=ie*_+ne*A+_e*N+Te*ce,n},p.P=b,p.Q=function(n,t){let r={};for(let c=0;c<t.length;c++){let h=t[c];h in n&&(r[h]=n[h])}return r},p.R=_r,p.S=ka,p.T=um,p.U=c0,p.V=l0,p.W=me,p.X=xe,p.Y=ia,p.Z=$r,p._=a,p.a=V,p.a$=Qr,p.a0=function(n,t){var r,c,h,y;if(!n)return t??{};if(!t)return n;let _=Object.assign({},n);if(t.removeAll&&(_.removeAll=!0),t.remove){let x=new Set(_.remove?_.remove.concat(t.remove):t.remove);_.remove=Array.from(x.values())}if(t.add){let x=_.add?_.add.concat(t.add):t.add,w=new Map(x.map((I=>[I.id,I])));_.add=Array.from(w.values())}if(t.update){let x=new Map((r=_.update)===null||r===void 0?void 0:r.map((w=>[w.id,w])));for(let w of t.update){let I=(c=x.get(w.id))!==null&&c!==void 0?c:{id:w.id};w.newGeometry&&(I.newGeometry=w.newGeometry),w.addOrUpdateProperties&&(I.addOrUpdateProperties=((h=I.addOrUpdateProperties)!==null&&h!==void 0?h:[]).concat(w.addOrUpdateProperties)),w.removeProperties&&(I.removeProperties=((y=I.removeProperties)!==null&&y!==void 0?y:[]).concat(w.removeProperties)),w.removeAllProperties&&(I.removeAllProperties=!0),x.set(w.id,I)}_.update=Array.from(x.values())}return _},p.a1=Lu,p.a2=bs,p.a3=25,p.a4=km,p.a5=n=>{let t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(let c of n){let h=window.document.createElement("source");ve(c)||(t.crossOrigin="Anonymous"),h.src=c,t.appendChild(h)}}))},p.a6=De,p.a7=function(){return Mr++},p.a8=R,p.a9=Kl,p.aA=function(n){let t=1/0,r=1/0,c=-1/0,h=-1/0;for(let y of n)t=Math.min(t,y.x),r=Math.min(r,y.y),c=Math.max(c,y.x),h=Math.max(h,y.y);return[t,r,c,h]},p.aB=Ci,p.aC=bn,p.aD=function(n,t,r,c,h=!1){if(!r[0]&&!r[1])return[0,0];let y=h?c==="map"?-n.bearingInRadians:0:c==="viewport"?n.bearingInRadians:0;if(y){let _=Math.sin(y),x=Math.cos(y);r=[r[0]*x-r[1]*_,r[0]*_+r[1]*x]}return[h?r[0]:bn(t,r[0],n.zoom),h?r[1]:bn(t,r[1],n.zoom)]},p.aF=Sm,p.aG=Lm,p.aH=Tm,p.aI=Dm,p.aJ=si,p.aK=Dd,p.aL=Q,p.aM=ft,p.aN=Bt,p.aO=Qo,p.aP=$n,p.aQ=h0,p.aR=zi,p.aS=Vi,p.aT=function(n){var t=new ke(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},p.aU=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},p.aV=function(n,t){var r=t[0],c=t[1],h=t[2],y=r*r+c*c+h*h;return y>0&&(y=1/Math.sqrt(y)),n[0]=t[0]*y,n[1]=t[1]*y,n[2]=t[2]*y,n},p.aW=pr,p.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},p.aY=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},p.aZ=qe,p.a_=function(n,t,r){let c=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return c===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/c},p.aa=Ro,p.ab=En,p.ac=m0,p.ad=function(n){let t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,c,h,y)=>{let _=h||y;return t[c]=!_||_.toLowerCase(),""})),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},p.ae=vo,p.af=function(n){return Math.pow(2,n)},p.ag=We,p.ah=ar,p.ai=85.051129,p.aj=u0,p.ak=function(n){return Math.log(n)/Math.LN2},p.al=function(n){var t=n[0],r=n[1];return t*t+r*r},p.am=function(n,t){let r=[];for(let c in n)c in t||r.push(c);return r},p.an=function(n,t){let r=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){let{interpolationType:h,minZoom:y,maxZoom:_}=n,x=h?ar(Fi.interpolationFactor(h,t,y,_),0,1):0;n.kind==="camera"?c=ln.number(n.minSize,n.maxSize,x):r=x}return{uSizeT:r,uSize:c}},p.ap=function(n,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:h}){return n.kind==="source"?c/Uo:n.kind==="composite"?ln.number(c/Uo,h/Uo,r):t},p.aq=function(n,t){var r=t[0],c=t[1],h=t[2],y=t[3],_=t[4],x=t[5],w=t[6],I=t[7],A=t[8],k=t[9],z=t[10],F=t[11],N=t[12],$=t[13],Z=t[14],X=t[15],ce=r*x-c*_,ie=r*w-h*_,ne=r*I-y*_,_e=c*w-h*x,Te=c*I-y*x,Ae=h*I-y*w,je=A*$-k*N,ze=A*Z-z*N,Be=A*X-F*N,Je=k*Z-z*$,Ne=k*X-F*$,Ue=z*X-F*Z,Ie=ce*Ue-ie*Ne+ne*Je+_e*Be-Te*ze+Ae*je;return Ie?(n[0]=(x*Ue-w*Ne+I*Je)*(Ie=1/Ie),n[1]=(h*Ne-c*Ue-y*Je)*Ie,n[2]=($*Ae-Z*Te+X*_e)*Ie,n[3]=(z*Te-k*Ae-F*_e)*Ie,n[4]=(w*Be-_*Ue-I*ze)*Ie,n[5]=(r*Ue-h*Be+y*ze)*Ie,n[6]=(Z*ne-N*Ae-X*ie)*Ie,n[7]=(A*Ae-z*ne+F*ie)*Ie,n[8]=(_*Ne-x*Be+I*je)*Ie,n[9]=(c*Be-r*Ne-y*je)*Ie,n[10]=(N*Te-$*ne+X*ce)*Ie,n[11]=(k*ne-A*Te-F*ce)*Ie,n[12]=(x*ze-_*Je-w*je)*Ie,n[13]=(r*Je-c*ze+h*je)*Ie,n[14]=($*ie-N*_e-Z*ce)*Ie,n[15]=(A*_e-k*ie+z*ce)*Ie,n):null},p.ar=xn,p.as=function(n){return Math.hypot(n[0],n[1])},p.at=function(n){return n[0]=0,n[1]=0,n},p.au=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},p.av=Im,p.aw=mo,p.ax=function(n,t,r,c){let h=t.y-n.y,y=t.x-n.x,_=c.y-r.y,x=c.x-r.x,w=_*y-x*h;if(w===0)return null;let I=(x*(n.y-r.y)-_*(n.x-r.x))/w;return new b(n.x+I*y,n.y+I*h)},p.ay=_0,p.az=s_,p.b=rn,p.b$=class extends m{},p.b0=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},p.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},p.b2=p0,p.b3=Xl,p.b4=function(n,t,r,c,h){var y,_=1/Math.tan(t/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+c)*(y=1/(c-h)),n[14]=2*h*c*y):(n[10]=-1,n[14]=-2*c),n},p.b5=function(n){var t=new ke(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},p.b6=function(n,t,r){var c=Math.sin(r),h=Math.cos(r),y=t[0],_=t[1],x=t[2],w=t[3],I=t[4],A=t[5],k=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*h+I*c,n[1]=_*h+A*c,n[2]=x*h+k*c,n[3]=w*h+z*c,n[4]=I*h-y*c,n[5]=A*h-_*c,n[6]=k*h-x*c,n[7]=z*h-w*c,n},p.b7=function(n,t,r){var c=Math.sin(r),h=Math.cos(r),y=t[4],_=t[5],x=t[6],w=t[7],I=t[8],A=t[9],k=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=y*h+I*c,n[5]=_*h+A*c,n[6]=x*h+k*c,n[7]=w*h+z*c,n[8]=I*h-y*c,n[9]=A*h-_*c,n[10]=k*h-x*c,n[11]=z*h-w*c,n},p.b8=function(){let n=new Float32Array(16);return We(n),n},p.b9=function(){let n=new Float64Array(16);return We(n),n},p.bA=function(n,t){let r=$i(n,360),c=$i(t,360),h=c-r,y=c>r?h-360:h+360;return Math.abs(h)<Math.abs(y)?h:y},p.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},p.bC=function(n,t,r,c){let h=Math.sqrt(n*n+t*t),y=Math.sqrt(r*r+c*c);n/=h,t/=h,r/=y,c/=y;let _=Math.acos(n*r+t*c);return-t*r+n*c>0?_:-_},p.bD=function(n,t){let r=$i(n,2*Math.PI),c=$i(t,2*Math.PI);return Math.min(Math.abs(r-c),Math.abs(r-c+2*Math.PI),Math.abs(r-c-2*Math.PI))},p.bE=function(){let n={},t=fe.$version;for(let r in fe.$root){let c=fe.$root[r];if(c.required){let h=null;h=r==="version"?t:c.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},p.bF=kl,p.bG=se,p.bH=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let c in t)if(!n(t[c],r[c]))return!1;return!0}return t===r},p.bI=function(n){n=n.slice();let t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=vt(n[r],t[n[r].ref]));return n},p.bJ=function(n){if(n.type==="custom")return new O2(n);switch(n.type){case"background":return new L2(n);case"circle":return new _w(n);case"color-relief":return new Sw(n);case"fill":return new Bw(n);case"fill-extrusion":return new Xw(n);case"heatmap":return new xw(n);case"hillshade":return new ww(n);case"line":return new r2(n);case"raster":return new z2(n);case"symbol":return new Bd(n)}},p.bK=fr,p.bL=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Qe(n.version,t.version))return[{command:"setStyle",args:[t]}];Qe(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Qe(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Qe(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Qe(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Qe(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Qe(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Qe(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Qe(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Qe(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Qe(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Qe(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),Qe(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Qe(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Qe(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let c={},h=[];(function(_,x,w,I){let A;for(A in x=x||{},_=_||{})Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(x,A)||xi(A,w,I));for(A in x)Object.prototype.hasOwnProperty.call(x,A)&&(Object.prototype.hasOwnProperty.call(_,A)?Qe(_[A],x[A])||(_[A].type==="geojson"&&x[A].type==="geojson"&&hi(_,x,A)?pt(w,{command:"setGeoJSONSourceData",args:[A,x[A].data]}):bi(A,x,w,I)):qt(A,x,w))})(n.sources,t.sources,h,c);let y=[];n.layers&&n.layers.forEach((_=>{"source"in _&&c[_.source]?r.push({command:"removeLayer",args:[_.id]}):y.push(_)})),r=r.concat(h),(function(_,x,w){x=x||[];let I=(_=_||[]).map(Mt),A=x.map(Mt),k=_.reduce(pi,{}),z=x.reduce(pi,{}),F=I.slice(),N=Object.create(null),$,Z,X,ce,ie;for(let ne=0,_e=0;ne<I.length;ne++)$=I[ne],Object.prototype.hasOwnProperty.call(z,$)?_e++:(pt(w,{command:"removeLayer",args:[$]}),F.splice(F.indexOf($,_e),1));for(let ne=0,_e=0;ne<A.length;ne++)$=A[A.length-1-ne],F[F.length-1-ne]!==$&&(Object.prototype.hasOwnProperty.call(k,$)?(pt(w,{command:"removeLayer",args:[$]}),F.splice(F.lastIndexOf($,F.length-_e),1)):_e++,ce=F[F.length-ne],pt(w,{command:"addLayer",args:[z[$],ce]}),F.splice(F.length-ne,0,$),N[$]=!0);for(let ne=0;ne<A.length;ne++)if($=A[ne],Z=k[$],X=z[$],!N[$]&&!Qe(Z,X))if(Qe(Z.source,X.source)&&Qe(Z["source-layer"],X["source-layer"])&&Qe(Z.type,X.type)){for(ie in St(Z.layout,X.layout,w,$,null,"setLayoutProperty"),St(Z.paint,X.paint,w,$,null,"setPaintProperty"),Qe(Z.filter,X.filter)||pt(w,{command:"setFilter",args:[$,X.filter]}),Qe(Z.minzoom,X.minzoom)&&Qe(Z.maxzoom,X.maxzoom)||pt(w,{command:"setLayerZoomRange",args:[$,X.minzoom,X.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?St(Z[ie],X[ie],w,$,ie.slice(6),"setPaintProperty"):Qe(Z[ie],X[ie])||pt(w,{command:"setLayerProperty",args:[$,ie,X[ie]]}));for(ie in X)Object.prototype.hasOwnProperty.call(X,ie)&&!Object.prototype.hasOwnProperty.call(Z,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?St(Z[ie],X[ie],w,$,ie.slice(6),"setPaintProperty"):Qe(Z[ie],X[ie])||pt(w,{command:"setLayerProperty",args:[$,ie,X[ie]]}))}else pt(w,{command:"removeLayer",args:[$]}),ce=F[F.lastIndexOf($)+1],pt(w,{command:"addLayer",args:[X,ce]})})(y,t.layers,r)}catch(c){console.warn("Unable to compute style diff:",c),r=[{command:"setStyle",args:[t]}]}return r},p.bM=function(n){let t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},p.bN=ea,p.bO=ta,p.bP=class extends ir{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},p.bQ=Ti,p.bR=class extends ir{constructor(n,t){super(n,t),this.current=Er}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},p.bS=gi,p.bT=class extends ir{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},p.bU=class extends ir{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},p.bV=Re,p.bW=function(n,t){var r=Math.sin(t),c=Math.cos(t);return n[0]=c,n[1]=r,n[2]=0,n[3]=-r,n[4]=c,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},p.bX=function(n,t,r){var c=t[0],h=t[1],y=t[2];return n[0]=c*r[0]+h*r[3]+y*r[6],n[1]=c*r[1]+h*r[4]+y*r[7],n[2]=c*r[2]+h*r[5]+y*r[8],n},p.bY=function(n,t,r,c,h,y,_){var x=1/(t-r),w=1/(c-h),I=1/(y-_);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+r)*x,n[13]=(h+c)*w,n[14]=(_+y)*I,n[15]=1,n},p.bZ=class extends ir{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},p.b_=class extends ir{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},p.ba=function(){return new Float64Array(16)},p.bb=function(n,t,r){let c=new Float64Array(4);return vn(c,n,t-90,r),c},p.bc=function(n,t,r,c){var h,y,_,x,w,I=t[0],A=t[1],k=t[2],z=t[3],F=r[0],N=r[1],$=r[2],Z=r[3];return(y=I*F+A*N+k*$+z*Z)<0&&(y=-y,F=-F,N=-N,$=-$,Z=-Z),1-y>Ce?(h=Math.acos(y),_=Math.sin(h),x=Math.sin((1-c)*h)/_,w=Math.sin(c*h)/_):(x=1-c,w=c),n[0]=x*I+w*F,n[1]=x*A+w*N,n[2]=x*k+w*$,n[3]=x*z+w*Z,n},p.bd=function(n){let t=new Float64Array(9);var r,c,h,y,_,x,w,I,A,k,z,F,N,$,Z,X,ce,ie;k=(h=(c=n)[0])*(w=h+h),z=(y=c[1])*w,N=(_=c[2])*w,$=_*(I=y+y),X=(x=c[3])*w,ce=x*I,ie=x*(A=_+_),(r=t)[0]=1-(F=y*I)-(Z=_*A),r[3]=z-ie,r[6]=N+ce,r[1]=z+ie,r[4]=1-k-Z,r[7]=$-X,r[2]=N-ce,r[5]=$+X,r[8]=1-k-F;let ne=$n(-Math.asin(ar(t[2],-1,1))),_e,Te;return Math.hypot(t[5],t[8])<.001?(_e=0,Te=-$n(Math.atan2(t[3],t[4]))):(_e=$n(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Te=$n(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:_e,pitch:ne+90,bearing:Te}},p.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},p.bf=wt,p.bg=ro,p.bh=ql,p.bi=Eu,p.bj=Gl,p.bk=go,p.bl=en,p.bm=qi,p.bn=function(n,t,r,c,h){return go(c,h,ar((n-t)/(r-t),0,1))},p.bo=$i,p.bp=function(){return new Float64Array(3)},p.bq=function(n,t,r,c){return n[0]=t[0]+r[0]*c,n[1]=t[1]+r[1]*c,n[2]=t[2]+r[2]*c,n},p.br=vn,p.bs=function(n,t,r){var c=r[0],h=r[1],y=r[2],_=t[0],x=t[1],w=t[2],I=h*w-y*x,A=y*_-c*w,k=c*x-h*_,z=h*k-y*A,F=y*I-c*k,N=c*A-h*I,$=2*r[3];return A*=$,k*=$,F*=2,N*=2,n[0]=_+(I*=$)+(z*=2),n[1]=x+A+F,n[2]=w+k+N,n},p.bt=function(n,t,r){let c=(h=[n[0],n[1],n[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((A=h[8])*(_=h[4])-(x=h[5])*(I=h[7]))+h[1]*(-A*(y=h[3])+x*(w=h[6]))+h[2]*(I*y-_*w);var h,y,_,x,w,I,A;if(c===0)return null;let k=pr([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),z=pr([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),F=pr([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),N=zi([],k,-n[3]);return Vi(N,N,zi([],z,-t[3])),Vi(N,N,zi([],F,-r[3])),zi(N,N,1/c),N},p.bu=Cm,p.bv=function(){return new Float64Array(4)},p.bw=function(n,t,r,c){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c),y[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c),y[2]=h[2],n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},p.bx=function(n,t,r,c){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[0],y[1]=h[1]*Math.cos(c)-h[2]*Math.sin(c),y[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c),n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},p.by=function(n,t,r,c){var h=[],y=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],y[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c),y[1]=h[1],y[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c),n[0]=y[0]+r[0],n[1]=y[1]+r[1],n[2]=y[2]+r[2],n},p.bz=function(n,t,r){var c=Math.sin(r),h=Math.cos(r),y=t[0],_=t[1],x=t[2],w=t[3],I=t[8],A=t[9],k=t[10],z=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=y*h-I*c,n[1]=_*h-A*c,n[2]=x*h-k*c,n[3]=w*h-z*c,n[8]=y*c+I*h,n[9]=_*c+A*h,n[10]=x*c+k*h,n[11]=w*c+z*h,n},p.c=ue,p.c0=s2,p.c1=class extends o{},p.c2=cm,p.c3=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},p.c4=y_,p.c5=function(n,t,r){var c=t[0],h=t[1],y=t[2],_=r[3]*c+r[7]*h+r[11]*y+r[15];return n[0]=(r[0]*c+r[4]*h+r[8]*y+r[12])/(_=_||1),n[1]=(r[1]*c+r[5]*h+r[9]*y+r[13])/_,n[2]=(r[2]*c+r[6]*h+r[10]*y+r[14])/_,n},p.c6=class extends gu{},p.c7=class extends E{},p.c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},p.c9=function(n,t){var r=n[0],c=n[1],h=n[2],y=n[3],_=n[4],x=n[5],w=n[6],I=n[7],A=n[8],k=n[9],z=n[10],F=n[11],N=n[12],$=n[13],Z=n[14],X=n[15],ce=t[0],ie=t[1],ne=t[2],_e=t[3],Te=t[4],Ae=t[5],je=t[6],ze=t[7],Be=t[8],Je=t[9],Ne=t[10],Ue=t[11],Ie=t[12],st=t[13],ct=t[14],tt=t[15];return Math.abs(r-ce)<=Ce*Math.max(1,Math.abs(r),Math.abs(ce))&&Math.abs(c-ie)<=Ce*Math.max(1,Math.abs(c),Math.abs(ie))&&Math.abs(h-ne)<=Ce*Math.max(1,Math.abs(h),Math.abs(ne))&&Math.abs(y-_e)<=Ce*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(_-Te)<=Ce*Math.max(1,Math.abs(_),Math.abs(Te))&&Math.abs(x-Ae)<=Ce*Math.max(1,Math.abs(x),Math.abs(Ae))&&Math.abs(w-je)<=Ce*Math.max(1,Math.abs(w),Math.abs(je))&&Math.abs(I-ze)<=Ce*Math.max(1,Math.abs(I),Math.abs(ze))&&Math.abs(A-Be)<=Ce*Math.max(1,Math.abs(A),Math.abs(Be))&&Math.abs(k-Je)<=Ce*Math.max(1,Math.abs(k),Math.abs(Je))&&Math.abs(z-Ne)<=Ce*Math.max(1,Math.abs(z),Math.abs(Ne))&&Math.abs(F-Ue)<=Ce*Math.max(1,Math.abs(F),Math.abs(Ue))&&Math.abs(N-Ie)<=Ce*Math.max(1,Math.abs(N),Math.abs(Ie))&&Math.abs($-st)<=Ce*Math.max(1,Math.abs($),Math.abs(st))&&Math.abs(Z-ct)<=Ce*Math.max(1,Math.abs(Z),Math.abs(ct))&&Math.abs(X-tt)<=Ce*Math.max(1,Math.abs(X),Math.abs(tt))},p.cA=function(n,t){V.REGISTERED_PROTOCOLS[n]=t},p.cB=function(n){delete V.REGISTERED_PROTOCOLS[n]},p.cC=function(n,t){let r={};for(let h=0;h<n.length;h++){let y=t&&t[n[h].id]||Yf(n[h]);t&&(t[n[h].id]=y);let _=r[y];_||(_=r[y]=[]),_.push(n[h])}let c=[];for(let h in r)c.push(r[h]);return c},p.cD=Ge,p.cE=f0,p.cF=g0,p.cG=Z_,p.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ot/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;let t=n.bucket.layers[0],r=t.layout,c=t._unevaluatedLayout._values,h={layoutIconSize:c["icon-size"].possiblyEvaluate(new Kt(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Kt(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Kt(18))};if(n.bucket.textSizeData.kind==="composite"){let{minZoom:I,maxZoom:A}=n.bucket.textSizeData;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Kt(I),n.canonical),c["text-size"].possiblyEvaluate(new Kt(A),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){let{minZoom:I,maxZoom:A}=n.bucket.iconSizeData;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Kt(I),n.canonical),c["icon-size"].possiblyEvaluate(new Kt(A),n.canonical)]}let y=r.get("text-line-height")*Ci,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),w=r.get("text-size");for(let I of n.bucket.features){let A=r.get("text-font").evaluate(I,{},n.canonical).join(","),k=w.evaluate(I,{},n.canonical),z=h.layoutTextSize.evaluate(I,{},n.canonical),F=h.layoutIconSize.evaluate(I,{},n.canonical),N={horizontal:{},vertical:void 0},$=I.text,Z,X=[0,0];if($){let ne=$.toString(),_e=r.get("text-letter-spacing").evaluate(I,{},n.canonical)*Ci,Te=tm(ne)?_e:0,Ae=r.get("text-anchor").evaluate(I,{},n.canonical),je=E0(t,I,n.canonical);if(!je){let Ne=r.get("text-radial-offset").evaluate(I,{},n.canonical);X=Ne?P0(Ae,[Ne*Ci,Rm]):r.get("text-offset").evaluate(I,{},n.canonical).map((Ue=>Ue*Ci))}let ze=_?"center":r.get("text-justify").evaluate(I,{},n.canonical),Be=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},n.canonical)*Ci:1/0,Je=()=>{n.bucket.allowVerticalPlacement&&Rl(ne)&&(N.vertical=Od($,n.glyphMap,n.glyphPositions,n.imagePositions,A,Be,y,Ae,"left",Te,X,p.ao.vertical,!0,z,k))};if(!_&&je){let Ne=new Set;if(ze==="auto")for(let Ie=0;Ie<je.values.length;Ie+=2)Ne.add(Lm(je.values[Ie]));else Ne.add(ze);let Ue=!1;for(let Ie of Ne)if(!N.horizontal[Ie])if(Ue)N.horizontal[Ie]=N.horizontal[0];else{let st=Od($,n.glyphMap,n.glyphPositions,n.imagePositions,A,Be,y,"center",Ie,Te,X,p.ao.horizontal,!1,z,k);st&&(N.horizontal[Ie]=st,Ue=st.positionedLines.length===1)}Je()}else{ze==="auto"&&(ze=Lm(Ae));let Ne=Od($,n.glyphMap,n.glyphPositions,n.imagePositions,A,Be,y,Ae,ze,Te,X,p.ao.horizontal,!1,z,k);Ne&&(N.horizontal[ze]=Ne),Je(),Rl(ne)&&_&&x&&(N.vertical=Od($,n.glyphMap,n.glyphPositions,n.imagePositions,A,Be,y,Ae,ze,Te,X,p.ao.vertical,!1,z,k))}}let ce=!1;if(I.icon&&I.icon.name){let ne=n.imageMap[I.icon.name];ne&&(Z=C2(n.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},n.canonical),r.get("icon-anchor").evaluate(I,{},n.canonical)),ce=!!ne.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ce:n.bucket.sdfIcons!==ce&&ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ne.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}let ie=C0(N.horizontal)||N.vertical;n.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||Z)&&q2(n.bucket,I,N,Z,n.imageMap,h,z,F,X,ce,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},p.cI=_m,p.cJ=mm,p.cK=ym,p.cL=R_,p.cM=xm,p.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},p.cO=function(n,t,r,c,h){return a(this,void 0,void 0,(function*(){if(xe())try{return yield ia(n,t,r,c,h)}catch{}return(function(y,_,x,w,I){let A=y.width,k=y.height;Un&&jn||(Un=new OffscreenCanvas(A,k),jn=Un.getContext("2d",{willReadFrequently:!0})),Un.width=A,Un.height=k,jn.drawImage(y,0,0,A,k);let z=jn.getImageData(_,x,w,I);return jn.clearRect(0,0,A,k),z.data})(n,t,r,c,h)}))},p.cP=x_,p.cQ=P,p.cR=k_,p.cS=Zl,p.cT=ss,p.cU=function(n,t){let r=new Map;if(n!=null)if(n.type==="Feature")r.set(Du(n,t),n);else for(let c of n.features)r.set(Du(c,t),c);return r},p.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return Du(n,t)!=null;if(n.type==="FeatureCollection"){let r=new Set;for(let c of n.features){let h=Du(c,t);if(h==null||r.has(h))return!1;r.add(h)}return!0}return!1},p.cW=function(n,t,r){var c,h,y,_;if(t.removeAll&&n.clear(),t.remove)for(let x of t.remove)n.delete(x);if(t.add)for(let x of t.add){let w=Du(x,r);w!=null&&n.set(w,x)}if(t.update)for(let x of t.update){let w=n.get(x.id);if(w==null)continue;let I=!x.removeAllProperties&&(((c=x.removeProperties)===null||c===void 0?void 0:c.length)>0||((h=x.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0);if((x.newGeometry||x.removeAllProperties||I)&&(w=Object.assign({},w),n.set(x.id,w),I&&(w.properties=Object.assign({},w.properties))),x.newGeometry&&(w.geometry=x.newGeometry),x.removeAllProperties)w.properties={};else if(((y=x.removeProperties)===null||y===void 0?void 0:y.length)>0)for(let A of x.removeProperties)Object.prototype.hasOwnProperty.call(w.properties,A)&&delete w.properties[A];if(((_=x.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(let{key:A,value:k}of x.addOrUpdateProperties)w.properties[A]=k}},p.cX=Br,p.ca=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},p.cb=n=>n.type==="symbol",p.cc=n=>n.type==="circle",p.cd=n=>n.type==="heatmap",p.ce=n=>n.type==="line",p.cf=n=>n.type==="fill",p.cg=n=>n.type==="fill-extrusion",p.ch=n=>n.type==="hillshade",p.ci=n=>n.type==="color-relief",p.cj=n=>n.type==="raster",p.ck=n=>n.type==="background",p.cl=n=>n.type==="custom",p.cm=Bn,p.cn=function(n,t,r){let c=Jo(t.x-r.x,t.y-r.y),h=Jo(n.x-r.x,n.y-r.y);var y,_;return $n(Math.atan2(c[0]*h[1]-c[1]*h[0],(y=c)[0]*(_=h)[0]+y[1]*_[1]))},p.co=yo,p.cp=function(n,t){return qn[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},p.cq=function(n,t){return Gn[t]&&"touches"in n},p.cr=function(n){return Gn[n]||qn[n]},p.cs=function(n,t,r){var c=t[0],h=t[1];return n[0]=r[0]*c+r[4]*h+r[12],n[1]=r[1]*c+r[5]*h+r[13],n},p.ct=function(n,t){let{x:r,y:c}=Lu.fromLngLat(t);return!(n<0||n>25||c<0||c>=1||r<0||r>=1)},p.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},p.cv=class extends Sa{},p.cw=W2,p.cy=function(n){return n.message===ra},p.cz=ee,p.d=ve,p.e=Tr,p.f=n=>a(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),p.g=G,p.h=n=>new Promise(((t,r)=>{let c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame((()=>{c.src=nn}))},c.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let h=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(h):nn})),p.i=tn,p.j=(n,t)=>he(Tr(n,{type:"json"}),t),p.k=Pe,p.l=Me,p.m=he,p.n=(n,t)=>he(Tr(n,{type:"arrayBuffer"}),t),p.o=function(n){return new xm(n).readFields(_2,[])},p.p=q_,p.q=wu,p.r=er,p.s=Vn,p.t=Id,p.u=Et,p.v=fe,p.w=ui,p.x=Jf,p.y=fs,p.z=xa})),l("worker",["./shared"],(function(p){"use strict";class a{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(let ee of V){this._layerConfigs[ee.id]=ee;let se=this._layers[ee.id]=p.bJ(ee);se._featureFilter=p.aa(se.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(let ee of G)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};let q=p.cC(Object.values(this._layerConfigs),this.keyCache);for(let ee of q){let se=ee.map((Pe=>this._layers[Pe.id])),he=se[0];if(he.visibility==="none")continue;let ve=he.source||"",pe=this.familiesBySource[ve];pe||(pe=this.familiesBySource[ve]={});let Se=he.sourceLayer||"_geojsonTileLayer",Me=pe[Se];Me||(Me=pe[Se]=[]),Me.push(se)}}}class b{constructor(V){let G={},q=[];for(let ve in V){let pe=V[ve],Se=G[ve]={};for(let Me in pe){let Pe=pe[+Me];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;let Xe={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};q.push(Xe),Se[Me]={rect:Xe,metrics:Pe.metrics}}}let{w:ee,h:se}=p.p(q),he=new p.q({width:ee||1,height:se||1});for(let ve in V){let pe=V[ve];for(let Se in pe){let Me=pe[+Se];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;let Pe=G[ve][Se].rect;p.q.copy(Me.bitmap,he,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},Me.bitmap)}}this.image=he,this.positions=G}}p.cD("GlyphAtlas",b);class P{constructor(V){this.tileID=new p.Z(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.globalState=V.globalState}parse(V,G,q,ee,se){return p._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new p.a8;let he=new p.cE(Object.keys(V.layers).sort()),ve=new p.cF(this.tileID,this.promoteId);ve.bucketLayerIDs=[];let pe={},Se={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q,subdivisionGranularity:se},Me=G.familiesBySource[this.source];for(let St in Me){let Mt=V.layers[St];if(!Mt)continue;Mt.version===1&&p.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let pi=he.encode(St),De=[];for(let Gi=0;Gi<Mt.length;Gi++){let Qt=Mt.feature(Gi),Zn=ve.getId(Qt,St);De.push({feature:Qt,id:Zn,index:Gi,sourceLayerIndex:pi})}for(let Gi of Me[St]){let Qt=Gi[0];Qt.source!==this.source&&p.w(`layer.source = ${Qt.source} does not equal this.source = ${this.source}`),Qt.minzoom&&this.zoom<Math.floor(Qt.minzoom)||Qt.maxzoom&&this.zoom>=Qt.maxzoom||Qt.visibility!=="none"&&(M(Gi,this.zoom,q),(pe[Qt.id]=Qt.createBucket({index:ve.bucketLayerIDs.length,layers:Gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pi,sourceID:this.source,globalState:this.globalState})).populate(De,Se,this.tileID.canonical),ve.bucketLayerIDs.push(Gi.map((Zn=>Zn.id))))}}let Pe=p.bN(Se.glyphDependencies,(St=>Object.keys(St).map(Number)));this.inFlightDependencies.forEach((St=>St?.abort())),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(Pe).length){let St=new AbortController;this.inFlightDependencies.push(St),Xe=ee.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}let fe=Object.keys(Se.iconDependencies),ut=Promise.resolve({});if(fe.length){let St=new AbortController;this.inFlightDependencies.push(St),ut=ee.sendAsync({type:"GI",data:{icons:fe,source:this.source,tileID:this.tileID,type:"icons"}},St)}let vt=Object.keys(Se.patternDependencies),Qe=Promise.resolve({});if(vt.length){let St=new AbortController;this.inFlightDependencies.push(St),Qe=ee.sendAsync({type:"GI",data:{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"}},St)}let[pt,qt,xi]=yield Promise.all([Xe,ut,Qe]),bi=new b(pt),hi=new p.cG(qt,xi);for(let St in pe){let Mt=pe[St];Mt instanceof p.a9?(M(Mt.layers,this.zoom,q),p.cH({bucket:Mt,glyphMap:pt,glyphPositions:bi.positions,imageMap:qt,imagePositions:hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):Mt.hasPattern&&(Mt instanceof p.cI||Mt instanceof p.cJ||Mt instanceof p.cK)&&(M(Mt.layers,this.zoom,q),Mt.addFeatures(Se,this.tileID.canonical,hi.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter((St=>!St.isEmpty())),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,imageAtlas:hi,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?qt:null,glyphPositions:this.returnDependencies?bi.positions:null}}))}}function M(ue,V,G){let q=new p.F(V);for(let ee of ue)ee.recalculate(q,G)}class D{constructor(V,G,q){this.actor=V,this.layerIndex=G,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,G){return p._(this,void 0,void 0,(function*(){let q=yield p.n(V.request,G);try{return{vectorTile:new p.cL(new p.cM(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(ee){let se=new Uint8Array(q.data),he=`Unable to parse the tile at ${V.request.url}, `;throw he+=se[0]===31&&se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.message}`,new Error(he)}}))}loadTile(V){return p._(this,void 0,void 0,(function*(){let G=V.uid,q=!!(V&&V.request&&V.request.collectResourceTiming)&&new p.cN(V.request),ee=new P(V);this.loading[G]=ee;let se=new AbortController;ee.abort=se;try{let he=yield this.loadVectorTile(V,se);if(delete this.loading[G],!he)return null;let ve=he.rawData,pe={};he.expires&&(pe.expires=he.expires),he.cacheControl&&(pe.cacheControl=he.cacheControl);let Se={};if(q){let Pe=q.finish();Pe&&(Se.resourceTiming=JSON.parse(JSON.stringify(Pe)))}ee.vectorTile=he.vectorTile;let Me=ee.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[G]=ee,this.fetching[G]={rawTileData:ve,cacheControl:pe,resourceTiming:Se};try{let Pe=yield Me;return p.e({rawTileData:ve.slice(0)},Pe,pe,Se)}finally{delete this.fetching[G]}}catch(he){throw delete this.loading[G],ee.status="done",this.loaded[G]=ee,he}}))}reloadTile(V){return p._(this,void 0,void 0,(function*(){let G=V.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let q=this.loaded[G];if(q.showCollisionBoxes=V.showCollisionBoxes,q.globalState=V.globalState,q.status==="parsing"){let ee=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity),se;if(this.fetching[G]){let{rawTileData:he,cacheControl:ve,resourceTiming:pe}=this.fetching[G];delete this.fetching[G],se=p.e({rawTileData:he.slice(0)},ee,ve,pe)}else se=ee;return se}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return p._(this,void 0,void 0,(function*(){let G=this.loading,q=V.uid;G&&G[q]&&G[q].abort&&(G[q].abort.abort(),delete G[q])}))}removeTile(V){return p._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class B{constructor(){this.loaded={}}loadTile(V){return p._(this,void 0,void 0,(function*(){let{uid:G,encoding:q,rawImageData:ee,redFactor:se,greenFactor:he,blueFactor:ve,baseShift:pe}=V,Se=ee.width+2,Me=ee.height+2,Pe=p.b(ee)?new p.R({width:Se,height:Me},yield p.cO(ee,-1,-1,Se,Me)):ee,Xe=new p.cP(G,Pe,q,se,he,ve,pe);return this.loaded=this.loaded||{},this.loaded[G]=Xe,Xe}))}removeTile(V){let G=this.loaded,q=V.uid;G&&G[q]&&delete G[q]}}var U,oe,le=(function(){if(oe)return U;function ue(G,q){if(G.length!==0){V(G[0],q);for(var ee=1;ee<G.length;ee++)V(G[ee],!q)}}function V(G,q){for(var ee=0,se=0,he=0,ve=G.length,pe=ve-1;he<ve;pe=he++){var Se=(G[he][0]-G[pe][0])*(G[pe][1]+G[he][1]),Me=ee+Se;se+=Math.abs(ee)>=Math.abs(Se)?ee-Me+Se:Se-Me+ee,ee=Me}ee+se>=0!=!!q&&G.reverse()}return oe=1,U=function G(q,ee){var se,he=q&&q.type;if(he==="FeatureCollection")for(se=0;se<q.features.length;se++)G(q.features[se],ee);else if(he==="GeometryCollection")for(se=0;se<q.geometries.length;se++)G(q.geometries[se],ee);else if(he==="Feature")G(q.geometry,ee);else if(he==="Polygon")ue(q.coordinates,ee);else if(he==="MultiPolygon")for(se=0;se<q.coordinates.length;se++)ue(q.coordinates[se],ee);return q}})(),me=p.cQ(le);class xe extends p.cS{constructor(V,G){super(new p.cM,0,G,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){let V=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let q of G){let ee=[];for(let se of q)ee.push(new p.P(se[0],se[1]));V.push(ee)}return V}}class Ce extends p.cR{constructor(V,G){super(new p.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=V.length,this.features=V}feature(V){return new xe(this.features[V],this.extent)}}function ke(ue,V){V.writeVarintField(15,ue.version||1),V.writeStringField(1,ue.name||""),V.writeVarintField(5,ue.extent||4096);let G={keys:[],values:[],keycache:{},valuecache:{}};for(let se=0;se<ue.length;se++)G.feature=ue.feature(se),V.writeMessage(2,Re,G);let q=G.keys;for(let se of q)V.writeStringField(3,se);let ee=G.values;for(let se of ee)V.writeMessage(4,Vi,se)}function Re(ue,V){if(!ue.feature)return;let G=ue.feature;G.id!==void 0&&V.writeVarintField(1,G.id),V.writeMessage(2,We,ue),V.writeVarintField(3,G.type),V.writeMessage(4,lt,G)}function We(ue,V){for(let G in ue.feature?.properties){let q=ue.feature.properties[G],ee=ue.keycache[G];if(q===null)continue;ee===void 0&&(ue.keys.push(G),ee=ue.keys.length-1,ue.keycache[G]=ee),V.writeVarint(ee),typeof q!="string"&&typeof q!="boolean"&&typeof q!="number"&&(q=JSON.stringify(q));let se=typeof q+":"+q,he=ue.valuecache[se];he===void 0&&(ue.values.push(q),he=ue.values.length-1,ue.valuecache[se]=he),V.writeVarint(he)}}function rt(ue,V){return(V<<3)+(7&ue)}function qe(ue){return ue<<1^ue>>31}function lt(ue,V){let G=ue.loadGeometry(),q=ue.type,ee=0,se=0;for(let he of G){let ve=1;q===1&&(ve=he.length),V.writeVarint(rt(1,ve));let pe=q===3?he.length-1:he.length;for(let Se=0;Se<pe;Se++){Se===1&&q!==1&&V.writeVarint(rt(2,pe-1));let Me=he[Se].x-ee,Pe=he[Se].y-se;V.writeVarint(qe(Me)),V.writeVarint(qe(Pe)),ee+=Me,se+=Pe}ue.type===3&&V.writeVarint(rt(7,1))}}function Vi(ue,V){let G=typeof ue;G==="string"?V.writeStringField(1,ue):G==="boolean"?V.writeBooleanField(7,ue):G==="number"&&(ue%1!=0?V.writeDoubleField(3,ue):ue<0?V.writeSVarintField(6,ue):V.writeVarintField(5,ue))}let zi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},pr=Math.fround||(Xi=new Float32Array(1),ue=>(Xi[0]=+ue,Xi[0]));var Xi;class Qr{constructor(V){this.options=Object.assign(Object.create(zi),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:G,minZoom:q,maxZoom:ee}=this.options;G&&console.time("total time");let se=`prepare ${V.length} points`;G&&console.time(se),this.points=V;let he=[];for(let pe=0;pe<V.length;pe++){let Se=V[pe];if(!Se.geometry)continue;let[Me,Pe]=Se.geometry.coordinates,Xe=pr(vn(Me)),fe=pr(xn(Pe));he.push(Xe,fe,1/0,pe,-1,1),this.options.reduce&&he.push(0)}let ve=this.trees[ee+1]=this._createTree(he);G&&console.timeEnd(se);for(let pe=ee;pe>=q;pe--){let Se=+Date.now();ve=this.trees[pe]=this._createTree(this._cluster(ve,pe)),G&&console.log("z%d: %d clusters in %dms",pe,ve.numItems,+Date.now()-Se)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let q=((V[0]+180)%360+360)%360-180,ee=Math.max(-90,Math.min(90,V[1])),se=V[2]===180?180:((V[2]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)q=-180,se=180;else if(q>se){let Pe=this.getClusters([q,ee,180,he],G),Xe=this.getClusters([-180,ee,se,he],G);return Pe.concat(Xe)}let ve=this.trees[this._limitZoom(G)],pe=ve.range(vn(q),xn(he),vn(se),xn(ee)),Se=ve.data,Me=[];for(let Pe of pe){let Xe=this.stride*Pe;Me.push(Se[Xe+5]>1?mo(Se,Xe,this.clusterProps):this.points[Se[Xe+3]])}return Me}getChildren(V){let G=this._getOriginId(V),q=this._getOriginZoom(V),ee="No cluster with the specified id.",se=this.trees[q];if(!se)throw new Error(ee);let he=se.data;if(G*this.stride>=he.length)throw new Error(ee);let ve=this.options.radius/(this.options.extent*Math.pow(2,q-1)),pe=se.within(he[G*this.stride],he[G*this.stride+1],ve),Se=[];for(let Me of pe){let Pe=Me*this.stride;he[Pe+4]===V&&Se.push(he[Pe+5]>1?mo(he,Pe,this.clusterProps):this.points[he[Pe+3]])}if(Se.length===0)throw new Error(ee);return Se}getLeaves(V,G,q){let ee=[];return this._appendLeaves(ee,V,G=G||10,q=q||0,0),ee}getTile(V,G,q){let ee=this.trees[this._limitZoom(V)],se=Math.pow(2,V),{extent:he,radius:ve}=this.options,pe=ve/he,Se=(q-pe)/se,Me=(q+1+pe)/se,Pe={features:[]};return this._addTileFeatures(ee.range((G-pe)/se,Se,(G+1+pe)/se,Me),ee.data,G,q,se,Pe),G===0&&this._addTileFeatures(ee.range(1-pe/se,Se,1,Me),ee.data,se,q,se,Pe),G===se-1&&this._addTileFeatures(ee.range(0,Se,pe/se,Me),ee.data,-1,q,se,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){let q=this.getChildren(V);if(G++,q.length!==1)break;V=q[0].properties.cluster_id}return G}_appendLeaves(V,G,q,ee,se){let he=this.getChildren(G);for(let ve of he){let pe=ve.properties;if(pe&&pe.cluster?se+pe.point_count<=ee?se+=pe.point_count:se=this._appendLeaves(V,pe.cluster_id,q,ee,se):se<ee?se++:V.push(ve),V.length===q)break}return se}_createTree(V){let G=new p.aI(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<V.length;q+=this.stride)G.add(V[q],V[q+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,q,ee,se,he){for(let ve of V){let pe=ve*this.stride,Se=G[pe+5]>1,Me,Pe,Xe;if(Se)Me=_n(G,pe,this.clusterProps),Pe=G[pe],Xe=G[pe+1];else{let vt=this.points[G[pe+3]];Me=vt.properties;let[Qe,pt]=vt.geometry.coordinates;Pe=vn(Qe),Xe=xn(pt)}let fe={type:1,geometry:[[Math.round(this.options.extent*(Pe*se-q)),Math.round(this.options.extent*(Xe*se-ee))]],tags:Me},ut;ut=Se||this.options.generateId?G[pe+3]:this.points[G[pe+3]].id,ut!==void 0&&(fe.id=ut),he.features.push(fe)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){let{radius:q,extent:ee,reduce:se,minPoints:he}=this.options,ve=q/(ee*Math.pow(2,G)),pe=V.data,Se=[],Me=this.stride;for(let Pe=0;Pe<pe.length;Pe+=Me){if(pe[Pe+2]<=G)continue;pe[Pe+2]=G;let Xe=pe[Pe],fe=pe[Pe+1],ut=V.within(pe[Pe],pe[Pe+1],ve),vt=pe[Pe+5],Qe=vt;for(let pt of ut){let qt=pt*Me;pe[qt+2]>G&&(Qe+=pe[qt+5])}if(Qe>vt&&Qe>=he){let pt,qt=Xe*vt,xi=fe*vt,bi=-1,hi=(Pe/Me<<5)+(G+1)+this.points.length;for(let St of ut){let Mt=St*Me;if(pe[Mt+2]<=G)continue;pe[Mt+2]=G;let pi=pe[Mt+5];qt+=pe[Mt]*pi,xi+=pe[Mt+1]*pi,pe[Mt+4]=hi,se&&(pt||(pt=this._map(pe,Pe,!0),bi=this.clusterProps.length,this.clusterProps.push(pt)),se(pt,this._map(pe,Mt)))}pe[Pe+4]=hi,Se.push(qt/Qe,xi/Qe,1/0,hi,-1,Qe),se&&Se.push(bi)}else{for(let pt=0;pt<Me;pt++)Se.push(pe[Pe+pt]);if(Qe>1)for(let pt of ut){let qt=pt*Me;if(!(pe[qt+2]<=G)){pe[qt+2]=G;for(let xi=0;xi<Me;xi++)Se.push(pe[qt+xi])}}}}return Se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,q){if(V[G+5]>1){let he=this.clusterProps[V[G+6]];return q?Object.assign({},he):he}let ee=this.points[V[G+3]].properties,se=this.options.map(ee);return q&&se===ee?Object.assign({},se):se}}function mo(ue,V,G){return{type:"Feature",id:ue[V+3],properties:_n(ue,V,G),geometry:{type:"Point",coordinates:[(q=ue[V],360*(q-.5)),Jo(ue[V+1])]}};var q}function _n(ue,V,G){let q=ue[V+5],ee=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,se=ue[V+6],he=se===-1?{}:Object.assign({},G[se]);return Object.assign(he,{cluster:!0,cluster_id:ue[V+3],point_count:q,point_count_abbreviated:ee})}function vn(ue){return ue/360+.5}function xn(ue){let V=Math.sin(ue*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Jo(ue){let V=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Ot(ue,V,G,q){let ee=q,se=V+(G-V>>1),he,ve=G-V,pe=ue[V],Se=ue[V+1],Me=ue[G],Pe=ue[G+1];for(let Xe=V+3;Xe<G;Xe+=3){let fe=bn(ue[Xe],ue[Xe+1],pe,Se,Me,Pe);if(fe>ee)he=Xe,ee=fe;else if(fe===ee){let ut=Math.abs(Xe-se);ut<ve&&(he=Xe,ve=ut)}}ee>q&&(he-V>3&&Ot(ue,V,he,q),ue[he+2]=ee,G-he>3&&Ot(ue,he,G,q))}function bn(ue,V,G,q,ee,se){let he=ee-G,ve=se-q;if(he!==0||ve!==0){let pe=((ue-G)*he+(V-q)*ve)/(he*he+ve*ve);pe>1?(G=ee,q=se):pe>0&&(G+=he*pe,q+=ve*pe)}return he=ue-G,ve=V-q,he*he+ve*ve}function $i(ue,V,G,q){let ee={id:ue??null,type:V,geometry:G,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")go(ee,G);else if(V==="Polygon")go(ee,G[0]);else if(V==="MultiLineString")for(let se of G)go(ee,se);else if(V==="MultiPolygon")for(let se of G)go(ee,se[0]);return ee}function go(ue,V){for(let G=0;G<V.length;G+=3)ue.minX=Math.min(ue.minX,V[G]),ue.minY=Math.min(ue.minY,V[G+1]),ue.maxX=Math.max(ue.maxX,V[G]),ue.maxY=Math.max(ue.maxY,V[G+1])}function en(ue,V,G,q){if(!V.geometry)return;let ee=V.geometry.coordinates;if(ee&&ee.length===0)return;let se=V.geometry.type,he=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),ve=[],pe=V.id;if(G.promoteId?pe=V.properties[G.promoteId]:G.generateId&&(pe=q||0),se==="Point")Bn(ee,ve);else if(se==="MultiPoint")for(let Se of ee)Bn(Se,ve);else if(se==="LineString")yo(ee,ve,he,!1);else if(se==="MultiLineString"){if(G.lineMetrics){for(let Se of ee)ve=[],yo(Se,ve,he,!1),ue.push($i(pe,"LineString",ve,V.properties));return}ar(ee,ve,he,!1)}else if(se==="Polygon")ar(ee,ve,he,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(let Se of V.geometry.geometries)en(ue,{id:pe,geometry:Se,properties:V.properties},G,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Se of ee){let Me=[];ar(Se,Me,he,!0),ve.push(Me)}}ue.push($i(pe,se,ve,V.properties))}function Bn(ue,V){V.push(Qo(ue[0]),Tr(ue[1]),0)}function yo(ue,V,G,q){let ee,se,he=0;for(let pe=0;pe<ue.length;pe++){let Se=Qo(ue[pe][0]),Me=Tr(ue[pe][1]);V.push(Se,Me,0),pe>0&&(he+=q?(ee*Me-Se*se)/2:Math.sqrt(Math.pow(Se-ee,2)+Math.pow(Me-se,2))),ee=Se,se=Me}let ve=V.length-3;V[2]=1,Ot(V,0,ve,G),V[ve+2]=1,V.size=Math.abs(he),V.start=0,V.end=V.size}function ar(ue,V,G,q){for(let ee=0;ee<ue.length;ee++){let se=[];yo(ue[ee],se,G,q),V.push(se)}}function Qo(ue){return ue/360+.5}function Tr(ue){let V=Math.sin(ue*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Mr(ue,V,G,q,ee,se,he,ve){if(q/=V,se>=(G/=V)&&he<q)return ue;if(he<G||se>=q)return null;let pe=[];for(let Se of ue){let Me=Se.geometry,Pe=Se.type,Xe=ee===0?Se.minX:Se.minY,fe=ee===0?Se.maxX:Se.maxY;if(Xe>=G&&fe<q){pe.push(Se);continue}if(fe<G||Xe>=q)continue;let ut=[];if(Pe==="Point"||Pe==="MultiPoint")ea(Me,ut,G,q,ee);else if(Pe==="LineString")ta(Me,ut,G,q,ee,!1,ve.lineMetrics);else if(Pe==="MultiLineString")ni(Me,ut,G,q,ee,!1);else if(Pe==="Polygon")ni(Me,ut,G,q,ee,!0);else if(Pe==="MultiPolygon")for(let vt of Me){let Qe=[];ni(vt,Qe,G,q,ee,!0),Qe.length&&ut.push(Qe)}if(ut.length){if(ve.lineMetrics&&Pe==="LineString"){for(let vt of ut)pe.push($i(Se.id,Pe,vt,Se.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(ut.length===1?(Pe="LineString",ut=ut[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=ut.length===3?"Point":"MultiPoint"),pe.push($i(Se.id,Pe,ut,Se.tags))}}return pe.length?pe:null}function ea(ue,V,G,q,ee){for(let se=0;se<ue.length;se+=3){let he=ue[se+ee];he>=G&&he<=q&&ui(V,ue[se],ue[se+1],ue[se+2])}}function ta(ue,V,G,q,ee,se,he){let ve=fr(ue),pe=ee===0?kr:tn,Se,Me,Pe=ue.start;for(let Qe=0;Qe<ue.length-3;Qe+=3){let pt=ue[Qe],qt=ue[Qe+1],xi=ue[Qe+2],bi=ue[Qe+3],hi=ue[Qe+4],St=ee===0?pt:qt,Mt=ee===0?bi:hi,pi=!1;he&&(Se=Math.sqrt(Math.pow(pt-bi,2)+Math.pow(qt-hi,2))),St<G?Mt>G&&(Me=pe(ve,pt,qt,bi,hi,G),he&&(ve.start=Pe+Se*Me)):St>q?Mt<q&&(Me=pe(ve,pt,qt,bi,hi,q),he&&(ve.start=Pe+Se*Me)):ui(ve,pt,qt,xi),Mt<G&&St>=G&&(Me=pe(ve,pt,qt,bi,hi,G),pi=!0),Mt>q&&St<=q&&(Me=pe(ve,pt,qt,bi,hi,q),pi=!0),!se&&pi&&(he&&(ve.end=Pe+Se*Me),V.push(ve),ve=fr(ue)),he&&(Pe+=Se)}let Xe=ue.length-3,fe=ue[Xe],ut=ue[Xe+1],vt=ee===0?fe:ut;vt>=G&&vt<=q&&ui(ve,fe,ut,ue[Xe+2]),Xe=ve.length-3,se&&Xe>=3&&(ve[Xe]!==ve[0]||ve[Xe+1]!==ve[1])&&ui(ve,ve[0],ve[1],ve[2]),ve.length&&V.push(ve)}function fr(ue){let V=[];return V.size=ue.size,V.start=ue.start,V.end=ue.end,V}function ni(ue,V,G,q,ee,se){for(let he of ue)ta(he,V,G,q,ee,se,!1)}function ui(ue,V,G,q){ue.push(V,G,q)}function kr(ue,V,G,q,ee,se){let he=(se-V)/(q-V);return ui(ue,se,G+(ee-G)*he,1),he}function tn(ue,V,G,q,ee,se){let he=(se-G)/(ee-G);return ui(ue,V+(q-V)*he,se,1),he}function _o(ue,V){let G=[];for(let q=0;q<ue.length;q++){let ee=ue[q],se=ee.type,he;if(se==="Point"||se==="MultiPoint"||se==="LineString")he=rn(ee.geometry,V);else if(se==="MultiLineString"||se==="Polygon"){he=[];for(let ve of ee.geometry)he.push(rn(ve,V))}else if(se==="MultiPolygon"){he=[];for(let ve of ee.geometry){let pe=[];for(let Se of ve)pe.push(rn(Se,V));he.push(pe)}}G.push($i(ee.id,se,he,ee.tags))}return G}function rn(ue,V){let G=[];G.size=ue.size,ue.start!==void 0&&(G.start=ue.start,G.end=ue.end);for(let q=0;q<ue.length;q+=3)G.push(ue[q]+V,ue[q+1],ue[q+2]);return G}function nn(ue,V){if(ue.transformed)return ue;let G=1<<ue.z,q=ue.x,ee=ue.y;for(let se of ue.features){let he=se.geometry,ve=se.type;if(se.geometry=[],ve===1)for(let pe=0;pe<he.length;pe+=2)se.geometry.push(ia(he[pe],he[pe+1],V,G,q,ee));else for(let pe=0;pe<he.length;pe++){let Se=[];for(let Me=0;Me<he[pe].length;Me+=2)Se.push(ia(he[pe][Me],he[pe][Me+1],V,G,q,ee));se.geometry.push(Se)}}return ue.transformed=!0,ue}function ia(ue,V,G,q,ee,se){return[Math.round(G*(ue*q-ee)),Math.round(G*(V*q-se))]}function Un(ue,V,G,q,ee){let se=V===ee.maxZoom?0:ee.tolerance/((1<<V)*ee.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:G,y:q,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ve of ue)jn(he,ve,se,ee);return he}function jn(ue,V,G,q){let ee=V.geometry,se=V.type,he=[];if(ue.minX=Math.min(ue.minX,V.minX),ue.minY=Math.min(ue.minY,V.minY),ue.maxX=Math.max(ue.maxX,V.maxX),ue.maxY=Math.max(ue.maxY,V.maxY),se==="Point"||se==="MultiPoint")for(let ve=0;ve<ee.length;ve+=3)he.push(ee[ve],ee[ve+1]),ue.numPoints++,ue.numSimplified++;else if(se==="LineString")Vn(he,ee,ue,G,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(let ve=0;ve<ee.length;ve++)Vn(he,ee[ve],ue,G,se==="Polygon",ve===0);else if(se==="MultiPolygon")for(let ve=0;ve<ee.length;ve++){let pe=ee[ve];for(let Se=0;Se<pe.length;Se++)Vn(he,pe[Se],ue,G,!0,Se===0)}if(he.length){let ve=V.tags||null;if(se==="LineString"&&q.lineMetrics){ve={};for(let Se in V.tags)ve[Se]=V.tags[Se];ve.mapbox_clip_start=ee.start/ee.size,ve.mapbox_clip_end=ee.end/ee.size}let pe={geometry:he,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:ve};V.id!==null&&(pe.id=V.id),ue.features.push(pe)}}function Vn(ue,V,G,q,ee,se){let he=q*q;if(q>0&&V.size<(ee?he:q))return void(G.numPoints+=V.length/3);let ve=[];for(let pe=0;pe<V.length;pe+=3)(q===0||V[pe+2]>he)&&(G.numSimplified++,ve.push(V[pe],V[pe+1])),G.numPoints++;ee&&(function(pe,Se){let Me=0;for(let Pe=0,Xe=pe.length,fe=Xe-2;Pe<Xe;fe=Pe,Pe+=2)Me+=(pe[Pe]-pe[fe])*(pe[Pe+1]+pe[fe+1]);if(Me>0===Se)for(let Pe=0,Xe=pe.length;Pe<Xe/2;Pe+=2){let fe=pe[Pe],ut=pe[Pe+1];pe[Pe]=pe[Xe-2-Pe],pe[Pe+1]=pe[Xe-1-Pe],pe[Xe-2-Pe]=fe,pe[Xe-1-Pe]=ut}})(ve,se),ue.push(ve)}let vo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $n{constructor(V,G){let q=(G=this.options=(function(se,he){for(let ve in he)se[ve]=he[ve];return se})(Object.create(vo),G)).debug;if(q&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let ee=(function(se,he){let ve=[];if(se.type==="FeatureCollection")for(let pe=0;pe<se.features.length;pe++)en(ve,se.features[pe],he,pe);else en(ve,se.type==="Feature"?se:{geometry:se},he);return ve})(V,G);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=(function(se,he){let ve=he.buffer/he.extent,pe=se,Se=Mr(se,1,-1-ve,ve,0,-1,2,he),Me=Mr(se,1,1-ve,2+ve,0,-1,2,he);return(Se||Me)&&(pe=Mr(se,1,-ve,1+ve,0,-1,2,he)||[],Se&&(pe=_o(Se,1).concat(pe)),Me&&(pe=pe.concat(_o(Me,-1)))),pe})(ee,G),ee.length&&this.splitTile(ee,0,0,0),q&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,G,q,ee,se,he,ve){let pe=[V,G,q,ee],Se=this.options,Me=Se.debug;for(;pe.length;){ee=pe.pop(),q=pe.pop(),G=pe.pop(),V=pe.pop();let Pe=1<<G,Xe=Gn(G,q,ee),fe=this.tiles[Xe];if(!fe&&(Me>1&&console.time("creation"),fe=this.tiles[Xe]=Un(V,G,q,ee,Se),this.tileCoords.push({z:G,x:q,y:ee}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,q,ee,fe.numFeatures,fe.numPoints,fe.numSimplified),console.timeEnd("creation"));let pi=`z${G}`;this.stats[pi]=(this.stats[pi]||0)+1,this.total++}if(fe.source=V,se==null){if(G===Se.indexMaxZoom||fe.numPoints<=Se.indexMaxPoints)continue}else{if(G===Se.maxZoom||G===se)continue;if(se!=null){let pi=se-G;if(q!==he>>pi||ee!==ve>>pi)continue}}if(fe.source=null,V.length===0)continue;Me>1&&console.time("clipping");let ut=.5*Se.buffer/Se.extent,vt=.5-ut,Qe=.5+ut,pt=1+ut,qt=null,xi=null,bi=null,hi=null,St=Mr(V,Pe,q-ut,q+Qe,0,fe.minX,fe.maxX,Se),Mt=Mr(V,Pe,q+vt,q+pt,0,fe.minX,fe.maxX,Se);V=null,St&&(qt=Mr(St,Pe,ee-ut,ee+Qe,1,fe.minY,fe.maxY,Se),xi=Mr(St,Pe,ee+vt,ee+pt,1,fe.minY,fe.maxY,Se),St=null),Mt&&(bi=Mr(Mt,Pe,ee-ut,ee+Qe,1,fe.minY,fe.maxY,Se),hi=Mr(Mt,Pe,ee+vt,ee+pt,1,fe.minY,fe.maxY,Se),Mt=null),Me>1&&console.timeEnd("clipping"),pe.push(qt||[],G+1,2*q,2*ee),pe.push(xi||[],G+1,2*q,2*ee+1),pe.push(bi||[],G+1,2*q+1,2*ee),pe.push(hi||[],G+1,2*q+1,2*ee+1)}}getTile(V,G,q){V=+V,G=+G,q=+q;let ee=this.options,{extent:se,debug:he}=ee;if(V<0||V>24)return null;let ve=1<<V,pe=Gn(V,G=G+ve&ve-1,q);if(this.tiles[pe])return nn(this.tiles[pe],se);he>1&&console.log("drilling down to z%d-%d-%d",V,G,q);let Se,Me=V,Pe=G,Xe=q;for(;!Se&&Me>0;)Me--,Pe>>=1,Xe>>=1,Se=this.tiles[Gn(Me,Pe,Xe)];return Se&&Se.source?(he>1&&(console.log("found parent tile z%d-%d-%d",Me,Pe,Xe),console.time("drilling down")),this.splitTile(Se.source,Me,Pe,Xe,V,G,q),he>1&&console.timeEnd("drilling down"),this.tiles[pe]?nn(this.tiles[pe],se):null):null}}function Gn(ue,V,G){return 32*((1<<ue)*G+V)+ue}class qn extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,G){return p._(this,void 0,void 0,(function*(){let q=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let ee=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ee)return null;let se=new Ce(ee.features,{version:2,extent:p.$}),he=(function(ve){let pe=new p.cM;return(function(Se,Me){for(let Pe in Se.layers)Me.writeMessage(3,ke,Se.layers[Pe])})(ve,pe),pe.finish()})(se);return he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),{vectorTile:se,rawData:he.buffer}}))}loadData(V){return p._(this,void 0,void 0,(function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();let q=!!(V&&V.request&&V.request.collectResourceTiming)&&new p.cN(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest);let ee=yield this._pendingData;this._geoJSONIndex=V.cluster?new Qr((function({superclusterOptions:he,clusterProperties:ve}){if(!ve||!he)return he;let pe={},Se={},Me={accumulated:null,zoom:0},Pe={properties:null},Xe=Object.keys(ve);for(let fe of Xe){let[ut,vt]=ve[fe],Qe=p.cT(vt),pt=p.cT(typeof ut=="string"?[ut,["accumulated"],["get",fe]]:ut);pe[fe]=Qe.value,Se[fe]=pt.value}return he.map=fe=>{Pe.properties=fe;let ut={};for(let vt of Xe)ut[vt]=pe[vt].evaluate(Me,Pe);return ut},he.reduce=(fe,ut)=>{Pe.properties=ut;for(let vt of Xe)Me.accumulated=fe[vt],fe[vt]=Se[vt].evaluate(Me,Pe)},he})(V)).load(ee.features):(function(he,ve){return new $n(he,ve)})(ee,V.geojsonVtOptions),this.loaded={};let se={data:ee};if(q){let he=q.finish();he&&(se.resourceTiming={},se.resourceTiming[V.source]=JSON.parse(JSON.stringify(he)))}return se}catch(ee){if(delete this._pendingRequest,p.cy(ee))return{abandoned:!0};throw ee}}))}getData(){return p._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){let G=this.loaded;return G&&G[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,G){return p._(this,void 0,void 0,(function*(){let q=yield this.loadGeoJSON(V,G);if(delete this._pendingRequest,typeof q!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(me(q,!0),V.filter){let ee=p.cT(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map((he=>`${he.key}: ${he.message}`)).join(", "));q={type:"FeatureCollection",features:q.features.filter((he=>ee.value.evaluate({zoom:0},he)))}}return q}))}loadGeoJSON(V,G){return p._(this,void 0,void 0,(function*(){let{promoteId:q}=V;if(V.request){let ee=yield p.j(V.request,G);return this._dataUpdateable=p.cV(ee.data,q)?p.cU(ee.data,q):void 0,ee.data}if(typeof V.data=="string")try{let ee=JSON.parse(V.data);return this._dataUpdateable=p.cV(ee,q)?p.cU(ee,q):void 0,ee}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return p.cW(this._dataUpdateable,V.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(V){return p._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class ra{constructor(V){this.self=V,this.actor=new p.J(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(G,q)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=q},this.self.addProtocol=p.cA,this.self.removeProtocol=p.cB,this.self.registerRTLTextPlugin=G=>{p.cX.setMethods(G)},this.actor.registerMessageHandler("LDT",((G,q)=>this._getDEMWorkerSource(G,q.source).loadTile(q))),this.actor.registerMessageHandler("RDT",((G,q)=>p._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(G,q.source).removeTile(q)})))),this.actor.registerMessageHandler("GCEZ",((G,q)=>p._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,q.type,q.source).getClusterExpansionZoom(q)})))),this.actor.registerMessageHandler("GCC",((G,q)=>p._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,q.type,q.source).getClusterChildren(q)})))),this.actor.registerMessageHandler("GCL",((G,q)=>p._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,q.type,q.source).getClusterLeaves(q)})))),this.actor.registerMessageHandler("LD",((G,q)=>this._getWorkerSource(G,q.type,q.source).loadData(q))),this.actor.registerMessageHandler("GD",((G,q)=>this._getWorkerSource(G,q.type,q.source).getData())),this.actor.registerMessageHandler("LT",((G,q)=>this._getWorkerSource(G,q.type,q.source).loadTile(q))),this.actor.registerMessageHandler("RT",((G,q)=>this._getWorkerSource(G,q.type,q.source).reloadTile(q))),this.actor.registerMessageHandler("AT",((G,q)=>this._getWorkerSource(G,q.type,q.source).abortTile(q))),this.actor.registerMessageHandler("RMT",((G,q)=>this._getWorkerSource(G,q.type,q.source).removeTile(q))),this.actor.registerMessageHandler("RS",((G,q)=>p._(this,void 0,void 0,(function*(){if(!this.workerSources[G]||!this.workerSources[G][q.type]||!this.workerSources[G][q.type][q.source])return;let ee=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],ee.removeSource!==void 0&&ee.removeSource(q)})))),this.actor.registerMessageHandler("RM",(G=>p._(this,void 0,void 0,(function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G]})))),this.actor.registerMessageHandler("SR",((G,q)=>p._(this,void 0,void 0,(function*(){this.referrer=q})))),this.actor.registerMessageHandler("SRPS",((G,q)=>this._syncRTLPluginState(G,q))),this.actor.registerMessageHandler("IS",((G,q)=>p._(this,void 0,void 0,(function*(){this.self.importScripts(q)})))),this.actor.registerMessageHandler("SI",((G,q)=>this._setImages(G,q))),this.actor.registerMessageHandler("UL",((G,q)=>p._(this,void 0,void 0,(function*(){this._getLayerIndex(G).update(q.layers,q.removedIds)})))),this.actor.registerMessageHandler("SL",((G,q)=>p._(this,void 0,void 0,(function*(){this._getLayerIndex(G).replace(q)}))))}_setImages(V,G){return p._(this,void 0,void 0,(function*(){this.availableImages[V]=G;for(let q in this.workerSources[V]){let ee=this.workerSources[V][q];for(let se in ee)ee[se].availableImages=G}}))}_syncRTLPluginState(V,G){return p._(this,void 0,void 0,(function*(){return yield p.cX.syncState(G,this.self.importScripts)}))}_getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}_getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new a),G}_getWorkerSource(V,G,q){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),!this.workerSources[V][G][q]){let ee={sendAsync:(se,he)=>(se.targetMapId=V,this.actor.sendAsync(se,he))};switch(G){case"vector":this.workerSources[V][G][q]=new D(ee,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][G][q]=new qn(ee,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][G][q]=new this.externalWorkerSourceTypes[G](ee,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][G][q]}_getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new B),this.demWorkerSources[V][G]}}return p.i(self)&&(self.worker=new ra(self)),ra})),l("index",["exports","./shared"],(function(p,a){"use strict";var b="5.6.2";function P(){var m=new a.A(4);return a.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let M,D,B={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,o){let u=requestAnimationFrame((g=>{d(),e(g)})),{unsubscribe:d}=a.s(m.signal,"abort",(()=>{d(),cancelAnimationFrame(u),o(a.c())}),!1)},frameAsync(m){return new Promise(((e,o)=>{this.frame(m,e,o)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){let e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(M||(M=document.createElement("a")),M.href=m,M.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(D==null&&(D=matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}};class U{static testProp(e){if(!U.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in U.docStyle)return e[o];return e[0]}static create(e,o,u){let d=window.document.createElement(e);return o!==void 0&&(d.className=o),u&&u.appendChild(d),d}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(e,o){e.style[U.transformProp]=o}static addEventListener(e,o,u,d={}){e.addEventListener(o,u,"passive"in d?d:d.capture)}static removeEventListener(e,o,u,d={}){e.removeEventListener(o,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",U.suppressClickInternal,!0)}),0)}static getScale(e){let o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){let d=o.boundingClientRect;return new a.P((u.clientX-d.left)/o.x-e.clientLeft,(u.clientY-d.top)/o.y-e.clientTop)}static mousePos(e,o){let u=U.getScale(e);return U.getPoint(e,u,o)}static touchPos(e,o){let u=[],d=U.getScale(e);for(let g=0;g<o.length;g++)u.push(U.getPoint(e,d,o[g]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let o=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=o.querySelectorAll("script");for(let d of u)d.remove();return U.clean(o),o.innerHTML}static isPossiblyDangerous(e,o){let u=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let o=e.children;for(let u of o)U.removeAttributes(u),U.clean(u)}static removeAttributes(e){for(let{name:o,value:u}of e.attributes)U.isPossiblyDangerous(o,u)&&e.removeAttribute(o)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);let oe={supported:!1,testSupport:function(m){!xe&&me&&(Ce?ke(m):le=m)}},le,me,xe=!1,Ce=!1;function ke(m){let e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,me),m.isContextLost())return;oe.supported=!0}catch{}m.deleteTexture(e),xe=!0}var Re;typeof document<"u"&&(me=document.createElement("img"),me.onload=()=>{le&&ke(le),le=null,Ce=!0},me.onerror=()=>{xe=!0,le=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,o,u,d;m.resetRequestQueue=()=>{e=[],o=0,u=0,d={}},m.addThrottleControl=S=>{let E=u++;return d[E]=S,E},m.removeThrottleControl=S=>{delete d[S],v()},m.getImage=(S,E,C=!0)=>new Promise(((L,R)=>{oe.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),a.e(S,{type:"image"}),e.push({abortController:E,requestParameters:S,supportImageRefresh:C,state:"queued",onError:O=>{R(O)},onSuccess:O=>{L(O)}}),v()}));let g=S=>a._(this,void 0,void 0,(function*(){S.state="running";let{requestParameters:E,supportImageRefresh:C,onError:L,onSuccess:R,abortController:O}=S,j=C===!1&&!a.i(self)&&!a.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce(((K,Y)=>K&&Y==="accept"),!0));o++;let H=j?T(E,O):a.m(E,O);try{let K=yield H;delete S.abortController,S.state="completed",K.data instanceof HTMLImageElement||a.b(K.data)?R(K):K.data&&R({data:yield(W=K.data,typeof createImageBitmap=="function"?a.f(W):a.h(W)),cacheControl:K.cacheControl,expires:K.expires})}catch(K){delete S.abortController,L(K)}finally{o--,v()}var W})),v=()=>{let S=(()=>{for(let E of Object.keys(d))if(d[E]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=o;E<S&&e.length>0;E++){let C=e.shift();C.abortController.signal.aborted?E--:g(C)}},T=(S,E)=>new Promise(((C,L)=>{let R=new Image,O=S.url,j=S.credentials;j&&j==="include"?R.crossOrigin="use-credentials":(j&&j==="same-origin"||!a.d(O))&&(R.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{R.src="",L(a.c())})),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,C({data:R})},R.onerror=()=>{R.onerror=R.onload=null,E.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=O}))})(Re||(Re={})),Re.resetRequestQueue();class We{constructor(e){this._transformRequestFn=e??null}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function rt(m){let e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){let o=[];for(let{id:u,url:d}of m){let g=`${u}${d}`;o.indexOf(g)===-1&&(o.push(g),e.push({id:u,url:d}))}}return e}function qe(m,e,o){try{let u=new URL(m);return u.pathname+=`${e}${o}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function lt(m){let{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Vi extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){let o=this.images[e];if(o&&!o.data&&o.spriteData){let u=o.spriteData;o.data=new a.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0,d=o.data||o.spriteData;return this._validateStretch(o.stretchX,d&&d.width)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,d&&d.height)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new a.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(let d of e){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;let u=o.spriteData,d=u&&u.width||o.data.width,g=u&&u.height||o.data.height;return!(e[0]<0||d<e[0]||e[1]<0||g<e[1]||e[2]<0||d<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){let d=this.getImage(e);if(u&&(d.data.width!==o.data.width||d.data.height!==o.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=d.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){let o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((o,u)=>{let d=!0;if(!this.isLoaded())for(let g of e)this.images[g]||(d=!1);this.isLoaded()||d?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})}))}_getImagesForIds(e){let o={};for(let u of e){let d=this.getImage(u);d||(this.fire(new a.l("styleimagemissing",{id:u})),d=this.getImage(u)),d?o[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:a.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){let{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){let o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{let d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new a.I(d,u);this.patterns[e]={bin:d,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let g in this.patterns)e.push(this.patterns[g].bin);let{w:o,h:u}=a.p(e),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(let g in this.patterns){let{bin:v}=this.patterns[g],T=v.x+1,S=v.y+1,E=this.getImage(g).data,C=E.width,L=E.height;a.R.copy(E,d,{x:0,y:0},{x:T,y:S},{width:C,height:L}),a.R.copy(E,d,{x:0,y:L-1},{x:T,y:S-1},{width:C,height:1}),a.R.copy(E,d,{x:0,y:0},{x:T,y:S+L},{width:C,height:1}),a.R.copy(E,d,{x:C-1,y:0},{x:T-1,y:S},{width:1,height:L}),a.R.copy(E,d,{x:0,y:0},{x:T+C,y:S},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;let u=this.getImage(o);u||a.w(`Image with ID: "${o}" was not found`),lt(u)&&this.updateImage(o,u)}}}let zi=1e20;function pr(m,e,o,u,d,g,v,T,S){for(let E=e;E<e+u;E++)Xi(m,o*g+E,g,d,v,T,S);for(let E=o;E<o+d;E++)Xi(m,E*g+e,1,u,v,T,S)}function Xi(m,e,o,u,d,g,v){g[0]=0,v[0]=-zi,v[1]=zi,d[0]=m[e];for(let T=1,S=0,E=0;T<u;T++){d[T]=m[e+T*o];let C=T*T;do{let L=g[S];E=(d[T]-d[L]+C-L*L)/(T-L)/2}while(E<=v[S]&&--S>-1);S++,g[S]=T,v[S]=E,v[S+1]=zi}for(let T=0,S=0;T<u;T++){for(;v[S+1]<T;)S++;let E=g[S],C=T-E;m[e+T*o]=d[E]+C*C}}class Qr{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return a._(this,void 0,void 0,(function*(){let o=[];for(let g in e)for(let v of e[g])o.push(this._getAndCacheGlyphsPromise(g,v));let u=yield Promise.all(o),d={};for(let{stack:g,id:v,glyph:T}of u)d[g]||(d[g]={}),d[g][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return d}))}_getAndCacheGlyphsPromise(e,o){return a._(this,void 0,void 0,(function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[o];if(d!==void 0)return{stack:e,id:o,glyph:d};if(d=this._tinySDF(u,e,o),d)return u.glyphs[o]=d,{stack:e,id:o,glyph:d};let g=Math.floor(o/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[g])return{stack:e,id:o,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[g]){let T=Qr.loadGlyphRange(e,g,this.url,this.requestManager);u.requests[g]=T}let v=yield u.requests[g];for(let T in v)this._doesCharSupportLocalGlyph(+T)||(u.glyphs[+T]=v[+T]);return u.ranges[g]=!0,{stack:e,id:o,glyph:v[o]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))||a.u["CJK Unified Ideographs"](e)||a.u["Hangul Syllables"](e)||a.u.Hiragana(e)||a.u.Katakana(e)||a.u["CJK Symbols and Punctuation"](e)||a.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,o,u){let d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let T="400";/bold/i.test(o)?T="900":/medium/i.test(o)?T="500":/light/i.test(o)&&(T="200"),g=e.tinySDF=new Qr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:T})}let v=g.draw(String.fromCharCode(u));return{id:u,bitmap:new a.q({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qr.loadGlyphRange=function(m,e,o,u){return a._(this,void 0,void 0,(function*(){let d=256*e,g=d+255,v=u.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${d}-${g}`),"Glyphs"),T=yield a.n(v,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${g}`);let S={};for(let E of a.o(T.data))S[E.id]=E;return S}))},Qr.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:v="normal",lang:T=null}={}){this.buffer=e,this.cutoff=u,this.radius=o,this.lang=T;let S=this.size=m+4*e,E=this._createCanvas(S),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${v} ${g} ${m}px ${d}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){let e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){let{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(m),v=Math.ceil(o),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),S=Math.min(this.size-this.buffer,v+Math.ceil(u)),E=T+2*this.buffer,C=S+2*this.buffer,L=Math.max(E*C,0),R=new Uint8ClampedArray(L),O={data:R,width:E,height:C,glyphWidth:T,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(T===0||S===0)return O;let{ctx:j,buffer:H,gridInner:W,gridOuter:K}=this;this.lang&&(j.lang=this.lang),j.clearRect(H,H,T,S),j.fillText(m,H,H+v);let Y=j.getImageData(H,H,T,S);K.fill(zi,0,L),W.fill(0,0,L);for(let te=0;te<S;te++)for(let J=0;J<T;J++){let re=Y.data[4*(te*T+J)+3]/255;if(re===0)continue;let ae=(te+H)*E+J+H;if(re===1)K[ae]=0,W[ae]=zi;else{let Q=.5-re;K[ae]=Q>0?Q*Q:0,W[ae]=Q<0?Q*Q:0}}pr(K,0,0,E,C,E,this.f,this.v,this.z),pr(W,H,H,T,S,E,this.f,this.v,this.z);for(let te=0;te<L;te++){let J=Math.sqrt(K[te])-Math.sqrt(W[te]);R[te]=Math.round(255-255*(J/this.radius+this.cutoff))}return O}};class mo{constructor(){this.specification=a.v.light.position}possiblyEvaluate(e,o){return a.B(e.expression.evaluate(o))}interpolate(e,o,u){return{x:a.C.number(e.x,o.x,u),y:a.C.number(e.y,o.y,u),z:a.C.number(e.z,o.z,u)}}}let _n;class vn extends a.E{constructor(e){super(),_n=_n||new a.r({anchor:new a.D(a.v.light.anchor),position:new mo,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(_n),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(a.x,e,o))for(let u in e){let d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&a.y(this,e.call(a.z,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}let xn=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Jo extends a.E{constructor(e){super(),this._transitionable=new a.t(xn),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(e,o={}){if(!this._validate(a.G,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let u in e){let d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return u?.validate!==!1&&a.y(this,e.call(a.z,a.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ot{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){let u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){let d=[],g=e.length%2==1?-e[e.length-1]*u:0,v=e[0]*u,T=!0;d.push({left:g,right:v,isDash:T,zeroLength:e[0]===0});let S=e[0];for(let E=1;E<e.length;E++){T=!T;let C=e[E];g=S*u,S+=C,v=S*u,d.push({left:g,right:v,isDash:T,zeroLength:C===0})}return d}addRoundDash(e,o,u){let d=o/2;for(let g=-u;g<=u;g++){let v=this.width*(this.nextRow+u+g),T=0,S=e[T];for(let E=0;E<this.width;E++){E/S.right>1&&(S=e[++T]);let C=Math.abs(E-S.left),L=Math.abs(E-S.right),R=Math.min(C,L),O,j=g/u*(d+1);if(S.isDash){let H=d-Math.abs(j);O=Math.sqrt(R*R+H*H)}else O=d-Math.sqrt(R*R+j*j);this.data[v+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){let S=e[T],E=e[T+1];S.zeroLength?e.splice(T,1):E&&E.isDash===S.isDash&&(E.left=S.left,e.splice(T,1))}let o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);let d=this.width*this.nextRow,g=0,v=e[g];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++g]);let S=Math.abs(T-v.left),E=Math.abs(T-v.right),C=Math.min(S,E);this.data[d+T]=Math.max(0,Math.min(255,(v.isDash?C:-C)+128))}}addDash(e,o){let u=o?7:0,d=2*u+1;if(this.nextRow+d>this.height)return a.w("LineAtlas out of space"),null;let g=0;for(let T=0;T<e.length;T++)g+=e[T];if(g!==0){let T=this.width/g,S=this.getDashRanges(e,this.width,T);o?this.addRoundDash(S,T,u):this.addRegularDash(S)}let v={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=d,this.dirty=!0,v}bind(e){let o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}let bn="maplibre_preloaded_worker_pool";class $i{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<$i.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[bn]}numActive(){return Object.keys(this.active).length}}let go=Math.floor(B.hardwareConcurrency/2),en,Bn;function yo(){return en||(en=new $i),en}$i.workerCount=a.H(globalThis)?Math.max(Math.min(go,3),1):1;class ar{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;let u=this.workerPool.acquire(o);for(let d=0;d<u.length;d++){let g=new a.J(u[d],o);g.name=`Worker ${d}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){let u=[];for(let d of this.actors)u.push(d.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(let u of this.actors)u.registerMessageHandler(e,o)}}function Qo(){return Bn||(Bn=new ar(yo(),a.K),Bn.registerMessageHandler("GR",((m,e,o)=>a.m(e,o)))),Bn}function Tr(m,e){let o=a.L();return a.M(o,o,[1,1,0]),a.N(o,o,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?a.O(o,o,m.calculatePosMatrix(e.toUnwrapped())):o}function Mr(m,e,o,u,d,g,v){var T;let S=(function(R,O,j){if(R)for(let H of R){let W=O[H];if(W&&W.source===j&&W.type==="fill-extrusion")return!0}else for(let H in O){let W=O[H];if(W.source===j&&W.type==="fill-extrusion")return!0}return!1})((T=d?.layers)!==null&&T!==void 0?T:null,e,m.id),E=g.maxPitchScaleFactor(),C=m.tilesIn(u,E,S);C.sort(ea);let L=[];for(let R of C)L.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,o,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,d,g,E,Tr(m.transform,R.tileID),v?(O,j)=>v(R.tileID,O,j):void 0)});return(function(R,O){for(let j in R)for(let H of R[j])ta(H,O);return R})((function(R){let O={},j={};for(let H of R){let W=H.queryResults,K=H.wrappedTileID,Y=j[K]=j[K]||{};for(let te in W){let J=W[te],re=Y[te]=Y[te]||{},ae=O[te]=O[te]||[];for(let Q of J)re[Q.featureIndex]||(re[Q.featureIndex]=!0,ae.push(Q))}}return O})(L),m)}function ea(m,e){let o=m.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function ta(m,e){let o=m.feature,u=e.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=u}function fr(m,e,o){return a._(this,void 0,void 0,(function*(){let u=m;if(m.url?u=(yield a.j(e.transformRequest(m.url,"Source"),o)).data:yield B.frameAsync(o),!u)return null;let d=a.Q(a.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map((g=>g.id))),d}))}class ni{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof a.S?new a.S(e.lng,e.lat):a.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof a.S?new a.S(e.lng,e.lat):a.S.convert(e),this}extend(e){let o=this._sw,u=this._ne,d,g;if(e instanceof a.S)d=e,g=e;else{if(!(e instanceof ni))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ni.convert(e)):this.extend(a.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(a.S.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new a.S(d.lng,d.lat),this._ne=new a.S(g.lng,g.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:o,lat:u}=a.S.convert(e),d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof ni?e:e&&new ni(e)}static fromLngLat(e,o=0){let u=360*o/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new ni(new a.S(e.lng-d,e.lat-u),new a.S(e.lng+d,e.lat+u))}adjustAntiMeridian(){let e=new a.S(this._sw.lng,this._sw.lat),o=new a.S(this._ne.lng,this._ne.lat);return new ni(e,e.lng>o.lng?new a.S(o.lng+360,o.lat):o)}}class ui{constructor(e,o,u){this.bounds=ni.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let o=Math.pow(2,e.z),u=Math.floor(a.V(this.bounds.getWest())*o),d=Math.floor(a.U(this.bounds.getNorth())*o),g=Math.ceil(a.V(this.bounds.getEast())*o),v=Math.ceil(a.U(this.bounds.getSouth())*o);return e.x>=u&&e.x<g&&e.y>=d&&e.y<v}}class kr extends a.E{constructor(e,o,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(o,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(a.e(this,e),e.bounds&&(this.tileBounds=new ui(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(e){return a._(this,void 0,void 0,(function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,v)=>{e.reloadPromise={resolve:g,reject:v}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{let g=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){let u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return a._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return a._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class tn extends a.E{constructor(e,o,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},o),a.e(this,a.Q(o,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let o=yield fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new ui(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(o){this._tileJSONRequest=null,this.fire(new a.k(o))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return a.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return a._(this,void 0,void 0,(function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let u=yield Re.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});let d=this.map.painter.context,g=d.gl,v=u.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new a.T(d,v,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}abortTile(e){return a._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return a._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class _o extends tn{constructor(e,o,u,d){super(e,o,u,d),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return a._(this,void 0,void 0,(function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let d=yield Re.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){let g=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});let v=a.b(g)&&a.W()?g:yield this.readImageNow(g),T={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let S=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return a._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&a.X()){let o=e.width+2,u=e.height+2;try{return new a.R({width:o,height:u},yield a.Y(e,-1,-1,o,u))}catch{}}return B.getImageData(e,1)}))}_getNeighboringTiles(e){let o=e.canonical,u=Math.pow(2,o.z),d=(o.x-1+u)%u,g=o.x===0?e.wrap-1:e.wrap,v=(o.x+1+u)%u,T=o.x+1===u?e.wrap+1:e.wrap,S={};return S[new a.Z(e.overscaledZ,g,o.z,d,o.y).key]={backfilled:!1},S[new a.Z(e.overscaledZ,T,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(S[new a.Z(e.overscaledZ,g,o.z,d,o.y-1).key]={backfilled:!1},S[new a.Z(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},S[new a.Z(e.overscaledZ,T,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<u&&(S[new a.Z(e.overscaledZ,g,o.z,d,o.y+1).key]={backfilled:!1},S[new a.Z(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},S[new a.Z(e.overscaledZ,T,o.z,v,o.y+1).key]={backfilled:!1}),S}unloadTile(e){return a._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class rn extends a.E{constructor(e,o,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:o.data},this.actor=u.getActor(),this.setEventedParent(d),this._data=o.data,this._options=a.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId,o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(o.buffer!==void 0?o.buffer:128),tolerance:this._pixelsToTileUnits(o.tolerance!==void 0?o.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(o.clusterMaxZoom),minPoints:Math.max(2,o.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(o.clusterRadius||50),log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(a.$/this.tileSize)}_getClusterMaxZoom(e){let o=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${o}"`),o}load(){return a._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,(function*(){let e=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((o=>o.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,(function*(){let e=new ni,o=yield this.getData(),u;switch(o.type){case"FeatureCollection":u=o.features.map((d=>this.getCoordinatesFromGeometry(d.geometry))).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(o.geometry);break;default:u=this.getCoordinatesFromGeometry(o)}if(u.length==0)return e;for(let d=0;d<u.length-1;d+=2)e.extend([u[d],u[d+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(){return a._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;let{data:e,diff:o}=this._pendingWorkerUpdate;if(!e&&!o)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let u=a.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(B.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):o&&(u.dataDiff=o,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{let d=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=d.data;let g=null;d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0));let v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&a.e(v,{resourceTiming:g}),this.fire(new a.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(d))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return a._(this,void 0,void 0,(function*(){let o=e.actor?"RT":"LT";e.actor=this.actor;let u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;let d=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,o==="RT")}))}abortTile(e){return a._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return a._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class nn extends a.E{constructor(e,o,u,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o}load(e){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let o=yield Re.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new a.k(o))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let o=e.map(a.a1.fromLngLat);var u;return this.tileID=(function(d){let g=a.a2.fromPoints(d),v=g.width(),T=g.height(),S=Math.max(v,T),E=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),C=Math.pow(2,E);return new a.a4(E,Math.floor((g.minX+g.maxX)/2*C),Math.floor((g.minY+g.maxY)/2*C))})(o),this.terrainTileRanges=this._getOverlappingTileRanges(o),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=o.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,o=e.gl;this.texture||(this.texture=new a.T(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(let d in this.tiles){let g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return a._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:o,minY:u,maxX:d,maxY:g}=a.a2.fromPoints(e),v={};for(let T=0;T<=a.a3;T++){let S=Math.pow(2,T),E=Math.floor(o*S),C=Math.floor(u*S),L=Math.floor(d*S),R=Math.floor(g*S);v[T]={minTileX:E,minTileY:C,maxTileX:L,maxTileY:R}}return v}}class ia extends nn{constructor(e,o,u,d){super(e,o,u,d),this.roundZoom=!0,this.type="video",this.options=o}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{let o=yield a.a5(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new a.k(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,o=e.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(let d in this.tiles){let g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Un extends nn{constructor(e,o,u,d){super(e,o,u,d),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((v=>typeof v!="number"))))||this.fire(new a.k(new a.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context,u=o.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(o,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(let g in this.tiles){let v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let jn={},Vn=m=>{switch(m){case"geojson":return rn;case"image":return nn;case"raster":return tn;case"raster-dem":return _o;case"vector":return kr;case"video":return ia;case"canvas":return Un}return jn[m]},vo="RTLPluginLoaded";class $n extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return a._(this,arguments,void 0,(function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=B.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return a._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(vo))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Gn=null;function qn(){return Gn||(Gn=new $n),Gn}class ra{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=a.a7(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,g){let v={};if(!g)return v;for(let T of d){let S=T.layerIds.map((E=>g.getLayer(E))).filter(Boolean);if(S.length!==0){T.layers=S,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map((E=>S.filter((C=>C.id===E))[0])));for(let E of S)v[E.id]=T}}return v})(e.buckets,o?.style),this.hasSymbolBuckets=!1;for(let d in this.buckets){let g=this.buckets[d];if(g instanceof a.a9){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let d in this.buckets){let g=this.buckets[d];if(g instanceof a.a9&&g.hasRTLText){this.hasRTLText=!0,qn().lazyLoad();break}}this.queryPadding=0;for(let d in this.buckets){let g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let u in this.buckets){let d=this.buckets[u];d.uploadPending()&&d.upload(e)}let o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,d,g,v,T,S,E,C,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:C,transform:S,params:T,queryPadding:this.queryPadding*E,getElevation:L},e,o,u):{}}querySourceFeatures(e,o){let u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;let d=u.loadVTLayers(),g=o&&o.sourceLayer?o.sourceLayer:"",v=d._geojsonTileLayer||d[g];if(!v)return;let T=a.aa(o&&o.filter),{z:S,x:E,y:C}=this.tileID.canonical,L={z:S,x:E,y:C};for(let R=0;R<v.length;R++){let O=v.feature(R);if(T.needGeometry){let W=a.ab(O,!0);if(!T.filter(new a.F(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!T.filter(new a.F(this.tileID.overscaledZ),O))continue;let j=u.getId(O,g),H=new a.ac(O,S,E,C,j);H.tile=L,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let o=this.expirationTime;if(e.cacheControl){let u=a.ad(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let u=Date.now(),d=!1;if(this.expirationTime>u)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{let g=this.expirationTime-o;g?this.expirationTime=u+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let u=this.latestFeatureIndex.loadVTLayers();for(let d in this.buckets){if(!o.style.hasLayer(d))continue;let g=this.buckets[d],v=g.layers[0].sourceLayer||"_geojsonTileLayer",T=u[v],S=e[v];if(!T||!S||Object.keys(S).length===0)continue;g.update(S,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});let E=o&&o.style&&o.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=B.now()+e}setDependencies(e,o){let u={};for(let d of o)u[d]=!0;this.dependencies[e]=u}hasDependency(e,o){for(let u of e){let d=this.dependencies[u];if(d){for(let g of o)if(d[g])return!0}}return!1}}class ue{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(let e in this.data)for(let o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){let d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);let g={value:o,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),u)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){let o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;let u=e.wrapped().key,d=o===void 0?0:this.data[u].indexOf(o),g=this.data[u][d];return this.data[u].splice(d,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){let o=[];for(let u in this.data)for(let d of this.data[u])e(d.value)||o.push(d);for(let u of o)this.remove(u.value.tileID,u)}}class V{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){let d=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},a.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(let g in this.state[e])g!==d&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(let g in this.state[e][d])u[g]||(this.deletedStates[e][d][g]=null)}else for(let g in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][g]===null&&delete this.deletedStates[e][d][g]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;let d=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,o){let u=String(o),d=a.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let g=this.deletedStates[e][o];if(g===null)return{};for(let v in g)delete d[v]}return d}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){let u={};for(let d in this.stateChanges){this.state[d]=this.state[d]||{};let g={};for(let v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),a.e(this.state[d][v],this.stateChanges[d][v]),g[v]=this.state[d][v];u[d]=g}for(let d in this.deletedStates){this.state[d]=this.state[d]||{};let g={};if(this.deletedStates[d]===null)for(let v in this.state[d])g[v]={},this.state[d][v]={};else for(let v in this.deletedStates[d]){if(this.deletedStates[d][v]===null)this.state[d][v]={};else for(let T of Object.keys(this.deletedStates[d][v]))delete this.state[d][v][T];g[v]=this.state[d][v]}u[d]=u[d]||{},a.e(u[d],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(let d in e)e[d].setFeatureState(u,o)}}let G=89.25;function q(m,e){let o=a.ah(e.lat,-a.ai,a.ai);return new a.P(a.V(e.lng)*m,a.U(o)*m)}function ee(m,e){return new a.a1(e.x/m,e.y/m).toLngLat()}function se(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-m.pitch)),Math.tan(a.ae(G-m.pitch)))}function he(m,e){let o=m.canonical,u=e/a.af(o.z),d=o.x+Math.pow(2,o.z)*m.wrap,g=a.ag(new Float64Array(16));return a.M(g,g,[d*u,o.y*u,0]),a.N(g,g,[u/a.$,u/a.$,1]),g}function ve(m,e,o,u,d){let g=a.a1.fromLngLat(m,e),v=d*a.aj(1,m.lat),T=v*Math.cos(a.ae(o)),S=Math.sqrt(v*v-T*T),E=S*Math.sin(a.ae(-u)),C=S*Math.cos(a.ae(-u));return new a.a1(g.x+E,g.y+C,g.z+T)}function pe(m,e,o){let u=e.intersectsFrustum(m);if(!o||u===0)return u;let d=e.intersectsPlane(o);return d===0?0:u===2&&d===2?2:1}function Se(m,e,o){let u=0,d=(o-e)/10;for(let g=0;g<10;g++)u+=d*Math.pow(Math.cos(e+(g+.5)/10*(o-e)),m);return u}function Me(m,e){return function(o,u,d,g,v){let T=2*((m-1)/a.ak(Math.cos(a.ae(G-v))/Math.cos(a.ae(G)))-1),S=Math.acos(d/g),E=2*Se(T-1,0,a.ae(v/2)),C=Math.min(a.ae(G),S+a.ae(v/2)),L=Se(T-1,Math.min(C,S-a.ae(v/2)),C),R=Math.atan(u/d),O=Math.hypot(u,d),j=o;return j+=a.ak(g/O/Math.max(.5,Math.cos(a.ae(v/2)))),j+=T*a.ak(Math.cos(R))/2,j-=a.ak(Math.max(1,L/E/e))/2,j}}let Pe=Me(9.314,3);function Xe(m,e){let o=(e.roundZoom?Math.round:Math.floor)(m.zoom+a.ak(m.tileSize/e.tileSize));return Math.max(0,o)}function fe(m,e){let o=m.getCameraFrustum(),u=m.getClippingPlane(),d=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=a.a1.fromLngLat(m.center,m.elevation);d.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;let v=m.getCoveringTilesDetailsProvider(),T=v.allowVariableZoom(m,e),S=Xe(m,e),E=e.minzoom||0,C=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,L=Math.min(Math.max(0,S),C),R=Math.pow(2,L),O=[R*d.x,R*d.y,0],j=[R*g.x,R*g.y,0],H=Math.hypot(g.x-d.x,g.y-d.y),W=Math.abs(g.z-d.z),K=Math.hypot(H,W),Y=re=>({zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),te=[],J=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let re=1;re<=3;re++)te.push(Y(-re)),te.push(Y(re));for(te.push(Y(0));te.length>0;){let re=te.pop(),ae=re.x,Q=re.y,de=re.fullyVisible,we={x:ae,y:Q,z:re.zoom},ge=v.getTileBoundingVolume(we,re.wrap,m.elevation,e);if(!de){let Oe=pe(o,ge,u);if(Oe===0)continue;de=Oe===2}let ye=v.distanceToTile2d(d.x,d.y,we,ge),be=S;T&&(be=(e.calculateTileZoom||Pe)(m.zoom+a.ak(m.tileSize/e.tileSize),ye,W,K,m.fov)),be=(e.roundZoom?Math.round:Math.floor)(be),be=Math.max(0,be);let Le=Math.min(be,C);if(re.wrap=v.getWrap(g,we,re.wrap),re.zoom>=Le){if(re.zoom<E)continue;let Oe=L-re.zoom,Ee=O[0]-.5-(ae<<Oe),He=O[1]-.5-(Q<<Oe),gt=e.reparseOverscaled?Math.max(re.zoom,be):re.zoom;J.push({tileID:new a.Z(re.zoom===C?gt:re.zoom,re.wrap,re.zoom,ae,Q),distanceSq:a.al([j[0]-.5-ae,j[1]-.5-Q]),tileDistanceToCamera:Math.sqrt(Ee*Ee+He*He)})}else for(let Oe=0;Oe<4;Oe++)te.push({zoom:re.zoom+1,x:(ae<<1)+Oe%2,y:(Q<<1)+(Oe>>1),wrap:re.wrap,fullyVisible:de})}return J.sort(((re,ae)=>re.distanceSq-ae.distanceSq)).map((re=>re.tileID))}let ut=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class vt extends a.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,g,v,T)=>{let S=new(Vn(g.type))(d,g,v,T);if(S.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${S.id}`);return S})(e,o,u,this),this._tiles={},this._cache=new ue(0,(d=>this._unloadTile(d))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new V,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return a._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new a.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new a.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Qe).map((e=>e.key))}getRenderableIds(e){let o=[];for(let u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort(((u,d)=>{let g=u.tileID,v=d.tileID,T=new a.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),S=new a.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-v.overscaledZ||S.y-T.y||S.x-T.x})).map((u=>u.tileID.key)):o.map((u=>u.tileID)).sort(Qe).map((u=>u.key))}hasRenderableParent(e){let o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)e?this._reloadTile(o,"expired"):this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(e,o){return a._(this,void 0,void 0,(function*(){let u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))}))}_tileLoaded(e,o,u){e.timeAdded=B.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let o=this.getRenderableIds();for(let d=0;d<o.length;d++){let g=o[d];if(e.neighboringTiles&&e.neighboringTiles[g]){let v=this.getTileByID(g);u(e,v),u(v,e)}}function u(d,g){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-d.tileID.canonical.x,T=g.tileID.canonical.y-d.tileID.canonical.y,S=Math.pow(2,d.tileID.canonical.z),E=g.tileID.key;v===0&&T===0||Math.abs(T)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,v,T),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,d){for(let g in this._tiles){let v=this._tiles[g];if(d[g]||!v.hasData()||v.tileID.overscaledZ<=o||v.tileID.overscaledZ>u)continue;let T=v.tileID;for(;v&&v.tileID.overscaledZ>o+1;){let E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(T=E)}let S=T;for(;S.overscaledZ>o;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]||e[S.canonical.key]){d[T.key]=T;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){let u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){let d=e.scaledTo(u),g=this._getLoadedTile(d);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(g)}handleWrapJump(e){let o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){let u={};for(let d in this._tiles){let g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+o),u[g.tileID.key]=g}this._tiles=u;for(let d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(let d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,o,u,d,g,v){let T={},S={},E=Object.keys(e),C=B.now();for(let L of E){let R=e[L],O=this._tiles[L];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=C)continue;let j=this.findLoadedParent(R,o),H=this.findLoadedSibling(R),W=j||H||null;W&&(this._addTile(W.tileID),T[W.tileID.key]=W.tileID),S[L]=R}this._retainLoadedChildren(S,d,u,e);for(let L in T)e[L]||(this._coveredTiles[L]=!0,e[L]=T[L]);if(v){let L={},R={};for(let O of g)this._tiles[O.key].hasData()?L[O.key]=O:R[O.key]=O;for(let O in R){let j=R[O].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(L[j[0].key]=e[j[0].key]=j[0],L[j[1].key]=e[j[1].key]=j[1],L[j[2].key]=e[j[2].key]=j[2],L[j[3].key]=e[j[3].key]=j[3],delete R[O])}for(let O in R){let j=R[O],H=this.findLoadedParent(j,this._source.minzoom),W=this.findLoadedSibling(j),K=H||W||null;if(K){L[K.tileID.key]=e[K.tileID.key]=K.tileID;for(let Y in L)L[Y].isChildOf(K.tileID)&&delete L[Y]}}for(let O in this._tiles)L[O]||(this._coveredTiles[O]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((C=>new a.Z(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y))):(u=fe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((C=>this._source.hasTile(C))))):u=[];let d=Xe(e,this._source),g=Math.max(d-vt.maxOverzooming,this._source.minzoom),v=Math.max(d+vt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let C={};for(let L of u)if(L.canonical.z>this._source.minzoom){let R=L.scaledTo(L.canonical.z-1);C[R.key]=R;let O=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));C[O.key]=O}u=u.concat(Object.values(C))}let T=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let S=this._updateRetainedTiles(u,d);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(S,g,v,d,u,o);for(let C in S)this._tiles[C].clearFadeHold();let E=a.am(this._tiles,S);for(let C of E){let L=this._tiles[C];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;let d={},g={},v=Math.max(o-vt.maxOverzooming,this._source.minzoom),T=Math.max(o+vt.maxUnderzooming,this._source.minzoom),S={};for(let E of e){let C=this._addTile(E);d[E.key]=E,C.hasData()||o<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,o,T,d);for(let E of e){let C=this._tiles[E.key];if(C.hasData())continue;if(o+1>this._source.maxzoom){let R=E.children(this._source.maxzoom)[0],O=this.getTile(R);if(O&&O.hasData()){d[R.key]=R;continue}}else{let R=E.children(this._source.maxzoom);if(d[R[0].key]&&d[R[1].key]&&d[R[2].key]&&d[R[3].key])continue}let L=C.wasRequested();for(let R=E.overscaledZ-1;R>=v;--R){let O=E.scaledTo(R);if(g[O.key])break;if(g[O.key]=!0,C=this.getTile(O),!C&&L&&(C=this._addTile(O)),C){let j=C.hasData();if((j||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||L)&&(d[O.key]=O),L=C.wasRequested(),j)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let o=[],u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}o.push(d.key);let g=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;d=g}for(let g of o)this._loadedParentTiles[g]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));let u=o;return o||(o=new ra(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new a.l("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),u))}refreshTiles(e){for(let o in this._tiles)(this._isIdRenderable(o)||this._tiles[o].state=="errored")&&e.some((u=>u.equals(this._tiles[o].tileID.canonical)))&&this._reloadTile(o,"expired")}_removeTile(e){let o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){let o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){let d=[],g=this.transform;if(!g)return d;let v=g.getCoveringTilesDetailsProvider().allowWorldCopies(),T=u?g.getCameraQueryGeometry(e):e,S=O=>g.screenPointToMercatorCoordinate(O,this.terrain),E=this.transformBbox(e,S,!v),C=this.transformBbox(T,S,!v),L=this.getIds(),R=a.a2.fromPoints(C);for(let O=0;O<L.length;O++){let j=this._tiles[L[O]];if(j.holdingForFade())continue;let H=v?[j.tileID]:[j.tileID.unwrapTo(-1),j.tileID.unwrapTo(0)],W=Math.pow(2,g.zoom-j.tileID.overscaledZ),K=o*j.queryPadding*a.$/j.tileSize/W;for(let Y of H){let te=R.map((J=>Y.getTilePoint(new a.a1(J.x,J.y))));if(te.expandBy(K),te.intersects(ut)){let J=E.map((ae=>Y.getTilePoint(ae))),re=C.map((ae=>Y.getTilePoint(ae)));d.push({tile:j,tileID:v?Y:Y.unwrapTo(0),queryGeometry:J,cameraQueryGeometry:re,scale:W})}}}return d}transformBbox(e,o,u){let d=e.map(o);if(u){let g=a.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));let v=g.map(o);a.a2.fromPoints(d).covers(v)||(d=d.map((T=>T.x>.5?new a.a1(T.x-1,T.y,T.z):T)))}return d}getVisibleCoordinates(e){let o=this.getRenderableIds(e).map((u=>this._tiles[u].tileID));return this.transform&&this.transform.populateCache(o),o}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){let e=B.now();for(let o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){let d=this._tiles[e];d&&d.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(let u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter((u=>!u.hasDependency(e,o)))}}function Qe(m,e){let o=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function pt(m){return m==="raster"||m==="image"||m==="video"}vt.maxOverzooming=10,vt.maxUnderzooming=3;class qt{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=a.ah(e,0,1);let o=1,u=this._distances[o],d=e*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];let g=o-1,v=this._distances[g],T=u-v,S=T>0?(d-v)/T:0;return this.points[g].mult(1-S).add(this.points[o].mult(S))}}function xi(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class bi{constructor(e,o,u){let d=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)d.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,d,g){this._forEachCell(o,u,d,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g)}insertCircle(e,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,o,u,d,g,v){this.boxCells[g].push(v)}_insertCircleCell(e,o,u,d,g,v){this.circleCells[g].push(v)}_query(e,o,u,d,g,v,T){if(u<0||e>this.width||d<0||o>this.height)return[];let S=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=d){if(g)return[{key:null,x1:e,y1:o,x2:u,y2:d}];for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){let C=this.circles[3*E],L=this.circles[3*E+1],R=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:C-R,y1:L-R,x2:C+R,y2:L+R})}}else this._forEachCell(e,o,u,d,this._queryCell,S,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},T);return S}query(e,o,u,d){return this._query(e,o,u,d,!1,null)}hitTest(e,o,u,d,g,v){return this._query(e,o,u,d,!0,g,v).length>0}hitTestCircle(e,o,u,d,g){let v=e-u,T=e+u,S=o-u,E=o+u;if(T<0||v>this.width||E<0||S>this.height)return!1;let C=[];return this._forEachCell(v,S,T,E,this._queryCellCircle,C,{hitTest:!0,overlapMode:d,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},g),C.length>0}_queryCell(e,o,u,d,g,v,T,S){let{seenUids:E,hitTest:C,overlapMode:L}=T,R=this.boxCells[g];if(R!==null){let j=this.bboxes;for(let H of R)if(!E.box[H]){E.box[H]=!0;let W=4*H,K=this.boxKeys[H];if(e<=j[W+2]&&o<=j[W+3]&&u>=j[W+0]&&d>=j[W+1]&&(!S||S(K))&&(!C||!xi(L,K.overlapMode))&&(v.push({key:K,x1:j[W],y1:j[W+1],x2:j[W+2],y2:j[W+3]}),C))return!0}}let O=this.circleCells[g];if(O!==null){let j=this.circles;for(let H of O)if(!E.circle[H]){E.circle[H]=!0;let W=3*H,K=this.circleKeys[H];if(this._circleAndRectCollide(j[W],j[W+1],j[W+2],e,o,u,d)&&(!S||S(K))&&(!C||!xi(L,K.overlapMode))){let Y=j[W],te=j[W+1],J=j[W+2];if(v.push({key:K,x1:Y-J,y1:te-J,x2:Y+J,y2:te+J}),C)return!0}}}return!1}_queryCellCircle(e,o,u,d,g,v,T,S){let{circle:E,seenUids:C,overlapMode:L}=T,R=this.boxCells[g];if(R!==null){let j=this.bboxes;for(let H of R)if(!C.box[H]){C.box[H]=!0;let W=4*H,K=this.boxKeys[H];if(this._circleAndRectCollide(E.x,E.y,E.radius,j[W+0],j[W+1],j[W+2],j[W+3])&&(!S||S(K))&&!xi(L,K.overlapMode))return v.push(!0),!0}}let O=this.circleCells[g];if(O!==null){let j=this.circles;for(let H of O)if(!C.circle[H]){C.circle[H]=!0;let W=3*H,K=this.circleKeys[H];if(this._circlesCollide(j[W],j[W+1],j[W+2],E.x,E.y,E.radius)&&(!S||S(K))&&!xi(L,K.overlapMode))return v.push(!0),!0}}}_forEachCell(e,o,u,d,g,v,T,S){let E=this._convertToXCellCoord(e),C=this._convertToYCellCoord(o),L=this._convertToXCellCoord(u),R=this._convertToYCellCoord(d);for(let O=E;O<=L;O++)for(let j=C;j<=R;j++)if(g.call(this,e,o,u,d,this.xCellCount*j+O,v,T,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,d,g,v){let T=d-e,S=g-o,E=u+v;return E*E>T*T+S*S}_circleAndRectCollide(e,o,u,d,g,v,T){let S=(v-d)/2,E=Math.abs(e-(d+S));if(E>S+u)return!1;let C=(T-g)/2,L=Math.abs(o-(g+C));if(L>C+u)return!1;if(E<=S||L<=C)return!0;let R=E-S,O=L-C;return R*R+O*O<=u*u}}function hi(m,e,o){let u=a.L();if(!m){let{vecSouth:L,vecEast:R}=Mt(e),O=P();O[0]=R[0],O[1]=R[1],O[2]=L[0],O[3]=L[1],d=O,(C=(v=(g=O)[0])*(E=g[3])-(S=g[2])*(T=g[1]))&&(d[0]=E*(C=1/C),d[1]=-T*C,d[2]=-S*C,d[3]=v*C),u[0]=O[0],u[1]=O[1],u[4]=O[2],u[5]=O[3]}var d,g,v,T,S,E,C;return a.N(u,u,[1/o,1/o,1]),u}function St(m,e,o,u){if(m){let d=a.L();if(!e){let{vecSouth:g,vecEast:v}=Mt(o);d[0]=v[0],d[1]=v[1],d[4]=g[0],d[5]=g[1]}return a.N(d,d,[u,u,1]),d}return o.pixelsToClipSpaceMatrix}function Mt(m){let e=Math.cos(m.rollInRadians),o=Math.sin(m.rollInRadians),u=Math.cos(m.pitchInRadians),d=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),v=a.ar();v[0]=-d*u*o-g*e,v[1]=-g*u*o+d*e;let T=a.as(v);T<1e-9?a.at(v):a.au(v,v,1/T);let S=a.ar();S[0]=d*u*e-g*o,S[1]=g*u*e+d*o;let E=a.as(S);return E<1e-9?a.at(S):a.au(S,S,1/E),{vecEast:S,vecSouth:v}}function pi(m,e,o,u){let d;u?(d=[m,e,u(m,e),1],a.aw(d,d,o)):(d=[m,e,0,1],oa(d,d,o));let g=d[3];return{point:new a.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function De(m,e){return .5+m/e*.5}function Gi(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Qt(m,e,o,u,d,g,v,T,S,E,C,L,R){let O=o?m.textSizeData:m.iconSizeData,j=a.an(O,e.transform.zoom),H=[256/e.width*2+1,256/e.height*2+1],W=o?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();let K=m.lineVertexArray,Y=o?m.text.placedSymbolArray:m.icon.placedSymbolArray,te=e.transform.width/e.transform.height,J=!1;for(let re=0;re<Y.length;re++){let ae=Y.get(re);if(ae.hidden||ae.writingMode===a.ao.vertical&&!J){on(ae.numGlyphs,W);continue}J=!1;let Q=new a.P(ae.anchorX,ae.anchorY),de={getElevation:R,pitchedLabelPlaneMatrix:u,lineVertexArray:K,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Q,unwrappedTileID:S,width:E,height:C,translation:L},we=Wn(ae.anchorX,ae.anchorY,de);if(!Gi(we.point,H)){on(ae.numGlyphs,W);continue}let ge=De(e.transform.cameraToCenterDistance,we.signedDistanceFromCamera),ye=a.ap(O,j,ae),be=g?ye*e.transform.getPitchedTextCorrection(ae.anchorX,ae.anchorY,S)/ge:ye*ge,Le=Ve({projectionContext:de,pitchedLabelPlaneMatrixInverse:d,symbol:ae,fontSize:be,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:te,rotateToLine:T});J=Le.useVertical,(Le.notEnoughRoom||J||Le.needsFlipping&&Ve({projectionContext:de,pitchedLabelPlaneMatrixInverse:d,symbol:ae,fontSize:be,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:te,rotateToLine:T}).notEnoughRoom)&&on(ae.numGlyphs,W)}o?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function Zn(m,e,o,u,d,g,v,T){let S=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,C=g.lineStartIndex+g.lineLength,L=e.getoffsetX(g.glyphStartIndex),R=e.getoffsetX(S-1),O=Hn(m*L,o,u,d,g.segment,E,C,T,v);if(!O)return null;let j=Hn(m*R,o,u,d,g.segment,E,C,T,v);return j?T.projectionCache.anyProjectionOccluded?null:{first:O,last:j}:null}function na(m,e,o,u){return m===a.ao.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(m===a.ao.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function Ve(m){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:o,symbol:u,fontSize:d,flip:g,keepUpright:v,glyphOffsetArray:T,dynamicLayoutVertexArray:S,aspectRatio:E,rotateToLine:C}=m,L=d/24,R=u.lineOffsetX*L,O=u.lineOffsetY*L,j;if(u.numGlyphs>1){let H=u.glyphStartIndex+u.numGlyphs,W=u.lineStartIndex,K=u.lineStartIndex+u.lineLength,Y=Zn(L,T,R,O,g,u,C,e);if(!Y)return{notEnoughRoom:!0};let te=xo(Y.first.point.x,Y.first.point.y,e,o),J=xo(Y.last.point.x,Y.last.point.y,e,o);if(v&&!g){let re=na(u.writingMode,te,J,E);if(re)return re}j=[Y.first];for(let re=u.glyphStartIndex+1;re<H-1;re++){let ae=Hn(L*T.getoffsetX(re),R,O,g,u.segment,W,K,e,C);if(!ae)return{notEnoughRoom:!0};j.push(ae)}j.push(Y.last)}else{if(v&&!g){let W=Oi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,K=u.lineStartIndex+u.segment+1,Y=new a.P(e.lineVertexArray.getx(K),e.lineVertexArray.gety(K)),te=Oi(Y.x,Y.y,e),J=te.signedDistanceFromCamera>0?te.point:xt(e.tileAnchorPoint,Y,W,1,e),re=xo(W.x,W.y,e,o),ae=xo(J.x,J.y,e,o),Q=na(u.writingMode,re,ae,E);if(Q)return Q}let H=Hn(L*T.getoffsetX(u.glyphStartIndex),R,O,g,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,C);if(!H||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};j=[H]}for(let H of j)a.av(S,H.point,H.angle);return{}}function xt(m,e,o,u,d){let g=m.add(m.sub(e)._unit()),v=Oi(g.x,g.y,d).point,T=o.sub(v);return o.add(T._mult(u/T.mag()))}function yt(m,e,o){let u=e.projectionCache;if(u.projections[m])return u.projections[m];let d=new a.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Oi(d.x,d.y,e);if(g.signedDistanceFromCamera>0)return u.projections[m]=g.point,u.anyProjectionOccluded=u.anyProjectionOccluded||g.isOccluded,g.point;let v=m-o.direction;return xt(o.distanceFromAnchor===0?e.tileAnchorPoint:new a.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),d,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function Oi(m,e,o){let u=m+o.translation[0],d=e+o.translation[1],g;return o.pitchWithMap?(g=pi(u,d,o.pitchedLabelPlaneMatrix,o.getElevation),g.isOccluded=!1):(g=o.transform.projectTileCoordinates(u,d,o.unwrappedTileID,o.getElevation),g.point.x=(.5*g.point.x+.5)*o.width,g.point.y=(.5*-g.point.y+.5)*o.height),g}function xo(m,e,o,u){if(o.pitchWithMap){let d=[m,e,0,1];return a.aw(d,d,u),o.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],o.unwrappedTileID,o.getElevation).point}return{x:m/o.width*2-1,y:1-e/o.height*2}}function Wn(m,e,o){return o.transform.projectTileCoordinates(m,e,o.unwrappedTileID,o.getElevation)}function mt(m,e,o){return m._unit()._perp()._mult(e*o)}function il(m,e,o,u,d,g,v,T,S){if(T.projectionCache.offsets[m])return T.projectionCache.offsets[m];let E=o.add(e);if(m+S.direction<u||m+S.direction>=d)return T.projectionCache.offsets[m]=E,E;let C=yt(m+S.direction,T,S),L=mt(C.sub(o),v,S.direction),R=o.add(L),O=C.add(L);return T.projectionCache.offsets[m]=a.ax(g,E,R,O)||E,T.projectionCache.offsets[m]}function Hn(m,e,o,u,d,g,v,T,S){let E=u?m-e:m+e,C=E>0?1:-1,L=0;u&&(C*=-1,L=Math.PI),C<0&&(L+=Math.PI);let R,O=C>0?g+d:g+d+1;T.projectionCache.cachedAnchorPoint?R=T.projectionCache.cachedAnchorPoint:(R=Oi(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=R);let j,H,W=R,K=R,Y=0,te=0,J=Math.abs(E),re=[],ae;for(;Y+te<=J;){if(O+=C,O<g||O>=v)return null;Y+=te,K=W,H=j;let we={absOffsetX:J,direction:C,distanceFromAnchor:Y,previousVertex:K};if(W=yt(O,T,we),o===0)re.push(K),ae=W.sub(K);else{let ge,ye=W.sub(K);ge=ye.mag()===0?mt(yt(O+C,T,we).sub(W),o,C):mt(ye,o,C),H||(H=K.add(ge)),j=il(O,ge,W,g,v,H,o,T,we),re.push(H),ae=j.sub(H)}te=ae.mag()}let Q=ae._mult((J-Y)/te)._add(H||K),de=L+Math.atan2(W.y-K.y,W.x-K.x);return re.push(Q),{point:Q,angle:S?de:0,path:re}}let rl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function on(m,e){for(let o=0;o<m;o++){let u=e.length;e.resize(u+4),e.float32.set(rl,3*u)}}function oa(m,e,o){let u=e[0],d=e[1];return m[0]=o[0]*u+o[4]*d+o[12],m[1]=o[1]*u+o[5]*d+o[13],m[3]=o[3]*u+o[7]*d+o[15],m}let oi=100;class nl{constructor(e,o=new bi(e.width+200,e.height+200,25),u=new bi(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+oi,this.screenBottomBoundary=e.height+oi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,d,g,v,T,S,E,C,L,R){let O=this.projectAndGetPerspectiveRatio(e.anchorPointX+S[0],e.anchorPointY+S[1],g,C,R),j=u*O.perspectiveRatio,H;if(v||T)H=this._projectCollisionBox(e,j,d,g,v,T,S,O,C,L,R);else{let ae=O.x+(L?L.x*j:0),Q=O.y+(L?L.y*j:0);H={allPointsOccluded:!1,box:[ae+e.x1*j,Q+e.y1*j,ae+e.x2*j,Q+e.y2*j]}}let[W,K,Y,te]=H.box,J=v?H.allPointsOccluded:O.isOccluded,re=J;return re||(re=O.perspectiveRatio<this.perspectiveRatioCutoff),re||(re=!this.isInsideGrid(W,K,Y,te)),re||o!=="always"&&this.grid.hitTest(W,K,Y,te,o,E)?{box:[W,K,Y,te],placeable:!1,offscreen:!1,occluded:J}:{box:[W,K,Y,te],placeable:!0,offscreen:this.isOffscreen(W,K,Y,te),occluded:J}}placeCollisionCircles(e,o,u,d,g,v,T,S,E,C,L,R,O,j){let H=[],W=new a.P(o.anchorX,o.anchorY),K=this.getPerspectiveRatio(W.x,W.y,v,j),Y=(E?g*this.transform.getPitchedTextCorrection(o.anchorX,o.anchorY,v)/K:g*K)/a.aB,te={getElevation:j,pitchedLabelPlaneMatrix:T,lineVertexArray:u,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:O},J=Zn(Y,d,o.lineOffsetX*Y,o.lineOffsetY*Y,!1,o,!1,te),re=!1,ae=!1,Q=!0;if(J){let de=.5*L*K+R,we=new a.P(-100,-100),ge=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ye=new qt,be=J.first,Le=J.last,Oe=[];for(let gt=be.path.length-1;gt>=1;gt--)Oe.push(be.path[gt]);for(let gt=1;gt<Le.path.length;gt++)Oe.push(Le.path[gt]);let Ee=2.5*de;if(E){let gt=this.projectPathToScreenSpace(Oe,te);Oe=gt.some((Dt=>Dt.signedDistanceFromCamera<=0))?[]:gt.map((Dt=>Dt.point))}let He=[];if(Oe.length>0){let gt=Oe[0].clone(),Dt=Oe[0].clone();for(let Bt=1;Bt<Oe.length;Bt++)gt.x=Math.min(gt.x,Oe[Bt].x),gt.y=Math.min(gt.y,Oe[Bt].y),Dt.x=Math.max(Dt.x,Oe[Bt].x),Dt.y=Math.max(Dt.y,Oe[Bt].y);He=gt.x>=we.x&&Dt.x<=ge.x&&gt.y>=we.y&&Dt.y<=ge.y?[Oe]:Dt.x<we.x||gt.x>ge.x||Dt.y<we.y||gt.y>ge.y?[]:a.ay([Oe],we.x,we.y,ge.x,ge.y)}for(let gt of He){ye.reset(gt,.25*de);let Dt=0;Dt=ye.length<=.5*de?1:Math.ceil(ye.paddedLength/Ee)+1;for(let Bt=0;Bt<Dt;Bt++){let Ft=Bt/Math.max(Dt-1,1),Yt=ye.lerp(Ft),ti=Yt.x+oi,ft=Yt.y+oi;H.push(ti,ft,de,0);let Ut=ti-de,mi=ft-de,wi=ti+de,Ai=ft+de;if(Q=Q&&this.isOffscreen(Ut,mi,wi,Ai),ae=ae||this.isInsideGrid(Ut,mi,wi,Ai),e!=="always"&&this.grid.hitTestCircle(ti,ft,de,e,C)&&(re=!0,!S))return{circles:[],offscreen:!1,collisionDetected:re}}}}return{circles:!S&&re||!ae||K<this.perspectiveRatioCutoff?[]:H,offscreen:Q,collisionDetected:re}}projectPathToScreenSpace(e,o){let u=(function(d,g){let v=a.L();return a.aq(v,g.pitchedLabelPlaneMatrix),d.map((T=>{let S=pi(T.x,T.y,v,g.getElevation),E=g.transform.projectTileCoordinates(S.point.x,S.point.y,g.unwrappedTileID,g.getElevation);return E.point.x=(.5*E.point.x+.5)*g.width,E.point.y=(.5*-E.point.y+.5)*g.height,E}))})(e,o);return(function(d){let g=0,v=0,T=0,S=0;for(let E=0;E<d.length;E++)d[E].isOccluded?(T=E+1,S=0):(S++,S>v&&(v=S,g=T));return d.slice(g,g+v)})(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],u=new a.a2;for(let L of e){let R=new a.P(L.x+oi,L.y+oi);u.extend(R),o.push(R)}let{minX:d,minY:g,maxX:v,maxY:T}=u,S=this.grid.query(d,g,v,T).concat(this.ignoredGrid.query(d,g,v,T)),E={},C={};for(let L of S){let R=L.key;if(E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;let O=[new a.P(L.x1,L.y1),new a.P(L.x2,L.y1),new a.P(L.x2,L.y2),new a.P(L.x1,L.y2)];a.az(o,O)&&(E[R.bucketInstanceId][R.featureIndex]=!0,C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]=[]),C[R.bucketInstanceId].push(R.featureIndex))}return C}insertCollisionBox(e,o,u,d,g,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:v,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,d,g,v){let T=u?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:g,collisionGroupID:v,overlapMode:o};for(let E=0;E<e.length;E+=4)T.insertCircle(S,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,o,u,d,g){if(g){let v;d?(v=[e,o,d(e,o),1],a.aw(v,v,g)):(v=[e,o,0,1],oa(v,v,g));let T=v[3];return{x:(v[0]/T+1)/2*this.transform.width+oi,y:(-v[1]/T+1)/2*this.transform.height+oi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{let v=this.transform.projectTileCoordinates(e,o,u,d);return{x:(v.point.x+1)/2*this.transform.width+oi,y:(1-v.point.y)/2*this.transform.height+oi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,o,u,d){let g=this.transform.projectTileCoordinates(e,o,u,d);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,o,u,d){return u<oi||e>=this.screenRightBoundary||d<oi||o>this.screenBottomBoundary}isInsideGrid(e,o,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let e=a.ag([]);return a.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,d,g,v,T,S,E,C,L){let R=1,O=0,j=0,H=1,W=e.anchorPointX+T[0],K=e.anchorPointY+T[1];if(v&&!g){let Oe=this.projectAndGetPerspectiveRatio(W+1,K,d,E,L),Ee=Oe.x-S.x,He=Math.atan((Oe.y-S.y)/Ee)+(Ee<0?Math.PI:0),gt=Math.sin(He),Dt=Math.cos(He);R=Dt,O=gt,j=-gt,H=Dt}else if(!v&&g){let Oe=Mt(this.transform);R=Oe.vecEast[0],O=Oe.vecEast[1],j=Oe.vecSouth[0],H=Oe.vecSouth[1]}let Y=S.x,te=S.y,J=o;g&&(Y=W,te=K,J=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),J*=this.transform.getPitchedTextCorrection(W,K,d),C||(J*=a.ah(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),C&&(Y+=R*C.x*J+j*C.y*J,te+=O*C.x*J+H*C.y*J);let re=e.x1*J,ae=e.x2*J,Q=(re+ae)/2,de=e.y1*J,we=e.y2*J,ge=(de+we)/2,ye=[{offsetX:re,offsetY:de},{offsetX:Q,offsetY:de},{offsetX:ae,offsetY:de},{offsetX:ae,offsetY:ge},{offsetX:ae,offsetY:we},{offsetX:Q,offsetY:we},{offsetX:re,offsetY:we},{offsetX:re,offsetY:ge}],be=[];for(let{offsetX:Oe,offsetY:Ee}of ye)be.push(new a.P(Y+R*Oe+j*Ee,te+O*Oe+H*Ee));let Le=!1;if(g){let Oe=be.map((Ee=>this.projectAndGetPerspectiveRatio(Ee.x,Ee.y,d,E,L)));Le=Oe.some((Ee=>!Ee.isOccluded)),be=Oe.map((Ee=>new a.P(Ee.x,Ee.y)))}else Le=!0;return{box:a.aA(be),allPointsOccluded:!Le}}}class sr{constructor(e,o,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Vt{constructor(e,o,u,d,g){this.text=new sr(e?e.text:null,o,u,g),this.icon=new sr(e?e.icon:null,o,d,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Oh{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class qa{constructor(e,o,u,d,g){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=g}}class Ec{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Kn(m,e,o,u,d){let{horizontalAlign:g,verticalAlign:v}=a.aH(m);return new a.P(-(g-.5)*e+u[0]*d,-(v-.5)*o+u[1]*d)}class Xn{constructor(e,o,u,d,g){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new nl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ec(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let o=this.terrain;return o?(u,d)=>o.getElevation(e,u,d):null}getBucketParts(e,o,u,d){let g=u.getBucket(o),v=u.latestFeatureIndex;if(!g||!v||o.id!==g.layerIds[0])return;let T=u.collisionBoxArray,S=g.layers[0].layout,E=g.layers[0].paint,C=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),L=u.tileSize/a.$,R=u.tileID.toUnwrapped(),O=S.get("text-rotation-alignment")==="map",j=a.aC(u,1,this.transform.zoom),H=a.aD(this.collisionIndex.transform,u,E.get("text-translate"),E.get("text-translate-anchor")),W=a.aD(this.collisionIndex.transform,u,E.get("icon-translate"),E.get("icon-translate-anchor")),K=hi(O,this.transform,j);this.retainedQueryData[g.bucketInstanceId]=new qa(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,u.tileID);let Y={bucket:g,layout:S,translationText:H,translationIcon:W,unwrappedTileID:R,pitchedLabelPlaneMatrix:K,scale:C,textPixelRatio:L,holdingForFade:u.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:a.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(d)for(let te of g.sortKeyRanges){let{sortKey:J,symbolInstanceStart:re,symbolInstanceEnd:ae}=te;e.push({sortKey:J,symbolInstanceStart:re,symbolInstanceEnd:ae,parameters:Y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Y})}attemptAnchorPlacement(e,o,u,d,g,v,T,S,E,C,L,R,O,j,H,W,K,Y,te,J){let re=a.aE[e.textAnchor],ae=[e.textOffset0,e.textOffset1],Q=Kn(re,u,d,ae,g),de=this.collisionIndex.placeCollisionBox(o,R,S,E,C,T,v,W,L.predicate,te,Q,J);if((!Y||this.collisionIndex.placeCollisionBox(Y,R,S,E,C,T,v,K,L.predicate,te,Q,J).placeable)&&de.placeable){let we;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(we=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:ae,width:u,height:d,anchor:re,textBoxScale:g,prevAnchor:we},this.markUsedJustification(j,re,O,H),j.allowVerticalPlacement&&(this.markUsedOrientation(j,H,O),this.placedOrientations[O.crossTileID]=H),{shift:Q,placedGlyphBoxes:de}}}placeLayerBucketPart(e,o,u){let{bucket:d,layout:g,translationText:v,translationIcon:T,unwrappedTileID:S,pitchedLabelPlaneMatrix:E,textPixelRatio:C,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:O,collisionGroup:j}=e.parameters,H=g.get("text-optional"),W=g.get("icon-optional"),K=a.aF(g,"text-overlap","text-allow-overlap"),Y=K==="always",te=a.aF(g,"icon-overlap","icon-allow-overlap"),J=te==="always",re=g.get("text-rotation-alignment")==="map",ae=g.get("text-pitch-alignment")==="map",Q=g.get("icon-text-fit")!=="none",de=g.get("symbol-z-order")==="viewport-y",we=Y&&(J||!d.hasIconData()||W),ge=J&&(Y||!d.hasTextData()||H);!d.collisionArrays&&R&&d.deserializeCollisionBoxes(R);let ye=this.retainedQueryData[d.bucketInstanceId].tileID,be=this._getTerrainElevationFunc(ye),Le=this.transform.getFastPathSimpleProjectionMatrix(ye),Oe=(Ee,He,gt)=>{var Dt,Bt;if(o[Ee.crossTileID])return;if(L)return void(this.placements[Ee.crossTileID]=new Oh(!1,!1,!1));let Ft=!1,Yt=!1,ti=!0,ft=null,Ut={box:null,placeable:!1,offscreen:null,occluded:!1},mi={placeable:!1},wi=null,Ai=null,tr=null,Ur=0,to=0,io=0;He.textFeatureIndex?Ur=He.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Ur=Ee.featureIndex),He.verticalTextFeatureIndex&&(to=He.verticalTextFeatureIndex);let Pa=He.textBox;if(Pa){let ur=gi=>{let Ti=a.ao.horizontal;if(d.allowVerticalPlacement&&!gi&&this.prevPlacement){let Er=this.prevPlacement.placedOrientations[Ee.crossTileID];Er&&(this.placedOrientations[Ee.crossTileID]=Er,Ti=Er,this.markUsedOrientation(d,Ti,Ee))}return Ti},jr=(gi,Ti)=>{if(d.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&He.verticalTextBox){for(let Er of d.writingModes)if(Er===a.ao.vertical?(Ut=Ti(),mi=Ut):Ut=gi(),Ut&&Ut.placeable)break}else Ut=gi()},ir=Ee.textAnchorOffsetStartIndex,ro=Ee.textAnchorOffsetEndIndex;if(ro===ir){let gi=(Ti,Er)=>{let yi=this.collisionIndex.placeCollisionBox(Ti,K,C,ye,S,ae,re,v,j.predicate,be,void 0,Le);return yi&&yi.placeable&&(this.markUsedOrientation(d,Er,Ee),this.placedOrientations[Ee.crossTileID]=Er),yi};jr((()=>gi(Pa,a.ao.horizontal)),(()=>{let Ti=He.verticalTextBox;return d.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&Ti?gi(Ti,a.ao.vertical):{box:null,offscreen:null}})),ur(Ut&&Ut.placeable)}else{let gi=a.aE[(Bt=(Dt=this.prevPlacement)===null||Dt===void 0?void 0:Dt.variableOffsets[Ee.crossTileID])===null||Bt===void 0?void 0:Bt.anchor],Ti=(yi,_s,Aa)=>{let Pn=yi.x2-yi.x1,Vr=yi.y2-yi.y1,no=Ee.textBoxScale,Ad=Q&&te==="never"?_s:null,yr=null,Cd=K==="never"?1:2,xu="never";gi&&Cd++;for(let Ul=0;Ul<Cd;Ul++){for(let jl=ir;jl<ro;jl++){let oo=d.textAnchorOffsets.get(jl);if(gi&&oo.textAnchor!==gi)continue;let En=this.attemptAnchorPlacement(oo,yi,Pn,Vr,no,re,ae,C,ye,S,j,xu,Ee,d,Aa,v,T,Ad,be);if(En&&(yr=En.placedGlyphBoxes,yr&&yr.placeable))return Ft=!0,ft=En.shift,yr}gi?gi=null:xu=K}return u&&!yr&&(yr={box:this.collisionIndex.placeCollisionBox(Pa,"always",C,ye,S,ae,re,v,j.predicate,be,void 0,Le).box,offscreen:!1,placeable:!1,occluded:!1}),yr};jr((()=>Ti(Pa,He.iconBox,a.ao.horizontal)),(()=>{let yi=He.verticalTextBox;return d.allowVerticalPlacement&&(!Ut||!Ut.placeable)&&Ee.numVerticalGlyphVertices>0&&yi?Ti(yi,He.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Ut&&(Ft=Ut.placeable,ti=Ut.offscreen);let Er=ur(Ut&&Ut.placeable);if(!Ft&&this.prevPlacement){let yi=this.prevPlacement.variableOffsets[Ee.crossTileID];yi&&(this.variableOffsets[Ee.crossTileID]=yi,this.markUsedJustification(d,yi.anchor,Ee,Er))}}}if(wi=Ut,Ft=wi&&wi.placeable,ti=wi&&wi.offscreen,Ee.useRuntimeCollisionCircles){let ur=d.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex),jr=a.ap(d.textSizeData,O,ur),ir=g.get("text-padding");Ai=this.collisionIndex.placeCollisionCircles(K,ur,d.lineVertexArray,d.glyphOffsetArray,jr,S,E,u,ae,j.predicate,Ee.collisionCircleDiameter,ir,v,be),Ai.circles.length&&Ai.collisionDetected&&!u&&a.w("Collisions detected, but collision boxes are not shown"),Ft=Y||Ai.circles.length>0&&!Ai.collisionDetected,ti=ti&&Ai.offscreen}if(He.iconFeatureIndex&&(io=He.iconFeatureIndex),He.iconBox){let ur=jr=>this.collisionIndex.placeCollisionBox(jr,te,C,ye,S,ae,re,T,j.predicate,be,Q&&ft?ft:void 0,Le);mi&&mi.placeable&&He.verticalIconBox?(tr=ur(He.verticalIconBox),Yt=tr.placeable):(tr=ur(He.iconBox),Yt=tr.placeable),ti=ti&&tr.offscreen}let Ea=H||Ee.numHorizontalGlyphVertices===0&&Ee.numVerticalGlyphVertices===0,No=W||Ee.numIconVertices===0;Ea||No?No?Ea||(Yt=Yt&&Ft):Ft=Yt&&Ft:Yt=Ft=Yt&&Ft;let Bo=Yt&&tr.placeable;if(Ft&&wi.placeable&&this.collisionIndex.insertCollisionBox(wi.box,K,g.get("text-ignore-placement"),d.bucketInstanceId,mi&&mi.placeable&&to?to:Ur,j.ID),Bo&&this.collisionIndex.insertCollisionBox(tr.box,te,g.get("icon-ignore-placement"),d.bucketInstanceId,io,j.ID),Ai&&Ft&&this.collisionIndex.insertCollisionCircles(Ai.circles,K,g.get("text-ignore-placement"),d.bucketInstanceId,Ur,j.ID),u&&this.storeCollisionData(d.bucketInstanceId,gt,He,wi,tr,Ai),Ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ee.crossTileID]=new Oh((Ft||we)&&!wi?.occluded,(Yt||ge)&&!tr?.occluded,ti||d.justReloaded),o[Ee.crossTileID]=!0};if(de){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ee=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let He=Ee.length-1;He>=0;--He){let gt=Ee[He];Oe(d.symbolInstances.get(gt),d.collisionArrays[gt],gt)}}else for(let Ee=e.symbolInstanceStart;Ee<e.symbolInstanceEnd;Ee++)Oe(d.symbolInstances.get(Ee),d.collisionArrays[Ee],Ee);d.justReloaded=!1}storeCollisionData(e,o,u,d,g,v){if(u.textBox||u.iconBox){let T,S;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(o)?S=T.get(o):(S={text:null,icon:null},T.set(o,S)),u.textBox&&(S.text=d.box),u.iconBox&&(S.icon=g.box)}if(v){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=[]);for(let S=0;S<v.circles.length;S+=4)T.push(v.circles[S+0]-oi),T.push(v.circles[S+1]-oi),T.push(v.circles[S+2]),T.push(v.collisionDetected?1:0)}}markUsedJustification(e,o,u,d){let g;g=d===a.ao.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[a.aG(o)];let v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(let T of v)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=g>=0&&T!==g?0:u.crossTileID)}markUsedOrientation(e,o,u){let d=o===a.ao.horizontal||o===a.ao.horizontalOnly?o:0,g=o===a.ao.vertical?o:0,v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(let T of v)e.text.placedSymbolArray.get(T).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let d=o?o.symbolFadeChange(e):1,g=o?o.opacities:{},v=o?o.variableOffsets:{},T=o?o.placedOrientations:{};for(let S in this.placements){let E=this.placements[S],C=g[S];C?(this.opacities[S]=new Vt(C,d,E.text,E.icon),u=u||E.text!==C.text.placed||E.icon!==C.icon.placed):(this.opacities[S]=new Vt(null,d,E.text,E.icon,E.skipFade),u=u||E.text||E.icon)}for(let S in g){let E=g[S];if(!this.opacities[S]){let C=new Vt(E,d,!1,!1);C.isHidden()||(this.opacities[S]=C,u=u||E.text.placed||E.icon.placed)}}for(let S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(let S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){let u={};for(let d of o){let g=d.getBucket(e);g&&d.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,o,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let g=e.layers[0],v=g.layout,T=new Vt(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),E=v.get("icon-allow-overlap"),C=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=v.get("text-rotation-alignment")==="map",R=v.get("text-pitch-alignment")==="map",O=v.get("icon-text-fit")!=="none",j=new Vt(null,0,S&&(E||!e.hasIconData()||v.get("icon-optional")),E&&(S||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);let H=(K,Y,te)=>{for(let J=0;J<Y/4;J++)K.opacityVertexArray.emplaceBack(te);K.hasVisibleVertices=K.hasVisibleVertices||te!==sa},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let K=0;K<e.symbolInstances.length;K++){let Y=e.symbolInstances.get(K),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:J,crossTileID:re}=Y,ae=this.opacities[re];u[re]?ae=T:ae||(ae=j,this.opacities[re]=ae),u[re]=!0;let Q=Y.numIconVertices>0,de=this.placedOrientations[Y.crossTileID],we=de===a.ao.vertical,ge=de===a.ao.horizontal||de===a.ao.horizontalOnly;if(te>0||J>0){let be=Cc(ae.text);H(e.text,te,we?sa:be),H(e.text,J,ge?sa:be);let Le=ae.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach((He=>{He>=0&&(e.text.placedSymbolArray.get(He).hidden=Le||we?1:0)})),Y.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Le||ge?1:0);let Oe=this.variableOffsets[Y.crossTileID];Oe&&this.markUsedJustification(e,Oe.anchor,Y,de);let Ee=this.placedOrientations[Y.crossTileID];Ee&&(this.markUsedJustification(e,"left",Y,Ee),this.markUsedOrientation(e,Ee,Y))}if(Q){let be=Cc(ae.icon),Le=!(O&&Y.verticalPlacedIconSymbolIndex&&we);Y.placedIconSymbolIndex>=0&&(H(e.icon,Y.numIconVertices,Le?be:sa),e.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ae.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,Y.numVerticalIconVertices,Le?sa:be),e.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}let ye=W&&W.has(K)?W.get(K):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let be=e.collisionArrays[K];if(be){let Le=new a.P(0,0);if(be.textBox||be.verticalTextBox){let Oe=!0;if(C){let Ee=this.variableOffsets[re];Ee?(Le=Kn(Ee.anchor,Ee.width,Ee.height,Ee.textOffset,Ee.textBoxScale),L&&Le._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Oe=!1}if(be.textBox||be.verticalTextBox){let Ee;be.textBox&&(Ee=we),be.verticalTextBox&&(Ee=ge),Ac(e.textCollisionBox.collisionVertexArray,ae.text.placed,!Oe||Ee,ye.text,Le.x,Le.y)}}if(be.iconBox||be.verticalIconBox){let Oe=!!(!ge&&be.verticalIconBox),Ee;be.iconBox&&(Ee=Oe),be.verticalIconBox&&(Ee=!Oe),Ac(e.iconCollisionBox.collisionVertexArray,ae.icon.placed,Ee,ye.icon,O?Le.x:0,O?Le.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){let u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Ac(m,e,o,u,d,g){u&&u.length!==0||(u=[0,0,0,0]);let v=u[0]-oi,T=u[1]-oi,S=u[2]-oi,E=u[3]-oi;m.emplaceBack(e?1:0,o?1:0,d||0,g||0,v,T),m.emplaceBack(e?1:0,o?1:0,d||0,g||0,S,T),m.emplaceBack(e?1:0,o?1:0,d||0,g||0,S,E),m.emplaceBack(e?1:0,o?1:0,d||0,g||0,v,E)}let Fh=Math.pow(2,25),Nh=Math.pow(2,24),aa=Math.pow(2,17),Bh=Math.pow(2,16),Cf=Math.pow(2,9),Mf=Math.pow(2,8),kf=Math.pow(2,1);function Cc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*Fh+e*Nh+o*aa+e*Bh+o*Cf+e*Mf+o*kf+e}let sa=0;class Mc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,d,g){let v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(v,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((T,S)=>T.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(o.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class kc{constructor(e,o,u,d,g,v,T,S){this.placement=new Xn(e,o,v,T,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){let d=B.now(),g=()=>!this._forceFullPlacement&&B.now()-d>2;for(;this._currentPlacementIndex>=0;){let v=o[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=T)&&(!v.maxzoom||v.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Mc(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let la=512/a.$/2;class Rc{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};let d=new Map;for(let g=0;g<o.length;g++){let v=o.get(g),T=v.key,S=d.get(T);S?S.push(v):d.set(T,[v])}for(let[g,v]of d){let T={positions:v.map((S=>({x:Math.floor(S.anchorX*la),y:Math.floor(S.anchorY*la)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(T.positions.length>128){let S=new a.aI(T.positions.length,16,Uint16Array);for(let{x:E,y:C}of T.positions)S.add(E,C);S.finish(),delete T.positions,T.index=S}this._symbolsByKey[g]=T}}getScaledCoordinates(e,o){let{x:u,y:d,z:g}=this.tileID.canonical,{x:v,y:T,z:S}=o.canonical,E=la/Math.pow(2,S-g),C=(T*a.$+e.anchorY)*E,L=d*a.$*la;return{x:Math.floor((v*a.$+e.anchorX)*E-u*a.$*la),y:Math.floor(C-L)}}findMatches(e,o,u){let d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let g=0;g<e.length;g++){let v=e.get(g);if(v.crossTileID)continue;let T=this._symbolsByKey[v.key];if(!T)continue;let S=this.getScaledCoordinates(v,o);if(T.index){let E=T.index.range(S.x-d,S.y-d,S.x+d,S.y+d).sort();for(let C of E){let L=T.crossTileIDs[C];if(!u[L]){u[L]=!0,v.crossTileID=L;break}}}else if(T.positions)for(let E=0;E<T.positions.length;E++){let C=T.positions[E],L=T.crossTileIDs[E];if(Math.abs(C.x-S.x)<=d&&Math.abs(C.y-S.y)<=d&&!u[L]){u[L]=!0,v.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Lc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let o=Math.round((e-this.lng)/360);if(o!==0)for(let u in this.indexes){let d=this.indexes[u],g={};for(let v in d){let T=d[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+o),g[T.tileID.key]=T}this.indexes[u]=g}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<o.symbolInstances.length;g++)o.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let d=this.usedCrossTileIDs[e.overscaledZ];for(let g in this.indexes){let v=this.indexes[g];if(Number(g)>e.overscaledZ)for(let T in v){let S=v[T];S.tileID.isChildOf(e)&&S.findMatches(o.symbolInstances,e,d)}else{let T=v[e.scaledTo(Number(g)).key];T&&T.findMatches(o.symbolInstances,e,d)}}for(let g=0;g<o.symbolInstances.length;g++){let v=o.symbolInstances.get(g);v.crossTileID||(v.crossTileID=u.generate(),d[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Rc(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(let u of o.getCrossTileIDsLists())for(let d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let o=!1;for(let u in this.indexes){let d=this.indexes[u];for(let g in d)e[d[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[g]),delete d[g],o=!0)}return o}}class ca{constructor(){this.layerIndexes={},this.crossTileIDs=new Lc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Rf);let g=!1,v={};d.handleWrapJump(u);for(let T of o){let S=T.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(T.tileID,S,this.crossTileIDs)&&(g=!0),v[S.bucketInstanceId]=!0)}return d.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(e){let o={};e.forEach((u=>{o[u]=!0}));for(let u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}var Za="void main() {fragColor=vec4(1.0);}";let Rr={prelude:bt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:bt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:bt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:bt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:bt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:bt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:bt(Za,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:bt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:bt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:bt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:bt(Za,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:bt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:bt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:bt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:bt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:bt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:bt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:bt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:bt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:bt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:bt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:bt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:bt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:bt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:bt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:bt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:bt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:bt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function bt(m,e){let o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(d):d,T={};return{fragmentSource:m=m.replace(o,((S,E,C,L,R)=>(T[R]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${C} ${L} ${R};
#else
uniform ${C} ${L} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${C} ${L} ${R} = u_${R};
#endif
`))),vertexSource:e=e.replace(o,((S,E,C,L,R)=>{let O=L==="float"?"vec2":"vec4",j=R.match(/color/)?"color":O;return T[R]?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${C} ${O} a_${R};
out ${C} ${L} ${R};
#else
uniform ${C} ${L} u_${R};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${C} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${j}(a_${R}, u_${R}_t);
#else
    ${C} ${L} ${R} = u_${R};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${C} ${O} a_${R};
#else
uniform ${C} ${L} u_${R};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${L} ${R} = a_${R};
#else
    ${C} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${L} ${R} = unpack_mix_${j}(a_${R}, u_${R}_t);
#else
    ${C} ${L} ${R} = u_${R};
#endif
`})),staticAttributes:u,staticUniforms:v}}class bo{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Yn=a.aJ([{name:"a_pos",type:"Int16",components:2}]);let wn="#define PROJECTION_MERCATOR",wo="mercator";class wt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return wo}get shaderDefine(){return wn}get shaderPreludeCode(){return Rr.projectionMercator}get vertexShaderPreludeCode(){return Rr.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,o,u,d,g){if(this._cachedMesh)return this._cachedMesh;let v=new a.aL;v.emplaceBack(0,0),v.emplaceBack(a.$,0),v.emplaceBack(0,a.$),v.emplaceBack(a.$,a.$);let T=e.createVertexBuffer(v,Yn.members),S=a.aM.simpleSegment(0,0,4,2),E=new a.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);let C=e.createIndexBuffer(E);return this._cachedMesh=new bo(T,C,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class To{constructor(e=0,o=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=d}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=a.C.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=a.C.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=a.C.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=a.C.number(e.right,o.right,u)),this}getCenter(e,o){let u=a.ah((this.left+e-this.right)/2,0,e),d=a.ah((this.top+o-this.bottom)/2,0,o);return new a.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new To(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ol(m,e){if(!m.renderWorldCopies||m.lngRange)return;let o=e.lng-m.center.lng;e.lng+=o>180?-360:o<-180?360:0}function al(m){return Math.max(0,Math.floor(m))}class Yi{constructor(e,o,u,d,g,v){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=al(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new To,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,o,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=al(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new To(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,o&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let o=a.aO(e,-180,180)*Math.PI/180;var u,d,g,v,T,S,E,C,L;this._bearingInRadians!==o&&(this._unmodified=!1,this._bearingInRadians=o,this._calcMatrices(),this._rotationMatrix=P(),u=this._rotationMatrix,g=-this._bearingInRadians,v=(d=this._rotationMatrix)[0],T=d[1],S=d[2],E=d[3],C=Math.sin(g),L=Math.cos(g),u[0]=v*L+S*C,u[1]=T*L+E*C,u[2]=v*-C+S*L,u[3]=T*-C+E*L)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let o=a.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==o&&(this._unmodified=!1,this._pitchInRadians=o,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let o=e/180*Math.PI;this._rollInRadians!==o&&(this._unmodified=!1,this._rollInRadians=o,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(e){e=a.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=a.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let o=this.getConstrained(this._center,e).zoom;this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this._tileZoom=Math.max(0,Math.floor(o)),this._scale=a.af(o),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,o){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=o,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}resize(e,o,u=!0){this._width=e,this._height=o,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ni([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(e,o){return this._callbacks.getConstrained(e,o)}getCameraQueryGeometry(e,o){if(o.length===1)return[o[0],e];{let{minX:u,minY:d,maxX:g,maxY:v}=a.a2.fromPoints(o).extend(e);return[new a.P(u,d),new a.P(g,d),new a.P(g,v),new a.P(u,v),new a.P(u,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(o),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=a.ag(new Float64Array(16));a.N(e,e,[this._width/2,-this._height/2,1]),a.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=a.ag(new Float64Array(16)),a.N(e,e,[1,-1,1]),a.M(e,e,[-1,-1,0]),a.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,o,u,d){let g=u!==void 0?u:this.bearing,v=d=d!==void 0?d:this.pitch,T=a.a1.fromLngLat(e,o),S=-Math.cos(a.ae(v)),E=Math.sin(a.ae(v)),C=E*Math.sin(a.ae(g)),L=-E*Math.cos(a.ae(g)),R=this.elevation,O=o-R,j;S*O>=0||Math.abs(S)<.1?(j=1e4,R=o+j*S):j=-O/S;let H,W,K=a.aQ(1,T.y),Y=0;do{if(Y+=1,Y>10)break;W=j/K,H=new a.a1(T.x+C*W,T.y+L*W),K=1/H.meterInMercatorCoordinateUnits()}while(Math.abs(j-W*K)>1e-12);return{center:H.toLngLat(),elevation:R,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/W/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let o=a.aj(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/o,d=a.a1.fromLngLat(this.center,this.elevation),g=ve(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;let v=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),a.aQ(g.z,d.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=a.aj(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let o=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/o,e.canonical.y/o,1/o/a.$,1/o/a.$]}}class Pi{constructor(e,o){this.min=e,this.max=o,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(e){let o=[e%2==0,e<2],u=a.aT(this.min),d=a.aT(this.max);for(let g=0;g<o.length;g++)u[g]=o[g]?this.min[g]:this.center[g],d[g]=o[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new Pi(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let o=!0;for(let u=0;u<e.planes.length;u++){let d=this.intersectsPlane(e.planes[u]);if(d===0)return 0;d===1&&(o=!1)}return o?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let o=e[3],u=e[3];for(let d=0;d<3;d++)e[d]>0?(o+=e[d]*this.min[d],u+=e[d]*this.max[d]):(u+=e[d]*this.min[d],o+=e[d]*this.max[d]);return o>=0?2:u<0?0:1}}class Ji{distanceToTile2d(e,o,u,d){let g=d.distanceX([e,o]),v=d.distanceY([e,o]);return Math.hypot(g,v)}getWrap(e,o,u){return u}getTileBoundingVolume(e,o,u,d){var g,v;let T=0,S=0;if(d?.terrain){let C=new a.Z(e.z,o,e.z,e.x,e.y),L=d.terrain.getMinMaxElevation(C);T=(g=L.minElevation)!==null&&g!==void 0?g:Math.min(0,u),S=(v=L.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}let E=1<<e.z;return new Pi([o+e.x/E,e.y/E,T],[o+(e.x+1)/E,(e.y+1)/E,S])}allowVariableZoom(e,o){let u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=a.ah(78.5-u/2,0,60);return!!o.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class fi{constructor(e,o,u){this.points=e,this.planes=o,this.aabb=u}static fromInvProjectionMatrix(e,o=1,u=0,d,g){let v=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,u),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>(function(O,j,H,W){let K=a.aw([],O,j),Y=1/K[3]/H*W;return a.aY(K,K,[Y,Y,1/K[3],Y])})(R,e,o,T)));d&&(function(R,O,j,H){let W=H?4:0,K=H?0:4,Y=0,te=[],J=[];for(let Q=0;Q<4;Q++){let de=a.aU([],R[Q+K],R[Q+W]),we=a.aZ(de);a.aR(de,de,1/we),te.push(we),J.push(de)}for(let Q=0;Q<4;Q++){let de=a.a_(R[Q+W],J[Q],j);Y=de!==null&&de>=0?Math.max(Y,de):Math.max(Y,te[Q])}let re=(function(Q,de){let we=a.aU([],Q[de[0]],Q[de[1]]),ge=a.aU([],Q[de[2]],Q[de[1]]),ye=[0,0,0,0];return a.aV(ye,a.aW([],we,ge)),ye[3]=-a.aX(ye,Q[de[0]]),ye})(R,O),ae=(function(Q,de){let we=a.a$(Q),ge=a.b0([],Q,1/we),ye=a.aU([],de,a.aR([],ge,a.aX(de,ge))),be=a.a$(ye);if(be>0){let Le=Math.sqrt(1-ge[3]*ge[3]),Oe=a.aR([],ge,-ge[3]),Ee=a.aS([],Oe,a.aR([],ye,Le/be));return a.b1(de,Ee)}return null})(j,re);if(ae!==null){let Q=ae/a.aX(J[0],re);Y=Math.min(Y,Q)}for(let Q=0;Q<4;Q++){let de=Math.min(Y,te[Q]);R[Q+K]=[R[Q+W][0]+J[Q][0]*de,R[Q+W][1]+J[Q][1]*de,R[Q+W][2]+J[Q][2]*de,1]}})(S,v[0],d,g);let E=v.map((R=>{let O=a.aU([],S[R[0]],S[R[1]]),j=a.aU([],S[R[2]],S[R[1]]),H=a.aV([],a.aW([],O,j)),W=-a.aX(H,S[R[1]]);return H.concat(W)})),C=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],L=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let R of S)for(let O=0;O<3;O++)C[O]=Math.min(C[O],R[O]),L[O]=Math.max(L[O],R[O]);return new fi(S,E,new Pi(C,L))}}class $t{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,u=!0){this._helper.resize(e,o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,o){}constructor(e,o,u,d,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(v,T)=>this.getConstrained(v,T)},e,o,u,d,g),this._coveringTilesDetailsProvider=new Ji}clone(){let e=new $t;return e.apply(this),e}apply(e,o,u){this._helper.apply(e,o,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let o=[new a.b2(0,e)];if(this._helper._renderWorldCopies){let u=this.screenPointToMercatorCoordinate(new a.P(0,0)),d=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),T=Math.floor(Math.min(u.x,d.x,g.x,v.x)),S=Math.floor(Math.max(u.x,d.x,g.x,v.x)),E=1;for(let C=T-E;C<=S+E;C++)C!==0&&o.push(new a.b2(C,e))}return o}getCameraFrustum(){return fi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let o=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(o,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,o){let u=a.aj(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(o,u),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),v=a.a1.fromLngLat(e),T=new a.a1(v.x-(d.x-g.x),v.y-(d.y-g.y));this.setCenter(T?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,o){return o?this.coordinatePoint(a.a1.fromLngLat(e),o.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(e))}screenPointToLocation(e,o){var u;return(u=this.screenPointToMercatorCoordinate(e,o))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,o){if(o){let u=o.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,o){let u=o||0,d=[e.x,e.y,0,1],g=[e.x,e.y,1,1];a.aw(d,d,this._pixelMatrixInverse),a.aw(g,g,this._pixelMatrixInverse);let v=d[3],T=g[3],S=d[1]/v,E=g[1]/T,C=d[2]/v,L=g[2]/T,R=C===L?0:(u-C)/(L-C);return new a.a1(a.C.number(d[0]/v,g[0]/T,R)/this.worldSize,a.C.number(S,E,R)/this.worldSize,u)}coordinatePoint(e,o=0,u=this._pixelMatrix){let d=[e.x*this.worldSize,e.y*this.worldSize,o,1];return a.aw(d,d,u),new a.P(d[0]/d[3],d[1]/d[3])}getBounds(){let e=Math.max(0,this._helper._height/2-se(this));return new ni().extend(this.screenPointToLocation(new a.P(0,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,e))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(e,o){return o?o.pointCoordinate(e)!=null:e.y>this.height/2-se(this)}calculatePosMatrix(e,o=!1,u){var d;let g=(d=e.key)!==null&&d!==void 0?d:a.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=o?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(g)){let E=v.get(g);return u?E.f32:E.f64}let T=he(e,this.worldSize);a.O(T,o?this._alignedProjMatrix:this._viewProjMatrix,T);let S={f64:T,f32:new Float32Array(T)};return v.set(g,S),u?S.f32:S.f64}calculateFogMatrix(e){let o=e.key,u=this._fogMatrixCacheF32;if(u.has(o))return u.get(o);let d=he(e,this.worldSize);return a.O(d,this._fogMatrix,d),u.set(o,new Float32Array(d)),u.get(o)}getConstrained(e,o){o=a.ah(+o,this.minZoom,this.maxZoom);let u={center:new a.S(e.lng,e.lat),zoom:o},d=this._helper._lngRange;if(!this._helper._renderWorldCopies&&d===null){let te=179.9999999999;d=[-te,te]}let g=this.tileSize*a.af(u.zoom),v=0,T=g,S=0,E=g,C=0,L=0,{x:R,y:O}=this.size;if(this._helper._latRange){let te=this._helper._latRange;v=a.U(te[1])*g,T=a.U(te[0])*g,T-v<O&&(C=O/(T-v))}d&&(S=a.aO(a.V(d[0])*g,0,g),E=a.aO(a.V(d[1])*g,0,g),E<S&&(E+=g),E-S<R&&(L=R/(E-S)));let{x:j,y:H}=q(g,e),W,K,Y=Math.max(L||0,C||0);if(Y){let te=new a.P(L?(E+S)/2:j,C?(T+v)/2:H);return u.center=ee(g,te).wrap(),u.zoom+=a.ak(Y),u}if(this._helper._latRange){let te=O/2;H-te<v&&(K=v+te),H+te>T&&(K=T-te)}if(d){let te=(S+E)/2,J=j;this._helper._renderWorldCopies&&(J=a.aO(j,te-g/2,te+g/2));let re=R/2;J-re<S&&(W=S+re),J+re>E&&(W=E-re)}if(W!==void 0||K!==void 0){let te=new a.P(W??j,K??H);u.center=ee(g,te).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}_calculateNearFarZIfNeeded(e,o,u){if(!this._helper.autoCalculateNearFarZ)return;let d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-d*this._helper._pixelPerMeter/Math.cos(o),v=d<0?g:e,T=Math.PI/2+this.pitchInRadians,S=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+u.y/this.height),E=Math.sin(S)*v/Math.sin(a.ah(Math.PI-T-S,.01,Math.PI-.01)),C=se(this),L=Math.atan(C/this._helper.cameraToCenterDistance),R=a.ae(.75),O=L>R?2*L*(.5+u.y/(2*C)):R,j=Math.sin(O)*v/Math.sin(a.ah(Math.PI-T-O,.01,Math.PI-.01)),H=Math.min(E,j);this._helper._farZ=1.01*(Math.cos(Math.PI/2-o)*H+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,o=q(this.worldSize,this.center),u=o.x,d=o.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;let g=a.ae(Math.min(this.pitch,G)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g)),T;this._calculateNearFarZIfNeeded(v,g,e),T=new Float64Array(16),a.b4(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,T),T[8]=2*-e.x/this._helper._width,T[9]=2*e.y/this._helper._height,this._projectionMatrix=a.b5(T),a.N(T,T,[1,-1,1]),a.M(T,T,[0,0,-this._helper.cameraToCenterDistance]),a.b6(T,T,-this.rollInRadians),a.b7(T,T,this.pitchInRadians),a.b6(T,T,-this.bearingInRadians),a.M(T,T,[-u,-d,0]),this._mercatorMatrix=a.N([],T,[this.worldSize,this.worldSize,this.worldSize]),a.N(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),a.M(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=a.aq([],T);let S=[0,0,-1,1];a.aw(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-u,-d,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);let E=this._helper._width%2/2,C=this._helper._height%2/2,L=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),O=u-Math.round(u)+L*E+R*C,j=d-Math.round(d)+L*C+R*E,H=new Float64Array(T);if(a.M(H,H,[O>.5?O-1:O,j>.5?j-1:j,0]),this._alignedProjMatrix=H,T=a.aq(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new a.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return a.aw(o,o,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=a.aj(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,o){let u=a.a1.fromLngLat(e),d=[u.x*this.worldSize,u.y*this.worldSize,o,1];return a.aw(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){let{overscaledTileID:o,aligned:u,applyTerrainMatrix:d}=e,g=this._helper.getMercatorTileCoordinates(o),v=o?this.calculatePosMatrix(o,u,!0):null,T;return T=o&&o.terrainRttPosMatrix32f&&d?o.terrainRttPosMatrix32f:v||a.b8(),{mainMatrix:T,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,o,u){return 1}transformLightDirection(e){return a.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,o,u,d){let g=this.calculatePosMatrix(u),v;d?(v=[e,o,d(e,o),1],a.aw(v,v,g)):(v=[e,o,0,1],oa(v,v,g));let T=v[3];return{point:new a.P(v[0]/T,v[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(e){for(let o of e)this.calculatePosMatrix(o)}getMatrixForModel(e,o){let u=a.a1.fromLngLat(e,o),d=u.meterInMercatorCoordinateUnits(),g=a.b9();return a.M(g,g,[u.x,u.y,u.z]),a.b6(g,g,Math.PI),a.b7(g,g,Math.PI/2),a.N(g,g,[-d,d,d]),g}getProjectionDataForCustomLayer(e=!0){let o=new a.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:o,applyGlobeMatrix:e}),d=he(o,this.worldSize);a.O(d,this._viewProjMatrix,d),u.tileMercatorCoords=[0,0,1,1];let g=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],v=a.ba();return a.N(v,d,g),u.fallbackMatrix=v,u.mainMatrix=v,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Uh(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Qi(m){if(m.useSlerp)if(m.k<1){let e=a.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),o=a.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),u=new Float64Array(4);a.bc(u,e,o,m.k);let d=a.bd(u);m.tr.setRoll(d.roll),m.tr.setPitch(d.pitch),m.tr.setBearing(d.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(a.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(a.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(a.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function mr(m,e,o,u,d){let g=d.padding,v=q(d.worldSize,o.getNorthWest()),T=q(d.worldSize,o.getNorthEast()),S=q(d.worldSize,o.getSouthEast()),E=q(d.worldSize,o.getSouthWest()),C=a.ae(-u),L=v.rotate(C),R=T.rotate(C),O=S.rotate(C),j=E.rotate(C),H=new a.P(Math.max(L.x,R.x,j.x,O.x),Math.max(L.y,R.y,j.y,O.y)),W=new a.P(Math.min(L.x,R.x,j.x,O.x),Math.min(L.y,R.y,j.y,O.y)),K=H.sub(W),Y=(d.width-(g.left+g.right+e.left+e.right))/K.x,te=(d.height-(g.top+g.bottom+e.top+e.bottom))/K.y;if(te<0||Y<0)return void Uh();let J=Math.min(a.ak(d.scale*Math.min(Y,te)),m.maxZoom),re=a.P.convert(m.offset),ae=new a.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(a.ae(u)),Q=re.add(ae).mult(d.scale/a.af(J));return{center:ee(d.worldSize,v.add(S).div(2).sub(Q)),zoom:J,bearing:u}}class qi{get useGlobeControls(){return!1}handlePanInertia(e,o){return{easingOffset:e,easingCenter:o.center}}handleMapControlsRollPitchBearingZoom(e,o){e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta),e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta)}handleMapControlsPan(e,o,u){e.around.distSqr(o.centerPoint)<.01||o.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,o,u,d,g){return mr(e,o,u,d,g)}handleJumpToCenterZoom(e,o){e.zoom!==(o.zoom!==void 0?+o.zoom:e.zoom)&&e.setZoom(+o.zoom),o.center!==void 0&&e.setCenter(a.S.convert(o.center))}handleEaseTo(e,o){let u=e.zoom,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},T=o.zoom!==void 0,S=!e.isPaddingEqual(o.padding),E=!1,C=T?+o.zoom:e.zoom,L=e.centerPoint.add(o.offsetAsPoint),R=e.screenPointToLocation(L),{center:O,zoom:j}=e.getConstrained(a.S.convert(o.center||R),C??u);ol(e,O);let H=q(e.worldSize,R),W=q(e.worldSize,O).sub(H),K=a.af(j-u);return E=j!==u,{easeFunc:Y=>{if(E&&e.setZoom(a.C.number(u,j,Y)),a.be(g,v)||Qi({startEulerAngles:g,endEulerAngles:v,tr:e,k:Y,useSlerp:g.roll!=v.roll}),S&&(e.interpolatePadding(d,o.padding,Y),L=e.centerPoint.add(o.offsetAsPoint)),o.around)e.setLocationAtPoint(o.around,o.aroundPoint);else{let te=a.af(e.zoom-u),J=j>u?Math.min(2,K):Math.max(.5,K),re=Math.pow(J,1-Y),ae=ee(e.worldSize,H.add(W.mult(Y*re)).mult(te));e.setLocationAtPoint(e.renderWorldCopies?ae.wrap():ae,L)}},isZooming:E,elevationCenter:O}}handleFlyTo(e,o){let u=o.zoom!==void 0,d=e.zoom,g=e.getConstrained(a.S.convert(o.center||o.locationAtOffset),u?+o.zoom:d),v=g.center,T=g.zoom;ol(e,v);let S=q(e.worldSize,o.locationAtOffset),E=q(e.worldSize,v).sub(S),C=E.mag(),L=a.af(T-d),R;if(o.minZoom!==void 0){let O=Math.min(+o.minZoom,d,T),j=e.getConstrained(v,O).zoom;R=a.af(j-d)}return{easeFunc:(O,j,H,W)=>{e.setZoom(O===1?T:d+a.ak(j));let K=O===1?v:ee(e.worldSize,S.add(E.mult(H)).mult(j));e.setLocationAtPoint(e.renderWorldCopies?K.wrap():K,W)},scaleOfZoom:L,targetCenter:v,scaleOfMinZoom:R,pixelPathLength:C}}}class Zt{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}Zt.Replace=[1,0],Zt.disabled=new Zt(Zt.Replace,a.bf.transparent,[!1,!1,!1,!1]),Zt.unblended=new Zt(Zt.Replace,a.bf.transparent,[!0,!0,!0,!0]),Zt.alphaBlended=new Zt([1,771],a.bf.transparent,[!0,!0,!0,!0]);let So=2305;class at{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}at.disabled=new at(!1,1029,So),at.backCCW=new at(!0,1029,So),at.frontCCW=new at(!0,1028,So);class dt{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}dt.ReadOnly=!1,dt.ReadWrite=!0,dt.disabled=new dt(519,dt.ReadOnly,[0,1]);let Tn=7680;class kt{constructor(e,o,u,d,g,v){this.test=e,this.ref=o,this.mask=u,this.fail=d,this.depthFail=g,this.pass=v}}kt.disabled=new kt({func:519,mask:0},0,0,Tn,Tn,Tn);let gr=new WeakMap;function an(m){var e;if(gr.has(m))return gr.get(m);{let o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return gr.set(m,o),o}}class sn{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let o=e.context,u=o.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;let d=new a.aL;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);let g=new a.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new bo(o.createVertexBuffer(d,Yn.members),o.createIndexBuffer(g),a.aM.simpleSegment(0,0,d.length,g.length)),this._resultBuffer=new Uint8Array(4),o.activeTexture.set(u.TEXTURE1);let v=u.createTexture();u.bindTexture(u.TEXTURE_2D,v),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=o.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),an(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,o){let u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,o),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,o=e.gl;e.activeTexture.set(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,o){let u=this._cachedRenderContext.context,d=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,d.TRIANGLES,dt.disabled,kt.disabled,Zt.unblended,at.disabled,((g,v)=>({u_input:g,u_output_expected:v}))(e,o),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&an(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);let g=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&an(e)){let o=e.clientWaitSync(this._readbackQueue.sync,0,0);if(o===e.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(o===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=sn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let o=0;return o+=e[0]/256,o+=e[1]/65536,o+=e[2]/16777216,e[3]<127&&(o=-o),o/128}}let sl=a.$/128;function Dc(m,e){let o=m.granularity!==void 0?Math.max(m.granularity,1):1,u=o+(m.generateBorders?2:0),d=o+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=u+1,v=d+1,T=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,E=o+(m.generateBorders?1:0),C=o+(m.generateBorders||m.extendToSouthPole?1:0),L=g*v,R=u*d*6,O=g*v>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let j=O||e==="32bit",H=new Int16Array(2*L),W=0;for(let te=S;te<=C;te++)for(let J=T;J<=E;J++){let re=J/o*a.$;J===-1&&(re=-sl),J===o+1&&(re=a.$+sl);let ae=te/o*a.$;te===-1&&(ae=m.extendToNorthPole?a.bh:-sl),te===o+1&&(ae=m.extendToSouthPole?a.bi:a.$+sl),H[W++]=re,H[W++]=ae}let K=j?new Uint32Array(R):new Uint16Array(R),Y=0;for(let te=0;te<d;te++)for(let J=0;J<u;J++){let re=J+1+te*g,ae=J+(te+1)*g,Q=J+1+(te+1)*g;K[Y++]=J+te*g,K[Y++]=ae,K[Y++]=re,K[Y++]=re,K[Y++]=ae,K[Y++]=Q}return{vertices:H.buffer.slice(0),indices:K.buffer.slice(0),uses32bitIndices:j}}let ua=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class Wa{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Rr.projectionGlobe}get vertexShaderPreludeCode(){return Rr.projectionMercator.vertexSource}get subdivisionGranularity(){return ua}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new sn(e));let o=a.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(o,u),g=B.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=g);let v=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,o,u,d,g){let v=(g==="stencil"?ua.stencil:ua.tile).getGranularityForZoomLevel(o.z);return this._getMesh(e,{granularity:v,generateBorders:u,extendToNorthPole:o.y===0&&d,extendToSouthPole:o.y===(1<<o.z)-1&&d})}_getMesh(e,o){let u=this._getMeshKey(o);if(u in this._tileMeshCache)return this._tileMeshCache[u];let d=(function(g,v){let T=Dc(v,"16bit"),S=a.aL.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),E=a.aN.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new bo(g.createVertexBuffer(S,Yn.members),g.createIndexBuffer(E),a.aM.simpleSegment(0,0,S.length,E.length))})(e,o);return this._tileMeshCache[u]=d,d}recalculate(e){}hasTransition(){let e=B.now(),o=!1;return o=o||(e-this._errorMeasurementLastChangeTime)/1e3<.7,o=o||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,o}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let ll=new a.r({type:new a.D(a.v.projection.type)});class cl extends a.E{constructor(e){super(),this._transitionable=new a.t(ll),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new wt,this._verticalPerspectiveProjection=new Wa}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof a.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,o,u,d,g){return this.currentProjection.getMeshFromTileID(e,o,u,d,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ul(m){let e=ha(m.worldSize,m.center.lat);return 2*Math.PI*e}function Lr(m,e,o,u,d){let g=1/(1<<d),v=e/a.$*g+u*g,T=a.bo((m/a.$*g+o*g)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,E=Math.cos(S),C=new Float64Array(3);return C[0]=Math.sin(T)*E,C[1]=Math.sin(S),C[2]=Math.cos(T)*E,C}function Ei(m){return(function(e,o){let u=Math.cos(o),d=new Float64Array(3);return d[0]=Math.sin(e)*u,d[1]=Math.sin(o),d[2]=Math.cos(e)*u,d})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function ha(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ha(m){let e=Math.asin(m[1])/Math.PI*180,o=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(o>1e-6){let u=m[0]/o,d=Math.acos(m[2]/o),g=(u>0?d:-d)/Math.PI*180;return new a.S(a.aO(g,-180,180),e)}return new a.S(0,e)}function Io(m){return Math.cos(m*Math.PI/180)}function ai(m,e){let o=Io(m),u=Io(e);return a.ak(u/o)}function jh(m,e){let o=m.rotate(e.bearingInRadians),u=e.zoom+ai(e.center.lat,0),d=a.bk(1/Io(e.center.lat),1/Io(Math.min(Math.abs(e.center.lat),60)),a.bn(u,7,3,0,1)),g=360/ul({worldSize:e.worldSize,center:{lat:e.center.lat}});return new a.S(e.center.lng-o.x*g*d,a.ah(e.center.lat+o.y*g,-a.ai,a.ai))}function Ka(m){let e=.5*m,o=Math.sin(e),u=Math.cos(e);return Math.log(o+u)-Math.log(u-o)}function zc(m,e,o,u){let d=m.lat+o*u;if(Math.abs(o)>1){let g=(Math.sign(m.lat+o)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+o)*Math.PI/180,T=Ka(g+u*(v-g)),S=Ka(g),E=Ka(v);return new a.S(m.lng+e*((T-S)/(E-S)),d)}return new a.S(m.lng+e*u,d)}class Lf{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,o,u,d){let g=`${e.z}_${e.x}_${e.y}_${d?.terrain?"t":""}`,v=this._cache.get(g);if(v)return v;let T=this._cachePrevious.get(g);if(T)return this._cache.set(g,T),T;let S=this._boundingVolumeFactory(e,o,u,d);return this._cache.set(g,S),this._hadAnyChanges=!0,S}}class da{constructor(e,o,u,d){this.min=u,this.max=d,this.points=e,this.planes=o}static fromAabb(e,o){let u=[];for(let d=0;d<8;d++)u.push([1&~d?e[0]:o[0],(d>>1&1)==1?o[1]:e[1],(d>>2&1)==1?o[2]:e[2]]);return new da(u,[[-1,0,0,o[0]],[1,0,0,-e[0]],[0,-1,0,o[1]],[0,1,0,-e[1]],[0,0,-1,o[2]],[0,0,1,-e[2]]],e,o)}static fromCenterSizeAngles(e,o,u){let d=a.br([],u[0],u[1],u[2]),g=a.bs([],[o[0],0,0],d),v=a.bs([],[0,o[1],0],d),T=a.bs([],[0,0,o[2]],d),S=[...e],E=[...e];for(let L=0;L<8;L++)for(let R=0;R<3;R++){let O=e[R]+g[R]*(1&~L?-1:1)+v[R]*((L>>1&1)==1?1:-1)+T[R]*((L>>2&1)==1?1:-1);S[R]=Math.min(S[R],O),E[R]=Math.max(E[R],O)}let C=[];for(let L=0;L<8;L++){let R=[...e];a.aS(R,R,a.aR([],g,1&~L?-1:1)),a.aS(R,R,a.aR([],v,(L>>1&1)==1?1:-1)),a.aS(R,R,a.aR([],T,(L>>2&1)==1?1:-1)),C.push(R)}return new da(C,[[...g,-a.aX(g,C[0])],[...v,-a.aX(v,C[0])],[...T,-a.aX(T,C[0])],[-g[0],-g[1],-g[2],-a.aX(g,C[7])],[-v[0],-v[1],-v[2],-a.aX(v,C[7])],[-T[0],-T[1],-T[2],-a.aX(T,C[7])]],S,E)}intersectsFrustum(e){let o=!0,u=this.points.length,d=this.planes.length,g=e.planes.length,v=e.points.length;for(let T=0;T<g;T++){let S=e.planes[T],E=0;for(let C=0;C<u;C++){let L=this.points[C];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&E++}if(E===0)return 0;E<u&&(o=!1)}if(o)return 2;for(let T=0;T<d;T++){let S=this.planes[T],E=0;for(let C=0;C<v;C++){let L=e.points[C];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){let o=this.points.length,u=0;for(let d=0;d<o;d++){let g=this.points[d];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&u++}return u===o?2:u===0?0:1}}function Fi(m,e,o){let u=m-e;return u<0?-u:Math.max(0,u-o)}function Xa(m,e,o,u,d){let g=m-o,v;return v=g<0?Math.min(-g,1+g-d):g>1?Math.min(Math.max(g-d,0),1-g):0,Math.max(v,Fi(e,u,d))}class ln{constructor(){this._boundingVolumeCache=new Lf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,o,u,d){let g=1<<u.z,v=1/g,T=u.x/g,S=u.y/g,E=2;return E=Math.min(E,Xa(e,o,T,S,v)),E=Math.min(E,Xa(e,o,T+.5,-S-v,v)),E=Math.min(E,Xa(e,o,T+.5,2-S-v,v)),E}getWrap(e,o,u){let d=1<<o.z,g=1/d,v=o.x/d,T=Fi(e.x,v,g),S=Fi(e.x,v-1,g),E=Fi(e.x,v+1,g),C=Math.min(T,S,E);return C===E?1:C===S?-1:0}allowVariableZoom(e,o){return Xe(e,o)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,o,u,d){return this._boundingVolumeCache.getTileBoundingVolume(e,o,u,d)}_computeTileBoundingVolume(e,o,u,d){var g,v;let T=0,S=0;if(d?.terrain){let E=new a.Z(e.z,o,e.z,e.x,e.y),C=d.terrain.getMinMaxElevation(E);T=(g=C.minElevation)!==null&&g!==void 0?g:Math.min(0,u),S=(v=C.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}if(T/=a.bu,S/=a.bu,T+=1,S+=1,e.z<=0)return da.fromAabb([-S,-S,-S],[S,S,S]);if(e.z===1)return da.fromAabb([e.x===0?-S:0,e.y===0?0:-S,-S],[e.x===0?0:S,e.y===0?S:0,S]);{let E=[Lr(0,0,e.x,e.y,e.z),Lr(a.$,0,e.x,e.y,e.z),Lr(a.$,a.$,e.x,e.y,e.z),Lr(0,a.$,e.x,e.y,e.z)],C=[];for(let ye of E)C.push(a.aR([],ye,S));if(S!==T)for(let ye of E)C.push(a.aR([],ye,T));e.y===0&&C.push([0,1,0]),e.y===(1<<e.z)-1&&C.push([0,-1,0]);let L=[1,1,1],R=[-1,-1,-1];for(let ye of C)for(let be=0;be<3;be++)L[be]=Math.min(L[be],ye[be]),R[be]=Math.max(R[be],ye[be]);let O=Lr(a.$/2,a.$/2,e.x,e.y,e.z),j=a.aW([],[0,1,0],O);a.aV(j,j);let H=a.aW([],O,j);a.aV(H,H);let W=a.aW([],E[2],E[1]);a.aV(W,W);let K=a.aW([],E[0],E[3]);a.aV(K,K),C.push(a.aR([],O,S)),e.y>=(1<<e.z)/2&&C.push(a.aR([],Lr(a.$/2,0,e.x,e.y,e.z),S)),e.y<(1<<e.z)/2&&C.push(a.aR([],Lr(a.$/2,a.$,e.x,e.y,e.z),S));let Y=Ya(O,C),te=Ya(H,C),J=[-O[0],-O[1],-O[2],Y.max],re=[O[0],O[1],O[2],-Y.min],ae=[-H[0],-H[1],-H[2],te.max],Q=[H[0],H[1],H[2],-te.min],de=[...W,0],we=[...K,0],ge=[];return e.y===0?ge.push(a.bt(we,de,J),a.bt(we,de,re)):ge.push(a.bt(ae,de,J),a.bt(ae,de,re),a.bt(ae,we,J),a.bt(ae,we,re)),e.y===(1<<e.z)-1?ge.push(a.bt(we,de,J),a.bt(we,de,re)):ge.push(a.bt(Q,de,J),a.bt(Q,de,re),a.bt(Q,we,J),a.bt(Q,we,re)),new da(ge,[J,re,ae,Q,de,we],L,R)}}}function Ya(m,e){let o=1/0,u=-1/0;for(let d of e){let g=a.aX(m,d);o=Math.min(o,g),u=Math.max(u,g)}return{min:o,max:u}}class Ja{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o){this._helper.resize(e,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._coveringTilesDetailsProvider=new ln}clone(){let e=new Ja;return e.apply(this),e}apply(e,o){this._globeLatitudeErrorCorrectionRadians=o||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=a.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:o,applyGlobeMatrix:u}=e,d=this._helper.getMercatorTileCoordinates(o);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let o=this.pitchInRadians,u=this.cameraToCenterDistance/e,d=Math.sin(o)*u,g=Math.cos(o)*u+1,v=1/Math.sqrt(d*d+g*g)*1,T=-d,S=g,E=Math.sqrt(T*T+S*S);T/=E,S/=E;let C=[0,T,S];a.bw(C,C,[0,0,0],-this.bearingInRadians),a.bx(C,C,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(C,C,[0,0,0],this.center.lng*Math.PI/180);let L=1/a.aZ(C);return a.aR(C,C,L),[...C,-v*L]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ei(e))}transformLightDirection(e){let o=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,d=Math.cos(u),g=[Math.sin(o)*d,Math.sin(u),Math.cos(o)*d],v=[g[2],0,-g[0]],T=[0,0,0];a.aW(T,v,g),a.aV(v,v),a.aV(T,T);let S=[0,0,0];return a.aV(S,[v[0]*e[0]+T[0]*e[1]+g[0]*e[2],v[1]*e[0]+T[1]*e[1]+g[1]*e[2],v[2]*e[0]+T[2]*e[1]+g[2]*e[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,o,u){let d=(function(T,S,E){let C=1/(1<<E.z);return new a.a1(T/a.$*C+E.x*C,S/a.$*C+E.y*C)})(e,o,u.canonical),g=(v=d.y,[a.bo(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,o,u,d){let g=u.canonical,v=Lr(e,o,g.x,g.y,g.z),T=1+(d?d(e,o):0)/a.bu,S=[v[0]*T,v[1]*T,v[2]*T,1];a.aw(S,S,this._globeViewProjMatrixNoCorrection);let E=this._cachedClippingPlane,C=E[0]*v[0]+E[1]*v[1]+E[2]*v[2]+E[3]<0;return{point:new a.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:C}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=ha(this.worldSize,this.center.lat),o=a.ba(),u=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),a.b4(o,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let d=this.centerOffset;o[8]=2*-d.x/this._helper._width,o[9]=2*d.y/this._helper._height,this._projectionMatrix=a.b5(o),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,o),a.M(o,o,[0,0,-this.cameraToCenterDistance]),a.b6(o,o,this.rollInRadians),a.b7(o,o,-this.pitchInRadians),a.b6(o,o,this.bearingInRadians),a.M(o,o,[0,0,-e]);let g=a.bp();g[0]=e,g[1]=e,g[2]=e,a.b7(u,o,this.center.lat*Math.PI/180),a.bz(u,u,-this.center.lng*Math.PI/180),a.N(u,u,g),this._globeViewProjMatrixNoCorrection=u,a.b7(o,o,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(o,o,-this.center.lng*Math.PI/180),a.N(o,o,g),this._globeViewProjMatrix32f=new Float32Array(o),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,u);let v=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,a.bw(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let T=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(T,T,[1,1,-1]),this._cachedFrustum=fi.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){a.w("calculateFogMatrix is not supported on globe projection.");let o=a.ba();return a.ag(o),o}getVisibleUnwrappedCoordinates(e){return[new a.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){if(!this._globeViewProjMatrixNoCorrection)return 1;let u=Ei(e);a.aR(u,u,1+o/a.bu);let d=a.bv();return a.aw(d,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){let e=.5*this.width,o=.5*this.height,u=[new a.P(0,0),new a.P(e,0),new a.P(this.width,0),new a.P(this.width,o),new a.P(this.width,this.height),new a.P(e,this.height),new a.P(0,this.height),new a.P(0,o)],d=[];for(let L of u)d.push(this.unprojectScreenPoint(L));let g=0,v=0,T=0,S=0,E=this.center;for(let L of d){let R=a.bA(E.lng,L.lng),O=a.bA(E.lat,L.lat);R<v&&(v=R),R>g&&(g=R),O<S&&(S=O),O>T&&(T=O)}let C=[E.lng+v,E.lat+S,E.lng+g,E.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(C[3]=90,C[0]=-180,C[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(C[1]=-90,C[0]=-180,C[2]=180),new ni(C)}getConstrained(e,o){let u=a.ah(e.lat,-a.ai,a.ai),d=a.ah(+o,this.minZoom+ai(0,u),this.maxZoom);return{center:new a.S(e.lng,u),zoom:d}}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}setLocationAtPoint(e,o){let u=Ei(this.unprojectScreenPoint(o)),d=Ei(e),g=a.bp();a.bB(g);let v=a.bp();a.by(v,u,g,-this.center.lng*Math.PI/180),a.bx(v,v,g,this.center.lat*Math.PI/180);let T=d[0]*d[0]+d[2]*d[2],S=v[0]*v[0];if(T<S)return;let E=Math.sqrt(T-S),C=-E,L=a.bC(d[0],d[2],v[0],E),R=a.bC(d[0],d[2],v[0],C),O=a.bp();a.by(O,d,g,-L);let j=a.bC(O[1],O[2],v[1],v[2]),H=a.bp();a.by(H,d,g,-R);let W=a.bC(H[1],H[2],v[1],v[2]),K=.5*Math.PI,Y=j>=-K&&j<=K,te=W>=-K&&W<=K,J,re;if(Y&&te){let we=this.center.lng*Math.PI/180,ge=this.center.lat*Math.PI/180;a.bD(L,we)+a.bD(j,ge)<a.bD(R,we)+a.bD(W,ge)?(J=L,re=j):(J=R,re=W)}else if(Y)J=L,re=j;else{if(!te)return;J=R,re=W}let ae=J/Math.PI*180,Q=re/Math.PI*180,de=this.center.lat;this.setCenter(new a.S(ae,a.ah(Q,-90,90))),this.setZoom(this.zoom+ai(de,this.center.lat))}locationToScreenPoint(e,o){let u=Ei(e);if(o){let d=o.getElevationForLngLatZoom(e,this._helper._tileZoom);a.aR(u,u,1+d/a.bu)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){let o=a.bv();return a.aw(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],new a.P((.5*o[0]+.5)*this.width,(.5*-o[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,o){if(o){let u=o.pointCoordinate(e);if(u)return u}return a.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,o){var u;return(u=this.screenPointToMercatorCoordinate(e,o))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,o){let u=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,d)}getRayDirectionFromPixel(e){let o=a.bv();o[0]=e.x/this.width*2-1,o[1]=-1*(e.y/this.height*2-1),o[2]=1,o[3]=1,a.aw(o,o,this._globeViewProjMatrixNoCorrectionInverted),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];let u=a.bp();u[0]=o[0]-this._cameraPosition[0],u[1]=o[1]-this._cameraPosition[1],u[2]=o[2]-this._cameraPosition[2];let d=a.bp();return a.aV(d,u),d}isSurfacePointVisible(e){let o=this._cachedClippingPlane;return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let o=a.bv();return a.aw(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3],o[0]>-1&&o[0]<1&&o[1]>-1&&o[1]<1&&o[2]>-1&&o[2]<1}rayPlanetIntersection(e,o){let u=a.aX(e,o),d=a.bp(),g=a.bp();a.aR(g,o,u),a.aU(d,e,g);let v=1-a.aX(d,d);if(v<0)return null;let T=a.aX(e,e)-1,S=-u+(u<0?1:-1)*Math.sqrt(v),E=T/S,C=S;return{tMin:Math.min(E,C),tMax:Math.max(E,C)}}unprojectScreenPoint(e){let o=this._cameraPosition,u=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(o,u);if(d){let C=a.bp();a.aS(C,o,[u[0]*d.tMin,u[1]*d.tMin,u[2]*d.tMin]);let L=a.bp();return a.aV(L,C),Ha(L)}let g=this._cachedClippingPlane,v=g[0]*u[0]+g[1]*u[1]+g[2]*u[2],T=-a.b1(g,o)/v,S=a.bp();if(T>0)a.aS(S,o,[u[0]*T,u[1]*T,u[2]*T]);else{let C=a.bp();a.aS(C,o,[2*u[0],2*u[1],2*u[2]]);let L=a.b1(this._cachedClippingPlane,C);a.aU(S,C,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}let E=(function(C){let L=a.bp();return L[0]=C[0]*-C[3],L[1]=C[1]*-C[3],L[2]=C[2]*-C[3],{center:L,radius:Math.sqrt(1-C[3]*C[3])}})(g);return Ha((function(C,L,R){let O=a.bp();a.aU(O,R,C);let j=a.bp();return a.bq(j,C,O,L/a.a$(O)),j})(E.center,E.radius,S))}getMatrixForModel(e,o){let u=a.S.convert(e),d=1/a.bu,g=a.b9();return a.bz(g,g,u.lng/180*Math.PI),a.b7(g,g,-u.lat/180*Math.PI),a.M(g,g,[0,0,1+o/a.bu]),a.b7(g,g,.5*Math.PI),a.N(g,g,[d,d,d]),g}getProjectionDataForCustomLayer(e=!0){let o=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:e});return o.tileMercatorCoords=[0,0,1,1],o}getFastPathSimpleProjectionMatrix(e){}}class Qa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,u=!0){this._helper.resize(e,o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,o){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=o,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._globeness=1,this._mercatorTransform=new $t,this._verticalPerspectiveTransform=new Ja}clone(){let e=new Qa;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let o=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:o.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:o.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,o,u){let d=this._mercatorTransform.getPitchedTextCorrection(e,o,u),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,o,u);return a.bk(d,g,this._globeness)}projectTileCoordinates(e,o,u,d){return this.currentTransform.projectTileCoordinates(e,o,u,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){return this.currentTransform.lngLatToCameraDepth(e,o)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,o){return this.currentTransform.getConstrained(e,o)}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}setLocationAtPoint(e,o){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,o),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,o),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,o){return this.currentTransform.locationToScreenPoint(e,o)}screenPointToMercatorCoordinate(e,o){return this.currentTransform.screenPointToMercatorCoordinate(e,o)}screenPointToLocation(e,o){return this.currentTransform.screenPointToLocation(e,o)}isPointOnMapSurface(e,o){return this.currentTransform.isPointOnMapSurface(e,o)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,o){return this.currentTransform.getMatrixForModel(e,o)}getProjectionDataForCustomLayer(e=!0){let o=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return o;let u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=o.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Zi{get useGlobeControls(){return!0}handlePanInertia(e,o){let u=jh(e,o);return Math.abs(u.lng-o.center.lng)>180&&(u.lng=o.center.lng+179.5*Math.sign(u.lng-o.center.lng)),{easingCenter:u,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,o){let u=e.around,d=o.screenPointToLocation(u);e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta);let g=o.zoom;e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta);let v=o.zoom-g;if(v===0)return;let T=a.bA(o.center.lng,d.lng),S=T/(Math.abs(T/180)+1),E=a.bA(o.center.lat,d.lat),C=o.getRayDirectionFromPixel(u),L=o.cameraPosition,R=-1*a.aX(L,C),O=a.bp();a.aS(O,L,[C[0]*R,C[1]*R,C[2]*R]);let j=a.aZ(O)-1,H=Math.exp(.5*-Math.max(j-.3,0)),W=ha(o.worldSize,o.center.lat)/Math.min(o.width,o.height),K=a.bn(W,.9,.5,1,.25),Y=(1-a.af(-v))*Math.min(H,K),te=o.center.lat,J=o.zoom,re=new a.S(o.center.lng+S*Y,a.ah(o.center.lat+E*Y,-a.ai,a.ai));o.setLocationAtPoint(d,u);let ae=o.center,Q=a.bn(Math.abs(T),45,85,0,1),de=a.bn(W,.75,.35,0,1),we=Math.pow(Math.max(Q,de),.25),ge=a.bA(ae.lng,re.lng),ye=a.bA(ae.lat,re.lat);o.setCenter(new a.S(ae.lng+ge*we,ae.lat+ye*we).wrap()),o.setZoom(J+ai(te,o.center.lat))}handleMapControlsPan(e,o,u){if(!e.panDelta)return;let d=o.center.lat,g=o.zoom;o.setCenter(jh(e.panDelta,o).wrap()),o.setZoom(g+ai(d,o.center.lat))}cameraForBoxAndBearing(e,o,u,d,g){let v=mr(e,o,u,d,g),T=o.left/g.width*2-1,S=(g.width-o.right)/g.width*2-1,E=o.top/g.height*-2+1,C=(g.height-o.bottom)/g.height*-2+1,L=a.bA(u.getWest(),u.getEast())<0,R=L?u.getEast():u.getWest(),O=L?u.getWest():u.getEast(),j=Math.max(u.getNorth(),u.getSouth()),H=Math.min(u.getNorth(),u.getSouth()),W=R+.5*a.bA(R,O),K=j+.5*a.bA(j,H),Y=g.clone();Y.setCenter(v.center),Y.setBearing(v.bearing),Y.setPitch(0),Y.setRoll(0),Y.setZoom(v.zoom);let te=Y.modelViewProjectionMatrix,J=[Ei(u.getNorthWest()),Ei(u.getNorthEast()),Ei(u.getSouthWest()),Ei(u.getSouthEast()),Ei(new a.S(O,K)),Ei(new a.S(R,K)),Ei(new a.S(W,j)),Ei(new a.S(W,H))],re=Ei(v.center),ae=Number.POSITIVE_INFINITY;for(let Q of J)T<0&&(ae=Zi.getLesserNonNegativeNonNull(ae,Zi.solveVectorScale(Q,re,te,"x",T))),S>0&&(ae=Zi.getLesserNonNegativeNonNull(ae,Zi.solveVectorScale(Q,re,te,"x",S))),E>0&&(ae=Zi.getLesserNonNegativeNonNull(ae,Zi.solveVectorScale(Q,re,te,"y",E))),C<0&&(ae=Zi.getLesserNonNegativeNonNull(ae,Zi.solveVectorScale(Q,re,te,"y",C)));if(Number.isFinite(ae)&&ae!==0)return v.zoom=Y.zoom+a.ak(ae),v;Uh()}handleJumpToCenterZoom(e,o){let u=e.center.lat,d=e.getConstrained(o.center?a.S.convert(o.center):e.center,e.zoom).center;e.setCenter(d.wrap());let g=o.zoom!==void 0?+o.zoom:e.zoom+ai(u,d.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,o){let u=e.zoom,d=e.center,g=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},S=o.zoom!==void 0,E=!e.isPaddingEqual(o.padding),C=!1,L=o.center?a.S.convert(o.center):d,R=e.getConstrained(L,u).center;ol(e,R);let O=e.clone();O.setCenter(R),O.setZoom(S?+o.zoom:u+ai(d.lat,L.lat)),O.setBearing(o.bearing);let j=new a.P(a.ah(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),a.ah(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(R,j);let H=(o.offset&&o.offsetAsPoint.mag())>0?O.center:R,W=S?+o.zoom:u+ai(d.lat,H.lat),K=u+ai(d.lat,0),Y=W+ai(H.lat,0),te=a.bA(d.lng,H.lng),J=a.bA(d.lat,H.lat),re=a.af(Y-K);return C=W!==u,{easeFunc:ae=>{if(a.be(v,T)||Qi({startEulerAngles:v,endEulerAngles:T,tr:e,k:ae,useSlerp:v.roll!=T.roll}),E&&e.interpolatePadding(g,o.padding,ae),o.around)a.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(o.around,o.aroundPoint);else{let Q=Y>K?Math.min(2,re):Math.max(.5,re),de=Math.pow(Q,1-ae),we=zc(d,te,J,ae*de);e.setCenter(we.wrap())}if(C){let Q=a.C.number(K,Y,ae)+ai(0,e.center.lat);e.setZoom(Q)}},isZooming:C,elevationCenter:H}}handleFlyTo(e,o){let u=o.zoom!==void 0,d=e.center,g=e.zoom,v=e.padding,T=!e.isPaddingEqual(o.padding),S=e.getConstrained(a.S.convert(o.center||o.locationAtOffset),g).center,E=u?+o.zoom:e.zoom+ai(e.center.lat,S.lat),C=e.clone();C.setCenter(S),C.setZoom(E),C.setBearing(o.bearing);let L=new a.P(a.ah(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),a.ah(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));C.setLocationAtPoint(S,L);let R=C.center;ol(e,R);let O=(function(J,re,ae){let Q=Ei(re),de=Ei(ae),we=a.aX(Q,de),ge=Math.acos(we),ye=ul(J);return ge/(2*Math.PI)*ye})(e,d,R),j=g+ai(d.lat,0),H=E+ai(R.lat,0),W=a.af(H-j),K;if(typeof o.minZoom=="number"){let J=+o.minZoom+ai(R.lat,0),re=Math.min(J,j,H)+ai(0,R.lat),ae=e.getConstrained(R,re).zoom+ai(R.lat,0);K=a.af(ae-j)}let Y=a.bA(d.lng,R.lng),te=a.bA(d.lat,R.lat);return{easeFunc:(J,re,ae,Q)=>{let de=zc(d,Y,te,ae);T&&e.interpolatePadding(v,o.padding,J);let we=J===1?R:de;e.setCenter(we.wrap());let ge=j+a.ak(re);e.setZoom(J===1?E:ge+ai(0,we.lat))},scaleOfZoom:W,targetCenter:R,scaleOfMinZoom:K,pixelPathLength:O}}static solveVectorScale(e,o,u,d,g){let v=d==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],T=[u[3],u[7],u[11],u[15]],S=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],E=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],C=o[0]*v[0]+o[1]*v[1]+o[2]*v[2],L=o[0]*T[0]+o[1]*T[1]+o[2]*T[2];return C+g*E===S+g*L||T[3]*(S-C)+v[3]*(L-E)+S*L==C*E?null:(C+v[3]-g*L-g*T[3])/(C-S-g*L+g*E)}static getLesserNonNegativeNonNull(e,o){return o!==null&&o>=0&&o<e?o:e}}class Vh{constructor(e){this._globe=e,this._mercatorCameraHelper=new qi,this._verticalPerspectiveCameraHelper=new Zi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,o){return this.currentHelper.handlePanInertia(e,o)}handleMapControlsRollPitchBearingZoom(e,o){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,o)}handleMapControlsPan(e,o,u){this.currentHelper.handleMapControlsPan(e,o,u)}cameraForBoxAndBearing(e,o,u,d,g){return this.currentHelper.cameraForBoxAndBearing(e,o,u,d,g)}handleJumpToCenterZoom(e,o){this.currentHelper.handleJumpToCenterZoom(e,o)}handleEaseTo(e,o){return this.currentHelper.handleEaseTo(e,o)}handleFlyTo(e,o){return this.currentHelper.handleFlyTo(e,o)}}let hl=(m,e)=>a.y(m,e&&e.filter((o=>o.identifier!=="source.canvas"))),Df=a.bE();class Oc extends a.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(let u in this.sourceCaches){let d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new ar(yo(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,d)=>this.getGlyphs(u,d))),this.dispatcher.registerMessageHandler("GI",((u,d)=>this.getImages(u,d))),this.imageManager=new Vi,this.imageManager.setEventedParent(this),this.glyphManager=new Qr(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new ca,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),qn().on(vo,this._rtlPluginLoaded),this.on("data",(u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;let d=this.sourceCaches[u.sourceId];if(!d)return;let g=d.getSource();if(g&&g.vectorLayerIds)for(let v in this._layers){let T=this._layers[v];T.source===g.id&&this._validateLayer(T)}}))}setGlobalStateProperty(e,o){var u,d,g;this._checkLoaded();let v=o===null?(g=(d=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||d===void 0?void 0:d.default)!==null&&g!==void 0?g:null:o;if(a.bH(v,this._globalState[e]))return this;this._globalState[e]=v;let T=this._findGlobalStateAffectedSources([e]);for(let S in this.sourceCaches)T.has(S)&&(this._reloadSource(S),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let o=[];for(let d in e)!a.bH(this._globalState[d],e[d].default)&&(o.push(d),this._globalState[d]=e[d].default);let u=this._findGlobalStateAffectedSources(o);for(let d in this.sourceCaches)u.has(d)&&(this._reloadSource(d),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;let o=new Set;for(let u in this._layers){let d=this._layers[u],g=d.getLayoutAffectingGlobalStateRefs();for(let v of e)g.has(v)&&o.add(d.source)}return o}loadURL(e,o={},u){this.fire(new a.l("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;let d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let g=this._loadStyleRequest;a.j(d,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,o,u)})).catch((v=>{this._loadStyleRequest=null,v&&!g.signal.aborted&&this.fire(new a.k(v))}))}loadJSON(e,o={},u){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)})).catch((()=>{}))}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Df,{validate:!1})}_load(e,o,u){var d,g,v;let T=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!hl(this,a.z(T))){this._loaded=!0,this.stylesheet=T;for(let S in T.sources)this.addSource(S,T.sources[S],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new vn(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Jo(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((v=this.stylesheet.state)!==null&&v!==void 0?v:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){let e=a.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((o=>o.id)),this._layers={},this._serializedLayers=null;for(let o of e){let u=a.bJ(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,v,T,S){return a._(this,void 0,void 0,(function*(){let E=rt(g),C=T>1?"@2x":"",L={},R={};for(let{id:O,url:j}of E){let H=v.transformRequest(qe(j,C,".json"),"SpriteJSON");L[O]=a.j(H,S);let W=v.transformRequest(qe(j,C,".png"),"SpriteImage");R[O]=Re.getImage(W,S)}return yield Promise.all([...Object.values(L),...Object.values(R)]),(function(O,j){return a._(this,void 0,void 0,(function*(){let H={};for(let W in O){H[W]={};let K=B.getImageCanvasContext((yield j[W]).data),Y=(yield O[W]).data;for(let te in Y){let{width:J,height:re,x:ae,y:Q,sdf:de,pixelRatio:we,stretchX:ge,stretchY:ye,content:be,textFitWidth:Le,textFitHeight:Oe}=Y[te];H[W][te]={data:null,pixelRatio:we,sdf:de,stretchX:ge,stretchY:ye,content:be,textFitWidth:Le,textFitHeight:Oe,spriteData:{width:J,height:re,x:ae,y:Q,context:K}}}}return H}))})(L,R)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(let v in g){this._spritesImagesIds[v]=[];let T=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((S=>!(S in g))):[];for(let S of T)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(let S in g[v]){let E=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[v][S],!1):this.imageManager.addImage(E,g[v][S]),o&&(this._changedImages[E]=!0)}}})).catch((g=>{this._spriteRequest=null,d=g,this.fire(new a.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),u&&u(d)}))}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(e){let o=this.sourceCaches[e.source];if(!o)return;let u=e.sourceLayer;if(!u)return;let d=o.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new a.k(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){let u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?a.bK(u):u);let d=[];for(let g of e)if(u[g]){let v=o?a.bK(u[g]):u[g];d.push(v)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let o=Object.keys(this._layers);for(let u of o){let d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){var e,o,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((o=this.sky)===null||o===void 0)&&o.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(let d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(let d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let o=this._changed;if(o){let d=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(d.length||g.length)&&this._updateWorkerLayers(d,g);for(let v in this._updatedSources){let T=this._updatedSources[v];if(T==="reload")this._reloadSource(v);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let u={};for(let d in this.sourceCaches){let g=this.sourceCaches[d];u[d]=g.used,g.used=!1}for(let d of this._order){let g=this._layers[d];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(let d in u){let g=this.sourceCaches[d];!!u[d]!=!!g.used&&g.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,o&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();let d=this.serialize();if(e=o.transformStyle?o.transformStyle(d,e):e,((u=o.validate)===null||u===void 0||u)&&hl(this,a.z(e)))return!1;(e=a.bK(e)).layers=a.bI(e.layers);let g=a.bL(d,e),v=this._getOperationsToPerform(g);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(let T of v.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let o=[],u=[];for(let d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":o.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":o.push((()=>{}));break;default:u.push(d.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new a.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(a.z.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let d=this.sourceCaches[e]=new vt(e,o,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let u in this._layers)if(this._layers[u].source===e)return this.fire(new a.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));let o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();let d=e.id;if(this.getLayer(d))return void this.fire(new a.k(new Error(`Layer "${d}" already exists on this map.`)));let g;if(e.type==="custom"){if(hl(this,a.bM(e)))return;g=a.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=a.bK(e),e=a.e(e,{source:d})),this._validate(a.z.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;g=a.bJ(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:d}})}let v=o?this._order.indexOf(o):this._order.length;if(o&&v===-1)this.fire(new a.k(new Error(`Cannot add layer "${d}" before non-existing layer "${o}".`)));else{if(this._order.splice(v,0,d),this._layerOrderChanged=!0,this._layers[d]=g,this._removedLayers[d]&&g.source&&g.type!=="custom"){let T=this._removedLayers[d];delete this._removedLayers[d],T.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new a.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;let u=this._order.indexOf(e);this._order.splice(u,1);let d=o?this._order.indexOf(o):this._order.length;o&&d===-1?this.fire(new a.k(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let o=this._layers[e];if(!o)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);let u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();let d=this.getLayer(e);d?d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();let d=this.getLayer(e);if(d){if(!a.bH(d.filter,o))return o==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(a.z.filter,`layers.${d.id}.filter`,o,null,u)||(d.setFilter(a.bK(o)),this._updateLayer(d)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return a.bK(this.getLayer(e).filter)}setLayoutProperty(e,o,u,d={}){this._checkLoaded();let g=this.getLayer(e);g?a.bH(g.getLayoutProperty(o),u)||(g.setLayoutProperty(o,u,d),this._updateLayer(g)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){let u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,d={}){this._checkLoaded();let g=this.getLayer(e);g?a.bH(g.getPaintProperty(o),u)||(g.setPaintProperty(o,u,d)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();let u=e.source,d=e.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new a.k(new Error(`The source '${u}' does not exist in the map's style.`)));let v=g.getSource().type;v==="geojson"&&d?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||d?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(d,e.id,o)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();let u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new a.k(new Error(`The source '${u}' does not exist in the map's style.`)));let g=d.getSource().type,v=g==="vector"?e.sourceLayer:void 0;g!=="vector"||v?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(v,e.id,o):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let o=e.source,u=e.sourceLayer,d=this.sourceCaches[o];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=a.bN(this.sourceCaches,(g=>g.serialize())),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return a.bO({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:o,terrain:u},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let o=v=>this._layers[v].type==="fill-extrusion",u={},d=[];for(let v=this._order.length-1;v>=0;v--){let T=this._order[v];if(o(T)){u[T]=v;for(let S of e){let E=S[T];if(E)for(let C of E)d.push(C)}}}d.sort(((v,T)=>T.intersectionZ-v.intersectionZ));let g=[];for(let v=this._order.length-1;v>=0;v--){let T=this._order[v];if(o(T))for(let S=d.length-1;S>=0;S--){let E=d[S].feature;if(u[E.layer.id]<v)break;g.push(E),d.pop()}else for(let S of e){let E=S[T];if(E)for(let C of E)g.push(C.feature)}}return g}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",o.filter,null,o);let d={};if(o&&o.layers){if(!(Array.isArray(o.layers)||o.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let E of o.layers){let C=this._layers[E];if(!C)return this.fire(new a.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];d[C.source]=!0}}let g=[];o.availableImages=this._availableImages;let v=this._serializedAllLayers(),T=o.layers instanceof Set?o.layers:Array.isArray(o.layers)?new Set(o.layers):null,S=Object.assign(Object.assign({},o),{layers:T});for(let E in this.sourceCaches)o.layers&&!d[E]||g.push(Mr(this.sourceCaches[E],this._layers,v,e,S,u,this.map.terrain?(C,L,R)=>this.map.terrain.getElevation(C,L,R):void 0));return this.placement&&g.push((function(E,C,L,R,O,j,H){let W={},K=j.queryRenderedSymbols(R),Y=[];for(let te of Object.keys(K).map(Number))Y.push(H[te]);Y.sort(ea);for(let te of Y){let J=te.featureIndex.lookupSymbolFeatures(K[te.bucketInstanceId],C,te.bucketIndex,te.sourceLayerIndex,O.filter,O.layers,O.availableImages,E);for(let re in J){let ae=W[re]=W[re]||[],Q=J[re];Q.sort(((de,we)=>{let ge=te.featureSortOrder;if(ge){let ye=ge.indexOf(de.featureIndex);return ge.indexOf(we.featureIndex)-ye}return we.featureIndex-de.featureIndex}));for(let de of Q)ae.push(de)}}return(function(te,J,re){for(let ae in te)for(let Q of te[ae])ta(Q,re[J[ae].source]);return te})(W,E,L)})(this._layers,v,this.sourceCaches,e,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,o){o&&o.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",o.filter,null,o);let u=this.sourceCaches[e];return u?(function(d,g){let v=d.getRenderableIds().map((E=>d.getTileByID(E))),T=[],S={};for(let E=0;E<v.length;E++){let C=v[E],L=C.tileID.canonical.key;S[L]||(S[L]=!0,C.querySourceFeatures(T,g))}return T})(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();let u=this.light.getLight(),d=!1;for(let v in e)if(!a.bH(e[v],u[v])){d=!0;break}if(!d)return;let g={now:B.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){this._checkLoaded();let u=this.getSky(),d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(let v in e)if(!a.bH(e[v],u[v])){d=!0;break}if(!d)return;let g={now:B.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(g)}_setProjectionInternal(e){let o=(function(u){if(Array.isArray(u)){let d=new cl({type:u});return{projection:d,transform:new Qa,cameraHelper:new Vh(d)}}switch(u){case"mercator":return{projection:new wt,transform:new $t,cameraHelper:new qi};case"globe":{let d=new cl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Qa,cameraHelper:new Vh(d)}}case"vertical-perspective":return{projection:new Wa,transform:new Ja,cameraHelper:new Zi};default:return a.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new wt,transform:new $t,cameraHelper:new qi}}})(e);this.projection=o.projection,this.map.migrateProjection(o.transform,o.cameraHelper);for(let u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,o,u,d,g={}){return(!g||g.validate!==!1)&&hl(this,e.call(a.z,a.e({key:o,style:this.serialize(),value:u,styleSpec:a.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qn().off(vo,this._rtlPluginLoaded);for(let o in this._layers)this._layers[o].setEventedParent(null);for(let o in this.sourceCaches){let u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,d,g=!1){let v=!1,T=!1,S={};for(let E of this._order){let C=this._layers[E];if(C.type!=="symbol")continue;if(!S[C.source]){let R=this.sourceCaches[C.source];S[C.source]=R.getRenderableIds(!0).map((O=>R.getTileByID(O))).sort(((O,j)=>j.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(j.tileID)?-1:1)))}let L=this.crossTileSymbolIndex.addLayer(C,S[C.source],e.center.lng);v=v||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(B.now(),e.zoom))&&(this.pauseablePlacement=new kc(e,this.map.terrain,this._order,g,o,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(B.now()),T=!0),v&&this.pauseablePlacement.placement.setStale()),T||v)for(let E of this._order){let C=this._layers[E];C.type==="symbol"&&this.placement.updateLayerOpacities(C,S[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(B.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return a._(this,void 0,void 0,(function*(){let u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();let d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,o.icons),u}))}getGlyphs(e,o){return a._(this,void 0,void 0,(function*(){let u=yield this.glyphManager.getGlyphs(o.stacks),d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(a.z.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},d){this._checkLoaded();let g=[{id:e,url:o}],v=[...rt(this.stylesheet.sprite),...g];this._validate(a.z.sprite,"sprite",v,null,u)||(this.stylesheet.sprite=v,this._loadSprite(g,!0,d))}removeSprite(e){this._checkLoaded();let o=rt(this.stylesheet.sprite);if(o.find((u=>u.id===e))){if(this._spritesImagesIds[e])for(let u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex((u=>u.id===e)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return rt(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(a.z.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var zf=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Of{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,d,g,v,T,S,E){this.context=e;let C=this.boundPaintVertexBuffers.length!==d.length;for(let L=0;!C&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(C=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||C||this.boundIndexBuffer!==g||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==E?this.freshBind(o,u,d,g,v,T,S,E):(e.bindVertexArray.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),S&&S.bind(),E&&E.bind())}freshBind(e,o,u,d,g,v,T,S){let E=e.numAttributes,C=this.context,L=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=S,o.enableAttributes(L,e);for(let R of u)R.enableAttributes(L,e);v&&v.enableAttributes(L,e),T&&T.enableAttributes(L,e),S&&S.enableAttributes(L,e),o.bind(),o.setVertexAttribPointers(L,e,g);for(let R of u)R.bind(),R.setVertexAttribPointers(L,e,g);v&&(v.bind(),v.setVertexAttribPointers(L,e,g)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(L,e,g)),S&&(S.bind(),S.setVertexAttribPointers(L,e,g)),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let dl=(m,e,o,u,d)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:o?o.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:o?o.calculateFogBlendOpacity(u):0,u_horizon_color:o?o.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),Fc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Po(m){let e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;let u=m[o].split(" ");e.push(u.pop())}return e}class Nc{constructor(e,o,u,d,g,v,T,S,E=[]){let C=e.gl;this.program=C.createProgram();let L=Po(o.staticAttributes),R=u?u.getBinderAttributes():[],O=L.concat(R),j=Rr.prelude.staticUniforms?Po(Rr.prelude.staticUniforms):[],H=T.staticUniforms?Po(T.staticUniforms):[],W=o.staticUniforms?Po(o.staticUniforms):[],K=u?u.getBinderUniforms():[],Y=j.concat(H).concat(W).concat(K),te=[];for(let ge of Y)te.indexOf(ge)<0&&te.push(ge);let J=u?u.defines():[];an(C)&&J.unshift("#version 300 es"),g&&J.push("#define OVERDRAW_INSPECTOR;"),v&&J.push("#define TERRAIN3D;"),S&&J.push(S),E&&J.push(...E);let re=J.concat(Rr.prelude.fragmentSource,T.fragmentSource,o.fragmentSource).join(`
`),ae=J.concat(Rr.prelude.vertexSource,T.vertexSource,o.vertexSource).join(`
`);an(C)||(re=(function(ge){return ge.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(re),ae=(function(ge){return ge.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ae));let Q=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Q,re),C.compileShader(Q),!C.getShaderParameter(Q,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(Q)}`);C.attachShader(this.program,Q);let de=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(de,ae),C.compileShader(de),!C.getShaderParameter(de,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(de)}`);C.attachShader(this.program,de),this.attributes={};let we={};this.numAttributes=O.length;for(let ge=0;ge<this.numAttributes;ge++)O[ge]&&(C.bindAttribLocation(this.program,ge,O[ge]),this.attributes[O[ge]]=ge);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(de),C.deleteShader(Q);for(let ge=0;ge<te.length;ge++){let ye=te[ge];if(ye&&!we[ye]){let be=C.getUniformLocation(this.program,ye);be&&(we[ye]=be)}}this.fixedUniforms=d(e,we),this.terrainUniforms=((ge,ye)=>({u_depth:new a.bP(ge,ye.u_depth),u_terrain:new a.bP(ge,ye.u_terrain),u_terrain_dim:new a.bg(ge,ye.u_terrain_dim),u_terrain_matrix:new a.bR(ge,ye.u_terrain_matrix),u_terrain_unpack:new a.bS(ge,ye.u_terrain_unpack),u_terrain_exaggeration:new a.bg(ge,ye.u_terrain_exaggeration)}))(e,we),this.projectionUniforms=((ge,ye)=>({u_projection_matrix:new a.bR(ge,ye.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(ge,ye.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(ge,ye.u_projection_clipping_plane),u_projection_transition:new a.bg(ge,ye.u_projection_transition),u_projection_fallback_matrix:new a.bR(ge,ye.u_projection_fallback_matrix)}))(e,we),this.binderUniforms=u?u.getUniforms(e,we):[]}draw(e,o,u,d,g,v,T,S,E,C,L,R,O,j,H,W,K,Y,te){let J=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(g),e.setCullFace(v),S){e.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,S.depthTexture),e.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,S.texture);for(let ae in this.terrainUniforms)this.terrainUniforms[ae].set(S[ae])}if(E)for(let ae in E)this.projectionUniforms[Fc[ae]].set(E[ae]);if(T)for(let ae in this.fixedUniforms)this.fixedUniforms[ae].set(T[ae]);W&&W.setUniforms(e,this.binderUniforms,j,{zoom:H});let re=0;switch(o){case J.LINES:re=2;break;case J.TRIANGLES:re=3;break;case J.LINE_STRIP:re=1}for(let ae of O.get()){let Q=ae.vaos||(ae.vaos={});(Q[C]||(Q[C]=new Of)).bind(e,this,L,W?W.getPaintVertexBuffers():[],R,ae.vertexOffset,K,Y,te),J.drawElements(o,ae.primitiveLength*re,J.UNSIGNED_SHORT,ae.primitiveOffset*re*2)}}}function pl(m,e,o){let u=1/a.aC(o,1,e.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,e.transform.tileZoom)/d,v=g*(o.tileID.canonical.x+o.tileID.wrap*d),T=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}let Dr=(m,e,o,u)=>{let d=m.style.light,g=d.properties.get("position"),v=[g.x,g.y,g.z],T=a.bV();d.properties.get("anchor")==="viewport"&&a.bW(T,m.transform.bearingInRadians),a.bX(v,v,T);let S=m.transform.transformLightDirection(v),E=d.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:o,u_fill_translate:u}},Ff=(m,e,o,u,d,g,v)=>a.e(Dr(m,e,o,u),pl(g,m,v),{u_height_factor:-Math.pow(2,d.overscaledZ)/v.tileSize/8}),fl=(m,e,o,u)=>a.e(pl(e,m,o),{u_fill_translate:u}),es=(m,e)=>({u_world:m,u_fill_translate:e}),ts=(m,e,o,u,d)=>a.e(fl(m,e,o,d),{u_world:u}),Nf=(m,e,o,u,d)=>{let g=m.transform,v,T,S=0;if(o.paint.get("circle-pitch-alignment")==="map"){let E=a.aC(e,1,g.zoom);v=!0,T=[E,E],S=E/(a.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else v=!1,T=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:S,u_translate:u}},ml=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Bf=m=>({u_viewport_size:[m.width,m.height]}),Eo=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),$h=(m,e,o,u)=>{let d=a.aC(m,1,e)/(a.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:a.aC(m,1,e),u_intensity:o,u_globe_extrude_scale:d}},Bc=(m,e,o,u)=>{let d=a.L();a.bY(d,0,m.width,m.height,0,0,1);let g=m.context.gl;return{u_matrix:d,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},Uf=(m,e,o)=>{let u=o.paint.get("hillshade-accent-color"),d;switch(o.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}let g=o.getIlluminationProperties();for(let v=0;v<g.directionRadians.length;v++)o.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Uc(0,e.tileID),u_exaggeration:o.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:u,u_method:d,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Gh=(m,e)=>{let o=e.stride,u=a.L();return a.bY(u,0,a.$,-a.$,0,0,1),a.M(u,u,[0,-a.$,0]),{u_matrix:u,u_image:1,u_dimension:[o,o],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Uc(m,e){let o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new a.a1(0,u/o).toLngLat().lat,new a.a1(0,(u+1)/o).toLngLat().lat]}let qh=(m,e,o=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:o,u_opacity:m.paint.get("color-relief-opacity")}),gl=(m,e,o,u)=>{let d=m.transform;return{u_translation:Vc(m,e,o),u_ratio:u/a.aC(e,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Zh=(m,e,o,u,d)=>a.e(gl(m,e,o,u),{u_image:0,u_image_height:d}),Wh=(m,e,o,u,d)=>{let g=m.transform,v=jc(e,g);return{u_translation:Vc(m,e,o),u_texsize:e.imageAtlasTexture.size,u_ratio:u/a.aC(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ao=(m,e,o,u,d,g)=>{let v=m.lineAtlas,T=jc(e,m.transform),S=o.layout.get("line-cap")==="round",E=v.getDash(d.from,S),C=v.getDash(d.to,S),L=E.width*g.fromScale,R=C.width*g.toScale;return a.e(gl(m,e,o,u),{u_patternscale_a:[T/L,-E.height/2],u_patternscale_b:[T/R,-C.height/2],u_sdfgamma:v.width/(256*Math.min(L,R)*m.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:C.y,u_mix:g.t})};function jc(m,e){return 1/a.aC(m,1,e.tileZoom)}function Vc(m,e,o){return a.aD(m.transform,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}let is=(m,e,o,u,d)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=u.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:jf(u.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var g,v};function jf(m){m*=Math.PI/180;let e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}let rs=(m,e,o,u,d,g,v,T,S,E,C,L,R)=>{let O=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:O.width/O.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:g,u_texsize:L,u_texture:0,u_translation:E,u_pitched_scale:R}},Hh=(m,e,o,u,d,g,v,T,S,E,C,L,R,O)=>{let j=v.transform;return a.e(rs(m,e,o,u,d,g,v,T,S,E,C,L,O),{u_gamma_scale:u?Math.cos(j.pitch*Math.PI/180)*j.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Vf=(m,e,o,u,d,g,v,T,S,E,C,L,R)=>a.e(Hh(m,e,o,u,d,g,v,T,S,E,!0,C,0,R),{u_texsize_icon:L,u_texture_icon:1}),Kh=(m,e)=>({u_opacity:m,u_color:e}),Xh=(m,e,o,u,d)=>a.e((function(g,v,T,S){let E=T.imageManager.getPattern(g.from.toString()),C=T.imageManager.getPattern(g.to.toString()),{width:L,height:R}=T.imageManager.getPixelSize(),O=Math.pow(2,S.tileID.overscaledZ),j=S.tileSize*Math.pow(2,T.transform.tileZoom)/O,H=j*(S.tileID.canonical.x+S.tileID.wrap*O),W=j*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:C.tl,u_pattern_br_b:C.br,u_texsize:[L,R],u_mix:v.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:C.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/a.aC(S,1,T.transform.tileZoom),u_pixel_coord_upper:[H>>16,W>>16],u_pixel_coord_lower:[65535&H,65535&W]}})(o,d,e,u),{u_opacity:m}),$c=(m,e)=>{},Gc={fillExtrusion:(m,e)=>({u_lightpos:new a.bT(m,e.u_lightpos),u_lightpos_globe:new a.bT(m,e.u_lightpos_globe),u_lightintensity:new a.bg(m,e.u_lightintensity),u_lightcolor:new a.bT(m,e.u_lightcolor),u_vertical_gradient:new a.bg(m,e.u_vertical_gradient),u_opacity:new a.bg(m,e.u_opacity),u_fill_translate:new a.bU(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new a.bT(m,e.u_lightpos),u_lightpos_globe:new a.bT(m,e.u_lightpos_globe),u_lightintensity:new a.bg(m,e.u_lightintensity),u_lightcolor:new a.bT(m,e.u_lightcolor),u_vertical_gradient:new a.bg(m,e.u_vertical_gradient),u_height_factor:new a.bg(m,e.u_height_factor),u_opacity:new a.bg(m,e.u_opacity),u_fill_translate:new a.bU(m,e.u_fill_translate),u_image:new a.bP(m,e.u_image),u_texsize:new a.bU(m,e.u_texsize),u_pixel_coord_upper:new a.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,e.u_pixel_coord_lower),u_scale:new a.bT(m,e.u_scale),u_fade:new a.bg(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new a.bU(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new a.bP(m,e.u_image),u_texsize:new a.bU(m,e.u_texsize),u_pixel_coord_upper:new a.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,e.u_pixel_coord_lower),u_scale:new a.bT(m,e.u_scale),u_fade:new a.bg(m,e.u_fade),u_fill_translate:new a.bU(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new a.bU(m,e.u_world),u_fill_translate:new a.bU(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new a.bU(m,e.u_world),u_image:new a.bP(m,e.u_image),u_texsize:new a.bU(m,e.u_texsize),u_pixel_coord_upper:new a.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,e.u_pixel_coord_lower),u_scale:new a.bT(m,e.u_scale),u_fade:new a.bg(m,e.u_fade),u_fill_translate:new a.bU(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new a.bg(m,e.u_camera_to_center_distance),u_scale_with_map:new a.bP(m,e.u_scale_with_map),u_pitch_with_map:new a.bP(m,e.u_pitch_with_map),u_extrude_scale:new a.bU(m,e.u_extrude_scale),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(m,e.u_globe_extrude_scale),u_translate:new a.bU(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new a.bU(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new a.bU(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new a.bQ(m,e.u_color),u_overlay:new a.bP(m,e.u_overlay),u_overlay_scale:new a.bg(m,e.u_overlay_scale)}),depth:$c,clippingMask:$c,heatmap:(m,e)=>({u_extrude_scale:new a.bg(m,e.u_extrude_scale),u_intensity:new a.bg(m,e.u_intensity),u_globe_extrude_scale:new a.bg(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new a.bR(m,e.u_matrix),u_world:new a.bU(m,e.u_world),u_image:new a.bP(m,e.u_image),u_color_ramp:new a.bP(m,e.u_color_ramp),u_opacity:new a.bg(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new a.bP(m,e.u_image),u_latrange:new a.bU(m,e.u_latrange),u_exaggeration:new a.bg(m,e.u_exaggeration),u_altitudes:new a.b_(m,e.u_altitudes),u_azimuths:new a.b_(m,e.u_azimuths),u_accent:new a.bQ(m,e.u_accent),u_method:new a.bP(m,e.u_method),u_shadows:new a.bZ(m,e.u_shadows),u_highlights:new a.bZ(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new a.bR(m,e.u_matrix),u_image:new a.bP(m,e.u_image),u_dimension:new a.bU(m,e.u_dimension),u_zoom:new a.bg(m,e.u_zoom),u_unpack:new a.bS(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new a.bP(m,e.u_image),u_unpack:new a.bS(m,e.u_unpack),u_dimension:new a.bU(m,e.u_dimension),u_elevation_stops:new a.bP(m,e.u_elevation_stops),u_color_stops:new a.bP(m,e.u_color_stops),u_color_ramp_size:new a.bP(m,e.u_color_ramp_size),u_opacity:new a.bg(m,e.u_opacity)}),line:(m,e)=>({u_translation:new a.bU(m,e.u_translation),u_ratio:new a.bg(m,e.u_ratio),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new a.bU(m,e.u_translation),u_ratio:new a.bg(m,e.u_ratio),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,e.u_units_to_pixels),u_image:new a.bP(m,e.u_image),u_image_height:new a.bg(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new a.bU(m,e.u_translation),u_texsize:new a.bU(m,e.u_texsize),u_ratio:new a.bg(m,e.u_ratio),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_image:new a.bP(m,e.u_image),u_units_to_pixels:new a.bU(m,e.u_units_to_pixels),u_scale:new a.bT(m,e.u_scale),u_fade:new a.bg(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new a.bU(m,e.u_translation),u_ratio:new a.bg(m,e.u_ratio),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,e.u_units_to_pixels),u_patternscale_a:new a.bU(m,e.u_patternscale_a),u_patternscale_b:new a.bU(m,e.u_patternscale_b),u_sdfgamma:new a.bg(m,e.u_sdfgamma),u_image:new a.bP(m,e.u_image),u_tex_y_a:new a.bg(m,e.u_tex_y_a),u_tex_y_b:new a.bg(m,e.u_tex_y_b),u_mix:new a.bg(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new a.bU(m,e.u_tl_parent),u_scale_parent:new a.bg(m,e.u_scale_parent),u_buffer_scale:new a.bg(m,e.u_buffer_scale),u_fade_t:new a.bg(m,e.u_fade_t),u_opacity:new a.bg(m,e.u_opacity),u_image0:new a.bP(m,e.u_image0),u_image1:new a.bP(m,e.u_image1),u_brightness_low:new a.bg(m,e.u_brightness_low),u_brightness_high:new a.bg(m,e.u_brightness_high),u_saturation_factor:new a.bg(m,e.u_saturation_factor),u_contrast_factor:new a.bg(m,e.u_contrast_factor),u_spin_weights:new a.bT(m,e.u_spin_weights),u_coords_top:new a.bS(m,e.u_coords_top),u_coords_bottom:new a.bS(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new a.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,e.u_is_size_feature_constant),u_size_t:new a.bg(m,e.u_size_t),u_size:new a.bg(m,e.u_size),u_camera_to_center_distance:new a.bg(m,e.u_camera_to_center_distance),u_pitch:new a.bg(m,e.u_pitch),u_rotate_symbol:new a.bP(m,e.u_rotate_symbol),u_aspect_ratio:new a.bg(m,e.u_aspect_ratio),u_fade_change:new a.bg(m,e.u_fade_change),u_label_plane_matrix:new a.bR(m,e.u_label_plane_matrix),u_coord_matrix:new a.bR(m,e.u_coord_matrix),u_is_text:new a.bP(m,e.u_is_text),u_pitch_with_map:new a.bP(m,e.u_pitch_with_map),u_is_along_line:new a.bP(m,e.u_is_along_line),u_is_variable_anchor:new a.bP(m,e.u_is_variable_anchor),u_texsize:new a.bU(m,e.u_texsize),u_texture:new a.bP(m,e.u_texture),u_translation:new a.bU(m,e.u_translation),u_pitched_scale:new a.bg(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new a.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,e.u_is_size_feature_constant),u_size_t:new a.bg(m,e.u_size_t),u_size:new a.bg(m,e.u_size),u_camera_to_center_distance:new a.bg(m,e.u_camera_to_center_distance),u_pitch:new a.bg(m,e.u_pitch),u_rotate_symbol:new a.bP(m,e.u_rotate_symbol),u_aspect_ratio:new a.bg(m,e.u_aspect_ratio),u_fade_change:new a.bg(m,e.u_fade_change),u_label_plane_matrix:new a.bR(m,e.u_label_plane_matrix),u_coord_matrix:new a.bR(m,e.u_coord_matrix),u_is_text:new a.bP(m,e.u_is_text),u_pitch_with_map:new a.bP(m,e.u_pitch_with_map),u_is_along_line:new a.bP(m,e.u_is_along_line),u_is_variable_anchor:new a.bP(m,e.u_is_variable_anchor),u_texsize:new a.bU(m,e.u_texsize),u_texture:new a.bP(m,e.u_texture),u_gamma_scale:new a.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_is_halo:new a.bP(m,e.u_is_halo),u_translation:new a.bU(m,e.u_translation),u_pitched_scale:new a.bg(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new a.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,e.u_is_size_feature_constant),u_size_t:new a.bg(m,e.u_size_t),u_size:new a.bg(m,e.u_size),u_camera_to_center_distance:new a.bg(m,e.u_camera_to_center_distance),u_pitch:new a.bg(m,e.u_pitch),u_rotate_symbol:new a.bP(m,e.u_rotate_symbol),u_aspect_ratio:new a.bg(m,e.u_aspect_ratio),u_fade_change:new a.bg(m,e.u_fade_change),u_label_plane_matrix:new a.bR(m,e.u_label_plane_matrix),u_coord_matrix:new a.bR(m,e.u_coord_matrix),u_is_text:new a.bP(m,e.u_is_text),u_pitch_with_map:new a.bP(m,e.u_pitch_with_map),u_is_along_line:new a.bP(m,e.u_is_along_line),u_is_variable_anchor:new a.bP(m,e.u_is_variable_anchor),u_texsize:new a.bU(m,e.u_texsize),u_texsize_icon:new a.bU(m,e.u_texsize_icon),u_texture:new a.bP(m,e.u_texture),u_texture_icon:new a.bP(m,e.u_texture_icon),u_gamma_scale:new a.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new a.bg(m,e.u_device_pixel_ratio),u_is_halo:new a.bP(m,e.u_is_halo),u_translation:new a.bU(m,e.u_translation),u_pitched_scale:new a.bg(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new a.bg(m,e.u_opacity),u_color:new a.bQ(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new a.bg(m,e.u_opacity),u_image:new a.bP(m,e.u_image),u_pattern_tl_a:new a.bU(m,e.u_pattern_tl_a),u_pattern_br_a:new a.bU(m,e.u_pattern_br_a),u_pattern_tl_b:new a.bU(m,e.u_pattern_tl_b),u_pattern_br_b:new a.bU(m,e.u_pattern_br_b),u_texsize:new a.bU(m,e.u_texsize),u_mix:new a.bg(m,e.u_mix),u_pattern_size_a:new a.bU(m,e.u_pattern_size_a),u_pattern_size_b:new a.bU(m,e.u_pattern_size_b),u_scale_a:new a.bg(m,e.u_scale_a),u_scale_b:new a.bg(m,e.u_scale_b),u_pixel_coord_upper:new a.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new a.bP(m,e.u_texture),u_ele_delta:new a.bg(m,e.u_ele_delta),u_fog_matrix:new a.bR(m,e.u_fog_matrix),u_fog_color:new a.bQ(m,e.u_fog_color),u_fog_ground_blend:new a.bg(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(m,e.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(m,e.u_horizon_color),u_horizon_fog_blend:new a.bg(m,e.u_horizon_fog_blend),u_is_globe_mode:new a.bg(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new a.bg(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new a.bP(m,e.u_texture),u_terrain_coords_id:new a.bg(m,e.u_terrain_coords_id),u_ele_delta:new a.bg(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new a.bg(m,e.u_input),u_output_expected:new a.bg(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new a.bT(m,e.u_sun_pos),u_atmosphere_blend:new a.bg(m,e.u_atmosphere_blend),u_globe_position:new a.bT(m,e.u_globe_position),u_globe_radius:new a.bg(m,e.u_globe_radius),u_inv_proj_matrix:new a.bR(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new a.bQ(m,e.u_sky_color),u_horizon_color:new a.bQ(m,e.u_horizon_color),u_horizon:new a.bU(m,e.u_horizon),u_horizon_normal:new a.bU(m,e.u_horizon_normal),u_sky_horizon_blend:new a.bg(m,e.u_sky_horizon_blend),u_sky_blend:new a.bg(m,e.u_sky_blend)})};class Yh{constructor(e,o,u){this.context=e;let d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let yl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sn{constructor(e,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=e;let g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){let d=o.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,o,u){for(let d=0;d<this.attributes.length;d++){let g=this.attributes[d],v=o.attributes[g.name];v!==void 0&&e.vertexAttribPointer(v,g.components,e[yl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qc extends Lt{getDefault(){return a.bf.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Zc extends Lt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Jh extends Lt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Wc extends Lt{getDefault(){return[!0,!0,!0,!0]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Co extends Lt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Hc extends Lt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class $f extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Gf extends Lt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class qf extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Zf extends Lt{getDefault(){return[0,1]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Qh extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class Wf extends Lt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ed extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class _l extends Lt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class vl extends Lt{getDefault(){return a.bf.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class xl extends Lt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Kc extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class Mo extends Lt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ns extends Lt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class pa extends Lt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Sr extends Lt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class td extends Lt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class id extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Xc extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ko extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class bl extends Lt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class wl extends Lt{getDefault(){return null}set(e){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class os extends Lt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;let u=this.gl;an(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Tl extends Lt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class rd extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class fa extends Lt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Jn extends Lt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class nd extends Jn{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Yc extends Jn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class It extends Jn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let as="Framebuffer is not complete";class Hf{constructor(e,o,u,d,g){this.context=e,this.width=o,this.height=u;let v=e.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new nd(e,T),d)this.depthAttachment=g?new It(e,T):new Yc(e,T);else if(g)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(as)}destroy(){let e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){let u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class od{constructor(e){var o,u;if(this.gl=e,this.clearColor=new qc(this),this.clearDepth=new Zc(this),this.clearStencil=new Jh(this),this.colorMask=new Wc(this),this.depthMask=new Co(this),this.stencilMask=new Hc(this),this.stencilFunc=new $f(this),this.stencilOp=new Gf(this),this.stencilTest=new qf(this),this.depthRange=new Zf(this),this.depthTest=new Qh(this),this.depthFunc=new Wf(this),this.blend=new ed(this),this.blendFunc=new _l(this),this.blendColor=new vl(this),this.blendEquation=new xl(this),this.cullFace=new Kc(this),this.cullFaceSide=new Mo(this),this.frontFace=new ns(this),this.program=new pa(this),this.activeTexture=new Sr(this),this.viewport=new td(this),this.bindFramebuffer=new id(this),this.bindRenderbuffer=new Xc(this),this.bindTexture=new ko(this),this.bindVertexBuffer=new bl(this),this.bindElementBuffer=new wl(this),this.bindVertexArray=new os(this),this.pixelStoreUnpack=new Tl(this),this.pixelStoreUnpackPremultiplyAlpha=new rd(this),this.pixelStoreUnpackFlipY=new fa(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),an(e)){this.HALF_FLOAT=e.HALF_FLOAT;let d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:d?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Yh(this,e,o)}createVertexBuffer(e,o,u){return new Sn(this,e,o,u)}createRenderbuffer(e,o,u){let d=this.gl,g=d.createRenderbuffer();return this.bindRenderbuffer.set(g),d.renderbufferStorage(d.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,o,u,d){return new Hf(this,e,o,u,d)}clear({color:e,depth:o,stencil:u}){let d=this.gl,g=0;e&&(g|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(g|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(g|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){a.bH(e.blendFunction,Zt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return an(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return an(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Qn;function ad(m,e,o,u,d){let g=m.context,v=m.transform,T=g.gl,S=m.useProgram("collisionBox"),E=[],C=0,L=0;for(let K=0;K<u.length;K++){let Y=u[K],te=e.getTile(Y).getBucket(o);if(!te)continue;let J=d?te.textCollisionBox:te.iconCollisionBox,re=te.collisionCircleArray;re.length>0&&(E.push({circleArray:re,circleOffset:L,coord:Y}),C+=re.length/4,L=C),J&&S.draw(g,T.LINES,dt.disabled,kt.disabled,m.colorModeForRenderPass(),at.disabled,ml(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),v.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),o.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,null,m.transform.zoom,null,null,J.collisionVertexBuffer)}if(!d||!E.length)return;let R=m.useProgram("collisionCircle"),O=new a.b$;O.resize(4*C),O._trim();let j=0;for(let K of E)for(let Y=0;Y<K.circleArray.length/4;Y++){let te=4*Y,J=K.circleArray[te+0],re=K.circleArray[te+1],ae=K.circleArray[te+2],Q=K.circleArray[te+3];O.emplace(j++,J,re,ae,Q,0),O.emplace(j++,J,re,ae,Q,1),O.emplace(j++,J,re,ae,Q,2),O.emplace(j++,J,re,ae,Q,3)}(!Qn||Qn.length<2*C)&&(Qn=(function(K){let Y=2*K,te=new a.c1;te.resize(Y),te._trim();for(let J=0;J<Y;J++){let re=6*J;te.uint16[re+0]=4*J+0,te.uint16[re+1]=4*J+1,te.uint16[re+2]=4*J+2,te.uint16[re+3]=4*J+2,te.uint16[re+4]=4*J+3,te.uint16[re+5]=4*J+0}return te})(C));let H=g.createIndexBuffer(Qn,!0),W=g.createVertexBuffer(O,a.c0.members,!0);for(let K of E){let Y=Bf(m.transform);R.draw(g,T.TRIANGLES,dt.disabled,kt.disabled,m.colorModeForRenderPass(),at.disabled,Y,m.style.map.terrain&&m.style.map.terrain.getTerrainData(K.coord),null,o.id,W,H,a.aM.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),H.destroy()}let Kf=a.ag(new Float32Array(16));function sd(m,e,o,u,d,g){let{horizontalAlign:v,verticalAlign:T}=a.aH(m);return new a.P((-(v-.5)*e/d+u[0])*g,(-(T-.5)*o/d+u[1])*g)}function Xf(m,e,o,u,d,g){let v=e.tileAnchorPoint.add(new a.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=u.mult(g);o||(T=T.rotate(-d));let S=v.add(T);return pi(S.x,S.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(o){let T=Oi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),S=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return m.add(u.rotate(S))}return m.add(u)}function Jc(m,e,o,u,d,g,v,T,S,E,C,L){let R=m.text.placedSymbolArray,O=m.text.dynamicLayoutVertexArray,j=m.icon.dynamicLayoutVertexArray,H={};O.clear();for(let W=0;W<R.length;W++){let K=R.get(W),Y=K.hidden||!K.crossTileID||m.allowVerticalPlacement&&!K.placedOrientation?null:u[K.crossTileID];if(Y){let te=new a.P(K.anchorX,K.anchorY),J={getElevation:L,width:d.width,height:d.height,pitchedLabelPlaneMatrix:g,pitchWithMap:o,transform:d,tileAnchorPoint:te,translation:E,unwrappedTileID:C},re=o?Wn(te.x,te.y,J):Oi(te.x,te.y,J),ae=De(d.cameraToCenterDistance,re.signedDistanceFromCamera),Q=a.ap(m.textSizeData,T,K)*ae/a.aB;o&&(Q*=m.tilePixelRatio/v);let{width:de,height:we,anchor:ge,textOffset:ye,textBoxScale:be}=Y,Le=sd(ge,de,we,ye,be,Q),Oe=d.getPitchedTextCorrection(te.x+E[0],te.y+E[1],C),Ee=Xf(re.point,J,e,Le,-d.bearingInRadians,Oe),He=m.allowVerticalPlacement&&K.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let gt=0;gt<K.numGlyphs;gt++)a.av(O,Ee,He);S&&K.associatedIconIndex>=0&&(H[K.associatedIconIndex]={shiftedAnchor:Ee,angle:He})}else on(K.numGlyphs,O)}if(S){j.clear();let W=m.icon.placedSymbolArray;for(let K=0;K<W.length;K++){let Y=W.get(K);if(Y.hidden)on(Y.numGlyphs,j);else{let te=H[K];if(te)for(let J=0;J<Y.numGlyphs;J++)a.av(j,te.shiftedAnchor,te.angle);else on(Y.numGlyphs,j)}}m.icon.dynamicLayoutVertexBuffer.updateData(j)}m.text.dynamicLayoutVertexBuffer.updateData(O)}function Sl(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ss(m,e,o,u,d,g,v,T,S,E,C,L,R){let O=m.context,j=O.gl,H=m.transform,W=T==="map",K=S==="map",Y=T!=="viewport"&&o.layout.get("symbol-placement")!=="point",te=W&&!K&&!Y,J=!o.layout.get("symbol-sort-key").isConstant(),re=!1,ae=m.getDepthModeForSublayer(0,dt.ReadOnly),Q=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],we=H.getCircleRadiusCorrection();for(let ge of u){let ye=e.getTile(ge),be=ye.getBucket(o);if(!be)continue;let Le=d?be.text:be.icon;if(!Le||!Le.segments.get().length||!Le.hasVisibleVertices)continue;let Oe=Le.programConfigurations.get(o.id),Ee=d||be.sdfIcons,He=d?be.textSizeData:be.iconSizeData,gt=K||H.pitch!==0,Dt=m.useProgram(Sl(Ee,d,be),Oe),Bt=a.an(He,H.zoom),Ft=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge),Yt,ti,ft,Ut,mi=[0,0],wi=null;if(d)ti=ye.glyphAtlasTexture,ft=j.LINEAR,Yt=ye.glyphAtlasTexture.size,be.iconsInText&&(mi=ye.imageAtlasTexture.size,wi=ye.imageAtlasTexture,Ut=gt||m.options.rotating||m.options.zooming||He.kind==="composite"||He.kind==="camera"?j.LINEAR:j.NEAREST);else{let gi=o.layout.get("icon-size").constantOr(0)!==1||be.iconsNeedLinear;ti=ye.imageAtlasTexture,ft=Ee||m.options.rotating||m.options.zooming||gi||gt?j.LINEAR:j.NEAREST,Yt=ye.imageAtlasTexture.size}let Ai=a.aC(ye,1,m.transform.zoom),tr=hi(W,m.transform,Ai),Ur=a.L();a.aq(Ur,tr);let to=St(K,W,m.transform,Ai),io=a.aD(H,ye,g,v),Pa=H.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ea=Q&&be.hasTextData(),No=o.layout.get("icon-text-fit")!=="none"&&Ea&&be.hasIconData();if(Y){let gi=m.style.map.terrain?(Er,yi)=>m.style.map.terrain.getElevation(ge,Er,yi):null,Ti=o.layout.get("text-rotation-alignment")==="map";Qt(be,m,d,tr,Ur,K,E,Ti,ge.toUnwrapped(),H.width,H.height,io,gi)}let Bo=d&&Q||No,ur=Y||Bo?Kf:K?tr:m.transform.clipSpaceToPixelsMatrix,jr=Ee&&o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ir;ir=Ee?be.iconsInText?Vf(He.kind,Bt,te,K,Y,Bo,m,ur,to,io,Yt,mi,we):Hh(He.kind,Bt,te,K,Y,Bo,m,ur,to,io,d,Yt,0,we):rs(He.kind,Bt,te,K,Y,Bo,m,ur,to,io,d,Yt,we);let ro={program:Dt,buffers:Le,uniformValues:ir,projectionData:Pa,atlasTexture:ti,atlasTextureIcon:wi,atlasInterpolation:ft,atlasInterpolationIcon:Ut,isSDF:Ee,hasHalo:jr};if(J&&be.canOverlap){re=!0;let gi=Le.segments.get();for(let Ti of gi)de.push({segments:new a.aM([Ti]),sortKey:Ti.sortKey,state:ro,terrainData:Ft})}else de.push({segments:Le.segments,sortKey:0,state:ro,terrainData:Ft})}re&&de.sort(((ge,ye)=>ge.sortKey-ye.sortKey));for(let ge of de){let ye=ge.state;if(O.activeTexture.set(j.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,j.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(O.activeTexture.set(j.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),ye.isSDF){let be=ye.uniformValues;ye.hasHalo&&(be.u_is_halo=1,ls(ye.buffers,ge.segments,o,m,ye.program,ae,C,L,be,ye.projectionData,ge.terrainData)),be.u_is_halo=0}ls(ye.buffers,ge.segments,o,m,ye.program,ae,C,L,ye.uniformValues,ye.projectionData,ge.terrainData)}}function ls(m,e,o,u,d,g,v,T,S,E,C){let L=u.context;d.draw(L,L.gl.TRIANGLES,g,v,T,at.backCCW,S,C,E,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,u.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Qc(m,e,o,u,d){let g=m.context,v=g.gl,T=kt.disabled,S=new Zt([v.ONE,v.ONE],a.bf.transparent,[!0,!0,!0,!0]),E=e.getBucket(o);if(!E)return;let C=u.key,L=o.heatmapFbos.get(C);L||(L=cs(g,e.tileSize,e.tileSize),o.heatmapFbos.set(C,L)),g.bindFramebuffer.set(L.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:a.bf.transparent});let R=E.programConfigurations.get(o.id),O=m.useProgram("heatmap",R,!d),j=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),H=m.style.map.terrain.getTerrainData(u);O.draw(g,v.TRIANGLES,dt.disabled,T,S,at.disabled,$h(e,m.transform.zoom,o.paint.get("heatmap-intensity"),1),H,j,o.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,o.paint,m.transform.zoom,R)}function ld(m,e,o,u,d){let g=m.context,v=g.gl,T=m.transform;g.setColorMode(m.colorModeForRenderPass());let S=us(g,e),E=o.key,C=e.heatmapFbos.get(E);if(!C)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,C.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);let L=T.getProjectionData({overscaledTileID:o,applyTerrainMatrix:d,applyGlobeMatrix:!u});m.useProgram("heatmapTexture").draw(g,v.TRIANGLES,dt.disabled,kt.disabled,m.colorModeForRenderPass(),at.disabled,Bc(m,e,0,1),null,L,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,T.zoom),C.destroy(),e.heatmapFbos.delete(E)}function cs(m,e,o){var u,d;let g=m.gl,v=g.createTexture();g.bindTexture(g.TEXTURE_2D,v),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);let T=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:g.UNSIGNED_BYTE,S=(d=m.RGBA16F)!==null&&d!==void 0?d:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,S,e,o,0,g.RGBA,T,null);let E=m.createFramebuffer(e,o,!1,!1);return E.colorAttachment.set(v),E}function us(m,e){return e.colorRampTexture||(e.colorRampTexture=new a.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function hs(m,e,o,u,d){if(!o||!u||!u.imageAtlas)return;let g=u.imageAtlas.patternPositions,v=g[o.to.toString()],T=g[o.from.toString()];if(!v&&T&&(v=T),!T&&v&&(T=v),!v||!T){let S=d.getPaintProperty(e);v=g[S],T=g[S]}v&&T&&m.setConstantPatternPositions(v,T)}function Il(m,e,o,u,d,g,v,T){let S=m.context.gl,E="fill-pattern",C=o.paint.get(E),L=C&&C.constantOr(1),R=o.getCrossfadeParameters(),O,j,H,W,K,Y=m.transform,te=o.paint.get("fill-translate"),J=o.paint.get("fill-translate-anchor");v?(j=L&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=S.LINES):(j=L?"fillPattern":"fill",O=S.TRIANGLES);let re=C.constantOr(null);for(let ae of u){let Q=e.getTile(ae);if(L&&!Q.patternsLoaded())continue;let de=Q.getBucket(o);if(!de)continue;let we=de.programConfigurations.get(o.id),ge=m.useProgram(j,we),ye=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ae);L&&(m.context.activeTexture.set(S.TEXTURE0),Q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),we.updatePaintBuffers(R)),hs(we,E,re,Q,o);let be=Y.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),Le=a.aD(Y,Q,te,J);if(v){W=de.indexBuffer2,K=de.segments2;let Ee=[S.drawingBufferWidth,S.drawingBufferHeight];H=j==="fillOutlinePattern"&&L?ts(m,R,Q,Ee,Le):es(Ee,Le)}else W=de.indexBuffer,K=de.segments,H=L?fl(m,R,Q,Le):{u_fill_translate:Le};let Oe=m.stencilModeForClipping(ae);ge.draw(m.context,O,d,Oe,g,at.backCCW,H,ye,be,o.id,de.layoutVertexBuffer,W,K,o.paint,m.transform.zoom,we)}}function eu(m,e,o,u,d,g,v,T){let S=m.context,E=S.gl,C="fill-extrusion-pattern",L=o.paint.get(C),R=L.constantOr(1),O=o.getCrossfadeParameters(),j=o.paint.get("fill-extrusion-opacity"),H=L.constantOr(null),W=m.transform;for(let K of u){let Y=e.getTile(K),te=Y.getBucket(o);if(!te)continue;let J=m.style.map.terrain&&m.style.map.terrain.getTerrainData(K),re=te.programConfigurations.get(o.id),ae=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",re);R&&(m.context.activeTexture.set(E.TEXTURE0),Y.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),re.updatePaintBuffers(O));let Q=W.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!T,applyTerrainMatrix:!0});hs(re,C,H,Y,o);let de=a.aD(W,Y,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),we=o.paint.get("fill-extrusion-vertical-gradient"),ge=R?Ff(m,we,j,de,K,O,Y):Dr(m,we,j,de);ae.draw(S,S.gl.TRIANGLES,d,g,v,at.backCCW,ge,J,Q,o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,m.transform.zoom,re,m.style.map.terrain&&te.centroidVertexBuffer)}}function Ro(m,e,o,u,d,g,v,T,S){var E;let C=m.style.projection,L=m.context,R=m.transform,O=L.gl,j=[`#define NUM_ILLUMINATION_SOURCES ${o.paint.get("hillshade-highlight-color").values.length}`],H=m.useProgram("hillshade",null,!1,j),W=!m.options.moving;for(let K of u){let Y=e.getTile(K),te=Y.fbo;if(!te)continue;let J=C.getMeshFromTileID(L,K.canonical,T,!0,"raster"),re=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(K);L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,te.colorAttachment.get());let ae=R.getProjectionData({overscaledTileID:K,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});H.draw(L,O.TRIANGLES,g,d[K.overscaledZ],v,at.backCCW,Uf(m,Y,o),re,ae,o.id,J.vertexBuffer,J.indexBuffer,J.segments)}}function tu(m,e,o,u,d,g,v,T,S){var E;let C=m.style.projection,L=m.context,R=m.transform,O=L.gl,j=m.useProgram("colorRelief"),H=!m.options.moving,W=!0,K=0;for(let Y of u){let te=e.getTile(Y),J=te.dem;if(W){let ge=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:ye,colorTexture:be}=o.getColorRampTextures(L,ge,J.getUnpackVector());L.activeTexture.set(O.TEXTURE1),ye.bind(O.NEAREST,O.CLAMP_TO_EDGE),L.activeTexture.set(O.TEXTURE4),be.bind(O.LINEAR,O.CLAMP_TO_EDGE),W=!1,K=ye.size[0]}if(!J||!J.data)continue;let re=J.stride,ae=J.getPixels();if(L.activeTexture.set(O.TEXTURE0),L.pixelStoreUnpackPremultiplyAlpha.set(!1),te.demTexture=te.demTexture||m.getTileTexture(re),te.demTexture){let ge=te.demTexture;ge.update(ae,{premultiply:!1}),ge.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else te.demTexture=new a.T(L,ae,O.RGBA,{premultiply:!1}),te.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let Q=C.getMeshFromTileID(L,Y.canonical,T,!0,"raster"),de=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(Y),we=R.getProjectionData({overscaledTileID:Y,aligned:H,applyGlobeMatrix:!S,applyTerrainMatrix:!0});j.draw(L,O.TRIANGLES,g,d[Y.overscaledZ],v,at.backCCW,qh(o,te.dem,K),de,we,o.id,Q.vertexBuffer,Q.indexBuffer,Q.segments)}}let Pl=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Lo(m,e,o,u,d,g,v,T,S=!1,E=!1){let C=u[u.length-1].overscaledZ,L=m.context,R=L.gl,O=m.useProgram("raster"),j=m.transform,H=m.style.projection,W=m.colorModeForRenderPass(),K=!m.options.moving;for(let Y of u){let te=m.getDepthModeForSublayer(Y.overscaledZ-C,o.paint.get("raster-opacity")===1?dt.ReadWrite:dt.ReadOnly,R.LESS),J=e.getTile(Y);J.registerFadeDuration(o.paint.get("raster-fade-duration"));let re=e.findLoadedParent(Y,0),ae=e.findLoadedSibling(Y),Q=iu(J,re||ae||null,e,o,m.transform,m.style.map.terrain),de,we,ge=o.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;L.activeTexture.set(R.TEXTURE0),J.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),L.activeTexture.set(R.TEXTURE1),re?(re.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,re.tileID.overscaledZ-J.tileID.overscaledZ),we=[J.tileID.canonical.x*de%1,J.tileID.canonical.y*de%1]):J.texture.bind(ge,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),J.texture.useMipmap&&L.extTextureFilterAnisotropic&&m.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);let ye=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),be=j.getProjectionData({overscaledTileID:Y,aligned:K,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),Le=is(we||[0,0],de||1,Q,o,T),Oe=H.getMeshFromTileID(L,Y.canonical,g,v,"raster");O.draw(L,R.TRIANGLES,te,d?d[Y.overscaledZ]:kt.disabled,W,S?at.frontCCW:at.backCCW,Le,ye,be,o.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}function iu(m,e,o,u,d,g){let v=u.paint.get("raster-fade-duration");if(!g&&v>0){let T=B.now(),S=(T-m.timeAdded)/v,E=e?(T-e.timeAdded)/v:-1,C=o.getSource(),L=Xe(d,{tileSize:C.tileSize,roundZoom:C.roundZoom}),R=!e||Math.abs(e.tileID.overscaledZ-L)>Math.abs(m.tileID.overscaledZ-L),O=R&&m.refreshedUponExpiration?1:a.ah(R?S:1-E,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}let cd=new a.bf(1,0,0,1),ud=new a.bf(0,1,0,1),El=new a.bf(0,0,1,1),ru=new a.bf(1,0,1,1),Yf=new a.bf(0,1,1,1);function nu(m,e,o,u){cn(m,0,e+o/2,m.transform.width,o,u)}function ei(m,e,o,u){cn(m,e-o/2,0,o,m.transform.height,u)}function cn(m,e,o,u,d,g){let v=m.context,T=v.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*m.pixelRatio,o*m.pixelRatio,u*m.pixelRatio,d*m.pixelRatio),v.clear({color:g}),T.disable(T.SCISSOR_TEST)}function Ir(m,e,o){let u=m.context,d=u.gl,g=m.useProgram("debug"),v=dt.disabled,T=kt.disabled,S=m.colorModeForRenderPass(),E="$debug",C=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);u.activeTexture.set(d.TEXTURE0);let L=e.getTileByID(o.key).latestRawTileData,R=Math.floor((L&&L.byteLength||0)/1024),O=e.getTile(o).tileSize,j=512/Math.min(O,512)*(o.overscaledZ/m.transform.zoom)*.5,H=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(H+=` => ${o.overscaledZ}`),(function(K,Y){K.initDebugOverlayCanvas();let te=K.debugOverlayCanvas,J=K.context.gl,re=K.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,te.width,te.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(Y,5,5),re.strokeText(Y,5,5),K.debugOverlayTexture.update(te),K.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)})(m,`${H} ${R}kB`);let W=m.transform.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(u,d.TRIANGLES,v,T,Zt.alphaBlended,at.disabled,Eo(a.bf.transparent,j),null,W,E,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(u,d.LINE_STRIP,v,T,S,at.disabled,Eo(a.bf.red),C,W,E,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Al(m,e,o,u){let{isRenderingGlobe:d}=u,g=m.context,v=g.gl,T=m.transform,S=m.colorModeForRenderPass(),E=m.getDepthModeFor3D(),C=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(let L of o){let R=e.getTerrainMesh(L.tileID),O=m.renderToTexture.getTexture(L),j=e.getTerrainData(L.tileID);g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,O.texture);let H=e.getMeshFrameDelta(T.zoom),W=T.calculateFogMatrix(L.tileID.toUnwrapped()),K=dl(H,W,m.style.sky,T.pitch,d),Y=T.getProjectionData({overscaledTileID:L.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});C.draw(g,v.TRIANGLES,E,kt.disabled,S,at.backCCW,K,j,Y,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function ds(m,e){if(!e.mesh){let o=new a.aL;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(1,1),o.emplaceBack(-1,1);let u=new a.aN;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new bo(m.createVertexBuffer(o,Yn.members),m.createIndexBuffer(u),a.aM.simpleSegment(0,0,o.length,u.length))}return e.mesh}class hd{constructor(e,o){this.context=new od(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=vt.maxUnderzooming+vt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ca}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style._order)this.style._layers[d].resize()}setup(){let e=this.context,o=new a.aL;o.emplaceBack(0,0),o.emplaceBack(a.$,0),o.emplaceBack(0,a.$),o.emplaceBack(a.$,a.$),this.tileExtentBuffer=e.createVertexBuffer(o,Yn.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);let u=new a.aL;u.emplaceBack(0,0),u.emplaceBack(a.$,0),u.emplaceBack(0,a.$),u.emplaceBack(a.$,a.$),this.debugBuffer=e.createVertexBuffer(u,Yn.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);let d=new a.c6;d.emplaceBack(0,0,0,0),d.emplaceBack(a.$,0,a.$,0),d.emplaceBack(0,a.$,0,a.$),d.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=e.createVertexBuffer(d,zf.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);let g=new a.aL;g.emplaceBack(0,0),g.emplaceBack(a.$,0),g.emplaceBack(0,a.$),g.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,Yn.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);let v=new a.aL;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,Yn.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);let T=new a.c7;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);let S=new a.aN;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);let E=this.context.gl;this.stencilClearMode=new kt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new bo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let u=a.L();a.bY(u,0,this.width,this.height,0,0,1),a.N(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]);let d={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,o.TRIANGLES,dt.disabled,this.stencilClearMode,Zt.disabled,at.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source,this.nextStencilID+o.length>256&&this.clearStencil();let d=this.context;d.setColorMode(Zt.disabled),d.setDepthMode(dt.disabled);let g={};for(let v of o)g[v.key]=this.nextStencilID++;this._renderTileMasks(g,o,u,!0),this._renderTileMasks(g,o,u,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,o,u,d){let g=this.context,v=g.gl,T=this.style.projection,S=this.transform,E=this.useProgram("clippingMask");for(let C of o){let L=e[C.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),O=T.getMeshFromTileID(this.context,C.canonical,d,!0,"stencil"),j=S.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!u,applyTerrainMatrix:!0});E.draw(g,v.TRIANGLES,dt.disabled,new kt({func:v.ALWAYS,mask:0},L,255,v.KEEP,v.KEEP,v.REPLACE),Zt.disabled,u?at.disabled:at.backCCW,null,R,j,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){let e=this.context,o=e.gl,u=this.style.projection,d=this.transform,g=this.useProgram("depth"),v=this.getDepthModeFor3D(),T=fe(d,{tileSize:d.tileSize});for(let S of T){let E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),C=u.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),L=d.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,o.TRIANGLES,v,kt.disabled,Zt.disabled,at.backCCW,null,E,L,"$clipping",C.vertexBuffer,C.indexBuffer,C.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,o=this.context.gl;return new kt({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){let o=this.context.gl;return new kt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let o=this.context.gl,u=e.sort(((v,T)=>T.overscaledZ-v.overscaledZ)),d=u[u.length-1].overscaledZ,g=u[0].overscaledZ-d+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();let v={};for(let T=0;T<g;T++)v[T+d]=new kt({func:o.GEQUAL,mask:255},T+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=g,[v,u]}return[{[d]:kt.disabled},u]}stencilConfigForOverlapTwoPass(e){let o=this.context.gl,u=e.sort(((v,T)=>T.overscaledZ-v.overscaledZ)),d=u[u.length-1].overscaledZ,g=u[0].overscaledZ-d+1;if(this.clearStencil(),g>1){let v={},T={};for(let S=0;S<g;S++)v[S+d]=new kt({func:o.GREATER,mask:255},g+1+S,255,o.KEEP,o.KEEP,o.REPLACE),T[S+d]=new kt({func:o.GREATER,mask:255},1+S,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID=2*g+1,[v,T,u]}return this.nextStencilID=3,[{[d]:new kt({func:o.GREATER,mask:255},2,255,o.KEEP,o.KEEP,o.REPLACE)},{[d]:new kt({func:o.GREATER,mask:255},1,255,o.KEEP,o.KEEP,o.REPLACE)},u]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Zt([e.CONSTANT_COLOR,e.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zt.unblended:Zt.alphaBlended}getDepthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return dt.disabled;let d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new dt(u||this.context.gl.LEQUAL,o,[d,d])}getDepthModeFor3D(){return new dt(this.context.gl.LEQUAL,dt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){var u,d;this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(B.now()),this.imageManager.beginFrame();let g=this.style._order,v=this.style.sourceCaches,T={},S={},E={},C={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(let R in v){let O=v[R];O.used&&O.prepare(this.context),T[R]=O.getVisibleCoordinates(!1),S[R]=T[R].slice().reverse(),E[R]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let R of g){let O=this.style._layers[R];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;let j=S[O.source];(O.type==="custom"||j.length)&&this.renderLayer(this,v[O.source],O,j,C)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(R,O){let j=R.context,H=j.gl,W=((ae,Q,de)=>{let we=Math.cos(Q.rollInRadians),ge=Math.sin(Q.rollInRadians),ye=se(Q),be=Q.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ae.properties.get("sky-color"),u_horizon_color:ae.properties.get("horizon-color"),u_horizon:[(Q.width/2-ye*ge)*de,(Q.height/2+ye*we)*de],u_horizon_normal:[-ge,we],u_sky_horizon_blend:ae.properties.get("sky-horizon-blend")*Q.height/2*de,u_sky_blend:be}})(O,R.style.map.transform,R.pixelRatio),K=new dt(H.LEQUAL,dt.ReadWrite,[0,1]),Y=kt.disabled,te=R.colorModeForRenderPass(),J=R.useProgram("sky"),re=ds(j,O);J.draw(j,H.TRIANGLES,K,Y,te,at.disabled,W,null,void 0,"sky",re.vertexBuffer,re.indexBuffer,re.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let R=this.style._layers[g[this.currentLayer]],O=v[R.source],j=T[R.source];this._renderTileClippingMasks(R,j,!1),this.renderLayer(this,O,R,j,C)}this.renderPass="translucent";let L=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let R=this.style._layers[g[this.currentLayer]],O=v[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,C))continue;this.opaquePassEnabledForLayer()||L||(L=!0,C.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let j=(R.type==="symbol"?E:S)[R.source];this._renderTileClippingMasks(R,T[R.source],!!this.renderToTexture),this.renderLayer(this,O,R,j,C)}if(C.isRenderingGlobe&&(function(R,O,j){let H=R.context,W=H.gl,K=R.useProgram("atmosphere"),Y=new dt(W.LEQUAL,dt.ReadOnly,[0,1]),te=R.transform,J=(function(be,Le){let Oe=be.properties.get("position"),Ee=[-Oe.x,-Oe.y,-Oe.z],He=a.ag(new Float64Array(16));return be.properties.get("anchor")==="map"&&(a.b6(He,He,Le.rollInRadians),a.b7(He,He,-Le.pitchInRadians),a.b6(He,He,Le.bearingInRadians),a.b7(He,He,Le.center.lat*Math.PI/180),a.bz(He,He,-Le.center.lng*Math.PI/180)),a.c5(Ee,Ee,He),Ee})(j,R.transform),re=te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=O.properties.get("atmosphere-blend")*re.projectionTransition;if(ae===0)return;let Q=ha(te.worldSize,te.center.lat),de=te.inverseProjectionMatrix,we=new Float64Array(4);we[3]=1,a.aw(we,we,te.modelViewProjectionMatrix),we[0]/=we[3],we[1]/=we[3],we[2]/=we[3],we[3]=1,a.aw(we,we,de),we[0]/=we[3],we[1]/=we[3],we[2]/=we[3],we[3]=1;let ge=((be,Le,Oe,Ee,He)=>({u_sun_pos:be,u_atmosphere_blend:Le,u_globe_position:Oe,u_globe_radius:Ee,u_inv_proj_matrix:He}))(J,ae,[we[0],we[1],we[2]],Q,de),ye=ds(H,O);K.draw(H,W.TRIANGLES,Y,kt.disabled,Zt.alphaBlended,at.disabled,ge,null,null,"atmosphere",ye.vertexBuffer,ye.indexBuffer,ye.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let R=(function(O,j){let H=null,W=Object.values(O._layers).flatMap((J=>J.source&&!J.isHidden(j)?[O.sourceCaches[J.source]]:[])),K=W.filter((J=>J.getSource().type==="vector")),Y=W.filter((J=>J.getSource().type!=="vector")),te=J=>{(!H||H.getSource().maxzoom<J.getSource().maxzoom)&&(H=J)};return K.forEach((J=>te(J))),H||Y.forEach((J=>te(J))),H})(this.style,this.transform.zoom);R&&(function(O,j,H){for(let W=0;W<H.length;W++)Ir(O,j,H[W])})(this,R,R.getVisibleCoordinates())}this.options.showPadding&&(function(R){let O=R.transform.padding;nu(R,R.transform.height-(O.top||0),3,cd),nu(R,O.bottom||0,3,ud),ei(R,O.left||0,3,El),ei(R,R.transform.width-(O.right||0),3,ru);let j=R.transform.centerPoint;(function(H,W,K,Y){cn(H,W-1,K-10,2,20,Y),cn(H,W-10,K-1,20,2,Y)})(R,j.x,R.transform.height-j.y,Yf)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix,d=this.terrainFacilitator.dirty;d||(d=e?!a.c8(o,u):!a.c9(o,u)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(a.ca(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,v){let T=g.context,S=T.gl,E=g.transform,C=Zt.unblended,L=new dt(S.LEQUAL,dt.ReadWrite,[0,1]),R=v.sourceCache.getRenderableTiles(),O=g.useProgram("terrainDepth");T.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),T.clear({color:a.bf.transparent,depth:1});for(let j of R){let H=v.getTerrainMesh(j.tileID),W=v.getTerrainData(j.tileID),K=E.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Y={u_ele_delta:v.getMeshFrameDelta(E.zoom)};O.draw(T,S.TRIANGLES,L,kt.disabled,C,at.backCCW,Y,W,K,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,v){let T=g.context,S=T.gl,E=g.transform,C=Zt.unblended,L=new dt(S.LEQUAL,dt.ReadWrite,[0,1]),R=v.getCoordsTexture(),O=v.sourceCache.getRenderableTiles(),j=g.useProgram("terrainCoords");T.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),T.clear({color:a.bf.transparent,depth:1}),v.coordsIndex=[];for(let H of O){let W=v.getTerrainMesh(H.tileID),K=v.getTerrainData(H.tileID);T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.texture);let Y={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(E.zoom)},te=E.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});j.draw(T,S.TRIANGLES,L,kt.disabled,C,at.backCCW,Y,K,te,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),v.coordsIndex.push(H.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,o,u,d,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,a.cb(u)?(function(v,T,S,E,C,L){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:R}=L,O=kt.disabled,j=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(H,W,K,Y,te,J,re,ae,Q){let de=W.transform,we=W.style.map.terrain,ge=te==="map",ye=J==="map";for(let be of H){let Le=Y.getTile(be),Oe=Le.getBucket(K);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;let Ee=a.an(Oe.textSizeData,de.zoom),He=a.aC(Le,1,W.transform.zoom),gt=hi(ge,W.transform,He),Dt=K.layout.get("icon-text-fit")!=="none"&&Oe.hasIconData();if(Ee){let Bt=Math.pow(2,de.zoom-Le.tileID.overscaledZ),Ft=we?(Yt,ti)=>we.getElevation(be,Yt,ti):null;Jc(Oe,ge,ye,Q,de,gt,Bt,Ee,Dt,a.aD(de,Le,re,ae),be.toUnwrapped(),Ft)}}})(E,v,S,T,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),C),S.paint.get("icon-opacity").constantOr(1)!==0&&ss(v,T,S,E,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),O,j,R),S.paint.get("text-opacity").constantOr(1)!==0&&ss(v,T,S,E,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),O,j,R),T.map.showCollisionBoxes&&(ad(v,T,S,E,!0),ad(v,T,S,E,!1))})(e,o,u,d,this.style.placement.variableOffsets,g):a.cc(u)?(function(v,T,S,E,C){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:L}=C,R=S.paint.get("circle-opacity"),O=S.paint.get("circle-stroke-width"),j=S.paint.get("circle-stroke-opacity"),H=!S.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(O.constantOr(1)===0||j.constantOr(1)===0))return;let W=v.context,K=W.gl,Y=v.transform,te=v.getDepthModeForSublayer(0,dt.ReadOnly),J=kt.disabled,re=v.colorModeForRenderPass(),ae=[],Q=Y.getCircleRadiusCorrection();for(let de=0;de<E.length;de++){let we=E[de],ge=T.getTile(we),ye=ge.getBucket(S);if(!ye)continue;let be=S.paint.get("circle-translate"),Le=S.paint.get("circle-translate-anchor"),Oe=a.aD(Y,ge,be,Le),Ee=ye.programConfigurations.get(S.id),He=v.useProgram("circle",Ee),gt=ye.layoutVertexBuffer,Dt=ye.indexBuffer,Bt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(we),Ft={programConfiguration:Ee,program:He,layoutVertexBuffer:gt,indexBuffer:Dt,uniformValues:Nf(v,ge,S,Oe,Q),terrainData:Bt,projectionData:Y.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!L,applyTerrainMatrix:!0})};if(H){let Yt=ye.segments.get();for(let ti of Yt)ae.push({segments:new a.aM([ti]),sortKey:ti.sortKey,state:Ft})}else ae.push({segments:ye.segments,sortKey:0,state:Ft})}H&&ae.sort(((de,we)=>de.sortKey-we.sortKey));for(let de of ae){let{programConfiguration:we,program:ge,layoutVertexBuffer:ye,indexBuffer:be,uniformValues:Le,terrainData:Oe,projectionData:Ee}=de.state;ge.draw(W,K.TRIANGLES,te,J,re,at.backCCW,Le,Oe,Ee,S.id,ye,be,de.segments,S.paint,v.transform.zoom,we)}})(e,o,u,d,g):a.cd(u)?(function(v,T,S,E,C){if(S.paint.get("heatmap-opacity")===0)return;let L=v.context,{isRenderingToTexture:R,isRenderingGlobe:O}=C;if(v.style.map.terrain){for(let j of E){let H=T.getTile(j);T.hasRenderableParent(j)||(v.renderPass==="offscreen"?Qc(v,H,S,j,O):v.renderPass==="translucent"&&ld(v,S,j,R,O))}L.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(j,H,W,K){let Y=j.context,te=Y.gl,J=j.transform,re=kt.disabled,ae=new Zt([te.ONE,te.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(Q,de,we){let ge=Q.gl;Q.activeTexture.set(ge.TEXTURE1),Q.viewport.set([0,0,de.width/4,de.height/4]);let ye=we.heatmapFbos.get(a.c2);ye?(ge.bindTexture(ge.TEXTURE_2D,ye.colorAttachment.get()),Q.bindFramebuffer.set(ye.framebuffer)):(ye=cs(Q,de.width/4,de.height/4),we.heatmapFbos.set(a.c2,ye))})(Y,j,W),Y.clear({color:a.bf.transparent});for(let Q=0;Q<K.length;Q++){let de=K[Q];if(H.hasRenderableParent(de))continue;let we=H.getTile(de),ge=we.getBucket(W);if(!ge)continue;let ye=ge.programConfigurations.get(W.id),be=j.useProgram("heatmap",ye),Le=J.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Oe=J.getCircleRadiusCorrection();be.draw(Y,te.TRIANGLES,dt.disabled,re,ae,at.backCCW,$h(we,J.zoom,W.paint.get("heatmap-intensity"),Oe),null,Le,W.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,W.paint,J.zoom,ye)}Y.viewport.set([0,0,j.width,j.height])})(v,T,S,E):v.renderPass==="translucent"&&(function(j,H){let W=j.context,K=W.gl;W.setColorMode(j.colorModeForRenderPass());let Y=H.heatmapFbos.get(a.c2);Y&&(W.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,Y.colorAttachment.get()),W.activeTexture.set(K.TEXTURE1),us(W,H).bind(K.LINEAR,K.CLAMP_TO_EDGE),j.useProgram("heatmapTexture").draw(W,K.TRIANGLES,dt.disabled,kt.disabled,j.colorModeForRenderPass(),at.disabled,Bc(j,H,0,1),null,null,H.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments,H.paint,j.transform.zoom))})(v,S)})(e,o,u,d,g):a.ce(u)?(function(v,T,S,E,C){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:L}=C,R=S.paint.get("line-opacity"),O=S.paint.get("line-width");if(R.constantOr(1)===0||O.constantOr(1)===0)return;let j=v.getDepthModeForSublayer(0,dt.ReadOnly),H=v.colorModeForRenderPass(),W=S.paint.get("line-dasharray"),K=S.paint.get("line-pattern"),Y=K.constantOr(1),te=S.paint.get("line-gradient"),J=S.getCrossfadeParameters(),re=Y?"linePattern":W?"lineSDF":te?"lineGradient":"line",ae=v.context,Q=ae.gl,de=v.transform,we=!0;for(let ge of E){let ye=T.getTile(ge);if(Y&&!ye.patternsLoaded())continue;let be=ye.getBucket(S);if(!be)continue;let Le=be.programConfigurations.get(S.id),Oe=v.context.program.get(),Ee=v.useProgram(re,Le),He=we||Ee.program!==Oe,gt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge),Dt=K.constantOr(null);if(Dt&&ye.imageAtlas){let ft=ye.imageAtlas,Ut=ft.patternPositions[Dt.to.toString()],mi=ft.patternPositions[Dt.from.toString()];Ut&&mi&&Le.setConstantPatternPositions(Ut,mi)}let Bt=de.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Ft=de.getPixelScale(),Yt=Y?Wh(v,ye,S,Ft,J):W?Ao(v,ye,S,Ft,W,J):te?Zh(v,ye,S,Ft,be.lineClipsArray.length):gl(v,ye,S,Ft);if(Y)ae.activeTexture.set(Q.TEXTURE0),ye.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Le.updatePaintBuffers(J);else if(W&&(He||v.lineAtlas.dirty))ae.activeTexture.set(Q.TEXTURE0),v.lineAtlas.bind(ae);else if(te){let ft=be.gradients[S.id],Ut=ft.texture;if(S.gradientVersion!==ft.version){let mi=256;if(S.stepInterpolant){let wi=T.getSource().maxzoom,Ai=ge.canonical.z===wi?Math.ceil(1<<v.transform.maxZoom-ge.canonical.z):1;mi=a.ah(a.c3(be.maxLineLength/a.$*1024*Ai),256,ae.maxTextureSize)}ft.gradient=a.c4({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:mi,image:ft.gradient||void 0,clips:be.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new a.T(ae,ft.gradient,Q.RGBA),ft.version=S.gradientVersion,Ut=ft.texture}ae.activeTexture.set(Q.TEXTURE0),Ut.bind(S.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}let ti=v.stencilModeForClipping(ge);Ee.draw(ae,Q.TRIANGLES,j,ti,H,at.disabled,Yt,gt,Bt,S.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,S.paint,v.transform.zoom,Le,be.layoutVertexBuffer2),we=!1}})(e,o,u,d,g):a.cf(u)?(function(v,T,S,E,C){let L=S.paint.get("fill-color"),R=S.paint.get("fill-opacity");if(R.constantOr(1)===0)return;let{isRenderingToTexture:O}=C,j=v.colorModeForRenderPass(),H=S.paint.get("fill-pattern"),W=v.opaquePassEnabledForLayer()&&!H.constantOr(1)&&L.constantOr(a.bf.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===W){let K=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?dt.ReadWrite:dt.ReadOnly);Il(v,T,S,E,K,j,!1,O)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){let K=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,dt.ReadOnly);Il(v,T,S,E,K,j,!0,O)}})(e,o,u,d,g):a.cg(u)?(function(v,T,S,E,C){let L=S.paint.get("fill-extrusion-opacity");if(L===0)return;let{isRenderingToTexture:R}=C;if(v.renderPass==="translucent"){let O=new dt(v.context.gl.LEQUAL,dt.ReadWrite,v.depthRangeFor3D);if(L!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))eu(v,T,S,E,O,kt.disabled,Zt.disabled,R),eu(v,T,S,E,O,v.stencilModeFor3D(),v.colorModeForRenderPass(),R);else{let j=v.colorModeForRenderPass();eu(v,T,S,E,O,kt.disabled,j,R)}}})(e,o,u,d,g):a.ch(u)?(function(v,T,S,E,C){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;let{isRenderingToTexture:L}=C,R=v.context,O=v.style.projection.useSubdivision,j=v.getDepthModeForSublayer(0,dt.ReadOnly),H=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(W,K,Y,te,J,re,ae){let Q=W.context,de=Q.gl;for(let we of Y){let ge=K.getTile(we),ye=ge.dem;if(!ye||!ye.data||!ge.needsHillshadePrepare)continue;let be=ye.dim,Le=ye.stride,Oe=ye.getPixels();if(Q.activeTexture.set(de.TEXTURE1),Q.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||W.getTileTexture(Le),ge.demTexture){let He=ge.demTexture;He.update(Oe,{premultiply:!1}),He.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else ge.demTexture=new a.T(Q,Oe,de.RGBA,{premultiply:!1}),ge.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);Q.activeTexture.set(de.TEXTURE0);let Ee=ge.fbo;if(!Ee){let He=new a.T(Q,{width:be,height:be,data:null},de.RGBA);He.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ee=ge.fbo=Q.createFramebuffer(be,be,!0,!1),Ee.colorAttachment.set(He.texture)}Q.bindFramebuffer.set(Ee.framebuffer),Q.viewport.set([0,0,be,be]),W.useProgram("hillshadePrepare").draw(Q,de.TRIANGLES,J,re,ae,at.disabled,Gh(ge.tileID,ye),null,null,te.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),ge.needsHillshadePrepare=!1}})(v,T,E,S,j,kt.disabled,H),R.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(O){let[W,K,Y]=v.stencilConfigForOverlapTwoPass(E);Ro(v,T,S,Y,W,j,H,!1,L),Ro(v,T,S,Y,K,j,H,!0,L)}else{let[W,K]=v.getStencilConfigForOverlapAndUpdateStencilID(E);Ro(v,T,S,K,W,j,H,!1,L)}})(e,o,u,d,g):a.ci(u)?(function(v,T,S,E,C){if(v.renderPass!=="translucent"||!E.length)return;let{isRenderingToTexture:L}=C,R=v.style.projection.useSubdivision,O=v.getDepthModeForSublayer(0,dt.ReadOnly),j=v.colorModeForRenderPass();if(R){let[H,W,K]=v.stencilConfigForOverlapTwoPass(E);tu(v,T,S,K,H,O,j,!1,L),tu(v,T,S,K,W,O,j,!0,L)}else{let[H,W]=v.getStencilConfigForOverlapAndUpdateStencilID(E);tu(v,T,S,W,H,O,j,!1,L)}})(e,o,u,d,g):a.cj(u)?(function(v,T,S,E,C){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!E.length)return;let{isRenderingToTexture:L}=C,R=T.getSource(),O=v.style.projection.useSubdivision;if(R instanceof nn)Lo(v,T,S,E,null,!1,!1,R.tileCoords,R.flippedWindingOrder,L);else if(O){let[j,H,W]=v.stencilConfigForOverlapTwoPass(E);Lo(v,T,S,W,j,!1,!0,Pl,!1,L),Lo(v,T,S,W,H,!0,!0,Pl,!1,L)}else{let[j,H]=v.getStencilConfigForOverlapAndUpdateStencilID(E);Lo(v,T,S,H,j,!1,!0,Pl,!1,L)}})(e,o,u,d,g):a.ck(u)?(function(v,T,S,E,C){let L=S.paint.get("background-color"),R=S.paint.get("background-opacity");if(R===0)return;let{isRenderingToTexture:O}=C,j=v.context,H=j.gl,W=v.style.projection,K=v.transform,Y=K.tileSize,te=S.paint.get("background-pattern");if(v.isPatternMissing(te))return;let J=!te&&L.a===1&&R===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==J)return;let re=kt.disabled,ae=v.getDepthModeForSublayer(0,J==="opaque"?dt.ReadWrite:dt.ReadOnly),Q=v.colorModeForRenderPass(),de=v.useProgram(te?"backgroundPattern":"background"),we=E||fe(K,{tileSize:Y,terrain:v.style.map.terrain});te&&(j.activeTexture.set(H.TEXTURE0),v.imageManager.bind(v.context));let ge=S.getCrossfadeParameters();for(let ye of we){let be=K.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Le=te?Xh(R,v,te,{tileID:ye,tileSize:Y},ge):Kh(R,L),Oe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ye),Ee=W.getMeshFromTileID(j,ye.canonical,!1,!0,"raster");de.draw(j,H.TRIANGLES,ae,re,Q,at.backCCW,Le,Oe,be,S.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}})(e,0,u,d,g):a.cl(u)&&(function(v,T,S,E){let{isRenderingGlobe:C}=E,L=v.context,R=S.implementation,O=v.style.projection,j=v.transform,H=j.getProjectionDataForCustomLayer(C),W={farZ:j.farZ,nearZ:j.nearZ,fov:j.fov*Math.PI/180,modelViewProjectionMatrix:j.modelViewProjectionMatrix,projectionMatrix:j.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:H},K=R.renderingMode?R.renderingMode:"2d";if(v.renderPass==="offscreen"){let Y=R.prerender;Y&&(v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),Y.call(R,L.gl,W),L.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),L.setStencilMode(kt.disabled);let Y=K==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,dt.ReadOnly);L.setDepthMode(Y),R.render(L.gl,W),L.setDirty(),v.setBaseState(),L.bindFramebuffer.set(null)}})(e,0,u,g))}saveTileTexture(e){let o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o,u=!1,d=[]){this.cache=this.cache||{};let g=!!this.style.map.terrain,v=this.style.projection,T=u?Rr.projectionMercator:v.shaderPreludeCode,S=u?wn:v.shaderDefine,E=e+(o?o.cacheKey:"")+`/${u?wo:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Nc(this.context,Rr[e],o,Gc[e],this._showOverdrawInspector,g,T,S,d)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}function Do(m,e){let o,u=!1,d=null,g=null,v=()=>{d=null,u&&(m.apply(g,o),d=setTimeout(v,e),u=!1)};return(...T)=>(u=!0,g=this,o=T,d||v(),d)}class Cl{constructor(e){this._getCurrentHash=()=>{let o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(u=d)})),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{let o=this._getCurrentHash();if(!this._isValidHash(o))return!1;let u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0},this._updateHashUnthrottled=()=>{let o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{let o=this._getCurrentHash();if(o.length===0)return;let u=o.join("/"),d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let g=window.location.hash.replace(d,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let v=window.location.href.replace(/(#.+)?$/,g);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Do(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,d),v=Math.round(o.lng*g)/g,T=Math.round(o.lat*g)/g,S=this._map.getBearing(),E=this._map.getPitch(),C="";if(C+=e?`/${v}/${T}/${u}`:`${u}/${T}/${v}`,(S||E)&&(C+="/"+Math.round(10*S)/10),E&&(C+=`/${Math.round(E)}`),this._hashName){let L=this._hashName,R=!1,O=window.location.hash.slice(1).split("&").map((j=>{let H=j.split("=")[0];return H===L?(R=!0,`${H}=${C}`):j})).filter((j=>j));return R||O.push(`${L}=${C}`),`#${O.join("&")}`}return`#${C}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new a.S(+e[2],+e[1])}catch{return!1}let o=+e[0],u=+(e[3]||0),d=+(e[4]||0);return o>=this._map.getMinZoom()&&o<=this._map.getMaxZoom()&&u>=-180&&u<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}let In={linearity:.3,easing:a.cm(0,0,.3,1)},ou=a.e({deceleration:2500,maxSpeed:1400},In),dd=a.e({deceleration:20,maxSpeed:1400},In),pd=a.e({deceleration:1e3,maxSpeed:360},In),fd=a.e({deceleration:1e3,maxSpeed:90},In),md=a.e({deceleration:1e3,maxSpeed:360},In);class gd{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:B.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,o=B.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let o={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:g}of this._inertiaBuffer)o.zoom+=g.zoomDelta||0,o.bearing+=g.bearingDelta||0,o.pitch+=g.pitchDelta||0,o.roll+=g.rollDelta||0,g.panDelta&&o.pan._add(g.panDelta),g.around&&(o.around=g.around),g.pinchAround&&(o.pinchAround=g.pinchAround);let u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){let g=ma(o.pan.mag(),u,a.e({},ou,e||{})),v=o.pan.mult(g.amount/o.pan.mag()),T=this._map.cameraHelper.handlePanInertia(v,this._map.transform);d.center=T.easingCenter,d.offset=T.easingOffset,zr(d,g)}if(o.zoom){let g=ma(o.zoom,u,dd);d.zoom=this._map.transform.zoom+g.amount,zr(d,g)}if(o.bearing){let g=ma(o.bearing,u,pd);d.bearing=this._map.transform.bearing+a.ah(g.amount,-179,179),zr(d,g)}if(o.pitch){let g=ma(o.pitch,u,fd);d.pitch=this._map.transform.pitch+g.amount,zr(d,g)}if(o.roll){let g=ma(o.roll,u,md);d.roll=this._map.transform.roll+a.ah(g.amount,-179,179),zr(d,g)}if(d.zoom||d.bearing){let g=o.pinchAround===void 0?o.around:o.pinchAround;d.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),a.e(d,{noMoveStart:!0})}}function zr(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function ma(m,e,o){let{maxSpeed:u,linearity:d,deceleration:g}=o,v=a.ah(m*d/(e/1e3),-u,u),T=Math.abs(v)/(g*d);return{easing:o.easing,duration:1e3*T,amount:v*(T/2)}}class lr extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,d={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);let g=U.mousePos(o.getCanvas(),u),v=o.unproject(g);super(e,a.e({point:g,lngLat:v,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class ga extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){let d=e==="touchend"?u.changedTouches:u.touches,g=U.touchPos(o.getCanvasContainer(),d),v=g.map((S=>o.unproject(S))),T=g.reduce(((S,E,C,L)=>S.add(E.div(L.length))),new a.P(0,0));super(e,{points:g,point:T,lngLats:v,lngLat:o.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class au extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class yd{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new au(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new lr(e.type,this._map,e))}mouseup(e){this._map.fire(new lr(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new lr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new lr(e.type,this._map,e))}mouseover(e){this._map.fire(new lr(e.type,this._map,e))}mouseout(e){this._map.fire(new lr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ga(e.type,this._map,e))}touchmove(e){this._map.fire(new ga(e.type,this._map,e))}touchend(e){this._map.fire(new ga(e.type,this._map,e))}touchcancel(e){this._map.fire(new ga(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _d{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new lr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new lr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ya{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(a.P.convert(e),this._map.terrain)}}class su{constructor(e,o){this._map=e,this._tr=new ya(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(U.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;let u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;let d=this._startPos;this._lastPos=u,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let g=Math.min(d.x,u.x),v=Math.max(d.x,u.x),T=Math.min(d.y,u.y),S=Math.max(d.y,u.y);U.setTransform(this._box,`translate(${g}px,${T}px)`),this._box.style.width=v-g+"px",this._box.style.height=S-T+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;let u=this._startPos,d=o;if(this.reset(),U.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new a.l(e,{originalEvent:o}))}}function _a(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);let o={};for(let u=0;u<m.length;u++)o[m[u].identifier]=e[u];return o}class vd{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=(function(d){let g=new a.P(0,0);for(let v of d)g._add(v);return g.div(d.length)})(o),this.touches=_a(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;let d=_a(u,o);for(let g in this.touches){let v=d[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){let d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class cr{constructor(e){this.singleTap=new vd(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){let d=this.singleTap.touchend(e,o,u);if(d){let g=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(d)<30;if(g&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Or{constructor(e){this._tr=new ya(e),this._zoomIn=new cr({numTouches:1,numTaps:2}),this._zoomOut=new cr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){let d=this._zoomIn.touchend(e,o,u),g=this._zoomOut.touchend(e,o,u),v=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(d)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.rollDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(o)?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;let u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let d=Array.isArray(o)?o[0]:o;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&U.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Fr=0,xa=2,Jf={[Fr]:1,[xa]:2};class ps{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let o=U.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(o,u){let d=Jf[u];return o.buttons===void 0||(o.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return U.mouseButton(e)===this._eventButton}}class Qf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class em{constructor(e=new ps({checkCorrectEvent:()=>!0}),o=new Qf){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=o}_executeRelevantHandler(e,o,u){return e instanceof MouseEvent?o(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.startMove(o)),(o=>this.oneFingerTouchMoveStateManager.startMove(o)))}endMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.endMove(o)),(o=>this.oneFingerTouchMoveStateManager.endMove(o)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidStartEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidStartEvent(o)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidMoveEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(o)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidEndEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidEndEvent(o)))}}let fs=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class ms{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);let d=_a(u,o),g=new a.P(0,0),v=new a.P(0,0),T=0;for(let E in d){let C=d[E],L=this._touches[E];L&&(g._add(C),v._add(C.sub(L)),T++,d[E]=C)}if(this._touches=d,this._shouldBePrevented(T)||!v.mag())return;let S=v.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(T),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();let[d,g]=this._firstTwoTouches,v=Ge(u,o,d),T=Ge(u,o,g);if(!v||!T)return;let S=this._aroundCenter?null:v.add(T).div(2);return this._move([v,T],S,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;let[d,g]=this._firstTwoTouches,v=Ge(u,o,d),T=Ge(u,o,g);v&&T||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ge(m,e,o){for(let u=0;u<m.length;u++)if(m[u].identifier===o)return e[u]}function lu(m,e){return Math.log(m/e)/Math.LN2}class Ml extends Nr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){let u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lu(this._distance,u),pinchAround:o}}}function cu(m,e){return 180*m.angleWith(e)/Math.PI}class ba extends Nr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){let d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cu(this._vector,d),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let o=25/(Math.PI*this._minDiameter)*360,u=cu(e,this._startVector);return Math.abs(u)<o}}function zo(m){return Math.abs(m.y)>Math.abs(m.x)}class kl extends Nr{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,zo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let d=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,g,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;let d=e.mag()>=2,g=o.mag()>=2;if(!d&&!g)return;if(!d||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;let v=e.y>0==o.y>0;return zo(e)&&zo(o)&&v}}let Et={panStep:100,bearingStep:15,pitchStep:10};class Rl{constructor(e){this._tr=new ya(e);let o=Et;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,d=0,g=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:T=>{let S=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:tm,zoom:o?Math.round(S.zoom)+o*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+u*this._bearingStep,pitch:S.pitch+d*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tm(m){return m*(2-m)}let Ll=4.000244140625,im=1/450;class xd{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new ya(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=im}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,u=B.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ll==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=U.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(a.S.convert(u.center)):o,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let T=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){let T=this._type==="wheel"&&Math.abs(this._delta)>Ll?this._wheelZoomRate:this._defaultZoomRate,S=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&S!==0&&(S=1/S);let E=typeof this._targetZoom!="number"?e.scale:a.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),a.ak(E*S)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let o=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,d=this._easing,g,v=!1;if(this._type==="wheel"&&u&&d){let T=B.now()-this._lastWheelEventTime,S=Math.min((T+5)/200,1),E=d(S);g=a.C.number(u,o,E),S<1?this._frameId||(this._frameId=!0):v=!0}else g=o,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=a.co;if(this._prevEase){let u=this._prevEase,d=(B.now()-u.start)/u.duration,g=u.easing(d+.01)-u.easing(d),v=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-v*v);o=a.cm(v,T,.25,1)}return this._prevEase={start:B.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class uu{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hu{constructor(e){this._tr=new ya(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(){this._tap=new cr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){let d=o[0],g=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(d)<30;g&&v?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;let d=o[0],g=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{let d=this._tap.touchend(e,o,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wd{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class du{constructor(e,o,u,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=o,this._mousePitch=u,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Td{constructor(e,o,u,d){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Sd{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=o,this._container.appendChild(d);let g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=u,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}let Br=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Kt extends a.l{}function wa(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class pu{constructor(e,o){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,g)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let v=d.type==="renderFrame"?void 0:d,T={needsRenderFrame:!1},S={},E={};for(let{handlerName:R,handler:O,allowed:j}of this._handlers){if(!O.isEnabled())continue;let H;if(this._blockedByActive(E,j,R))O.reset();else if(O[g||d.type]){if(a.cp(d,g||d.type)){let W=U.mousePos(this._map.getCanvas(),d);H=O[g||d.type](d,W)}else if(a.cq(d,g||d.type)){let W=this._getMapTouches(d.touches),K=U.touchPos(this._map.getCanvas(),W);H=O[g||d.type](d,K,W)}else a.cr(g||d.type)||(H=O[g||d.type](d));this.mergeHandlerResult(T,S,H,R,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()}(H||O.isActive())&&(E[R]=O)}let C={};for(let R in this._previousActiveHandlers)E[R]||(C[R]=v);this._previousActiveHandlers=E,(Object.keys(C).length||wa(T))&&(this._changes.push([T,S,C]),this._triggerRenderFrame()),(Object.keys(E).length||wa(T))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:L}=T;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gd(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);let u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(let[d,g,v]of this._listeners)U.addEventListener(d,g,d===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(let[e,o,u]of this._listeners)U.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){let o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new yd(o,e));let d=o.boxZoom=new su(o,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();let g=o.cooperativeGestures=new Sd(o,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();let v=new Or(o),T=new hu(o);o.doubleClickZoom=new uu(T,v),this._add("tapZoom",v),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();let S=new bd;this._add("tapDragZoom",S);let E=o.touchPitch=new kl(o);this._add("touchPitch",E),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);let C=()=>o.project(o.getCenter()),L=(function({enable:J,clickTolerance:re,aroundCenter:ae=!0,minPixelCenterThreshold:Q=100,rotateDegreesPerPixelMoved:de=.8},we){let ge=new ps({checkCorrectEvent:ye=>U.mouseButton(ye)===0&&ye.ctrlKey||U.mouseButton(ye)===2&&!ye.ctrlKey});return new va({clickTolerance:re,move:(ye,be)=>{let Le=we();if(ae&&Math.abs(Le.y-ye.y)>Q)return{bearingDelta:a.cn(new a.P(ye.x,be.y),be,Le)};let Oe=(be.x-ye.x)*de;return ae&&be.y<Le.y&&(Oe=-Oe),{bearingDelta:Oe}},moveStateManager:ge,enable:J,assignEvents:fs})})(e,C),R=(function({enable:J,clickTolerance:re,pitchDegreesPerPixelMoved:ae=-.5}){let Q=new ps({checkCorrectEvent:de=>U.mouseButton(de)===0&&de.ctrlKey||U.mouseButton(de)===2});return new va({clickTolerance:re,move:(de,we)=>({pitchDelta:(we.y-de.y)*ae}),moveStateManager:Q,enable:J,assignEvents:fs})})(e),O=(function({enable:J,clickTolerance:re,rollDegreesPerPixelMoved:ae=.3},Q){let de=new ps({checkCorrectEvent:we=>U.mouseButton(we)===2&&we.ctrlKey});return new va({clickTolerance:re,move:(we,ge)=>{let ye=Q(),be=(ge.x-we.x)*ae;return ge.y<ye.y&&(be=-be),{rollDelta:be}},moveStateManager:de,enable:J,assignEvents:fs})})(e,C);o.dragRotate=new du(e,L,R,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();let j=(function({enable:J,clickTolerance:re}){let ae=new ps({checkCorrectEvent:Q=>U.mouseButton(Q)===0&&!Q.ctrlKey});return new va({clickTolerance:re,move:(Q,de)=>({around:de,panDelta:de.sub(Q)}),activateOnStart:!0,moveStateManager:ae,enable:J,assignEvents:fs})})(e),H=new ms(e,o);o.dragPan=new wd(u,j,H),this._add("mousePan",j),this._add("touchPan",H,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);let W=new ba,K=new Ml;o.touchZoomRotate=new Td(u,K,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);let Y=o.scrollZoom=new xd(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Y,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);let te=o.keyboard=new Rl(o);this._add("keyboard",te),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new _d(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Br(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(let d in e)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}_getMapTouches(e){let o=[];for(let u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,d,g){if(!u)return;a.e(e,u);let v={handlerName:d,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(o.zoom=v),u.panDelta!==void 0&&(o.drag=v),u.rollDelta!==void 0&&(o.roll=v),u.pitchDelta!==void 0&&(o.pitch=v),u.bearingDelta!==void 0&&(o.rotate=v)}_applyChanges(){let e={},o={},u={};for(let[d,g,v]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new a.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),a.e(o,g),a.e(u,v);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){let d=this._map,g=d._getTransformForUpdate(),v=d.terrain;if(!(wa(e)||v&&this._terrainMovement))return this._fireEvents(o,u,!0);d._stop(!0);let{panDelta:T,zoomDelta:S,bearingDelta:E,pitchDelta:C,rollDelta:L,around:R,pinchAround:O}=e;O!==void 0&&(R=O),R=R||d.transform.centerPoint,v&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);let j={panDelta:T,zoomDelta:S,rollDelta:L,pitchDelta:C,bearingDelta:E,around:R};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);let H=R.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(T?R.sub(T):R);v?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(j,g),this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(T))):this._map.cameraHelper.handleMapControlsPan(j,g,H):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(j,g,H))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(j,g),this._map.cameraHelper.handleMapControlsPan(j,g,H)),d._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){let d=Br(this._eventsInProgress),g=Br(e),v={};for(let L in e){let{originalEvent:R}=e[L];this._eventsInProgress[L]||(v[`${L}start`]=R),this._eventsInProgress[L]=e[L]}!d&&g&&this._fireEvent("movestart",g.originalEvent);for(let L in v)this._fireEvent(L,v[L]);g&&this._fireEvent("move",g.originalEvent);for(let L in e){let{originalEvent:R}=e[L];this._fireEvent(L,R)}let T={},S;for(let L in this._eventsInProgress){let{handlerName:R,originalEvent:O}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],S=o[R]||O,T[`${L}end`]=S)}for(let L in T)this._fireEvent(L,T[L]);let E=Br(this._eventsInProgress),C=(d||g)&&!E;if(C&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let L=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&L.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(L)}if(u&&C){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!L||!L.essential&&B.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new a.l(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Kt("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Id extends a.E{constructor(e,o,u){super(),this._renderFrameCallback=()=>{let d=Math.min((B.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=o,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,o){e.apply(this.transform),this.transform=e,this.cameraHelper=o}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,o){return this.jumpTo({elevation:e},o),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,o,u){return e=a.P.convert(e).mult(-1),this.panTo(this.transform.center,a.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(a.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(a.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,o){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new a.l("movestart",o)).fire(new a.l("move",o)).fire(new a.l("moveend",o))),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(a.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,a.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}getRoll(){return this.transform.roll}setRoll(e,o){return this.jumpTo({roll:e},o),this}cameraForBounds(e,o){e=ni.convert(e).adjustAntiMeridian();let u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,d){let g={top:0,bottom:0,right:0,left:0};if(typeof(d=a.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){let E=d.padding;d.padding={top:E,bottom:E,right:E,left:E}}let v=a.e(g,d.padding);d.padding=v;let T=this.transform,S=new ni(e,o);return this.cameraHelper.cameraForBoxAndBearing(d,v,S,u,T)}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,d,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(e)),this.transform.screenPointToLocation(a.P.convert(o)),u,d),d,g)}_fitInternal(e,o,u){return e?(delete(o=a.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();let u=this._getTransformForUpdate(),d=!1,g=!1,v=!1,T=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);let S=u.zoom!==T;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(d=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(g=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(v=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new a.l("movestart",o)).fire(new a.l("move",o)),S&&this.fire(new a.l("zoomstart",o)).fire(new a.l("zoom",o)).fire(new a.l("zoomend",o)),d&&this.fire(new a.l("rotatestart",o)).fire(new a.l("rotate",o)).fire(new a.l("rotateend",o)),g&&this.fire(new a.l("pitchstart",o)).fire(new a.l("pitch",o)).fire(new a.l("pitchend",o)),v&&this.fire(new a.l("rollstart",o)).fire(new a.l("roll",o)).fire(new a.l("rollend",o)),this.fire(new a.l("moveend",o))}calculateCameraOptionsFromTo(e,o,u,d=0){let g=a.a1.fromLngLat(e,o),v=a.a1.fromLngLat(u,d),T=v.x-g.x,S=v.y-g.y,E=v.z-g.z,C=Math.hypot(T,S,E);if(C===0)throw new Error("Can't calculate camera options with same From and To");let L=Math.hypot(T,S),R=a.ak(this.transform.cameraToCenterDistance/C/this.transform.tileSize),O=180*Math.atan2(T,-S)/Math.PI,j=180*Math.acos(L/C)/Math.PI;return j=E<0?90-j:90+j,{center:v.toLngLat(),elevation:d,zoom:R,pitch:j,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,o,u,d,g){let v=this.transform.calculateCenterFromCameraLngLatAlt(e,o,u,d);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:u,pitch:d,roll:g}}easeTo(e,o){this._stop(!1,e.easeId),((e=a.e({offset:[0,0],duration:500,easing:a.co},e)).animate===!1||!e.essential&&B.prefersReducedMotion)&&(e.duration=0);let u=this._getTransformForUpdate(),d=this.getBearing(),g=u.pitch,v=u.roll,T="bearing"in e?this._normalizeBearing(e.bearing,d):d,S="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,v):v,C="padding"in e?e.padding:u.padding,L=a.P.convert(e.offset),R,O;e.around&&(R=a.S.convert(e.around),O=u.locationToScreenPoint(R));let j={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},H=this.cameraHelper.handleEaseTo(u,{bearing:T,pitch:S,roll:E,padding:C,around:R,aroundPoint:O,offsetAsPoint:L,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==T,this._pitching=this._pitching||S!==g,this._rolling=this._rolling||E!==v,this._padding=!u.isPaddingEqual(C),this._zooming=this._zooming||H.isZooming,this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,j),this.terrain&&this._prepareElevation(H.elevationCenter),this._ease((W=>{H.easeFunc(W),this.terrain&&!e.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(u),this._fireMoveEvents(o)}),(W=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,W)}),e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new a.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new a.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new a.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new a.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new a.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){let u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let o=e.getCameraLngLat(),u=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(o,e.zoom):0;if(u<d){let g=this.calculateCameraOptionsFromTo(o,d,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){let o=[];if(o.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&o.push((d=>this.transformCameraUpdate(d))),!o.length)return;let u=e.clone();for(let d of o){let g=u.clone(),{center:v,zoom:T,roll:S,pitch:E,bearing:C,elevation:L}=d(g);v&&g.setCenter(v),L!==void 0&&g.setElevation(L),T!==void 0&&g.setZoom(T),S!==void 0&&g.setRoll(S),E!==void 0&&g.setPitch(E),C!==void 0&&g.setBearing(C),u.apply(g)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new a.l("move",e)),this._zooming&&this.fire(new a.l("zoom",e)),this._rotating&&this.fire(new a.l("rotate",e)),this._pitching&&this.fire(new a.l("pitch",e)),this._rolling&&this.fire(new a.l("roll",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;let u=this._zooming,d=this._rotating,g=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new a.l("zoomend",e)),d&&this.fire(new a.l("rotateend",e)),g&&this.fire(new a.l("pitchend",e)),v&&this.fire(new a.l("rollend",e)),this.fire(new a.l("moveend",e))}flyTo(e,o){if(!e.essential&&B.prefersReducedMotion){let be=a.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(be,o)}this.stop(),e=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},e);let u=this._getTransformForUpdate(),d=u.bearing,g=u.pitch,v=u.roll,T=u.padding,S="bearing"in e?this._normalizeBearing(e.bearing,d):d,E="pitch"in e?+e.pitch:g,C="roll"in e?this._normalizeBearing(e.roll,v):v,L="padding"in e?e.padding:u.padding,R=a.P.convert(e.offset),O=u.centerPoint.add(R),j=u.screenPointToLocation(O),H=this.cameraHelper.handleFlyTo(u,{bearing:S,pitch:E,roll:C,padding:L,locationAtOffset:j,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),W=e.curve,K=Math.max(u.width,u.height),Y=K/H.scaleOfZoom,te=H.pixelPathLength;typeof H.scaleOfMinZoom=="number"&&(W=Math.sqrt(K/H.scaleOfMinZoom/te*2));let J=W*W;function re(be){let Le=(Y*Y-K*K+(be?-1:1)*J*J*te*te)/(2*(be?Y:K)*J*te);return Math.log(Math.sqrt(Le*Le+1)-Le)}function ae(be){return(Math.exp(be)-Math.exp(-be))/2}function Q(be){return(Math.exp(be)+Math.exp(-be))/2}let de=re(!1),we=function(be){return Q(de)/Q(de+W*be)},ge=function(be){return K*((Q(de)*(ae(Le=de+W*be)/Q(Le))-ae(de))/J)/te;var Le},ye=(re(!0)-de)/W;if(Math.abs(te)<2e-6||!isFinite(ye)){if(Math.abs(K-Y)<1e-6)return this.easeTo(e,o);let be=Y<K?-1:1;ye=Math.abs(Math.log(Y/K))/W,ge=()=>0,we=Le=>Math.exp(be*W*Le)}return e.duration="duration"in e?+e.duration:1e3*ye/("screenSpeed"in e?+e.screenSpeed/W:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==S,this._pitching=E!==g,this._rolling=C!==v,this._padding=!u.isPaddingEqual(L),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(H.targetCenter),this._ease((be=>{let Le=be*ye,Oe=1/we(Le),Ee=ge(Le);this._rotating&&u.setBearing(a.C.number(d,S,be)),this._pitching&&u.setPitch(a.C.number(g,E,be)),this._rolling&&u.setRoll(a.C.number(v,C,be)),this._padding&&(u.interpolatePadding(T,L,be),O=u.centerPoint.add(R)),H.easeFunc(be,Oe,Ee,O),this.terrain&&!e.freezeElevation&&this._updateElevation(be),this._applyUpdatedTransform(u),this._fireMoveEvents(o)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=B.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=a.aO(e,-180,180);let u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(e),this.transform.tileZoom):null}}let fu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mu{constructor(e=fu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){let u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}let o=this._map.style.sourceCaches;for(let d in o){let g=o[d];if(g.used||g.usedForTerrain){let v=g.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,g)=>d.length-g.length)),e=e.filter(((d,g)=>{for(let v=g+1;v<e.length;v++)if(e[v].indexOf(d)>=0)return!1;return!0}));let u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=U.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pd{constructor(e={}){this._updateCompact=()=>{let o=this._container.children;if(o.length){let u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");let o=U.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class un{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){let o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(let d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let o=this._currentlyRunning=this._queue;this._queue=[];for(let u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Dl=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ye extends a.E{constructor(e){super(),this._lastTilesetChange=B.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];let u={};for(let d of fe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),a.bY(d.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[d.key]=new ra(d,this.tileSize),this._lastTilesetChange=B.now());for(let d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(let o in this._tiles){let u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,o){return o?this._getTerrainCoordsForTileRanges(e,o):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let o={};for(let u of this._renderableTilesKeys){let d=this._tiles[u].tileID,g=e.clone(),v=a.ba();if(d.canonical.equals(e.canonical))a.bY(v,0,a.$,a.$,0,0,1);else if(d.canonical.isChildOf(e.canonical)){let T=d.canonical.z-e.canonical.z,S=d.canonical.x-(d.canonical.x>>T<<T),E=d.canonical.y-(d.canonical.y>>T<<T),C=a.$>>T;a.bY(v,0,C,C,0,0,1),a.M(v,v,[-S*C,-E*C,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{let T=e.canonical.z-d.canonical.z,S=e.canonical.x-(e.canonical.x>>T<<T),E=e.canonical.y-(e.canonical.y>>T<<T),C=a.$>>T;a.bY(v,0,a.$,a.$,0,0,1),a.M(v,v,[S*C,E*C,0]),a.N(v,v,[1/2**T,1/2**T,0])}}g.terrainRttPosMatrix32f=new Float32Array(v),o[u]=g}return o}_getTerrainCoordsForTileRanges(e,o){let u={};for(let d of this._renderableTilesKeys){let g=this._tiles[d].tileID;if(!this._isWithinTileRanges(g,o))continue;let v=e.clone(),T=a.ba();if(g.canonical.z===e.canonical.z){let S=e.canonical.x-g.canonical.x,E=e.canonical.y-g.canonical.y;a.bY(T,0,a.$,a.$,0,0,1),a.M(T,T,[S*a.$,E*a.$,0])}else if(g.canonical.z>e.canonical.z){let S=g.canonical.z-e.canonical.z,E=g.canonical.x-(g.canonical.x>>S<<S),C=g.canonical.y-(g.canonical.y>>S<<S),L=e.canonical.x-(g.canonical.x>>S),R=e.canonical.y-(g.canonical.y>>S),O=a.$>>S;a.bY(T,0,O,O,0,0,1),a.M(T,T,[-E*O+L*a.$,-C*O+R*a.$,0])}else{let S=e.canonical.z-g.canonical.z,E=e.canonical.x-(e.canonical.x>>S<<S),C=e.canonical.y-(e.canonical.y>>S<<S),L=(e.canonical.x>>S)-g.canonical.x,R=(e.canonical.y>>S)-g.canonical.y,O=a.$<<S;a.bY(T,0,O,O,0,0,1),a.M(T,T,[E*a.$+L*O,C*a.$+R*O,0])}v.terrainRttPosMatrix32f=new Float32Array(T),u[d]=v}return u}getSourceTile(e,o){let u=this.sourceCache._source,d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&o)for(;d>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(d--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,o){return o[e.canonical.z]&&e.canonical.x>=o[e.canonical.z].minTileX&&e.canonical.x<=o[e.canonical.z].maxTileX&&e.canonical.y>=o[e.canonical.z].minTileY&&e.canonical.y<=o[e.canonical.z].maxTileY}}class ot{constructor(e,o,u){this._meshCache={},this.painter=e,this.sourceCache=new Ye(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,d=a.$){var g;if(!(o>=0&&o<d&&u>=0&&u<d))return 0;let v=this.getTerrainData(e),T=(g=v.tile)===null||g===void 0?void 0:g.dem;if(!T)return 0;let S=a.cs([],[o/d*a.$,u/d*a.$],v.u_terrain_matrix),E=[S[0]*T.dim,S[1]*T.dim],C=Math.floor(E[0]),L=Math.floor(E[1]),R=E[0]-C,O=E[1]-L;return T.get(C,L)*(1-R)*(1-O)+T.get(C+1,L)*R*(1-O)+T.get(C,L+1)*(1-R)*O+T.get(C+1,L+1)*R*O}getElevationForLngLatZoom(e,o){if(!a.ct(o,e.wrap()))return 0;let{tileID:u,mercatorX:d,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,d%a.$,g%a.$,a.$)}getElevation(e,o,u,d=a.$){return this.getDEMElevation(e,o,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let d=this.painter.context,g=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(d,g,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(d,new a.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}let o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){let d=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new a.T(d,o.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),o.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}let u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){let d=this.sourceCache.sourceCache._source.maxzoom,g=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?g=e.canonical.z-d:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let v=e.canonical.x-(e.canonical.x>>g<<g),T=e.canonical.y-(e.canonical.y>>g<<g),S=a.cu(new Float64Array(16),[1/(a.$<<g),1/(a.$<<g),0]);a.M(S,S,[v*a.$,T*a.$,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){let o=this.painter,u=o.width/devicePixelRatio,d=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let T=0;T<this._coordsTextureSize;T++,v+=4)o[v+0]=255&T,o[v+1]=255&g,o[v+2]=T>>8<<4|g>>8,o[v+3]=0;let u=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),d=new a.T(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let o=new Uint8Array(4),u=this.painter.context,d=u.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(g,T-v-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);let S=o[0]+(o[2]>>4<<8),E=o[1]+((15&o[2])<<8),C=this.coordsIndex[255-o[3]],L=C&&this.sourceCache.getTileByID(C);if(!L)return null;let R=this._coordsTextureSize,O=(1<<L.tileID.canonical.z)*R;return new a.a1((L.tileID.canonical.x*R+S)/O+L.tileID.wrap,(L.tileID.canonical.y*R+E)/O,this.getElevation(L.tileID,S,E,R))}depthAtPoint(e){let o=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(e){var o;let u=((o=this.painter.style.projection)===null||o===void 0?void 0:o.transitionState)>0,d=u&&e.canonical.y===0,g=u&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${d?"n":""}_${g?"s":""}`;if(this._meshCache[v])return this._meshCache[v];let T=this.painter.context,S=new a.cv,E=new a.aN,C=this.meshSize,L=a.$/C,R=C*C;for(let Q=0;Q<=C;Q++)for(let de=0;de<=C;de++)S.emplaceBack(de*L,Q*L,0);for(let Q=0;Q<R;Q+=C+1)for(let de=0;de<C;de++)E.emplaceBack(de+Q,C+de+Q+1,C+de+Q+2),E.emplaceBack(de+Q,C+de+Q+2,de+Q+1);let O=S.length,j=O+(C+1),H=(C+1)*C,W=d?a.bh:0,K=d?0:1,Y=g?a.bi:a.$,te=g?0:1;for(let Q=0;Q<=C;Q++)S.emplaceBack(Q*L,W,K);for(let Q=0;Q<=C;Q++)S.emplaceBack(Q*L,Y,te);for(let Q=0;Q<C;Q++)E.emplaceBack(H+Q,j+Q,j+Q+1),E.emplaceBack(H+Q,j+Q+1,H+Q+1),E.emplaceBack(0+Q,O+Q+1,O+Q),E.emplaceBack(0+Q,0+Q+1,O+Q+1);let J=S.length,re=J+2*(C+1);for(let Q of[0,1])for(let de=0;de<=C;de++)for(let we of[0,1])S.emplaceBack(Q*a.$,de*L,we);for(let Q=0;Q<2*C;Q+=2)E.emplaceBack(J+Q,J+Q+1,J+Q+3),E.emplaceBack(J+Q,J+Q+3,J+Q+2),E.emplaceBack(re+Q,re+Q+3,re+Q+1),E.emplaceBack(re+Q,re+Q+2,re+Q+3);let ae=new bo(T.createVertexBuffer(S,Dl.members),T.createIndexBuffer(E),a.aM.simpleSegment(0,0,S.length,E.length));return this._meshCache[v]=ae,ae}getMeshFrameDelta(e){return 2*Math.PI*a.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,o){var u;let{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){let o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){let u=a.a1.fromLngLat(e.wrap()),d=(1<<o)*a.$,g=u.x*d,v=u.y*d,T=Math.floor(g/a.$),S=Math.floor(v/a.$);return{tileID:new a.Z(o,0,o,T,S),mercatorX:g,mercatorY:v}}}class zl{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>e.id!==o)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}let eo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ol{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new zl(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((u=>!e._layers[u].isHidden(o))),this._coordsAscending={};for(let u in e.sourceCaches){this._coordsAscending[u]={};let d=e.sourceCaches[u].getVisibleCoordinates(),g=e.sourceCaches[u].getSource(),v=g instanceof nn?g.terrainTileRanges:null;for(let T of d){let S=this.terrain.sourceCache.getTerrainCoords(T,v);for(let E in S)this._coordsAscending[u][E]||(this._coordsAscending[u][E]=[]),this._coordsAscending[u][E].push(S[E])}}this._coordsAscendingStr={};for(let u of e._order){let d=e._layers[u],g=d.source;if(eo[d.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(let v in this._coordsAscending[g])this._coordsAscendingStr[g][v]=this._coordsAscending[g][v].map((T=>T.key)).sort().join()}}for(let u of this._renderableTiles)for(let d in this._coordsAscendingStr){let g=this._coordsAscendingStr[d][u.tileID.key];g&&g!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e,o){if(e.isHidden(this.painter.transform.zoom))return!1;let u=Object.assign(Object.assign({},o),{isRenderingToTexture:!0}),d=e.type,g=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(eo[d]&&(this._prevType&&eo[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(eo[this._prevType]||eo[d]&&v){this._prevType=d;let T=this._stacks.length-1,S=this._stacks[T]||[];for(let E of this._renderableTiles){if(this.pool.isFull()&&(Al(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[T]){let L=this.pool.getObjectForId(E.rtt[T].id);if(L.stamp===E.rtt[T].stamp){this.pool.useObject(L);continue}}let C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),E.rtt[T]={id:C.id,stamp:C.stamp},g.context.bindFramebuffer.set(C.fbo.framebuffer),g.context.clear({color:a.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let L=0;L<S.length;L++){let R=g.style._layers[S[L]],O=R.source?this._coordsAscending[R.source][E.tileID.key]:[E.tileID];g.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),g._renderTileClippingMasks(R,O,!0),g.renderLayer(g,g.style.sourceCaches[R.source],R,O,u),R.source&&(E.rttCoords[R.source]=this._coordsAscendingStr[R.source][E.tileID.key])}}return Al(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),eo[d]}return!1}}let er={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ed=b,Pr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:fu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},rm={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class gs{constructor(e,o,u=!1){this.mousedown=g=>{this.startMove(g,U.mousePos(this.element,g)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,U.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=o;let d=new em;this._rotatePitchHandler=new va({clickTolerance:3,move:(g,v)=>{let T=o.getBoundingClientRect(),S=new a.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:a.cn(new a.P(g.x,v.y),v,S),pitchDelta:u?-.5*(v.y-g.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,U.addEventListener(o,"mousedown",this.mousedown),U.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(o,"touchcancel",this.reset)}startMove(e,o){this._rotatePitchHandler.dragStart(e,o),U.disableDrag()}move(e,o){let u=this.map,{bearingDelta:d,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,o)||{};d&&u.setBearing(u.getBearing()+d),g&&u.setPitch(u.getPitch()+g)}off(){let e=this.element;U.removeEventListener(e,"mousedown",this.mousedown),U.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let Nt;function si(m,e,o,u=!1){if(u||!o.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();let d=new a.S(m.lng,m.lat);if(m=new a.S(m.lng,m.lat),e){let g=new a.S(m.lng-360,m.lat),v=new a.S(m.lng+360,m.lat),T=o.locationToScreenPoint(m).distSqr(e);o.locationToScreenPoint(g).distSqr(e)<T?m=g:o.locationToScreenPoint(v).distSqr(e)<T&&(m=v)}for(;Math.abs(m.lng-o.center.lng)>180;){let g=o.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=o.width&&g.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==d.lng&&o.isPointOnMapSurface(o.locationToScreenPoint(m))?m:d}let Fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ta(m,e,o){let u=m.classList;for(let d in Fl)u.remove(`maplibregl-${o}-anchor-${d}`);u.add(`maplibregl-${o}-anchor-${e}`)}class Sa extends a.E{constructor(e){if(super(),this._onKeyPress=o=>{let u=o.code,d=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=o=>{let u=o.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=o=>{if(!this._map)return;let u=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=si(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${Fl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${d}`),B.frameAsync(new AbortController).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){let u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=a.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");let o=U.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${d}px`),o.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);let g=U.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");let v=U.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");let T=U.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");let S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let K of S){let Y=U.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",K.rx),Y.setAttributeNS(null,"ry",K.ry),T.appendChild(Y)}let E=U.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);let C=U.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(C);let L=U.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");let R=U.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(R);let O=U.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");let j=U.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");let H=U.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");let W=U.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),j.appendChild(H),j.appendChild(W),v.appendChild(T),v.appendChild(E),v.appendChild(L),v.appendChild(O),v.appendChild(j),o.appendChild(v),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(o),this._offset=a.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),Ta(this._element,this._anchor,"marker"),e&&e.className)for(let o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=a.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;let d=(o=this._map)===null||o===void 0?void 0:o.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!d||g){let O=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}let v=this._map,T=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-T<.006)return void(this._element.style.opacity=this._opacity);let E=-this._offset.y/v.transform.pixelsPerMeter,C=Math.sin(v.getPitch()*Math.PI/180)*E,L=v.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),R=v.transform.lngLatToCameraDepth(this._lngLat,S+C)-L>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=a.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return(this._opacity===void 0||e===void 0&&o===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}let gu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ia=0,Oo=!1,ys={maxWidth:100,unit:"metric"};function Nl(m,e,o){let u=o&&o.maxWidth||100,d=m._container.clientHeight/2,g=m._container.clientWidth/2,v=m.unproject([g-u/2,d]),T=m.unproject([g+u/2,d]),S=Math.round(m.project(T).x-m.project(v).x),E=Math.min(u,S,m._container.clientWidth),C=v.distanceTo(T);if(o&&o.unit==="imperial"){let L=3.2808*C;L>5280?Fo(e,E,L/5280,m._getUIString("ScaleControl.Miles")):Fo(e,E,L,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Fo(e,E,C/1852,m._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Fo(e,E,C/1e3,m._getUIString("ScaleControl.Kilometers")):Fo(e,E,C,m._getUIString("ScaleControl.Meters"))}function Fo(m,e,o,u){let d=(function(g){let v=Math.pow(10,`${Math.floor(g)}`.length-1),T=g/v;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:(function(S){let E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E})(T),v*T})(o);m.style.width=e*(d/o)+"px",m.innerHTML=`${d}&nbsp;${u}`}let yu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bl(m){if(m){if(typeof m=="number"){let e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,m),"top-left":new a.P(e,e),"top-right":new a.P(-e,e),bottom:new a.P(0,-m),"bottom-left":new a.P(e,-e),"bottom-right":new a.P(-e,-e),left:new a.P(m,0),right:new a.P(-m,0)}}if(m instanceof a.P||Array.isArray(m)){let e=a.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:a.P.convert(m.center||[0,0]),top:a.P.convert(m.top||[0,0]),"top-left":a.P.convert(m["top-left"]||[0,0]),"top-right":a.P.convert(m["top-right"]||[0,0]),bottom:a.P.convert(m.bottom||[0,0]),"bottom-left":a.P.convert(m["bottom-left"]||[0,0]),"bottom-right":a.P.convert(m["bottom-right"]||[0,0]),left:a.P.convert(m.left||[0,0]),right:a.P.convert(m.right||[0,0])}}return Bl(new a.P(0,0))}let vu=b;p.AJAXError=a.cz,p.Event=a.l,p.Evented=a.E,p.LngLat=a.S,p.MercatorCoordinate=a.a1,p.Point=a.P,p.addProtocol=a.cA,p.config=a.a,p.removeProtocol=a.cB,p.AttributionControl=mu,p.BoxZoomHandler=su,p.CanvasSource=Un,p.CooperativeGesturesHandler=Sd,p.DoubleClickZoomHandler=uu,p.DragPanHandler=wd,p.DragRotateHandler=du,p.EdgeInsets=To,p.FullscreenControl=class extends a.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let m=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},p.GeoJSONSource=rn,p.GeolocateControl=class extends a.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let o=new a.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),g=a.e({bearing:d},this.options.fitBoundsOptions),v=ni.fromLngLat(o,u);this._map.fitBounds(v,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let o=new a.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Oo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Sa({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{let u=o?.[0]instanceof ResizeObserverEntry;o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))}))}},this.options=a.e({},gu,m)}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return a._(this,arguments,void 0,(function*(e=!1){if(Nt!==void 0&&!e)return Nt;if(window.navigator.permissions===void 0)return Nt=!!window.navigator.geolocation,Nt;try{Nt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Nt=!!window.navigator.geolocation}return Nt}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ia=0,Oo=!1}_isOutOfMapMaxBounds(m){let e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),u=e.distanceTo(o),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ia--,Oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ia++,Ia>1?(m={maximumAge:6e5,timeout:0},Oo=!0):(m=this.options.positionOptions,Oo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},p.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;let e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=U.create("button","maplibregl-ctrl-globe",this._container),U.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},p.Hash=Cl,p.ImageSource=nn,p.KeyboardHandler=Rl,p.LngLatBounds=ni,p.LogoControl=Pd,p.Map=class extends Id{constructor(m){var e,o;a.cw.mark(a.cx.create);let u=Object.assign(Object.assign(Object.assign({},Pr),m),{canvasContextAttributes:Object.assign(Object.assign({},Pr.canvasContextAttributes),m.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let d=new $t,g=new qi;if(u.minZoom!==void 0&&d.setMinZoom(u.minZoom),u.maxZoom!==void 0&&d.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&d.setMinPitch(u.minPitch),u.maxPitch!==void 0&&d.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&d.setRenderWorldCopies(u.renderWorldCopies),super(d,g,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new un,this._controls=[],this._mapId=a.a7(),this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},er),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Re.addThrottleControl((()=>this.isMoving())),this._requestManager=new We(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1,S=Do((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{T?S(E):T=!0})),this._resizeObserver.observe(this._container)}this.handlers=new pu(this,u),this._hash=u.hash&&new Cl(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.e({},u.fitBoundsOptions,{duration:0}))));let v=typeof u.style=="string"||((o=(e=u.style)===null||e===void 0?void 0:e.projection)===null||o===void 0?void 0:o.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new mu(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new Pd,u.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){let T=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}})),this.on("data",(T=>{this._update(T.dataType==="style"),this.fire(new a.l(`${T.dataType}data`,T))})),this.on("dataloading",(T=>{this.fire(new a.l(`${T.dataType}dataloading`,T))})),this.on("dataabort",(T=>{this.fire(new a.l("sourcedataabort",T))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=m.onAdd(this);this._controls.push(m);let u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,u)}resize(m,e=!0){let[o,u]=this._containerDimensions(),d=this._getClampedPixelRatio(o,u);if(this._resizeCanvas(o,u,d),this.painter.resize(o,u,d),this.painter.overLimit()){let v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];let T=this._getClampedPixelRatio(o,u);this._resizeCanvas(o,u,T),this.painter.resize(o,u,T)}this._resizeTransform(e);let g=!this._moving;return g&&(this.stop(),this.fire(new a.l("movestart",m)).fire(new a.l("move",m))),this.fire(new a.l("resize",m)),g&&this.fire(new a.l("moveend",m)),this}_resizeTransform(m=!0){var e;let[o,u]=this._containerDimensions();this.transform.resize(o,u,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,u,m)}_getClampedPixelRatio(m,e){let{0:o,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),g=m*d,v=e*d;return Math.min(g>o?o/g:1,v>u?u/v:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(ni.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(a.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(a.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:g=>{let v=e.filter((S=>this.getLayer(S))),T=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];T.length?u||(u=!0,o.call(this,new lr(m,this,g.originalEvent,{features:T}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:v=>{let T=e.filter((S=>this.getLayer(S)));(T.length!==0?this.queryRenderedFeatures(v.point,{layers:T}):[]).length?u=!0:u&&(u=!1,o.call(this,new lr(m,this,v.originalEvent)))},mouseout:v=>{u&&(u=!1,o.call(this,new lr(m,this,v.originalEvent)))}}}}{let u=d=>{let g=e.filter((T=>this.getLayer(T))),v=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];v.length&&(d.features=v,o.call(this,d),delete d.features)};return{layers:e,listener:o,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;let u=this._delegatedListeners[m];for(let d=0;d<u.length;d++){let g=u[d];if(g.listener===o&&g.layers.length===e.length&&g.layers.every((v=>e.includes(v)))){for(let v in g.delegates)this.off(v,g.delegates[v]);return void u.splice(d,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);let u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,u,o);this._saveDelegatedListener(m,d);for(let g in d.delegates)this.on(g,d.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,u,o)}}}once(m,e,o){if(o===void 0)return super.once(m,e);let u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,u,o);for(let g in d.delegates){let v=d.delegates[g];d.delegates[g]=(...T)=>{this._removeDelegatedListener(m,u,o),v(...T)}}this._saveDelegatedListener(m,d);for(let g in d.delegates)this.once(g,d.delegates[g]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o,u=m instanceof a.P||Array.isArray(m),d=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},d instanceof a.P||typeof d[0]=="number")o=[a.P.convert(d)];else{let g=a.P.convert(d[0]),v=a.P.convert(d[1]);o=[g,new a.P(v.x,g.y),v,new a.P(g.x,v.y),g]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){let e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var o,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));let d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Oc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,d):this.style.loadJSON(m,e,d),this):((u=(o=this.style)===null||o===void 0?void 0:o.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Oc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){let o=this._requestManager.transformRequest(m,"Style");a.j(o,new AbortController).then((u=>{this._updateDiff(u.data,e)})).catch((u=>{u&&this.fire(new a.k(u))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){a.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){let e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new a.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){let e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(let o in this.style._layers){let u=this.style._layers[o];u.type==="hillshade"&&u.source===m.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===m.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ot(this.painter,e,m),this.painter.renderToTexture=new Ol(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=o=>{var u;o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=o.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let m=this.style&&this.style.sourceCaches;for(let e in m){let o=m[e]._tiles;for(let u in o){let d=o[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,o){if(o){let u=this.getSource(o);if(!u)throw new Error(`There is no source with ID "${o}", cannot set LOD parameters`);u.calculateTileZoom=Me(Math.max(1,m),Math.max(1,e))}else for(let u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=Me(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){let o=this.style.sourceCaches[m];if(!o)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?o.reload(!0):o.refreshTiles(e.map((u=>new a.a4(u.z,u.x,u.y))))}addImage(m,e,o={}){let{pixelRatio:u=1,sdf:d=!1,stretchX:g,stretchY:v,content:T,textFitWidth:S,textFitHeight:E}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||a.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:C,height:L,data:R}=e,O=e;return this.style.addImage(m,{data:new a.R({width:C,height:L},new Uint8Array(R)),pixelRatio:u,stretchX:g,stretchY:v,content:T,textFitWidth:S,textFitHeight:E,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m),this}}{let{width:C,height:L,data:R}=B.getImageData(e);this.style.addImage(m,{data:new a.R({width:C,height:L},R),pixelRatio:u,stretchX:g,stretchY:v,content:T,textFitWidth:S,textFitHeight:E,sdf:d,version:0})}}updateImage(m,e){let o=this.style.getImage(m);if(!o)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let u=e instanceof HTMLImageElement||a.b(e)?B.getImageData(e):e,{width:d,height:g,data:v}=u;if(d===void 0||g===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==o.data.width||g!==o.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let T=!(e instanceof HTMLImageElement||a.b(e));return o.data.replace(v,T),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Re.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,u={}){return this.style.setPaintProperty(m,e,o,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,u={}){return this.style.setLayoutProperty(m,e,o,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,(u=>{u||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(o=>{o||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){let m=this._container;m.classList.add("maplibregl-map");let e=this._canvasContainer=U.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);let d=this._controlContainer=U.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{g[v]=U.create("div",`maplibregl-ctrl-${v} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)}),{once:!0});let o=null;if(o=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!o){let u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new hd(o,this.transform),oe.testSupport(o)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,o,u,d,g;let v=this._idleTriggered?this._fadeDuration:0,T=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let L=this.transform.zoom,R=B.now();this.style.zoomHistory.update(L,R);let O=new a.F(L,{now:R,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),j=O.crossFadingFactor();j===1&&j===this._crossFadingFactor||(S=!0,this._crossFadingFactor=j),this.style.update(O)}let E=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0!==T;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let C=this._sourcesDirty||this._styleDirty||this._placementDirty;return C||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Re.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,B.frame(this._frameRequest,(m=>{a.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!a.cy(e)&&!(function(o){return o.message===as})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Ed}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},p.MapMouseEvent=lr,p.MapTouchEvent=ga,p.MapWheelEvent=au,p.Marker=Sa,p.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{let e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,o)=>{let u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=a.e({},rm,m),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){let o=U.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},p.Popup=class extends a.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=si(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor,d=Bl(this.options.offset);if(!u){let v=this._container.offsetWidth,T=this._container.offsetHeight,S;S=o.y+d.bottom.y<T?["top"]:o.y>this._map.transform.height-T?["bottom"]:[],o.x<v/2?S.push("left"):o.x>this._map.transform.width-v/2&&S.push("right"),u=S.length===0?"bottom":S.join("-")}let g=o.add(d[u]);this.options.subpixelPositioning||(g=g.round()),U.setTransform(this._container,`${Fl[u]} translate(${g.x}px,${g.y}px)`),Ta(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(yu),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=a.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let e=document.createDocumentFragment(),o=document.createElement("body"),u;for(o.innerHTML=m;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(_u);m&&m.focus()}},p.RasterDEMTileSource=_o,p.RasterTileSource=tn,p.ScaleControl=class{constructor(m){this._onMove=()=>{Nl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Nl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ys),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},p.ScrollZoomHandler=xd,p.Style=Oc,p.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},p.TwoFingersTouchPitchHandler=kl,p.TwoFingersTouchRotateHandler=ba,p.TwoFingersTouchZoomHandler=Ml,p.TwoFingersTouchZoomRotateHandler=Td,p.VectorTileSource=kr,p.VideoSource=ia,p.addSourceType=(m,e)=>a._(void 0,void 0,void 0,(function*(){if(Vn(m))throw new Error(`A source type called "${m}" already exists.`);((o,u)=>{jn[o]=u})(m,e)})),p.clearPrewarmedResources=function(){let m=en;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(bn),en=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},p.createTileMesh=Dc,p.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},p.getRTLTextPluginStatus=function(){return qn().getRTLTextPluginStatus()},p.getVersion=function(){return vu},p.getWorkerCount=function(){return $i.workerCount},p.getWorkerUrl=function(){return a.a.WORKER_URL},p.importScriptInWorkers=function(m){return Qo().broadcast("IS",m)},p.prewarm=function(){yo().acquire(bn)},p.setMaxParallelImageRequests=function(m){a.a.MAX_PARALLEL_IMAGE_REQUESTS=m},p.setRTLTextPlugin=function(m,e){return qn().setRTLTextPlugin(m,e)},p.setWorkerCount=function(m){$i.workerCount=m},p.setWorkerUrl=function(m){a.a.WORKER_URL=m}}));var f=s;return f}))});var xv=U0((YC,eg)=>{"use strict";var uc=typeof Reflect=="object"?Reflect:null,uv=uc&&typeof uc.apply=="function"?uc.apply:function(i,l,f){return Function.prototype.apply.call(i,l,f)},ep;uc&&typeof uc.ownKeys=="function"?ep=uc.ownKeys:Object.getOwnPropertySymbols?ep=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:ep=function(i){return Object.getOwnPropertyNames(i)};function fT(s){console&&console.warn&&console.warn(s)}var dv=Number.isNaN||function(i){return i!==i};function Ht(){Ht.init.call(this)}eg.exports=Ht;eg.exports.once=_T;Ht.EventEmitter=Ht;Ht.prototype._events=void 0;Ht.prototype._eventsCount=0;Ht.prototype._maxListeners=void 0;var hv=10;function tp(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(Ht,"defaultMaxListeners",{enumerable:!0,get:function(){return hv},set:function(s){if(typeof s!="number"||s<0||dv(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");hv=s}});Ht.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ht.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||dv(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function pv(s){return s._maxListeners===void 0?Ht.defaultMaxListeners:s._maxListeners}Ht.prototype.getMaxListeners=function(){return pv(this)};Ht.prototype.emit=function(i){for(var l=[],f=1;f<arguments.length;f++)l.push(arguments[f]);var p=i==="error",a=this._events;if(a!==void 0)p=p&&a.error===void 0;else if(!p)return!1;if(p){var b;if(l.length>0&&(b=l[0]),b instanceof Error)throw b;var P=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw P.context=b,P}var M=a[i];if(M===void 0)return!1;if(typeof M=="function")uv(M,this,l);else for(var D=M.length,B=_v(M,D),f=0;f<D;++f)uv(B[f],this,l);return!0};function fv(s,i,l,f){var p,a,b;if(tp(l),a=s._events,a===void 0?(a=s._events=Object.create(null),s._eventsCount=0):(a.newListener!==void 0&&(s.emit("newListener",i,l.listener?l.listener:l),a=s._events),b=a[i]),b===void 0)b=a[i]=l,++s._eventsCount;else if(typeof b=="function"?b=a[i]=f?[l,b]:[b,l]:f?b.unshift(l):b.push(l),p=pv(s),p>0&&b.length>p&&!b.warned){b.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.emitter=s,P.type=i,P.count=b.length,fT(P)}return s}Ht.prototype.addListener=function(i,l){return fv(this,i,l,!1)};Ht.prototype.on=Ht.prototype.addListener;Ht.prototype.prependListener=function(i,l){return fv(this,i,l,!0)};function mT(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mv(s,i,l){var f={fired:!1,wrapFn:void 0,target:s,type:i,listener:l},p=mT.bind(f);return p.listener=l,f.wrapFn=p,p}Ht.prototype.once=function(i,l){return tp(l),this.on(i,mv(this,i,l)),this};Ht.prototype.prependOnceListener=function(i,l){return tp(l),this.prependListener(i,mv(this,i,l)),this};Ht.prototype.removeListener=function(i,l){var f,p,a,b,P;if(tp(l),p=this._events,p===void 0)return this;if(f=p[i],f===void 0)return this;if(f===l||f.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete p[i],p.removeListener&&this.emit("removeListener",i,f.listener||l));else if(typeof f!="function"){for(a=-1,b=f.length-1;b>=0;b--)if(f[b]===l||f[b].listener===l){P=f[b].listener,a=b;break}if(a<0)return this;a===0?f.shift():gT(f,a),f.length===1&&(p[i]=f[0]),p.removeListener!==void 0&&this.emit("removeListener",i,P||l)}return this};Ht.prototype.off=Ht.prototype.removeListener;Ht.prototype.removeAllListeners=function(i){var l,f,p;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[i]),this;if(arguments.length===0){var a=Object.keys(f),b;for(p=0;p<a.length;++p)b=a[p],b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=f[i],typeof l=="function")this.removeListener(i,l);else if(l!==void 0)for(p=l.length-1;p>=0;p--)this.removeListener(i,l[p]);return this};function gv(s,i,l){var f=s._events;if(f===void 0)return[];var p=f[i];return p===void 0?[]:typeof p=="function"?l?[p.listener||p]:[p]:l?yT(p):_v(p,p.length)}Ht.prototype.listeners=function(i){return gv(this,i,!0)};Ht.prototype.rawListeners=function(i){return gv(this,i,!1)};Ht.listenerCount=function(s,i){return typeof s.listenerCount=="function"?s.listenerCount(i):yv.call(s,i)};Ht.prototype.listenerCount=yv;function yv(s){var i=this._events;if(i!==void 0){var l=i[s];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}Ht.prototype.eventNames=function(){return this._eventsCount>0?ep(this._events):[]};function _v(s,i){for(var l=new Array(i),f=0;f<i;++f)l[f]=s[f];return l}function gT(s,i){for(;i+1<s.length;i++)s[i]=s[i+1];s.pop()}function yT(s){for(var i=new Array(s.length),l=0;l<i.length;++l)i[l]=s[l].listener||s[l];return i}function _T(s,i){return new Promise(function(l,f){function p(b){s.removeListener(i,a),f(b)}function a(){typeof s.removeListener=="function"&&s.removeListener("error",p),l([].slice.call(arguments))}vv(s,i,a,{once:!0}),i!=="error"&&vT(s,p,{once:!0})})}function vT(s,i,l){typeof s.on=="function"&&vv(s,"error",i,l)}function vv(s,i,l,f){if(typeof s.on=="function")f.once?s.once(i,l):s.on(i,l);else if(typeof s.addEventListener=="function")s.addEventListener(i,function p(a){f.once&&s.removeEventListener(i,p),l(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}});var et=j0(ov(),1);function aT(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}var Qm=class{constructor(){this._apiKey="",this._fetch=aT(),this.tileCacheSize=200}set apiKey(i){this._apiKey=i}get apiKey(){return this._apiKey}set fetch(i){this._fetch=i}get fetch(){return this._fetch}},Is=new Qm,sT={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},lT={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},cc={...sT,...lT};function sv(s,i=cc){return s in i?s[s]:null}function Bu(s,i=cc){for(let l of Object.values(i))if(l.code===s)return l;return null}function Nu(s,i=cc){for(let l of Object.values(i))if(l.flag===s)return l;return null}function lv(s){return s!==null&&typeof s=="object"&&"code"in s&&"flag"in s&&"name"in s&&"latin"in s&&"isMode"in s&&"geocoding"in s&&(typeof s.code=="string"||s.code===null)&&typeof s.flag=="string"&&typeof s.name=="string"&&typeof s.latin=="boolean"&&typeof s.isMode=="boolean"&&typeof s.geocoding=="boolean"}function Yd(s,i=cc){return lv(s)?Nu(s.flag,i):typeof s!="string"?null:sv(s,i)||Bu(s,i)||Nu(s,i)||null}async function cT(s,i={}){if(Is.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(s).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Is.fetch(s,i)}var cv={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(cv);var Xd=class extends Error{constructor(i,l=""){super(`Call to enpoint ${i.url} failed with the status code ${i.status}. ${l}`),this.res=i}};var av={403:"Key is missing, invalid or restricted"};async function uT(s={}){let i=new URL("geolocation/ip.json",cv.maptilerApiURL);i.searchParams.set("key",s.apiKey??Is.apiKey),"elevation"in s&&i.searchParams.set("elevation",s.elevation?"true":"false");let l=i.toString(),f=await cT(l);if(!f.ok)throw new Xd(f,f.status in av?av[f.status]:"");return await f.json()}var Jd={info:uT};function Qd(s){let i=/^maptiler:\/\/(.*)/,l,f=s.trim(),p;return f.startsWith("http://")||f.startsWith("https://")?p=f:(l=i.exec(f))!==null?p=`https://api.maptiler.com/maps/${l[1]}/style.json`:p=`https://api.maptiler.com/maps/${f}/style.json`,p}var sc=class{constructor(i,l,f,p,a,b,P=!1){this.name=i,this.variantType=l,this.id=f,this.referenceStyle=p,this.description=a,this.imageURL=b,this.deprecated=P}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(i){return this.referenceStyle.hasVariant(i)}getVariant(i){let l=this.referenceStyle.getVariant(i);return this.warnIfDeprecated(l),l}getVariants(){return this.referenceStyle.getVariants().filter(i=>i!==this).map(i=>(this.warnIfDeprecated(i),i))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return Qd(this.getId())}warnIfDeprecated(i=this){if(!i.deprecated)return i;let l=i.getFullName();return console.warn(`Style "${l}" is deprecated and will be removed in a future version.`),i}},lc=class{constructor(i,l){this.name=i,this.id=l,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(i){this.variants[i.getType()]=i,this.orderedVariants.push(i)}hasVariant(i){return i in this.variants}getVariant(i){return i in this.variants?this.variants[i]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}},Ps=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function hT(s){return new Proxy(s,{get(i,l,f){return i.hasVariant(l)?i.getVariant(l):l.toString().toUpperCase()===l?s.getDefaultVariant():Reflect.get(i,l,f)}})}function dT(){let s={};for(let i=0;i<Ps.length;i+=1){let l=Ps[i],f=hT(new lc(l.name,l.referenceStyleID));for(let p=0;p<l.variants.length;p+=1){let a=l.variants[p],b=new sc(a.name,a.variantType,a.id,f,a.description,a.imageURL,a.deprecated);f.addVariant(b)}s[l.referenceStyleID]=f}return s}var Vo=dT();var pT=63710088e-1,KC=2*Math.PI*pT;var tx=j0(xv(),1);var nr=[];for(let s=0;s<256;++s)nr.push((s+256).toString(16).slice(1));function bv(s,i=0){return(nr[s[i+0]]+nr[s[i+1]]+nr[s[i+2]]+nr[s[i+3]]+"-"+nr[s[i+4]]+nr[s[i+5]]+"-"+nr[s[i+6]]+nr[s[i+7]]+"-"+nr[s[i+8]]+nr[s[i+9]]+"-"+nr[s[i+10]]+nr[s[i+11]]+nr[s[i+12]]+nr[s[i+13]]+nr[s[i+14]]+nr[s[i+15]]).toLowerCase()}var tg,xT=new Uint8Array(16);function ig(){if(!tg){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tg=crypto.getRandomValues.bind(crypto)}return tg(xT)}var bT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),rg={randomUUID:bT};function wT(s,i,l){if(rg.randomUUID&&!i&&!s)return rg.randomUUID();s=s||{};let f=s.random??s.rng?.()??ig();if(f.length<16)throw new Error("Random bytes length must be >= 16");if(f[6]=f[6]&15|64,f[8]=f[8]&63|128,i){if(l=l||0,l<0||l+16>i.length)throw new RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let p=0;p<16;++p)i[l+p]=f[p];return i}return bv(f)}var ng=wT;var Ev="3.7.8",TT=Ev,dc=typeof Buffer=="function",wv=typeof TextDecoder=="function"?new TextDecoder:void 0,Tv=typeof TextEncoder=="function"?new TextEncoder:void 0,ST="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Uu=Array.prototype.slice.call(ST),ip=(s=>{let i={};return s.forEach((l,f)=>i[l]=f),i})(Uu),IT=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,or=String.fromCharCode.bind(String),Sv=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):s=>new Uint8Array(Array.prototype.slice.call(s,0)),Av=s=>s.replace(/=/g,"").replace(/[+\/]/g,i=>i=="+"?"-":"_"),Cv=s=>s.replace(/[^A-Za-z0-9\+\/]/g,""),Mv=s=>{let i,l,f,p,a="",b=s.length%3;for(let P=0;P<s.length;){if((l=s.charCodeAt(P++))>255||(f=s.charCodeAt(P++))>255||(p=s.charCodeAt(P++))>255)throw new TypeError("invalid character found");i=l<<16|f<<8|p,a+=Uu[i>>18&63]+Uu[i>>12&63]+Uu[i>>6&63]+Uu[i&63]}return b?a.slice(0,b-3)+"===".substring(b):a},sg=typeof btoa=="function"?s=>btoa(s):dc?s=>Buffer.from(s,"binary").toString("base64"):Mv,og=dc?s=>Buffer.from(s).toString("base64"):s=>{let l=[];for(let f=0,p=s.length;f<p;f+=4096)l.push(or.apply(null,s.subarray(f,f+4096)));return sg(l.join(""))},rp=(s,i=!1)=>i?Av(og(s)):og(s),PT=s=>{if(s.length<2){var i=s.charCodeAt(0);return i<128?s:i<2048?or(192|i>>>6)+or(128|i&63):or(224|i>>>12&15)+or(128|i>>>6&63)+or(128|i&63)}else{var i=65536+(s.charCodeAt(0)-55296)*1024+(s.charCodeAt(1)-56320);return or(240|i>>>18&7)+or(128|i>>>12&63)+or(128|i>>>6&63)+or(128|i&63)}},ET=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,kv=s=>s.replace(ET,PT),Iv=dc?s=>Buffer.from(s,"utf8").toString("base64"):Tv?s=>og(Tv.encode(s)):s=>sg(kv(s)),hc=(s,i=!1)=>i?Av(Iv(s)):Iv(s),Pv=s=>hc(s,!0),AT=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,CT=s=>{switch(s.length){case 4:var i=(7&s.charCodeAt(0))<<18|(63&s.charCodeAt(1))<<12|(63&s.charCodeAt(2))<<6|63&s.charCodeAt(3),l=i-65536;return or((l>>>10)+55296)+or((l&1023)+56320);case 3:return or((15&s.charCodeAt(0))<<12|(63&s.charCodeAt(1))<<6|63&s.charCodeAt(2));default:return or((31&s.charCodeAt(0))<<6|63&s.charCodeAt(1))}},Rv=s=>s.replace(AT,CT),Lv=s=>{if(s=s.replace(/\s+/g,""),!IT.test(s))throw new TypeError("malformed base64.");s+="==".slice(2-(s.length&3));let i,l,f,p=[];for(let a=0;a<s.length;)i=ip[s.charAt(a++)]<<18|ip[s.charAt(a++)]<<12|(l=ip[s.charAt(a++)])<<6|(f=ip[s.charAt(a++)]),l===64?p.push(or(i>>16&255)):f===64?p.push(or(i>>16&255,i>>8&255)):p.push(or(i>>16&255,i>>8&255,i&255));return p.join("")},lg=typeof atob=="function"?s=>atob(Cv(s)):dc?s=>Buffer.from(s,"base64").toString("binary"):Lv,Dv=dc?s=>Sv(Buffer.from(s,"base64")):s=>Sv(lg(s).split("").map(i=>i.charCodeAt(0))),zv=s=>Dv(Ov(s)),MT=dc?s=>Buffer.from(s,"base64").toString("utf8"):wv?s=>wv.decode(Dv(s)):s=>Rv(lg(s)),Ov=s=>Cv(s.replace(/[-_]/g,i=>i=="-"?"+":"/")),ag=s=>MT(Ov(s)),kT=s=>{if(typeof s!="string")return!1;let i=s.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(i)||!/[^\s0-9a-zA-Z\-_]/.test(i)},Fv=s=>({value:s,enumerable:!1,writable:!0,configurable:!0}),Nv=function(){let s=(i,l)=>Object.defineProperty(String.prototype,i,Fv(l));s("fromBase64",function(){return ag(this)}),s("toBase64",function(i){return hc(this,i)}),s("toBase64URI",function(){return hc(this,!0)}),s("toBase64URL",function(){return hc(this,!0)}),s("toUint8Array",function(){return zv(this)})},Bv=function(){let s=(i,l)=>Object.defineProperty(Uint8Array.prototype,i,Fv(l));s("toBase64",function(i){return rp(this,i)}),s("toBase64URI",function(){return rp(this,!0)}),s("toBase64URL",function(){return rp(this,!0)})},RT=()=>{Nv(),Bv()},Uv={version:Ev,VERSION:TT,atob:lg,atobPolyfill:Lv,btoa:sg,btoaPolyfill:Mv,fromBase64:ag,toBase64:hc,encode:hc,encodeURI:Pv,encodeURL:Pv,utob:kv,btou:Rv,decode:ag,isValid:kT,fromUint8Array:rp,toUint8Array:zv,extendString:Nv,extendUint8Array:Bv,extendBuiltins:RT};var LT=Object.defineProperty,ex=s=>{throw TypeError(s)},DT=(s,i,l)=>i in s?LT(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l,Ze=(s,i,l)=>DT(s,typeof i!="symbol"?i+"":i,l),ly=(s,i,l)=>i.has(s)||ex("Cannot "+l),it=(s,i,l)=>(ly(s,i,"read from private field"),l?l.call(s):i.get(s)),Cr=(s,i,l)=>i.has(s)?ex("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,l),Xr=(s,i,l,f)=>(ly(s,i,"write to private field"),f?f.call(s,l):i.set(s,l),l),Hr=(s,i,l)=>(ly(s,i,"access private method"),l),zt={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...cc};function jv(){if(typeof navigator>"u"){let s=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Bu(s)||zt.ENGLISH}return Array.from(new Set(navigator.languages.map(s=>s.split("-")[0]))).map(s=>Bu(s)).filter(s=>s)[0]??zt.LOCAL}var wr={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:zt.STYLE,secondaryLanguage:zt.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(wr);var cy=ng(),wg=class extends tx.default{constructor(){super(...arguments),Ze(this,"primaryLanguage",wr.primaryLanguage),Ze(this,"secondaryLanguage"),Ze(this,"session",!0),Ze(this,"caching",!0),Ze(this,"telemetry",!0),Ze(this,"_unit","metric"),Ze(this,"_apiKey","")}set unit(i){this._unit=i,this.emit("unit",i)}get unit(){return this._unit}set apiKey(i){this._apiKey=i,Is.apiKey=i,this.emit("apiKey",i)}get apiKey(){return this._apiKey}set fetch(i){Is.fetch=i}get fetch(){return Is.fetch}},li=new wg,Tg="localcache_source",Sg="localcache",zT="maptiler_sdk",OT=1e3,FT=100,Ig=typeof caches<"u",{addProtocol:Vv}=et.default;function NT(s,i){if(Ig&&li.caching&&li.session&&s.host===wr.maptilerApiHost){if(i==="Source"&&s.href.includes("tiles.json"))return s.href.replace("https://",`${Tg}://`);if(i==="Tile"||i==="Glyphs")return s.href.replace("https://",`${Sg}://`)}return s.href}var cg;async function ix(){return cg||(cg=await caches.open(zT)),cg}var $v=0;async function BT(){let s=await ix(),i=await s.keys(),l=i.slice(0,Math.max(i.length-OT,0));for(let f of l)s.delete(f)}function UT(){Vv(Tg,async(s,i)=>{if(!s.url)throw new Error("");s.url=s.url.replace(`${Tg}://`,"https://");let l=s;l.signal=i.signal;let f=await fetch(s.url,l),p=await f.json();return p.tiles&&p.tiles.length>0&&(p.tiles[0]+=`&last-modified=${f.headers.get("Last-Modified")}`),{data:p,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}}),Vv(Sg,async(s,i)=>{if(!s.url)throw new Error("");s.url=s.url.replace(`${Sg}://`,"https://");let l=new URL(s.url),f=new URL(l);f.searchParams.delete("mtsid"),f.searchParams.delete("key");let p=f.toString(),a=new URL(l);a.searchParams.delete("last-modified");let b=a.toString(),P=async oe=>({data:await oe.arrayBuffer(),cacheControl:oe.headers.get("Cache-Control"),expires:oe.headers.get("Expires")}),M=await ix(),D=await M.match(p);if(D)return P(D);let B=s;B.signal=i.signal;let U=await fetch(b,B);return U.status>=200&&U.status<300&&(M.put(p,U.clone()).catch(()=>{}),++$v>FT&&(BT(),$v=0)),P(U)})}function jT(){if(typeof window>"u")return;let s=et.default.getRTLTextPluginStatus();if(s==="unavailable"||s==="requested")try{et.default.setRTLTextPlugin(wr.rtlPluginURL,!0)}catch{}}function VT(s,i){for(let l of s)typeof i[l]=="function"&&(i[l]=i[l].bind(i))}function Gv(s,i){let l=null;try{l=new URL(s)}catch{return{url:s}}return l.host===wr.maptilerApiHost&&(l.searchParams.has("key")||l.searchParams.append("key",li.apiKey),li.session&&l.searchParams.append("mtsid",cy)),{url:NT(l,i)}}function qv(s){return(i,l)=>{if(s!=null){let f=s(i,l),p=Gv(f?.url??"",l);return{...f,...p}}return Gv(i,l)}}function rx(){return Math.random().toString(36).substring(2)}function Lp(s){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(s)}function $T(s){try{return JSON.parse(s)}catch{}return null}function GT(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function qT(s){let i=GT();if(!i)return;let l=null;if(typeof s=="string"?l=document.getElementById(s):s instanceof HTMLElement&&(l=s),!l)throw new Error("The Map container must be provided.");let f=document.createElement("div");throw f.innerHTML=i,f.classList.add("webgl-warning-div"),l.appendChild(f),new Error(i)}function Zv(s,i){return!(!Array.isArray(s)||s.length!==2||s[0]!=="get"||typeof s[1]!="string"||i&&!s[1].startsWith("name:")||!i&&s[1]!=="name")}function ZT(s,i,l){let f=structuredClone(s),p=a=>{if(typeof a!="string")for(let b=0;b<a.length;b+=1)Zv(a[b],l)?a[b]=structuredClone(i):p(a[b])};return Zv(f,l)?i:(p(f),f)}function WT(s,i){let l=i?/\{name:\S+\}/:/\{name\}/;return{contains:l.test(s),exactMatch:new RegExp(`^${l.source}$`).test(s)}}function HT(s,i,l){let f=l?/\{name:\S+\}/:/\{name\}/,p=s.split(f);return["concat",...p.flatMap((a,b)=>b===p.length-1?[a]:[a,i])]}function KT(s){var i;let l=/\{name(?::(?<language>\S+))?\}/g,f=[];for(;;){let p=l.exec(s);if(!p)break;let a=((i=p.groups)==null?void 0:i.language)??null;f.push(a)}return f}function XT(s){return!Array.isArray(s)||s.length!==2||s[0]!=="get"||typeof s[1]!="string"?null:s[1].trim()==="name"?{isLanguage:!0,localization:null}:s[1].trim().startsWith("name:")?{isLanguage:!0,localization:s[1].trim().split(":").pop()}:null}function YT(s){let i=[],l=structuredClone(s),f=p=>{if(typeof p!="string")for(let a=0;a<p.length;a+=1){let b=XT(p[a]);b?i.push(b.localization):f(p[a])}};return f([l]),i}function JT(s,i){let l=[];for(let a of s){if(a.type!=="symbol")continue;let b=a,{id:P,layout:M}=b;if(!M||!("text-field"in M))continue;let D=i.getLayoutProperty(P,"text-field");if(D)if(typeof D=="string"){let B=KT(D);l.push(B)}else{let B=YT(D);l.push(B)}}let f=l.flat(),p={unlocalized:0,localized:{}};for(let a of f)a===null?p.unlocalized+=1:(a in p.localized||(p.localized[a]=0),p.localized[a]+=1);return p}var nx=class extends et.default.Marker{addTo(s){return super.addTo(s)}},Wv=class extends et.default.Popup{addTo(i){return super.addTo(i)}},Hv=class extends et.default.Style{constructor(i,l={}){super(i,l)}},Kv=class extends et.default.CanvasSource{onAdd(i){super.onAdd(i)}},Xv=class extends et.default.GeoJSONSource{onAdd(i){super.onAdd(i)}},Yv=class extends et.default.ImageSource{onAdd(i){super.onAdd(i)}},Jv=class extends et.default.RasterTileSource{onAdd(i){super.onAdd(i)}},Qv=class extends et.default.RasterDEMTileSource{onAdd(i){super.onAdd(i)}},e1=class extends et.default.VectorTileSource{onAdd(i){super.onAdd(i)}},t1=class extends et.default.VideoSource{onAdd(i){super.onAdd(i)}},Pg=class extends et.default.NavigationControl{onAdd(i){return super.onAdd(i)}},Eg=class extends et.default.GeolocateControl{onAdd(i){return super.onAdd(i)}},i1=class extends et.default.AttributionControl{onAdd(i){return super.onAdd(i)}},Ag=class extends et.default.LogoControl{onAdd(i){return super.onAdd(i)}},Cg=class extends et.default.ScaleControl{onAdd(i){return super.onAdd(i)}},Mg=class extends et.default.FullscreenControl{onAdd(i){return super.onAdd(i)}},r1=class extends et.default.TerrainControl{onAdd(i){return super.onAdd(i)}},n1=class extends et.default.BoxZoomHandler{constructor(i,l){super(i,l)}},o1=class extends et.default.ScrollZoomHandler{constructor(i,l){super(i,l)}},a1=class extends et.default.CooperativeGesturesHandler{constructor(i,l){super(i,l)}},s1=class extends et.default.KeyboardHandler{constructor(i){super(i)}},l1=class extends et.default.TwoFingersTouchPitchHandler{constructor(i){super(i)}},c1=class extends et.default.MapWheelEvent{constructor(i,l,f){super(i,l,f)}},u1=class extends et.default.MapTouchEvent{constructor(i,l,f){super(i,l,f)}},h1=class extends et.default.MapMouseEvent{constructor(i,l,f,p={}){super(i,l,f,p)}},mp=class extends Ag{constructor(i={}){super(i),Ze(this,"logoURL",""),Ze(this,"linkURL",""),this.logoURL=i.logoURL??wr.maptilerLogoURL,this.linkURL=i.linkURL??wr.maptilerURL}onAdd(i){this._map=i,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";let l=window.document.createElement("a");return l.style.backgroundRepeat="no-repeat",l.style.cursor="pointer",l.style.display="block",l.style.height="23px",l.style.margin="0 0 -4px -4px",l.style.overflow="hidden",l.style.width="88px",l.style.backgroundImage=`url(${this.logoURL})`,l.style.backgroundSize="100px 30px",l.style.width="100px",l.style.height="30px",l.target="_blank",l.rel="noopener",l.href=this.linkURL,l.setAttribute("aria-label","MapTiler logo"),l.setAttribute("rel","noopener"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},QT=8,eS={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},tS={"*":{type:"source"}},iS=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],rS={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},nS={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},oS={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},aS={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},sS={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},lS={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},cS={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},uS=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],hS={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},dS={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},pS={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},fS={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},mS={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},gS={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},yS={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},_S={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},vS={type:"array",value:"*"},xS={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},bS={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},wS={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},TS={type:"array",value:"*",minimum:1},SS={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},IS={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},PS={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},ES={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},AS=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],CS={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},MS={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},kS={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},RS={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},LS={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},DS={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},zS={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},OS={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},FS={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},NS={"*":{type:"string"}},BS={$version:QT,$root:eS,sources:tS,source:iS,source_vector:rS,source_raster:nS,source_raster_dem:oS,source_geojson:aS,source_video:sS,source_image:lS,layer:cS,layout:uS,layout_background:hS,layout_fill:dS,layout_circle:pS,layout_heatmap:fS,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:mS,layout_symbol:gS,layout_raster:yS,layout_hillshade:_S,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:vS,filter_operator:xS,geometry_type:bS,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:wS,expression:TS,light:SS,sky:IS,terrain:PS,projection:ES,paint:AS,paint_fill:CS,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:MS,paint_circle:kS,paint_heatmap:RS,paint_symbol:LS,paint_raster:DS,paint_hillshade:zS,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:OS,transition:FS,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:NS},Fe=class{constructor(i,l,f,p){this.message=(i?`${i}: `:"")+f,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}};function gp(s,...i){for(let l of i)for(let f in l)s[f]=l[f];return s}var pn=class extends Error{constructor(i,l){super(l),this.message=l,this.key=i}},kg=class s{constructor(i,l=[]){this.parent=i,this.bindings={};for(let[f,p]of l)this.bindings[f]=p}concat(i){return new s(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return this.bindings[i]?!0:this.parent?this.parent.has(i):!1}},Dp={kind:"null"},$e={kind:"number"},Ct={kind:"string"},Pt={kind:"boolean"},lo={kind:"color"},zp={kind:"projectionDefinition"},Os={kind:"object"},Tt={kind:"value"},US={kind:"error"},Op={kind:"collator"},Fp={kind:"formatted"},Np={kind:"padding"},Ju={kind:"colorArray"},Bp={kind:"numberArray"},fh={kind:"resolvedImage"},Up={kind:"variableAnchorOffsetCollection"};function Yr(s,i){return{kind:"array",itemType:s,N:i}}function ci(s){if(s.kind==="array"){let i=ci(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}else return s.kind}var jS=[Dp,$e,Ct,Pt,lo,zp,Fp,Os,Yr(Tt),Np,Bp,Ju,fh,Up];function Qu(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Qu(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(let l of jS)if(!Qu(l,i))return null}}return`Expected ${ci(s)} but found ${ci(i)} instead.`}function uy(s,i){return i.some(l=>l.kind===s.kind)}function Fs(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function Da(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}var ox=.96422,ax=1,sx=.82521,lx=4/29,gc=6/29,cx=3*gc*gc,VS=gc*gc*gc,$S=Math.PI/180,GS=180/Math.PI;function ux(s){return s=s%360,s<0&&(s+=360),s}function hx([s,i,l,f]){s=ug(s),i=ug(i),l=ug(l);let p,a,b=hg((.2225045*s+.7168786*i+.0606169*l)/ax);s===i&&i===l?p=a=b:(p=hg((.4360747*s+.3850649*i+.1430804*l)/ox),a=hg((.0139322*s+.0971045*i+.7141733*l)/sx));let P=116*b-16;return[P<0?0:P,500*(p-b),200*(b-a),f]}function ug(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function hg(s){return s>VS?Math.pow(s,1/3):s/cx+lx}function dx([s,i,l,f]){let p=(s+16)/116,a=isNaN(i)?p:p+i/500,b=isNaN(l)?p:p-l/200;return p=ax*pg(p),a=ox*pg(a),b=sx*pg(b),[dg(3.1338561*a-1.6168667*p-.4906146*b),dg(-.9787684*a+1.9161415*p+.033454*b),dg(.0719453*a-.2289914*p+1.4052427*b),f]}function dg(s){return s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055,s<0?0:s>1?1:s}function pg(s){return s>gc?s*s*s:cx*(s-lx)}function qS(s){let[i,l,f,p]=hx(s),a=Math.sqrt(l*l+f*f);return[Math.round(a*1e4)?ux(Math.atan2(f,l)*GS):NaN,a,i,p]}function ZS([s,i,l,f]){return s=isNaN(s)?0:s*$S,dx([l,Math.cos(s)*i,Math.sin(s)*i,f])}function WS([s,i,l,f]){s=ux(s),i/=100,l/=100;function p(a){let b=(a+s/30)%12,P=i*Math.min(l,1-l);return l-P*Math.max(-1,Math.min(b-3,9-b,1))}return[p(0),p(8),p(4),f]}var HS=Object.hasOwn||function(s,i){return Object.prototype.hasOwnProperty.call(s,i)};function Zu(s,i){return HS(s,i)?s[i]:void 0}function KS(s){if(s=s.toLowerCase().trim(),s==="transparent")return[0,0,0,0];let i=Zu(XS,s);if(i){let[p,a,b]=i;return[p/255,a/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){let p=s.length<6?1:2,a=1;return[np(s.slice(a,a+=p)),np(s.slice(a,a+=p)),np(s.slice(a,a+=p)),np(s.slice(a,a+p)||"ff")]}if(s.startsWith("rgb")){let p=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,a=s.match(p);if(a){let[b,P,M,D,B,U,oe,le,me,xe,Ce,ke]=a,Re=[D||" ",oe||" ",xe].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){let We=[M,U,me].join(""),rt=We==="%%%"?100:We===""?255:0;if(rt){let qe=[fc(+P/rt,0,1),fc(+B/rt,0,1),fc(+le/rt,0,1),Ce?d1(+Ce,ke):1];if(p1(qe))return qe}}return}}let l=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,f=s.match(l);if(f){let[p,a,b,P,M,D,B,U,oe]=f,le=[b||" ",M||" ",B].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){let me=[+a,fc(+P,0,100),fc(+D,0,100),U?d1(+U,oe):1];if(p1(me))return WS(me)}}}function np(s){return parseInt(s.padEnd(2,s),16)/255}function d1(s,i){return fc(i?s/100:s,0,1)}function fc(s,i,l){return Math.min(Math.max(i,s),l)}function p1(s){return!s.some(Number.isNaN)}var XS={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ns(s,i,l){return s+l*(i-s)}function eh(s,i,l){return s.map((f,p)=>Ns(f,i[p],l))}var Xt=class s{constructor(i,l,f,p=1,a=!0){this.r=i,this.g=l,this.b=f,this.a=p,a||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[i,l,f,p]))}static parse(i){if(i instanceof s)return i;if(typeof i!="string")return;let l=KS(i);if(l)return new s(...l,!1)}get rgb(){let{r:i,g:l,b:f,a:p}=this,a=p||1/0;return this.overwriteGetter("rgb",[i/a,l/a,f/a,p])}get hcl(){return this.overwriteGetter("hcl",qS(this.rgb))}get lab(){return this.overwriteGetter("lab",hx(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){let[i,l,f,p]=this.rgb;return`rgba(${[i,l,f].map(a=>Math.round(a*255)).join(",")},${p})`}static interpolate(i,l,f,p="rgb"){switch(p){case"rgb":{let[a,b,P,M]=eh(i.rgb,l.rgb,f);return new s(a,b,P,M,!1)}case"hcl":{let[a,b,P,M]=i.hcl,[D,B,U,oe]=l.hcl,le,me;if(!isNaN(a)&&!isNaN(D)){let We=D-a;D>a&&We>180?We-=360:D<a&&a-D>180&&(We+=360),le=a+f*We}else isNaN(a)?isNaN(D)?le=NaN:(le=D,(P===1||P===0)&&(me=B)):(le=a,(U===1||U===0)&&(me=b));let[xe,Ce,ke,Re]=ZS([le,me??Ns(b,B,f),Ns(P,U,f),Ns(M,oe,f)]);return new s(xe,Ce,ke,Re,!1)}case"lab":{let[a,b,P,M]=dx(eh(i.lab,l.lab,f));return new s(a,b,P,M,!1)}}}};Xt.black=new Xt(0,0,0,1);Xt.white=new Xt(1,1,1,1);Xt.transparent=new Xt(0,0,0,0);Xt.red=new Xt(1,0,0,1);var th=class{constructor(i,l,f){i?this.sensitivity=l?"variant":"case":this.sensitivity=l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},YS=["bottom","center","top"],ih=class{constructor(i,l,f,p,a,b){this.text=i,this.image=l,this.scale=f,this.fontStack=p,this.textColor=a,this.verticalAlign=b}},js=class s{constructor(i){this.sections=i}static fromString(i){return new s([new ih(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof s?i:s.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}},qo=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="number")return new s([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(let l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]];break}return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,f){return new s(eh(i.values,l.values,f))}},Zo=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="number")return new s([i]);if(Array.isArray(i)){for(let l of i)if(typeof l!="number")return;return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,f){return new s(eh(i.values,l.values,f))}},Dn=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(typeof i=="string"){let f=Xt.parse(i);return f?new s([f]):void 0}if(!Array.isArray(i))return;let l=[];for(let f of i){if(typeof f!="string")return;let p=Xt.parse(f);if(!p)return;l.push(p)}return new s(l)}toString(){return JSON.stringify(this.values)}static interpolate(i,l,f,p="rgb"){let a=[];if(i.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let b=0;b<i.values.length;b++)a.push(Xt.interpolate(i.values[b],l.values[b],f,p));return new s(a)}},ri=class extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}},JS=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),Wo=class s{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof s)return i;if(!(!Array.isArray(i)||i.length<1||i.length%2!==0)){for(let l=0;l<i.length;l+=2){let f=i[l],p=i[l+1];if(typeof f!="string"||!JS.has(f)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new s(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,f){let p=i.values,a=l.values;if(p.length!==a.length)throw new ri(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${l.toString()}`);let b=[];for(let P=0;P<p.length;P+=2){if(p[P]!==a[P])throw new ri(`Cannot interpolate values containing mismatched anchors. from[${P}]: ${p[P]}, to[${P}]: ${a[P]}`);b.push(p[P]);let[M,D]=p[P+1],[B,U]=a[P+1];b.push([Ns(M,B,f),Ns(D,U,f)])}return new s(b)}},Na=class s{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new s({name:i,available:!1}):null}},Vs=class s{constructor(i,l,f){this.from=i,this.to=l,this.transition=f}static interpolate(i,l,f){return new s(i,l,f)}static parse(i){if(i instanceof s)return i;if(Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number")return new s(i[0],i[1],i[2]);if(typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number")return new s(i.from,i.to,i.transition);if(typeof i=="string")return new s(i,i,1)}};function px(s,i,l,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?typeof f>"u"||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,l,f]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rh(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Vs||s instanceof Xt||s instanceof th||s instanceof js||s instanceof qo||s instanceof Zo||s instanceof Dn||s instanceof Wo||s instanceof Na)return!0;if(Array.isArray(s)){for(let i of s)if(!rh(i))return!1;return!0}else if(typeof s=="object"){for(let i in s)if(!rh(s[i]))return!1;return!0}else return!1}function Di(s){if(s===null)return Dp;if(typeof s=="string")return Ct;if(typeof s=="boolean")return Pt;if(typeof s=="number")return $e;if(s instanceof Xt)return lo;if(s instanceof Vs)return zp;if(s instanceof th)return Op;if(s instanceof js)return Fp;if(s instanceof qo)return Np;if(s instanceof Zo)return Bp;if(s instanceof Dn)return Ju;if(s instanceof Wo)return Up;if(s instanceof Na)return fh;if(Array.isArray(s)){let i=s.length,l;for(let f of s){let p=Di(f);if(!l)l=p;else{if(l===p)continue;l=Tt;break}}return Yr(l||Tt,i)}else return Os}function Wu(s){let i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof Xt||s instanceof Vs||s instanceof js||s instanceof qo||s instanceof Zo||s instanceof Dn||s instanceof Wo||s instanceof Na?s.toString():JSON.stringify(s)}var yc=class s{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!rh(i[1]))return l.error("invalid value");let f=i[1],p=Di(f),a=l.expectedType;return p.kind==="array"&&p.N===0&&a&&a.kind==="array"&&(typeof a.N!="number"||a.N===0)&&(p=a),new s(p,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},op={string:Ct,number:$e,boolean:Pt,object:Os},Ln=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f=1,p,a=i[0];if(a==="array"){let P;if(i.length>2){let D=i[1];if(typeof D!="string"||!(D in op)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);P=op[D],f++}else P=Tt;let M;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=i[2],f++}p=Yr(P,M)}else{if(!op[a])throw new Error(`Types doesn't contain name = ${a}`);p=op[a]}let b=[];for(;f<i.length;f++){let P=l.parse(i[f],f,Tt);if(!P)return null;b.push(P)}return new s(p,b)}evaluate(i){for(let l=0;l<this.args.length;l++){let f=this.args[l].evaluate(i);if(Qu(this.type,Di(f))){if(l===this.args.length-1)throw new ri(`Expected value to be of type ${ci(this.type)}, but found ${ci(Di(f))} instead.`)}else return f}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},f1={"to-boolean":Pt,"to-color":lo,"to-number":$e,"to-string":Ct},za=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f=i[0];if(!f1[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return l.error("Expected one argument.");let p=f1[f],a=[];for(let b=1;b<i.length;b++){let P=l.parse(i[b],b,Tt);if(!P)return null;a.push(P)}return new s(p,a)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,f;for(let p of this.args){if(l=p.evaluate(i),f=null,l instanceof Xt)return l;if(typeof l=="string"){let a=i.parseColor(l);if(a)return a}else if(Array.isArray(l)&&(l.length<3||l.length>4?f=`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:f=px(l[0],l[1],l[2],l[3]),!f))return new Xt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ri(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(let f of this.args){l=f.evaluate(i);let p=qo.parse(l);if(p)return p}throw new ri(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(let f of this.args){l=f.evaluate(i);let p=Zo.parse(l);if(p)return p}throw new ri(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(let f of this.args){l=f.evaluate(i);let p=Dn.parse(l);if(p)return p}throw new ri(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(let f of this.args){l=f.evaluate(i);let p=Wo.parse(l);if(p)return p}throw new ri(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(let f of this.args){if(l=f.evaluate(i),l===null)return 0;let p=Number(l);if(!isNaN(p))return p}throw new ri(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return js.fromString(Wu(this.args[0].evaluate(i)));case"resolvedImage":return Na.fromString(Wu(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Wu(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},QS=["Unknown","Point","LineString","Polygon"],yp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?QS[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache.get(i);return l||(l=Xt.parse(i),this._parseColorCache.set(i,l)),l}},_p=class s{constructor(i,l,f=[],p,a=new kg,b=[]){this.registry=i,this.path=f,this.key=f.map(P=>`[${P}]`).join(""),this.scope=a,this.errors=b,this.expectedType=p,this._isConstant=l}parse(i,l,f,p,a={}){return l?this.concat(l,f,p)._parse(i,a):this._parse(i,a)}_parse(i,l){(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number")&&(i=["literal",i]);function f(p,a,b){return b==="assert"?new Ln(a,[p]):b==="coerce"?new za(a,[p]):p}if(Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=i[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let a=this.registry[p];if(a){let b=a.parse(i,this);if(!b)return null;if(this.expectedType){let P=this.expectedType,M=b.type;if((P.kind==="string"||P.kind==="number"||P.kind==="boolean"||P.kind==="object"||P.kind==="array")&&M.kind==="value")b=f(b,P,l.typeAnnotation||"assert");else if(P.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(P.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(P.kind)&&["value","number","array"].includes(M.kind)||P.kind==="colorArray"&&["value","string","array"].includes(M.kind)||P.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))b=f(b,P,l.typeAnnotation||"coerce");else if(this.checkSubtype(P,M))return null}if(!(b instanceof yc)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){let P=new yp;try{b=new yc(b.type,b.evaluate(P))}catch(M){return this.error(M.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof i>"u"?this.error("'undefined' value invalid. Use null instead."):typeof i=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof i} instead.`)}concat(i,l,f){let p=typeof i=="number"?this.path.concat(i):this.path,a=f?this.scope.concat(f):this.scope;return new s(this.registry,this._isConstant,p,l||null,a,this.errors)}error(i,...l){let f=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new pn(f,i))}checkSubtype(i,l){let f=Qu(i,l);return f&&this.error(f),f}},vp=class s{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let f=[];for(let a=1;a<i.length-1;a+=2){let b=i[a];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,a);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",a);let P=l.parse(i[a+1],a+1);if(!P)return null;f.push([b,P])}let p=l.parse(i[i.length-1],i.length-1,l.expectedType,f);return p?new s(f,p):null}outputDefined(){return this.result.outputDefined()}},xp=class s{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let f=i[1];return l.scope.has(f)?new s(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}},Rg=class s{constructor(i,l,f){this.type=i,this.index=l,this.input=f}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let f=l.parse(i[1],1,$e),p=l.parse(i[2],2,Yr(l.expectedType||Tt));if(!f||!p)return null;let a=p.type;return new s(a.itemType,f,p)}evaluate(i){let l=this.index.evaluate(i),f=this.input.evaluate(i);if(l<0)throw new ri(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new ri(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new ri(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}},Lg=class s{constructor(i,l){this.type=Pt,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let f=l.parse(i[1],1,Tt),p=l.parse(i[2],2,Tt);return!f||!p?null:uy(f.type,[Pt,Ct,$e,Dp,Tt])?new s(f,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(f.type)} instead`)}evaluate(i){let l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!Fs(l,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Di(l))} instead.`);if(!Fs(f,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${ci(Di(f))} instead.`);return f.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}},Dg=class s{constructor(i,l,f){this.type=$e,this.needle=i,this.haystack=l,this.fromIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let f=l.parse(i[1],1,Tt),p=l.parse(i[2],2,Tt);if(!f||!p)return null;if(!uy(f.type,[Pt,Ct,$e,Dp,Tt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(f.type)} instead`);if(i.length===4){let a=l.parse(i[3],3,$e);return a?new s(f,p,a):null}else return new s(f,p)}evaluate(i){let l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!Fs(l,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Di(l))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(i)),Fs(f,["string"])){let a=f.indexOf(l,p);return a===-1?-1:[...f.slice(0,a)].length}else{if(Fs(f,["array"]))return f.indexOf(l,p);throw new ri(`Expected second argument to be of type array or string, but found ${ci(Di(f))} instead.`)}}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}},zg=class s{constructor(i,l,f,p,a,b){this.inputType=i,this.type=l,this.input=f,this.cases=p,this.outputs=a,this.otherwise=b}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!==1)return l.error("Expected an even number of arguments.");let f,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);let a={},b=[];for(let D=2;D<i.length-1;D+=2){let B=i[D],U=i[D+1];Array.isArray(B)||(B=[B]);let oe=l.concat(D);if(B.length===0)return oe.error("Expected at least one branch label.");for(let me of B){if(typeof me!="number"&&typeof me!="string")return oe.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof me=="number"&&Math.floor(me)!==me)return oe.error("Numeric branch labels must be integer values.");if(!f)f=Di(me);else if(oe.checkSubtype(f,Di(me)))return null;if(typeof a[String(me)]<"u")return oe.error("Branch labels must be unique.");a[String(me)]=b.length}let le=l.parse(U,D,p);if(!le)return null;p=p||le.type,b.push(le)}let P=l.parse(i[1],1,Tt);if(!P)return null;let M=l.parse(i[i.length-1],i.length-1,p);return!M||P.type.kind!=="value"&&l.concat(1).checkSubtype(f,P.type)?null:new s(f,p,P,a,b,M)}evaluate(i){let l=this.input.evaluate(i);return(Di(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}},Og=class s{constructor(i,l,f){this.type=i,this.branches=l,this.otherwise=f}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!==0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);let p=[];for(let b=1;b<i.length-1;b+=2){let P=l.parse(i[b],b,Pt);if(!P)return null;let M=l.parse(i[b+1],b+1,f);if(!M)return null;p.push([P,M]),f=f||M.type}let a=l.parse(i[i.length-1],i.length-1,f);if(!a)return null;if(!f)throw new Error("Can't infer output type");return new s(f,p,a)}evaluate(i){for(let[l,f]of this.branches)if(l.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[l,f]of this.branches)i(l),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}},Fg=class s{constructor(i,l,f,p){this.type=i,this.input=l,this.beginIndex=f,this.endIndex=p}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let f=l.parse(i[1],1,Tt),p=l.parse(i[2],2,$e);if(!f||!p)return null;if(!uy(f.type,[Yr(Tt),Ct,Tt]))return l.error(`Expected first argument to be of type array or string, but found ${ci(f.type)} instead`);if(i.length===4){let a=l.parse(i[3],3,$e);return a?new s(f.type,f,p,a):null}else return new s(f.type,f,p)}evaluate(i){let l=this.input.evaluate(i),f=this.beginIndex.evaluate(i),p;if(this.endIndex&&(p=this.endIndex.evaluate(i)),Fs(l,["string"]))return[...l].slice(f,p).join("");if(Fs(l,["array"]))return l.slice(f,p);throw new ri(`Expected first argument to be of type array or string, but found ${ci(Di(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}};function fx(s,i){let l=s.length-1,f=0,p=l,a=0,b,P;for(;f<=p;)if(a=Math.floor((f+p)/2),b=s[a],P=s[a+1],b<=i){if(a===l||i<P)return a;f=a+1}else if(b>i)p=a-1;else throw new ri("Input is not a number.");return 0}var bp=class s{constructor(i,l,f){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(let[p,a]of f)this.labels.push(p),this.outputs.push(a)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return l.error("Expected an even number of arguments.");let f=l.parse(i[1],1,$e);if(!f)return null;let p=[],a=null;l.expectedType&&l.expectedType.kind!=="value"&&(a=l.expectedType);for(let b=1;b<i.length;b+=2){let P=b===1?-1/0:i[b],M=i[b+1],D=b,B=b+1;if(typeof P!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=P)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let U=l.parse(M,B,a);if(!U)return null;a=a||U.type,p.push([P,U])}return new s(a,f,p)}evaluate(i){let l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);let p=this.input.evaluate(i);if(p<=l[0])return f[0].evaluate(i);let a=l.length;if(p>=l[a-1])return f[a-1].evaluate(i);let b=fx(l,p);return f[b].evaluate(i)}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function eI(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var fg,m1;function tI(){if(m1)return fg;m1=1,fg=s;function s(i,l,f,p){this.cx=3*i,this.bx=3*(f-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=f,this.p2y=p}return s.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var f=i,p=0;p<8;p++){var a=this.sampleCurveX(f)-i;if(Math.abs(a)<l)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f=f-a/b}var P=0,M=1;for(f=i,p=0;p<20&&(a=this.sampleCurveX(f),!(Math.abs(a-i)<l));p++)i>a?P=f:M=f,f=(M-P)*.5+P;return f},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},fg}var iI=tI(),rI=eI(iI),$o=class s{constructor(i,l,f,p,a){this.type=i,this.operator=l,this.interpolation=f,this.input=p,this.labels=[],this.outputs=[];for(let[b,P]of a)this.labels.push(b),this.outputs.push(P)}static interpolationFactor(i,l,f,p){let a=0;if(i.name==="exponential")a=mg(l,i.base,f,p);else if(i.name==="linear")a=mg(l,1,f,p);else if(i.name==="cubic-bezier"){let b=i.controlPoints;a=new rI(b[0],b[1],b[2],b[3]).solve(mg(l,1,f,p))}return a}static parse(i,l){let[f,p,a,...b]=i;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let D=p[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else if(p[0]==="cubic-bezier"){let D=p.slice(1);if(D.length!==4||D.some(B=>typeof B!="number"||B<0||B>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}else return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return l.error("Expected an even number of arguments.");if(a=l.parse(a,2,$e),!a)return null;let P=[],M=null;(f==="interpolate-hcl"||f==="interpolate-lab")&&l.expectedType!=Ju?M=lo:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let D=0;D<b.length;D+=2){let B=b[D],U=b[D+1],oe=D+3,le=D+4;if(typeof B!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(P.length&&P[P.length-1][0]>=B)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);let me=l.parse(U,le,M);if(!me)return null;M=M||me.type,P.push([B,me])}return!Da(M,$e)&&!Da(M,zp)&&!Da(M,lo)&&!Da(M,Np)&&!Da(M,Bp)&&!Da(M,Ju)&&!Da(M,Up)&&!Da(M,Yr($e))?l.error(`Type ${ci(M)} is not interpolatable.`):new s(M,f,p,a,P)}evaluate(i){let l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);let p=this.input.evaluate(i);if(p<=l[0])return f[0].evaluate(i);let a=l.length;if(p>=l[a-1])return f[a-1].evaluate(i);let b=fx(l,p),P=l[b],M=l[b+1],D=s.interpolationFactor(this.interpolation,p,P,M),B=f[b].evaluate(i),U=f[b+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ns(B,U,D);case"color":return Xt.interpolate(B,U,D);case"padding":return qo.interpolate(B,U,D);case"colorArray":return Dn.interpolate(B,U,D);case"numberArray":return Zo.interpolate(B,U,D);case"variableAnchorOffsetCollection":return Wo.interpolate(B,U,D);case"array":return eh(B,U,D);case"projectionDefinition":return Vs.interpolate(B,U,D)}case"interpolate-hcl":switch(this.type.kind){case"color":return Xt.interpolate(B,U,D,"hcl");case"colorArray":return Dn.interpolate(B,U,D,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Xt.interpolate(B,U,D,"lab");case"colorArray":return Dn.interpolate(B,U,D,"lab")}}}eachChild(i){i(this.input);for(let l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function mg(s,i,l,f){let p=f-l,a=s-l;return p===0?0:i===1?a/p:(Math.pow(i,a)-1)/(Math.pow(i,p)-1)}Xt.interpolate,qo.interpolate,Zo.interpolate,Dn.interpolate,Wo.interpolate;var wp=class s{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f=null,p=l.expectedType;p&&p.kind!=="value"&&(f=p);let a=[];for(let b of i.slice(1)){let P=l.parse(b,1+a.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,a.push(P)}if(!f)throw new Error("No output type");return p&&a.some(b=>Qu(p,b.type))?new s(Tt,a):new s(f,a)}evaluate(i){let l=null,f=0,p;for(let a of this.args)if(f++,l=a.evaluate(i),l&&l instanceof Na&&!l.available&&(p||(p=l.name),l=null,f===this.args.length&&(l=p)),l!==null)break;return l}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}};function g1(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function nI(s,i,l){return i===l}function oI(s,i,l){return i!==l}function aI(s,i,l){return i<l}function sI(s,i,l){return i>l}function lI(s,i,l){return i<=l}function cI(s,i,l){return i>=l}function mx(s,i,l,f){return f.compare(i,l)===0}function uI(s,i,l,f){return!mx(s,i,l,f)}function hI(s,i,l,f){return f.compare(i,l)<0}function dI(s,i,l,f){return f.compare(i,l)>0}function pI(s,i,l,f){return f.compare(i,l)<=0}function fI(s,i,l,f){return f.compare(i,l)>=0}function vc(s,i,l){let f=s!=="=="&&s!=="!=";return class gx{constructor(a,b,P){this.type=Pt,this.lhs=a,this.rhs=b,this.collator=P,this.hasUntypedArgument=a.type.kind==="value"||b.type.kind==="value"}static parse(a,b){if(a.length!==3&&a.length!==4)return b.error("Expected two or three arguments.");let P=a[0],M=b.parse(a[1],1,Tt);if(!M)return null;if(!g1(P,M.type))return b.concat(1).error(`"${P}" comparisons are not supported for type '${ci(M.type)}'.`);let D=b.parse(a[2],2,Tt);if(!D)return null;if(!g1(P,D.type))return b.concat(2).error(`"${P}" comparisons are not supported for type '${ci(D.type)}'.`);if(M.type.kind!==D.type.kind&&M.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${ci(M.type)}' and '${ci(D.type)}'.`);f&&(M.type.kind==="value"&&D.type.kind!=="value"?M=new Ln(D.type,[M]):M.type.kind!=="value"&&D.type.kind==="value"&&(D=new Ln(M.type,[D])));let B=null;if(a.length===4){if(M.type.kind!=="string"&&D.type.kind!=="string"&&M.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(B=b.parse(a[3],3,Op),!B)return null}return new gx(M,D,B)}evaluate(a){let b=this.lhs.evaluate(a),P=this.rhs.evaluate(a);if(f&&this.hasUntypedArgument){let M=Di(b),D=Di(P);if(M.kind!==D.kind||!(M.kind==="string"||M.kind==="number"))throw new ri(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${D.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){let M=Di(b),D=Di(P);if(M.kind!=="string"||D.kind!=="string")return i(a,b,P)}return this.collator?l(a,b,P,this.collator.evaluate(a)):i(a,b,P)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}}}var mI=vc("==",nI,mx),gI=vc("!=",oI,uI),yI=vc("<",aI,hI),_I=vc(">",sI,dI),vI=vc("<=",lI,pI),xI=vc(">=",cI,fI),Tp=class s{constructor(i,l,f){this.type=Op,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");let f=i[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");let p=l.parse(f["case-sensitive"]===void 0?!1:f["case-sensitive"],1,Pt);if(!p)return null;let a=l.parse(f["diacritic-sensitive"]===void 0?!1:f["diacritic-sensitive"],1,Pt);if(!a)return null;let b=null;return f.locale&&(b=l.parse(f.locale,1,Ct),!b)?null:new s(p,a,b)}evaluate(i){return new th(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}},Ng=class s{constructor(i,l,f,p,a){this.type=Ct,this.number=i,this.locale=l,this.currency=f,this.minFractionDigits=p,this.maxFractionDigits=a}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");let f=l.parse(i[1],1,$e);if(!f)return null;let p=i[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let a=null;if(p.locale&&(a=l.parse(p.locale,1,Ct),!a))return null;let b=null;if(p.currency&&(b=l.parse(p.currency,1,Ct),!b))return null;let P=null;if(p["min-fraction-digits"]&&(P=l.parse(p["min-fraction-digits"],1,$e),!P))return null;let M=null;return p["max-fraction-digits"]&&(M=l.parse(p["max-fraction-digits"],1,$e),!M)?null:new s(f,a,b,P,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}},Bg=class s{constructor(i){this.type=Fp,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f=i[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");let p=[],a=!1;for(let b=1;b<=i.length-1;++b){let P=i[b];if(a&&typeof P=="object"&&!Array.isArray(P)){a=!1;let M=null;if(P["font-scale"]&&(M=l.parse(P["font-scale"],1,$e),!M))return null;let D=null;if(P["text-font"]&&(D=l.parse(P["text-font"],1,Yr(Ct)),!D))return null;let B=null;if(P["text-color"]&&(B=l.parse(P["text-color"],1,lo),!B))return null;let U=null;if(P["vertical-align"]){if(typeof P["vertical-align"]=="string"&&!YS.includes(P["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${P["vertical-align"]}' instead.`);if(U=l.parse(P["vertical-align"],1,Ct),!U)return null}let oe=p[p.length-1];oe.scale=M,oe.font=D,oe.textColor=B,oe.verticalAlign=U}else{let M=l.parse(i[b],1,Tt);if(!M)return null;let D=M.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,p.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new s(p)}evaluate(i){let l=f=>{let p=f.content.evaluate(i);return Di(p)===fh?new ih("",p,null,null,null,f.verticalAlign?f.verticalAlign.evaluate(i):null):new ih(Wu(p),null,f.scale?f.scale.evaluate(i):null,f.font?f.font.evaluate(i).join(","):null,f.textColor?f.textColor.evaluate(i):null,f.verticalAlign?f.verticalAlign.evaluate(i):null)};return new js(this.sections.map(l))}eachChild(i){for(let l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor),l.verticalAlign&&i(l.verticalAlign)}outputDefined(){return!1}},Ug=class s{constructor(i){this.type=fh,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");let f=l.parse(i[1],1,Ct);return f?new s(f):l.error("No image name provided.")}evaluate(i){let l=this.input.evaluate(i),f=Na.fromString(l);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(l)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}},jg=class s{constructor(i){this.type=$e,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let f=l.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ci(f.type)} instead.`):new s(f):null}evaluate(i){let l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new ri(`Expected value to be of type string or array, but found ${ci(Di(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}},co=8192;function bI(s,i){let l=wI(s[0]),f=SI(s[1]),p=Math.pow(2,i.z);return[Math.round(l*p*co),Math.round(f*p*co)]}function hy(s,i){let l=Math.pow(2,i.z),f=(s[0]/co+i.x)/l,p=(s[1]/co+i.y)/l;return[TI(f),II(p)]}function wI(s){return(180+s)/360}function TI(s){return s*360-180}function SI(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function II(s){return 360/Math.PI*Math.atan(Math.exp((180-s*360)*Math.PI/180))-90}function mh(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function nh(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function PI(s,i,l){return i[1]>s[1]!=l[1]>s[1]&&s[0]<(l[0]-i[0])*(s[1]-i[1])/(l[1]-i[1])+i[0]}function EI(s,i,l){let f=s[0]-i[0],p=s[1]-i[1],a=s[0]-l[0],b=s[1]-l[1];return f*b-a*p===0&&f*a<=0&&p*b<=0}function jp(s,i,l,f){let p=[i[0]-s[0],i[1]-s[1]],a=[f[0]-l[0],f[1]-l[1]];return kI(a,p)===0?!1:!!(y1(s,i,l,f)&&y1(l,f,s,i))}function AI(s,i,l){for(let f of l)for(let p=0;p<f.length-1;++p)if(jp(s,i,f[p],f[p+1]))return!0;return!1}function xc(s,i,l=!1){let f=!1;for(let p of i)for(let a=0;a<p.length-1;a++){if(EI(s,p[a],p[a+1]))return l;PI(s,p[a],p[a+1])&&(f=!f)}return f}function CI(s,i){for(let l of i)if(xc(s,l))return!0;return!1}function yx(s,i){for(let l of s)if(!xc(l,i))return!1;for(let l=0;l<s.length-1;++l)if(AI(s[l],s[l+1],i))return!1;return!0}function MI(s,i){for(let l of i)if(yx(s,l))return!0;return!1}function kI(s,i){return s[0]*i[1]-s[1]*i[0]}function y1(s,i,l,f){let p=s[0]-l[0],a=s[1]-l[1],b=i[0]-l[0],P=i[1]-l[1],M=f[0]-l[0],D=f[1]-l[1],B=p*D-M*a,U=b*D-M*P;return B>0&&U<0||B<0&&U>0}function dy(s,i,l){let f=[];for(let p=0;p<s.length;p++){let a=[];for(let b=0;b<s[p].length;b++){let P=bI(s[p][b],l);mh(i,P),a.push(P)}f.push(a)}return f}function _x(s,i,l){let f=[];for(let p=0;p<s.length;p++){let a=dy(s[p],i,l);f.push(a)}return f}function vx(s,i,l,f){if(s[0]<l[0]||s[0]>l[2]){let p=f*.5,a=s[0]-l[0]>p?-f:l[0]-s[0]>p?f:0;a===0&&(a=s[0]-l[2]>p?-f:l[2]-s[0]>p?f:0),s[0]+=a}mh(i,s)}function RI(s){s[0]=s[1]=1/0,s[2]=s[3]=-1/0}function _1(s,i,l,f){let p=Math.pow(2,f.z)*co,a=[f.x*co,f.y*co],b=[];for(let P of s)for(let M of P){let D=[M.x+a[0],M.y+a[1]];vx(D,i,l,p),b.push(D)}return b}function v1(s,i,l,f){let p=Math.pow(2,f.z)*co,a=[f.x*co,f.y*co],b=[];for(let P of s){let M=[];for(let D of P){let B=[D.x+a[0],D.y+a[1]];mh(i,B),M.push(B)}b.push(M)}if(i[2]-i[0]<=p/2){RI(i);for(let P of b)for(let M of P)vx(M,i,l,p)}return b}function LI(s,i){let l=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=s.canonicalID();if(i.type==="Polygon"){let a=dy(i.coordinates,f,p),b=_1(s.geometry(),l,f,p);if(!nh(l,f))return!1;for(let P of b)if(!xc(P,a))return!1}if(i.type==="MultiPolygon"){let a=_x(i.coordinates,f,p),b=_1(s.geometry(),l,f,p);if(!nh(l,f))return!1;for(let P of b)if(!CI(P,a))return!1}return!0}function DI(s,i){let l=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=s.canonicalID();if(i.type==="Polygon"){let a=dy(i.coordinates,f,p),b=v1(s.geometry(),l,f,p);if(!nh(l,f))return!1;for(let P of b)if(!yx(P,a))return!1}if(i.type==="MultiPolygon"){let a=_x(i.coordinates,f,p),b=v1(s.geometry(),l,f,p);if(!nh(l,f))return!1;for(let P of b)if(!MI(P,a))return!1}return!0}var oh=class s{constructor(i,l){this.type=Pt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(rh(i[1])){let f=i[1];if(f.type==="FeatureCollection"){let p=[];for(let a of f.features){let{type:b,coordinates:P}=a.geometry;b==="Polygon"&&p.push(P),b==="MultiPolygon"&&p.push(...P)}if(p.length){let a={type:"MultiPolygon",coordinates:p};return new s(f,a)}}else if(f.type==="Feature"){let p=f.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new s(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new s(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return LI(i,this.geometries);if(i.geometryType()==="LineString")return DI(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},Sp=class{constructor(i=[],l=(f,p)=>f<p?-1:f>p?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:l,compare:f}=this,p=l[i];for(;i>0;){let a=i-1>>1,b=l[a];if(f(p,b)>=0)break;l[i]=b,i=a}l[i]=p}_down(i){let{data:l,compare:f}=this,p=this.length>>1,a=l[i];for(;i<p;){let b=(i<<1)+1,P=b+1;if(P<this.length&&f(l[P],l[b])<0&&(b=P),f(l[b],a)>=0)break;l[i]=l[b],i=b}l[i]=a}};function zI(s,i){if(s.length<=1)return[s];let l=[],f,p;for(let a of s){let b=OI(a);b!==0&&(a.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(f&&l.push(f),f=[a]):f.push(a))}return f&&l.push(f),l}function OI(s){let i=0;for(let l=0,f=s.length,p=f-1,a,b;l<f;p=l++)a=s[l],b=s[p],i+=(b.x-a.x)*(a.y+b.y);return i}var FI=6378.137,x1=1/298.257223563,b1=x1*(2-x1),w1=Math.PI/180,ah=class{constructor(i){let l=w1*FI*1e3,f=Math.cos(i*w1),p=1/(1-b1*(1-f*f)),a=Math.sqrt(p);this.kx=l*a*f,this.ky=l*a*p*(1-b1)}distance(i,l){let f=this.wrap(i[0]-l[0])*this.kx,p=(i[1]-l[1])*this.ky;return Math.sqrt(f*f+p*p)}pointOnLine(i,l){let f=1/0,p,a,b,P;for(let M=0;M<i.length-1;M++){let D=i[M][0],B=i[M][1],U=this.wrap(i[M+1][0]-D)*this.kx,oe=(i[M+1][1]-B)*this.ky,le=0;(U!==0||oe!==0)&&(le=(this.wrap(l[0]-D)*this.kx*U+(l[1]-B)*this.ky*oe)/(U*U+oe*oe),le>1?(D=i[M+1][0],B=i[M+1][1]):le>0&&(D+=U/this.kx*le,B+=oe/this.ky*le)),U=this.wrap(l[0]-D)*this.kx,oe=(l[1]-B)*this.ky;let me=U*U+oe*oe;me<f&&(f=me,p=D,a=B,b=M,P=le)}return{point:[p,a],index:b,t:Math.max(0,Math.min(1,P))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}},Vg=100,$g=50;function xx(s,i){return i[0]-s[0]}function Ip(s){return s[1]-s[0]+1}function Ho(s,i){return s[1]>=s[0]&&s[1]<i}function Gg(s,i){if(s[0]>s[1])return[null,null];let l=Ip(s);if(i){if(l===2)return[s,null];let p=Math.floor(l/2);return[[s[0],s[0]+p],[s[0]+p,s[1]]]}if(l===1)return[s,null];let f=Math.floor(l/2)-1;return[[s[0],s[0]+f],[s[0]+f+1,s[1]]]}function qg(s,i){if(!Ho(i,s.length))return[1/0,1/0,-1/0,-1/0];let l=[1/0,1/0,-1/0,-1/0];for(let f=i[0];f<=i[1];++f)mh(l,s[f]);return l}function Zg(s){let i=[1/0,1/0,-1/0,-1/0];for(let l of s)for(let f of l)mh(i,f);return i}function T1(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function py(s,i,l){if(!T1(s)||!T1(i))return NaN;let f=0,p=0;return s[2]<i[0]&&(f=i[0]-s[2]),s[0]>i[2]&&(f=s[0]-i[2]),s[1]>i[3]&&(p=s[1]-i[3]),s[3]<i[1]&&(p=i[1]-s[3]),l.distance([0,0],[f,p])}function zs(s,i,l){let f=l.pointOnLine(i,s);return l.distance(s,f.point)}function fy(s,i,l,f,p){let a=Math.min(zs(s,[l,f],p),zs(i,[l,f],p)),b=Math.min(zs(l,[s,i],p),zs(f,[s,i],p));return Math.min(a,b)}function NI(s,i,l,f,p){if(!(Ho(i,s.length)&&Ho(f,l.length)))return 1/0;let a=1/0;for(let b=i[0];b<i[1];++b){let P=s[b],M=s[b+1];for(let D=f[0];D<f[1];++D){let B=l[D],U=l[D+1];if(jp(P,M,B,U))return 0;a=Math.min(a,fy(P,M,B,U,p))}}return a}function BI(s,i,l,f,p){if(!(Ho(i,s.length)&&Ho(f,l.length)))return NaN;let a=1/0;for(let b=i[0];b<=i[1];++b)for(let P=f[0];P<=f[1];++P)if(a=Math.min(a,p.distance(s[b],l[P])),a===0)return a;return a}function UI(s,i,l){if(xc(s,i,!0))return 0;let f=1/0;for(let p of i){let a=p[0],b=p[p.length-1];if(a!==b&&(f=Math.min(f,zs(s,[b,a],l)),f===0))return f;let P=l.pointOnLine(p,s);if(f=Math.min(f,l.distance(s,P.point)),f===0)return f}return f}function jI(s,i,l,f){if(!Ho(i,s.length))return NaN;for(let a=i[0];a<=i[1];++a)if(xc(s[a],l,!0))return 0;let p=1/0;for(let a=i[0];a<i[1];++a){let b=s[a],P=s[a+1];for(let M of l)for(let D=0,B=M.length,U=B-1;D<B;U=D++){let oe=M[U],le=M[D];if(jp(b,P,oe,le))return 0;p=Math.min(p,fy(b,P,oe,le,f))}}return p}function S1(s,i){for(let l of s)for(let f of l)if(xc(f,i,!0))return!0;return!1}function VI(s,i,l,f=1/0){let p=Zg(s),a=Zg(i);if(f!==1/0&&py(p,a,l)>=f)return f;if(nh(p,a)){if(S1(s,i))return 0}else if(S1(i,s))return 0;let b=1/0;for(let P of s)for(let M=0,D=P.length,B=D-1;M<D;B=M++){let U=P[B],oe=P[M];for(let le of i)for(let me=0,xe=le.length,Ce=xe-1;me<xe;Ce=me++){let ke=le[Ce],Re=le[me];if(jp(U,oe,ke,Re))return 0;b=Math.min(b,fy(U,oe,ke,Re,l))}}return b}function I1(s,i,l,f,p,a){if(!a)return;let b=py(qg(f,a),p,l);b<i&&s.push([b,a,[0,0]])}function ap(s,i,l,f,p,a,b){if(!a||!b)return;let P=py(qg(f,a),qg(p,b),l);P<i&&s.push([P,a,b])}function Pp(s,i,l,f,p=1/0){let a=Math.min(f.distance(s[0],l[0][0]),p);if(a===0)return a;let b=new Sp([[0,[0,s.length-1],[0,0]]],xx),P=Zg(l);for(;b.length>0;){let M=b.pop();if(M[0]>=a)continue;let D=M[1],B=i?$g:Vg;if(Ip(D)<=B){if(!Ho(D,s.length))return NaN;if(i){let U=jI(s,D,l,f);if(isNaN(U)||U===0)return U;a=Math.min(a,U)}else for(let U=D[0];U<=D[1];++U){let oe=UI(s[U],l,f);if(a=Math.min(a,oe),a===0)return 0}}else{let U=Gg(D,i);I1(b,a,f,s,P,U[0]),I1(b,a,f,s,P,U[1])}}return a}function Ep(s,i,l,f,p,a=1/0){let b=Math.min(a,p.distance(s[0],l[0]));if(b===0)return b;let P=new Sp([[0,[0,s.length-1],[0,l.length-1]]],xx);for(;P.length>0;){let M=P.pop();if(M[0]>=b)continue;let D=M[1],B=M[2],U=i?$g:Vg,oe=f?$g:Vg;if(Ip(D)<=U&&Ip(B)<=oe){if(!Ho(D,s.length)&&Ho(B,l.length))return NaN;let le;if(i&&f)le=NI(s,D,l,B,p),b=Math.min(b,le);else if(i&&!f){let me=s.slice(D[0],D[1]+1);for(let xe=B[0];xe<=B[1];++xe)if(le=zs(l[xe],me,p),b=Math.min(b,le),b===0)return b}else if(!i&&f){let me=l.slice(B[0],B[1]+1);for(let xe=D[0];xe<=D[1];++xe)if(le=zs(s[xe],me,p),b=Math.min(b,le),b===0)return b}else le=BI(s,D,l,B,p),b=Math.min(b,le)}else{let le=Gg(D,i),me=Gg(B,f);ap(P,b,p,s,l,le[0],me[0]),ap(P,b,p,s,l,le[0],me[1]),ap(P,b,p,s,l,le[1],me[0]),ap(P,b,p,s,l,le[1],me[1])}}return b}function $I(s,i){let l=s.geometry(),f=l.flat().map(b=>hy([b.x,b.y],s.canonical));if(l.length===0)return NaN;let p=new ah(f[0][1]),a=1/0;for(let b of i){switch(b.type){case"Point":a=Math.min(a,Ep(f,!1,[b.coordinates],!1,p,a));break;case"LineString":a=Math.min(a,Ep(f,!1,b.coordinates,!0,p,a));break;case"Polygon":a=Math.min(a,Pp(f,!1,b.coordinates,p,a));break}if(a===0)return a}return a}function GI(s,i){let l=s.geometry(),f=l.flat().map(b=>hy([b.x,b.y],s.canonical));if(l.length===0)return NaN;let p=new ah(f[0][1]),a=1/0;for(let b of i){switch(b.type){case"Point":a=Math.min(a,Ep(f,!0,[b.coordinates],!1,p,a));break;case"LineString":a=Math.min(a,Ep(f,!0,b.coordinates,!0,p,a));break;case"Polygon":a=Math.min(a,Pp(f,!0,b.coordinates,p,a));break}if(a===0)return a}return a}function qI(s,i){let l=s.geometry();if(l.length===0||l[0].length===0)return NaN;let f=zI(l).map(b=>b.map(P=>P.map(M=>hy([M.x,M.y],s.canonical)))),p=new ah(f[0][0][0][1]),a=1/0;for(let b of i)for(let P of f){switch(b.type){case"Point":a=Math.min(a,Pp([b.coordinates],!1,P,p,a));break;case"LineString":a=Math.min(a,Pp(b.coordinates,!0,P,p,a));break;case"Polygon":a=Math.min(a,VI(P,b.coordinates,p,a));break}if(a===0)return a}return a}function gg(s){return s.type==="MultiPolygon"?s.coordinates.map(i=>({type:"Polygon",coordinates:i})):s.type==="MultiLineString"?s.coordinates.map(i=>({type:"LineString",coordinates:i})):s.type==="MultiPoint"?s.coordinates.map(i=>({type:"Point",coordinates:i})):[s]}var sh=class s{constructor(i,l){this.type=$e,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(rh(i[1])){let f=i[1];if(f.type==="FeatureCollection")return new s(f,f.features.map(p=>gg(p.geometry)).flat());if(f.type==="Feature")return new s(f,gg(f.geometry));if("type"in f&&"coordinates"in f)return new s(f,gg(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return $I(i,this.geometries);if(i.geometryType()==="LineString")return GI(i,this.geometries);if(i.geometryType()==="Polygon")return qI(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},lh=class s{constructor(i){this.type=Tt,this.key=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);let f=i[1];return f==null?l.error("Global state property must be defined."):typeof f!="string"?l.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new s(f)}evaluate(i){var l;let f=(l=i.globals)===null||l===void 0?void 0:l.globalState;return!f||Object.keys(f).length===0?null:Zu(f,this.key)}eachChild(){}outputDefined(){return!1}},my={"==":mI,"!=":gI,">":_I,"<":yI,">=":xI,"<=":vI,array:Ln,at:Rg,boolean:Ln,case:Og,coalesce:wp,collator:Tp,format:Bg,image:Ug,in:Lg,"index-of":Dg,interpolate:$o,"interpolate-hcl":$o,"interpolate-lab":$o,length:jg,let:vp,literal:yc,match:zg,number:Ln,"number-format":Ng,object:Ln,slice:Fg,step:bp,string:Ln,"to-boolean":za,"to-color":za,"to-number":za,"to-string":za,var:xp,within:oh,distance:sh,"global-state":lh},Ba=class s{constructor(i,l,f,p){this.name=i,this.type=l,this._evaluate=f,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){let f=i[0],p=s.definitions[f];if(!p)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);let a=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,P=b.filter(([D])=>!Array.isArray(D)||D.length===i.length-1),M=null;for(let[D,B]of P){M=new _p(l.registry,Ap,l.path,null,l.scope);let U=[],oe=!1;for(let le=1;le<i.length;le++){let me=i[le],xe=Array.isArray(D)?D[le-1]:D.type,Ce=M.parse(me,1+U.length,xe);if(!Ce){oe=!0;break}U.push(Ce)}if(!oe){if(Array.isArray(D)&&D.length!==U.length){M.error(`Expected ${D.length} arguments, but found ${U.length} instead.`);continue}for(let le=0;le<U.length;le++){let me=Array.isArray(D)?D[le]:D.type,xe=U[le];M.concat(le+1).checkSubtype(me,xe.type)}if(M.errors.length===0)return new s(f,a,B,U)}}if(P.length===1)l.errors.push(...M.errors);else{let D=(P.length?P:b).map(([U])=>WI(U)).join(" | "),B=[];for(let U=1;U<i.length;U++){let oe=l.parse(i[U],1+B.length);if(!oe)return null;B.push(ci(oe.type))}l.error(`Expected arguments of type ${D}, but found (${B.join(", ")}) instead.`)}return null}static register(i,l){s.definitions=l;for(let f in l)i[f]=s}};function P1(s,[i,l,f,p]){i=i.evaluate(s),l=l.evaluate(s),f=f.evaluate(s);let a=p?p.evaluate(s):1,b=px(i,l,f,a);if(b)throw new ri(b);return new Xt(i/255,l/255,f/255,a,!1)}function E1(s,i){return s in i}function yg(s,i){let l=i[s];return typeof l>"u"?null:l}function ZI(s,i,l,f){for(;l<=f;){let p=l+f>>1;if(i[p]===s)return!0;i[p]>s?f=p-1:l=p+1}return!1}function Es(s){return{type:s}}Ba.register(my,{error:[US,[Ct],(s,[i])=>{throw new ri(i.evaluate(s))}],typeof:[Ct,[Tt],(s,[i])=>ci(Di(i.evaluate(s)))],"to-rgba":[Yr($e,4),[lo],(s,[i])=>{let[l,f,p,a]=i.evaluate(s).rgb;return[l*255,f*255,p*255,a]}],rgb:[lo,[$e,$e,$e],P1],rgba:[lo,[$e,$e,$e,$e],P1],has:{type:Pt,overloads:[[[Ct],(s,[i])=>E1(i.evaluate(s),s.properties())],[[Ct,Os],(s,[i,l])=>E1(i.evaluate(s),l.evaluate(s))]]},get:{type:Tt,overloads:[[[Ct],(s,[i])=>yg(i.evaluate(s),s.properties())],[[Ct,Os],(s,[i,l])=>yg(i.evaluate(s),l.evaluate(s))]]},"feature-state":[Tt,[Ct],(s,[i])=>yg(i.evaluate(s),s.featureState||{})],properties:[Os,[],s=>s.properties()],"geometry-type":[Ct,[],s=>s.geometryType()],id:[Tt,[],s=>s.id()],zoom:[$e,[],s=>s.globals.zoom],"heatmap-density":[$e,[],s=>s.globals.heatmapDensity||0],elevation:[$e,[],s=>s.globals.elevation||0],"line-progress":[$e,[],s=>s.globals.lineProgress||0],accumulated:[Tt,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[$e,Es($e),(s,i)=>{let l=0;for(let f of i)l+=f.evaluate(s);return l}],"*":[$e,Es($e),(s,i)=>{let l=1;for(let f of i)l*=f.evaluate(s);return l}],"-":{type:$e,overloads:[[[$e,$e],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[$e],(s,[i])=>-i.evaluate(s)]]},"/":[$e,[$e,$e],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[$e,[$e,$e],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[$e,[$e],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[$e,[$e],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[$e,[$e],(s,[i])=>Math.log(i.evaluate(s))],log2:[$e,[$e],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[$e,[$e],(s,[i])=>Math.sin(i.evaluate(s))],cos:[$e,[$e],(s,[i])=>Math.cos(i.evaluate(s))],tan:[$e,[$e],(s,[i])=>Math.tan(i.evaluate(s))],asin:[$e,[$e],(s,[i])=>Math.asin(i.evaluate(s))],acos:[$e,[$e],(s,[i])=>Math.acos(i.evaluate(s))],atan:[$e,[$e],(s,[i])=>Math.atan(i.evaluate(s))],min:[$e,Es($e),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[$e,Es($e),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[$e,[$e],(s,[i])=>Math.abs(i.evaluate(s))],round:[$e,[$e],(s,[i])=>{let l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[$e,[$e],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[$e,[$e],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Pt,[Ct,Tt],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[Pt,[Tt],(s,[i])=>s.id()===i.value],"filter-type-==":[Pt,[Ct],(s,[i])=>s.geometryType()===i.value],"filter-<":[Pt,[Ct,Tt],(s,[i,l])=>{let f=s.properties()[i.value],p=l.value;return typeof f==typeof p&&f<p}],"filter-id-<":[Pt,[Tt],(s,[i])=>{let l=s.id(),f=i.value;return typeof l==typeof f&&l<f}],"filter->":[Pt,[Ct,Tt],(s,[i,l])=>{let f=s.properties()[i.value],p=l.value;return typeof f==typeof p&&f>p}],"filter-id->":[Pt,[Tt],(s,[i])=>{let l=s.id(),f=i.value;return typeof l==typeof f&&l>f}],"filter-<=":[Pt,[Ct,Tt],(s,[i,l])=>{let f=s.properties()[i.value],p=l.value;return typeof f==typeof p&&f<=p}],"filter-id-<=":[Pt,[Tt],(s,[i])=>{let l=s.id(),f=i.value;return typeof l==typeof f&&l<=f}],"filter->=":[Pt,[Ct,Tt],(s,[i,l])=>{let f=s.properties()[i.value],p=l.value;return typeof f==typeof p&&f>=p}],"filter-id->=":[Pt,[Tt],(s,[i])=>{let l=s.id(),f=i.value;return typeof l==typeof f&&l>=f}],"filter-has":[Pt,[Tt],(s,[i])=>i.value in s.properties()],"filter-has-id":[Pt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Pt,[Yr(Ct)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Pt,[Yr(Tt)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Pt,[Ct,Yr(Tt)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Pt,[Ct,Yr(Tt)],(s,[i,l])=>ZI(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[Es(Pt),(s,i)=>{for(let l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[Es(Pt),(s,i)=>{for(let l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[Pt,[Pt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Pt,[Ct],(s,[i])=>{let l=s.globals&&s.globals.isSupportedScript;return l?l(i.evaluate(s)):!0}],upcase:[Ct,[Ct],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[Ct,[Ct],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[Ct,Es(Tt),(s,i)=>i.map(l=>Wu(l.evaluate(s))).join("")],"resolved-locale":[Ct,[Op],(s,[i])=>i.evaluate(s).resolvedLocale()]});function WI(s){return Array.isArray(s)?`(${s.map(ci).join(", ")})`:`(${ci(s.type)}...)`}function Ap(s){if(s instanceof xp)return Ap(s.boundExpression);if(s instanceof Ba&&s.name==="error"||s instanceof Tp||s instanceof oh||s instanceof sh||s instanceof lh)return!1;let i=s instanceof za||s instanceof Ln,l=!0;return s.eachChild(f=>{i?l=l&&Ap(f):l=l&&f instanceof yc}),l?Vp(s)&&$p(s,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Vp(s){if(s instanceof Ba&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof oh||s instanceof sh)return!1;let i=!0;return s.eachChild(l=>{i&&!Vp(l)&&(i=!1)}),i}function ch(s){if(s instanceof Ba&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!ch(l)&&(i=!1)}),i}function $p(s,i){if(s instanceof Ba&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(f=>{l&&!$p(f,i)&&(l=!1)}),l}function Wg(s){return{result:"success",value:s}}function mc(s){return{result:"error",value:s}}function Cp(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function bx(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function wx(s){return!!s.expression&&s.expression.interpolated}function Rt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function gy(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&Di(s)===Os}var Hg=class{constructor(i,l){this.expression=i,this._warningHistory={},this._evaluator=new yp,this._defaultValue=l?XI(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,f,p,a,b){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=p,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,l,f,p,a,b){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=p,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=b||null;try{let P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!==P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}};function Tx(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in my}function Sx(s,i){let l=new _p(my,Ap,[],i?KI(i):void 0),f=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Wg(new Hg(f,i)):mc(l.errors)}var Mp=class{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!ch(l.expression),this.globalStateRefs=yy(l.expression)}evaluateWithoutErrorHandling(i,l,f,p,a,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,p,a,b)}evaluate(i,l,f,p,a,b){return this._styleExpression.evaluate(i,l,f,p,a,b)}},kp=class{constructor(i,l,f,p){this.kind=i,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!ch(l.expression),this.globalStateRefs=yy(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,l,f,p,a,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,p,a,b)}evaluate(i,l,f,p,a,b){return this._styleExpression.evaluate(i,l,f,p,a,b)}interpolationFactor(i,l,f){return this.interpolationType?$o.interpolationFactor(this.interpolationType,i,l,f):0}};function HI(s,i){let l=Sx(s,i);if(l.result==="error")return l;let f=l.value.expression,p=Vp(f);if(!p&&!Cp(i))return mc([new pn("","data expressions not supported")]);let a=$p(f,["zoom"]);if(!a&&!bx(i))return mc([new pn("","zoom expressions not supported")]);let b=cp(f);if(!b&&!a)return mc([new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(b instanceof pn)return mc([b]);if(b instanceof $o&&!wx(i))return mc([new pn("",'"interpolate" expressions cannot be used with this property')]);if(!b)return Wg(p?new Mp("constant",l.value):new Mp("source",l.value));let P=b instanceof $o?b.interpolation:void 0;return Wg(p?new kp("camera",l.value,b.labels,P):new kp("composite",l.value,b.labels,P))}function cp(s){let i=null;if(s instanceof vp)i=cp(s.result);else if(s instanceof wp){for(let l of s.args)if(i=cp(l),i)break}else(s instanceof bp||s instanceof $o)&&s.input instanceof Ba&&s.input.name==="zoom"&&(i=s);return i instanceof pn||s.eachChild(l=>{let f=cp(l);f instanceof pn?i=f:!i&&f?i=new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new pn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function yy(s,i=new Set){return s instanceof lh&&i.add(s.key),s.eachChild(l=>{yy(l,i)}),i}function KI(s){let i={color:lo,string:Ct,number:$e,enum:Ct,boolean:Pt,formatted:Fp,padding:Np,numberArray:Bp,colorArray:Ju,projectionDefinition:zp,resolvedImage:fh,variableAnchorOffsetCollection:Up};return s.type==="array"?Yr(i[s.value]||Tt,s.length):i[s.type]}function XI(s){if(s.type==="color"&&gy(s.default))return new Xt(0,0,0,0);switch(s.type){case"color":return Xt.parse(s.default)||null;case"padding":return qo.parse(s.default)||null;case"numberArray":return Zo.parse(s.default)||null;case"colorArray":return Dn.parse(s.default)||null;case"variableAnchorOffsetCollection":return Wo.parse(s.default)||null;case"projectionDefinition":return Vs.parse(s.default)||null;default:return s.default===void 0?null:s.default}}function Ix(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(let i of s.slice(1))if(!Ix(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function Px(s){let i=s.key,l=s.value;return l?[new Fe(i,l,"constants have been deprecated as of v8")]:[]}function vi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function $s(s){if(Array.isArray(s))return s.map($s);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){let i={};for(let l in s)i[l]=$s(s[l]);return i}return vi(s)}function fn(s){let i=s.key,l=s.value,f=s.valueSpec||{},p=s.objectElementValidators||{},a=s.style,b=s.styleSpec,P=s.validateSpec,M=[],D=Rt(l);if(D!=="object")return[new Fe(i,l,`object expected, ${D} found`)];for(let B in l){let U=B.split(".")[0],oe=Zu(f,U)||f["*"],le;if(Zu(p,U))le=p[U];else if(Zu(f,U))le=P;else if(p["*"])le=p["*"];else if(f["*"])le=P;else{M.push(new Fe(i,l[B],`unknown property "${B}"`));continue}M=M.concat(le({key:(i&&`${i}.`)+B,value:l[B],valueSpec:oe,style:a,styleSpec:b,object:l,objectKey:B,validateSpec:P},l))}for(let B in f)p[B]||f[B].required&&f[B].default===void 0&&l[B]===void 0&&M.push(new Fe(i,l,`missing required property "${B}"`));return M}function _y(s){let i=s.value,l=s.valueSpec,f=s.validateSpec,p=s.style,a=s.styleSpec,b=s.key,P=s.arrayElementValidator||f;if(Rt(i)!=="array")return[new Fe(b,i,`array expected, ${Rt(i)} found`)];if(l.length&&i.length!==l.length)return[new Fe(b,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Fe(b,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let M={type:l.value,values:l.values};a.$version<7&&(M.function=l.function),Rt(l.value)==="object"&&(M=l.value);let D=[];for(let B=0;B<i.length;B++)D=D.concat(P({array:i,arrayIndex:B,value:i[B],valueSpec:M,validateSpec:s.validateSpec,style:p,styleSpec:a,key:`${b}[${B}]`}));return D}function Gp(s){let i=s.key,l=s.value,f=s.valueSpec,p=Rt(l);return p==="number"&&l!==l&&(p="NaN"),p!=="number"?[new Fe(i,l,`number expected, ${p} found`)]:"minimum"in f&&l<f.minimum?[new Fe(i,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new Fe(i,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function Ex(s){let i=s.valueSpec,l=vi(s.value.type),f,p={},a,b,P=l!=="categorical"&&s.value.property===void 0,M=!P,D=Rt(s.value.stops)==="array"&&Rt(s.value.stops[0])==="array"&&Rt(s.value.stops[0][0])==="object",B=fn({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:U,default:me}});return l==="identity"&&P&&B.push(new Fe(s.key,s.value,'missing required property "property"')),l!=="identity"&&!s.value.stops&&B.push(new Fe(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!wx(s.valueSpec)&&B.push(new Fe(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!Cp(s.valueSpec)?B.push(new Fe(s.key,s.value,"property functions not supported")):P&&!bx(s.valueSpec)&&B.push(new Fe(s.key,s.value,"zoom functions not supported"))),(l==="categorical"||D)&&s.value.property===void 0&&B.push(new Fe(s.key,s.value,'"property" property is required')),B;function U(xe){if(l==="identity")return[new Fe(xe.key,xe.value,'identity function may not have a "stops" property')];let Ce=[],ke=xe.value;return Ce=Ce.concat(_y({key:xe.key,value:ke,valueSpec:xe.valueSpec,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:oe})),Rt(ke)==="array"&&ke.length===0&&Ce.push(new Fe(xe.key,ke,"array must have at least one stop")),Ce}function oe(xe){let Ce=[],ke=xe.value,Re=xe.key;if(Rt(ke)!=="array")return[new Fe(Re,ke,`array expected, ${Rt(ke)} found`)];if(ke.length!==2)return[new Fe(Re,ke,`array length 2 expected, length ${ke.length} found`)];if(D){if(Rt(ke[0])!=="object")return[new Fe(Re,ke,`object expected, ${Rt(ke[0])} found`)];if(ke[0].zoom===void 0)return[new Fe(Re,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Fe(Re,ke,"object stop key must have value")];if(b&&b>vi(ke[0].zoom))return[new Fe(Re,ke[0].zoom,"stop zoom values must appear in ascending order")];vi(ke[0].zoom)!==b&&(b=vi(ke[0].zoom),a=void 0,p={}),Ce=Ce.concat(fn({key:`${Re}[0]`,value:ke[0],valueSpec:{zoom:{}},validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:Gp,value:le}}))}else Ce=Ce.concat(le({key:`${Re}[0]`,value:ke[0],validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec},ke));return Tx($s(ke[1]))?Ce.concat([new Fe(`${Re}[1]`,ke[1],"expressions are not allowed in function stops.")]):Ce.concat(xe.validateSpec({key:`${Re}[1]`,value:ke[1],valueSpec:i,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec}))}function le(xe,Ce){let ke=Rt(xe.value),Re=vi(xe.value),We=xe.value!==null?xe.value:Ce;if(!f)f=ke;else if(ke!==f)return[new Fe(xe.key,We,`${ke} stop domain type must match previous stop domain type ${f}`)];if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Fe(xe.key,We,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&l!=="categorical"){let rt=`number expected, ${ke} found`;return Cp(i)&&l===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(xe.key,We,rt)]}return l==="categorical"&&ke==="number"&&(!isFinite(Re)||Math.floor(Re)!==Re)?[new Fe(xe.key,We,`integer expected, found ${Re}`)]:l!=="categorical"&&ke==="number"&&a!==void 0&&Re<a?[new Fe(xe.key,We,"stop domain values must appear in ascending order")]:(a=Re,l==="categorical"&&Re in p?[new Fe(xe.key,We,"stop domain values must be unique")]:(p[Re]=!0,[]))}function me(xe){return xe.validateSpec({key:xe.key,value:xe.value,valueSpec:i,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec})}}function _c(s){let i=(s.expressionContext==="property"?HI:Sx)($s(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new Fe(`${s.key}${f.key}`,s.value,f.message));let l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new Fe(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ch(l))return[new Fe(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!ch(l))return[new Fe(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!$p(l,["zoom","feature-state"]))return[new Fe(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Vp(l))return[new Fe(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function YI(s){let i=s.value,l=s.key,f=Rt(i);return f!=="boolean"?[new Fe(l,i,`boolean expected, ${f} found`)]:[]}function Kg(s){let i=s.key,l=s.value,f=Rt(l);return f!=="string"?[new Fe(i,l,`color expected, ${f} found`)]:Xt.parse(String(l))?[]:[new Fe(i,l,`color expected, "${l}" found`)]}function uh(s){let i=s.key,l=s.value,f=s.valueSpec,p=[];return Array.isArray(f.values)?f.values.indexOf(vi(l))===-1&&p.push(new Fe(i,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(vi(l))===-1&&p.push(new Fe(i,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function vy(s){return Ix($s(s.value))?_c(gp({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ax(s)}function Ax(s){let i=s.value,l=s.key;if(Rt(i)!=="array")return[new Fe(l,i,`array expected, ${Rt(i)} found`)];let f=s.styleSpec,p,a=[];if(i.length<1)return[new Fe(l,i,"filter array must have at least 1 element")];switch(a=a.concat(uh({key:`${l}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),vi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&vi(i[1])==="$type"&&a.push(new Fe(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&a.push(new Fe(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Rt(i[1]),p!=="string"&&a.push(new Fe(`${l}[1]`,i[1],`string expected, ${p} found`)));for(let b=2;b<i.length;b++)p=Rt(i[b]),vi(i[1])==="$type"?a=a.concat(uh({key:`${l}[${b}]`,value:i[b],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&a.push(new Fe(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)a=a.concat(Ax({key:`${l}[${b}]`,value:i[b],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=Rt(i[1]),i.length!==2?a.push(new Fe(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):p!=="string"&&a.push(new Fe(`${l}[1]`,i[1],`string expected, ${p} found`));break}return a}function Cx(s,i){let l=s.key,f=s.validateSpec,p=s.style,a=s.styleSpec,b=s.value,P=s.objectKey,M=a[`${i}_${s.layerType}`];if(!M)return[];let D=P.match(/^(.*)-transition$/);if(i==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return f({key:l,value:b,valueSpec:a.transition,style:p,styleSpec:a});let B=s.valueSpec||M[P];if(!B)return[new Fe(l,b,`unknown property "${P}"`)];let U;if(Rt(b)==="string"&&Cp(B)&&!B.tokens&&(U=/^{([^}]+)}$/.exec(b)))return[new Fe(l,b,`"${P}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];let oe=[];return s.layerType==="symbol"&&(P==="text-field"&&p&&!p.glyphs&&oe.push(new Fe(l,b,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&gy($s(b))&&vi(b.type)==="identity"&&oe.push(new Fe(l,b,'"text-font" does not support identity functions'))),oe.concat(f({key:s.key,value:b,valueSpec:B,style:p,styleSpec:a,expressionContext:"property",propertyType:i,propertyKey:P}))}function Mx(s){return Cx(s,"paint")}function kx(s){return Cx(s,"layout")}function Rx(s){let i=[],l=s.value,f=s.key,p=s.style,a=s.styleSpec;if(Rt(l)!=="object")return[new Fe(f,l,`object expected, ${Rt(l)} found`)];!l.type&&!l.ref&&i.push(new Fe(f,l,'either "type" or "ref" is required'));let b=vi(l.type),P=vi(l.ref);if(l.id){let M=vi(l.id);for(let D=0;D<s.arrayIndex;D++){let B=p.layers[D];vi(B.id)===M&&i.push(new Fe(f,l.id,`duplicate layer id "${l.id}", previously used at line ${B.id.__line__}`))}}if("ref"in l){["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&i.push(new Fe(f,l[D],`"${D}" is prohibited for ref layers`))});let M;p.layers.forEach(D=>{vi(D.id)===P&&(M=D)}),M?M.ref?i.push(new Fe(f,l.ref,"ref cannot reference another ref layer")):b=vi(M.type):i.push(new Fe(f,l.ref,`ref layer "${P}" not found`))}else if(b!=="background")if(!l.source)i.push(new Fe(f,l,'missing required property "source"'));else{let M=p.sources&&p.sources[l.source],D=M&&vi(M.type);M?D==="vector"&&b==="raster"?i.push(new Fe(f,l.source,`layer "${l.id}" requires a raster source`)):D!=="raster-dem"&&b==="hillshade"?i.push(new Fe(f,l.source,`layer "${l.id}" requires a raster-dem source`)):D!=="raster-dem"&&b==="color-relief"?i.push(new Fe(f,l.source,`layer "${l.id}" requires a raster-dem source`)):D==="raster"&&b!=="raster"?i.push(new Fe(f,l.source,`layer "${l.id}" requires a vector source`)):D==="vector"&&!l["source-layer"]?i.push(new Fe(f,l,`layer "${l.id}" must specify a "source-layer"`)):D==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?i.push(new Fe(f,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b==="line"&&l.paint&&l.paint["line-gradient"]&&(D!=="geojson"||!M.lineMetrics)&&i.push(new Fe(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Fe(f,l.source,`source "${l.source}" not found`))}return i=i.concat(fn({key:f,value:l,valueSpec:a.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*"(){return[]},type(){return s.validateSpec({key:`${f}.type`,value:l.type,valueSpec:a.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"})},filter:vy,layout(M){return fn({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*"(D){return kx(gp({layerType:b},D))}}})},paint(M){return fn({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*"(D){return Mx(gp({layerType:b},D))}}})}}})),i}function Gs(s){let i=s.value,l=s.key,f=Rt(i);return f!=="string"?[new Fe(l,i,`string expected, ${f} found`)]:[]}function JI(s){var i;let l=(i=s.sourceName)!==null&&i!==void 0?i:"",f=s.value,p=s.styleSpec,a=p.source_raster_dem,b=s.style,P=[],M=Rt(f);if(f===void 0)return P;if(M!=="object")return P.push(new Fe("source_raster_dem",f,`object expected, ${M} found`)),P;let D=vi(f.encoding)==="custom",B=["redFactor","greenFactor","blueFactor","baseShift"],U=s.value.encoding?`"${s.value.encoding}"`:"Default";for(let oe in f)!D&&B.includes(oe)?P.push(new Fe(oe,f[oe],`In "${l}": "${oe}" is only valid when "encoding" is set to "custom". ${U} encoding found`)):a[oe]?P=P.concat(s.validateSpec({key:oe,value:f[oe],valueSpec:a[oe],validateSpec:s.validateSpec,style:b,styleSpec:p})):P.push(new Fe(oe,f[oe],`unknown property "${oe}"`));return P}var A1={promoteId:QI};function Lx(s){let i=s.value,l=s.key,f=s.styleSpec,p=s.style,a=s.validateSpec;if(!i.type)return[new Fe(l,i,'"type" is required')];let b=vi(i.type),P;switch(b){case"vector":case"raster":return P=fn({key:l,value:i,valueSpec:f[`source_${b.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:A1,validateSpec:a}),P;case"raster-dem":return P=JI({sourceName:l,value:i,style:s.style,styleSpec:f,validateSpec:a}),P;case"geojson":if(P=fn({key:l,value:i,valueSpec:f.source_geojson,style:p,styleSpec:f,validateSpec:a,objectElementValidators:A1}),i.cluster)for(let M in i.clusterProperties){let[D,B]=i.clusterProperties[M],U=typeof D=="string"?[D,["accumulated"],["get",M]]:D;P.push(..._c({key:`${l}.${M}.map`,value:B,expressionContext:"cluster-map"})),P.push(..._c({key:`${l}.${M}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return P;case"video":return fn({key:l,value:i,valueSpec:f.source_video,style:p,validateSpec:a,styleSpec:f});case"image":return fn({key:l,value:i,valueSpec:f.source_image,style:p,validateSpec:a,styleSpec:f});case"canvas":return[new Fe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uh({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function QI({key:s,value:i}){if(Rt(i)==="string")return Gs({key:s,value:i});{let l=[];for(let f in i)l.push(...Gs({key:`${s}.${f}`,value:i[f]}));return l}}function Dx(s){let i=s.value,l=s.styleSpec,f=l.light,p=s.style,a=[],b=Rt(i);if(i===void 0)return a;if(b!=="object")return a=a.concat([new Fe("light",i,`object expected, ${b} found`)]),a;for(let P in i){let M=P.match(/^(.*)-transition$/);M&&f[M[1]]&&f[M[1]].transition?a=a.concat(s.validateSpec({key:P,value:i[P],valueSpec:l.transition,validateSpec:s.validateSpec,style:p,styleSpec:l})):f[P]?a=a.concat(s.validateSpec({key:P,value:i[P],valueSpec:f[P],validateSpec:s.validateSpec,style:p,styleSpec:l})):a=a.concat([new Fe(P,i[P],`unknown property "${P}"`)])}return a}function zx(s){let i=s.value,l=s.styleSpec,f=l.sky,p=s.style,a=Rt(i);if(i===void 0)return[];if(a!=="object")return[new Fe("sky",i,`object expected, ${a} found`)];let b=[];for(let P in i)f[P]?b=b.concat(s.validateSpec({key:P,value:i[P],valueSpec:f[P],style:p,styleSpec:l})):b=b.concat([new Fe(P,i[P],`unknown property "${P}"`)]);return b}function Ox(s){let i=s.value,l=s.styleSpec,f=l.terrain,p=s.style,a=[],b=Rt(i);if(i===void 0)return a;if(b!=="object")return a=a.concat([new Fe("terrain",i,`object expected, ${b} found`)]),a;for(let P in i)f[P]?a=a.concat(s.validateSpec({key:P,value:i[P],valueSpec:f[P],validateSpec:s.validateSpec,style:p,styleSpec:l})):a=a.concat([new Fe(P,i[P],`unknown property "${P}"`)]);return a}function eP(s){return Gs(s).length===0?[]:_c(s)}function tP(s){return Gs(s).length===0?[]:_c(s)}function iP(s){let i=s.key,l=s.value;if(Rt(l)==="array"){if(l.length<1||l.length>4)return[new Fe(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];let f={type:"number"},p=[];for(let a=0;a<l.length;a++)p=p.concat(s.validateSpec({key:`${i}[${a}]`,value:l[a],validateSpec:s.validateSpec,valueSpec:f}));return p}else return Gp({key:i,value:l,valueSpec:{}})}function rP(s){let i=s.key,l=s.value;if(Rt(l)==="array"){let f={type:"number"};if(l.length<1)return[new Fe(i,l,"array length at least 1 expected, length 0 found")];let p=[];for(let a=0;a<l.length;a++)p=p.concat(s.validateSpec({key:`${i}[${a}]`,value:l[a],validateSpec:s.validateSpec,valueSpec:f}));return p}else return Gp({key:i,value:l,valueSpec:{}})}function nP(s){let i=s.key,l=s.value;if(Rt(l)==="array"){if(l.length<1)return[new Fe(i,l,"array length at least 1 expected, length 0 found")];let f=[];for(let p=0;p<l.length;p++)f=f.concat(Kg({key:`${i}[${p}]`,value:l[p]}));return f}else return Kg({key:i,value:l})}function oP(s){let i=s.key,l=s.value,f=Rt(l),p=s.styleSpec;if(f!=="array"||l.length<1||l.length%2!==0)return[new Fe(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let b=0;b<l.length;b+=2)a=a.concat(uh({key:`${i}[${b}]`,value:l[b],valueSpec:p.layout_symbol["text-anchor"]})),a=a.concat(_y({key:`${i}[${b+1}]`,value:l[b+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:p}));return a}function Fx(s){let i=[],l=s.value,f=s.key;if(Array.isArray(l)){let p=[],a=[];for(let b in l){l[b].id&&p.includes(l[b].id)&&i.push(new Fe(f,l,`all the sprites' ids must be unique, but ${l[b].id} is duplicated`)),p.push(l[b].id),l[b].url&&a.includes(l[b].url)&&i.push(new Fe(f,l,`all the sprites' URLs must be unique, but ${l[b].url} is duplicated`)),a.push(l[b].url);let P={id:{type:"string",required:!0},url:{type:"string",required:!0}};i=i.concat(fn({key:`${f}[${b}]`,value:l[b],valueSpec:P,validateSpec:s.validateSpec}))}return i}else return Gs({key:f,value:l})}function aP(s){let i=s.value,l=s.styleSpec,f=l.projection,p=s.style,a=Rt(i);if(i===void 0)return[];if(a!=="object")return[new Fe("projection",i,`object expected, ${a} found`)];let b=[];for(let P in i)f[P]?b=b.concat(s.validateSpec({key:P,value:i[P],valueSpec:f[P],style:p,styleSpec:l})):b=b.concat([new Fe(P,i[P],`unknown property "${P}"`)]);return b}function sP(s){let i=s.key,l=s.value;l=l instanceof String?l.valueOf():l;let f=Rt(l);return f==="array"&&!cP(l)&&!lP(l)?[new Fe(i,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]:["array","string"].includes(f)?[]:[new Fe(i,l,`projection expected, invalid type "${f}" found`)]}function lP(s){return!!["interpolate","step","literal"].includes(s[0])}function cP(s){return Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"}function uP(s){return!!s&&s.constructor===Object}function Nx(s){return uP(s.value)?[]:[new Fe(s.key,s.value,`object expected, ${Rt(s.value)} found`)]}var C1={"*"(){return[]},array:_y,boolean:YI,number:Gp,color:Kg,constants:Px,enum:uh,filter:vy,function:Ex,layer:Rx,object:fn,source:Lx,light:Dx,sky:zx,terrain:Ox,projection:aP,projectionDefinition:sP,string:Gs,formatted:eP,resolvedImage:tP,padding:iP,numberArray:rP,colorArray:nP,variableAnchorOffsetCollection:oP,sprite:Fx,state:Nx};function Rp(s){let i=s.value,l=s.valueSpec,f=s.styleSpec;return s.validateSpec=Rp,l.expression&&gy(vi(i))?Ex(s):l.expression&&Tx($s(i))?_c(s):l.type&&C1[l.type]?C1[l.type](s):fn(gp({},s,{valueSpec:l.type?f[l.type]:l}))}function Bx(s){let i=s.value,l=s.key,f=Gs(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new Fe(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new Fe(l,i,'"glyphs" url must include a "{range}" token'))),f}function Jr(s,i=BS){let l=[];return l=l.concat(Rp({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:Rp,objectElementValidators:{glyphs:Bx,"*"(){return[]}}})),s.constants&&(l=l.concat(Px({key:"constants",value:s.constants}))),Ux(l)}Jr.source=On(zn(Lx));Jr.sprite=On(zn(Fx));Jr.glyphs=On(zn(Bx));Jr.light=On(zn(Dx));Jr.sky=On(zn(zx));Jr.terrain=On(zn(Ox));Jr.state=On(zn(Nx));Jr.layer=On(zn(Rx));Jr.filter=On(zn(vy));Jr.paintProperty=On(zn(Mx));Jr.layoutProperty=On(zn(kx));function zn(s){return function(i){return s({...i,validateSpec:Rp})}}function Ux(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function On(s){return function(...i){return Ux(s.apply(this,i))}}function M1(s){if(!s)return{style:Vo[Ps[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof s=="string"){let i=dP(s);return i.isValidStyle?{style:i.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:i.isValidJSON?{style:Vo[Ps[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:s.startsWith("http")?{style:s,requiresUrlMonitoring:!0,isFallback:!1}:s.toLowerCase().includes(".json")?{style:hP(s),requiresUrlMonitoring:!0,isFallback:!1}:{style:Qd(s),requiresUrlMonitoring:!0,isFallback:!1}}return s instanceof sc?{style:s.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:s instanceof lc?{style:s.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Jr(s).length===0?{style:s,requiresUrlMonitoring:!1,isFallback:!1}:{style:Vo[Ps[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function hP(s){try{return new URL(s).href}catch{}return new URL(s,location.origin).href}function dP(s){try{let i=JSON.parse(s),l=Jr(i);return{isValidJSON:!0,isValidStyle:l.length===0,styleObject:l.length===0?i:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Go(s,i,l){let f=window.document.createElement(s);return i!==void 0&&(f.className=i),l&&l.appendChild(f),f}function hh(s){s.parentNode&&s.parentNode.removeChild(s)}var Xg=class{constructor(){Ze(this,"_map"),Ze(this,"_container"),Ze(this,"_terrainButton"),VT(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(i){return this._map=i,this._container=Go("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Go("button","maplibregl-ctrl-terrain",this._container),Go("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){hh(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){jx(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}};function jx(s){s.hasTerrain()?s.disableTerrain():s.enableTerrain()}var Yg=class extends Pg{constructor(i={}){super({showCompass:i.showCompass??!0,showZoom:i.showZoom??!0,visualizePitch:i.visualizePitch??!0}),Ze(this,"_rotateCompassArrow",()=>{let l=this._map.getBearing(),f=this._map.getPitch(),p=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(f*(Math.PI/180))**.5)}) rotateX(${Math.min(70,f)}deg) rotateZ(${-l}deg)`:`rotate(${-l}deg)`;this._compassIcon.style.transform=p}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",l=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}))}_createButton(i,l){let f=super._createButton(i,l);return f.clickFunction=l,f}},k1=et.default.Marker,R1=et.default.LngLat,pP=et.default.LngLatBounds,Jg=class extends Eg{constructor(){super(...arguments),Ze(this,"lastUpdatedCenter",new R1(0,0)),Ze(this,"_updateCamera",i=>{var l;let f=new R1(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,a={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},b=this._map.getZoom();b>(((l=this.options.fitBoundsOptions)==null?void 0:l.maxZoom)??30)&&(a.zoom=b),this._map.fitBounds(pP.fromLngLat(f,p),a,{geolocateSource:!0});let P=!1,M=()=>{P=!0};this._map.once("click",M),this._map.once("dblclick",M),this._map.once("dragstart",M),this._map.once("mousedown",M),this._map.once("touchstart",M),this._map.once("wheel",M),this._map.once("moveend",()=>{this._map.off("click",M),this._map.off("dblclick",M),this._map.off("dragstart",M),this._map.off("mousedown",M),this._map.off("touchstart",M),this._map.off("wheel",M),!P&&(this.lastUpdatedCenter=this._map.getCenter())})}),Ze(this,"_finishSetupUI",i=>{if(this._map){if(i===!1){let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Go("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new k1({element:this._dotElement}),this._circleElement=Go("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new k1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",l=>{let f=l.originalEvent&&l.originalEvent.type==="resize",p=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!l.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!f&&p>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),Ze(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;let i=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],l=this._map.project(i),f=this._map.unproject([l.x,l.y]),p=this._map.unproject([l.x+20,l.y]),a=f.distanceTo(p)/20,b=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}},Cs,Wr,Ms,ks,Vu,Qg=class{constructor(i,l,f){if(Cr(this,Cs),Cr(this,Wr),Cr(this,Ms),Cr(this,ks),Cr(this,Vu),typeof i=="string"){let p=document.querySelector(i);if(!p)throw new Error(`No element has been found with selector "${i}" when creating an external control.`);Xr(this,Wr,p)}else Xr(this,Wr,i);l&&Xr(this,Ms,p=>{l(it(this,Cs),it(this,Wr),p)}),f&&Xr(this,ks,p=>{f(it(this,Cs),it(this,Wr),p)}),Xr(this,Vu,it(this,Wr).parentElement)}onAdd(i){return Xr(this,Cs,i),it(this,Ms)&&it(this,Wr).addEventListener("click",it(this,Ms)),it(this,ks)&&it(this,Cs).on("render",it(this,ks)),hh(it(this,Wr)),it(this,Wr)}onRemove(){it(this,Ms)&&it(this,Wr).removeEventListener("click",it(this,Ms)),it(this,ks)&&it(this,Cs).off("render",it(this,ks)),it(this,Vu)?it(this,Vu).appendChild(it(this,Wr)):hh(it(this,Wr))}};Cs=new WeakMap,Wr=new WeakMap,Ms=new WeakMap,ks=new WeakMap,Vu=new WeakMap;var ey=class{constructor(){Ze(this,"map"),Ze(this,"container"),Ze(this,"projectionButton")}onAdd(i){return this.map=i,this.container=Go("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Go("button","maplibregl-ctrl-projection",this.container),Go("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),i.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){hh(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){Vx(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}};function Vx(s){s.getProjection()===void 0&&s.setProjection({type:"mercator"}),s.isGlobeProjection()?s.enableMercatorProjection():s.enableGlobeProjection()}var $u={"zoom-in":s=>s.zoomIn(),"zoom-out":s=>s.zoomOut(),"toggle-projection":Vx,"toggle-terrain":jx,"reset-view":s=>{s.getPitch()===0?s.easeTo({pitch:Math.min(s.getMaxPitch(),80)}):s.resetNorthPitch()},"reset-bearing":s=>{s.rotateTo(0)},"reset-pitch":s=>{s.setPitch(0)},"reset-roll":s=>{s.setRoll(0)}},up,Gu,dh=class extends Qg{constructor(i,l){if(l&&!(l in $u))throw new Error(`data-maptiler-control value "${l}" is invalid.`);super(i,l&&$u[l]),Cr(this,up),Cr(this,Gu,new Map)}onAdd(i){return Xr(this,up,i),super.onAdd(i)}onRemove(){for(let[i,l]of it(this,Gu)){let f=i.deref();f&&f.removeEventListener("click",l)}it(this,Gu).clear(),super.onRemove()}configureGroupItem(i,l){if(!l)return;if(!(l in $u))throw new Error(`data-maptiler-control value "${l}" is invalid.`);let f=p=>{$u[l](it(this,up),i,p)};i.addEventListener("click",f),it(this,Gu).set(new WeakRef(i),f)}};up=new WeakMap,Gu=new WeakMap,Ze(dh,"controlCallbacks",$u);var Kr,so,Rs,Ls,hn,hp,br,$x,dn,Gx,Hu=class{constructor(i,l){Cr(this,br),Cr(this,Kr),Ze(this,"map"),Cr(this,so),Cr(this,Rs),Cr(this,Ls),Cr(this,hn,!1),Cr(this,hp),i.style!==void 0&&Xr(this,hn,!0),Xr(this,Kr,{zoomAdjust:-4,position:"top-right",...l,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...i,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...i.containerStyle??{}}}),i.lockZoom!==void 0&&(it(this,Kr).minZoom=i.lockZoom,it(this,Kr).maxZoom=i.lockZoom)}setStyle(i,l){it(this,hn)||this.map.setStyle(i,l),Hr(this,br,dn).call(this)}addLayer(i,l){return it(this,hn)||this.map.addLayer(i,l),Hr(this,br,dn).call(this),this.map}moveLayer(i,l){return it(this,hn)||this.map.moveLayer(i,l),Hr(this,br,dn).call(this),this.map}removeLayer(i){return it(this,hn)||this.map.removeLayer(i),Hr(this,br,dn).call(this),this}setLayerZoomRange(i,l,f){return it(this,hn)||this.map.setLayerZoomRange(i,l,f),Hr(this,br,dn).call(this),this}setFilter(i,l,f){return it(this,hn)||this.map.setFilter(i,l,f),Hr(this,br,dn).call(this),this}setPaintProperty(i,l,f,p){return it(this,hn)||this.map.setPaintProperty(i,l,f,p),Hr(this,br,dn).call(this),this}setLayoutProperty(i,l,f,p){return it(this,hn)||this.map.setLayoutProperty(i,l,f,p),Hr(this,br,dn).call(this),this}setGlyphs(i,l){return it(this,hn)||this.map.setGlyphs(i,l),Hr(this,br,dn).call(this),this}onAdd(i){Xr(this,so,i),Xr(this,Rs,Go("div","maplibregl-ctrl maplibregl-ctrl-group"));for(let[l,f]of Object.entries(it(this,Kr).containerStyle))it(this,Rs).style.setProperty(l,f);return it(this,Kr).container=it(this,Rs),it(this,Kr).zoom=i.getZoom()+it(this,Kr).zoomAdjust,this.map=new by(it(this,Kr)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Hr(this,br,$x).call(this,it(this,Kr).parentRect),Xr(this,hp,Hr(this,br,Gx).call(this))}),it(this,Rs)}onRemove(){var i;(i=it(this,hp))==null||i.call(this),hh(it(this,Rs))}};Kr=new WeakMap,so=new WeakMap,Rs=new WeakMap,Ls=new WeakMap,hn=new WeakMap,hp=new WeakMap,br=new WeakSet,$x=function(s){s===void 0||s.linePaint===void 0&&s.fillPaint===void 0||(Xr(this,Ls,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:it(this,Ls)}),(s.lineLayout!==void 0||s.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...s.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...s.linePaint}}),s.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...s.fillPaint}}),Hr(this,br,dn).call(this))},dn=function(){if(it(this,Ls)===void 0)return;let{devicePixelRatio:s}=window,i=it(this,so).getCanvas(),l=i.width/s,f=i.height/s,p=it(this,so).unproject.bind(it(this,so)),a=p([0,0]),b=p([l,0]),P=p([0,f]),M=p([l,f]);it(this,Ls).geometry.coordinates=[[P.toArray(),M.toArray(),b.toArray(),a.toArray(),P.toArray()]];let D=this.map.getSource("parentRect");D!==void 0&&D.setData(it(this,Ls))},Gx=function(){let{pitchAdjust:s}=it(this,Kr),i=()=>{a("parent")},l=()=>{a("minimap")},f=()=>{it(this,so).on("move",i),this.map.on("move",l)},p=()=>{it(this,so).off("move",i),this.map.off("move",l)},a=b=>{p();let P=b==="parent"?it(this,so):this.map,M=b==="parent"?this.map:it(this,so),D=P.getCenter(),B=P.getZoom()+it(this,Kr).zoomAdjust*(b==="parent"?1:-1),U=P.getBearing(),oe=P.getPitch();M.jumpTo({center:D,zoom:B,bearing:U,pitch:s?oe:0}),Hr(this,br,dn).call(this),f()};return f(),()=>{p()}};var ty=class{constructor(i,l=2e3){Ze(this,"map"),Ze(this,"registeredModules",new Set),Ze(this,"viewerType"),this.map=i,this.viewerType="Map",setTimeout(async()=>{if(!li.telemetry)return;let f=this.preparePayload();try{(await fetch(f,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(p){console.warn("The metrics could not be sent to MapTiler Cloud",p)}},Math.max(1e3,l))}registerModule(i,l){this.registeredModules.add(`${i}:${l}`)}registerViewerType(i="Map"){this.viewerType=i}preparePayload(){let i=new URL(wr.telemetryURL);return i.searchParams.append("sdk",TE()),i.searchParams.append("key",li.apiKey),i.searchParams.append("mtsid",cy),i.searchParams.append("session",li.session?"1":"0"),i.searchParams.append("caching",li.caching?"1":"0"),i.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),i.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),i.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),i.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&i.searchParams.append("modules",Array.from(this.registeredModules).join("|")),i.href}},ph=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});function Ku(){var s=new ph(16);return ph!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function fP(s,i,l,f,p,a,b,P,M,D,B,U,oe,le,me,xe,Ce){return s[0]=i,s[1]=l,s[2]=f,s[3]=p,s[4]=a,s[5]=b,s[6]=P,s[7]=M,s[8]=D,s[9]=B,s[10]=U,s[11]=oe,s[12]=le,s[13]=me,s[14]=xe,s[15]=Ce,s}function mP(s,i,l){var f=i[0],p=i[1],a=i[2],b=i[3],P=i[4],M=i[5],D=i[6],B=i[7],U=i[8],oe=i[9],le=i[10],me=i[11],xe=i[12],Ce=i[13],ke=i[14],Re=i[15],We=l[0],rt=l[1],qe=l[2],lt=l[3];return s[0]=We*f+rt*P+qe*U+lt*xe,s[1]=We*p+rt*M+qe*oe+lt*Ce,s[2]=We*a+rt*D+qe*le+lt*ke,s[3]=We*b+rt*B+qe*me+lt*Re,We=l[4],rt=l[5],qe=l[6],lt=l[7],s[4]=We*f+rt*P+qe*U+lt*xe,s[5]=We*p+rt*M+qe*oe+lt*Ce,s[6]=We*a+rt*D+qe*le+lt*ke,s[7]=We*b+rt*B+qe*me+lt*Re,We=l[8],rt=l[9],qe=l[10],lt=l[11],s[8]=We*f+rt*P+qe*U+lt*xe,s[9]=We*p+rt*M+qe*oe+lt*Ce,s[10]=We*a+rt*D+qe*le+lt*ke,s[11]=We*b+rt*B+qe*me+lt*Re,We=l[12],rt=l[13],qe=l[14],lt=l[15],s[12]=We*f+rt*P+qe*U+lt*xe,s[13]=We*p+rt*M+qe*oe+lt*Ce,s[14]=We*a+rt*D+qe*le+lt*ke,s[15]=We*b+rt*B+qe*me+lt*Re,s}function gP(s,i,l){var f=l[0],p=l[1],a=l[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*p,s[5]=i[5]*p,s[6]=i[6]*p,s[7]=i[7]*p,s[8]=i[8]*a,s[9]=i[9]*a,s[10]=i[10]*a,s[11]=i[11]*a,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function L1(s,i,l){var f=Math.sin(l),p=Math.cos(l),a=i[4],b=i[5],P=i[6],M=i[7],D=i[8],B=i[9],U=i[10],oe=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=a*p+D*f,s[5]=b*p+B*f,s[6]=P*p+U*f,s[7]=M*p+oe*f,s[8]=D*p-a*f,s[9]=B*p-b*f,s[10]=U*p-P*f,s[11]=oe*p-M*f,s}function yP(s,i,l){var f=Math.sin(l),p=Math.cos(l),a=i[0],b=i[1],P=i[2],M=i[3],D=i[8],B=i[9],U=i[10],oe=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=a*p-D*f,s[1]=b*p-B*f,s[2]=P*p-U*f,s[3]=M*p-oe*f,s[8]=a*f+D*p,s[9]=b*f+B*p,s[10]=P*f+U*p,s[11]=M*f+oe*p,s}function D1(s,i,l){var f=Math.sin(l),p=Math.cos(l),a=i[0],b=i[1],P=i[2],M=i[3],D=i[4],B=i[5],U=i[6],oe=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=a*p+D*f,s[1]=b*p+B*f,s[2]=P*p+U*f,s[3]=M*p+oe*f,s[4]=D*p-a*f,s[5]=B*p-b*f,s[6]=U*p-P*f,s[7]=oe*p-M*f,s}function _P(s,i,l,f,p){var a=1/Math.tan(i/2),b;return s[0]=a/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,p!=null&&p!==1/0?(b=1/(f-p),s[10]=(p+f)*b,s[14]=2*p*f*b):(s[10]=-1,s[14]=-2*f),s}var vP=_P;function dp(){var s=new ph(3);return ph!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function xP(s,i,l){var f=new ph(3);return f[0]=s,f[1]=i,f[2]=l,f}function _g(s,i){var l=i[0],f=i[1],p=i[2],a=l*l+f*f+p*p;return a>0&&(a=1/Math.sqrt(a)),s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s}function z1(s,i,l){var f=i[0],p=i[1],a=i[2],b=l[0],P=l[1],M=l[2];return s[0]=p*M-a*P,s[1]=a*b-f*M,s[2]=f*P-p*b,s}(function(){var s=dp();return function(i,l,f,p,a,b){var P,M;for(l||(l=3),f||(f=0),p?M=Math.min(p*l+f,i.length):M=i.length,P=f;P<M;P+=l)s[0]=i[P],s[1]=i[P+1],s[2]=i[P+2],a(s,s,b),i[P]=s[0],i[P+1]=s[1],i[P+2]=s[2];return i}})();function bP(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var O1,F1;function wP(){return F1||(F1=1,O1={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),O1}var vg,N1;function qx(){if(N1)return vg;N1=1;let s=wP(),i={};for(let p of Object.keys(s))i[s[p]]=p;let l={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};vg=l;for(let p of Object.keys(l)){if(!("channels"in l[p]))throw new Error("missing channels property: "+p);if(!("labels"in l[p]))throw new Error("missing channel labels property: "+p);if(l[p].labels.length!==l[p].channels)throw new Error("channel and label counts mismatch: "+p);let{channels:a,labels:b}=l[p];delete l[p].channels,delete l[p].labels,Object.defineProperty(l[p],"channels",{value:a}),Object.defineProperty(l[p],"labels",{value:b})}l.rgb.hsl=function(p){let a=p[0]/255,b=p[1]/255,P=p[2]/255,M=Math.min(a,b,P),D=Math.max(a,b,P),B=D-M,U,oe;D===M?U=0:a===D?U=(b-P)/B:b===D?U=2+(P-a)/B:P===D&&(U=4+(a-b)/B),U=Math.min(U*60,360),U<0&&(U+=360);let le=(M+D)/2;return D===M?oe=0:le<=.5?oe=B/(D+M):oe=B/(2-D-M),[U,oe*100,le*100]},l.rgb.hsv=function(p){let a,b,P,M,D,B=p[0]/255,U=p[1]/255,oe=p[2]/255,le=Math.max(B,U,oe),me=le-Math.min(B,U,oe),xe=function(Ce){return(le-Ce)/6/me+1/2};return me===0?(M=0,D=0):(D=me/le,a=xe(B),b=xe(U),P=xe(oe),B===le?M=P-b:U===le?M=1/3+a-P:oe===le&&(M=2/3+b-a),M<0?M+=1:M>1&&(M-=1)),[M*360,D*100,le*100]},l.rgb.hwb=function(p){let a=p[0],b=p[1],P=p[2],M=l.rgb.hsl(p)[0],D=1/255*Math.min(a,Math.min(b,P));return P=1-1/255*Math.max(a,Math.max(b,P)),[M,D*100,P*100]},l.rgb.cmyk=function(p){let a=p[0]/255,b=p[1]/255,P=p[2]/255,M=Math.min(1-a,1-b,1-P),D=(1-a-M)/(1-M)||0,B=(1-b-M)/(1-M)||0,U=(1-P-M)/(1-M)||0;return[D*100,B*100,U*100,M*100]};function f(p,a){return(p[0]-a[0])**2+(p[1]-a[1])**2+(p[2]-a[2])**2}return l.rgb.keyword=function(p){let a=i[p];if(a)return a;let b=1/0,P;for(let M of Object.keys(s)){let D=s[M],B=f(p,D);B<b&&(b=B,P=M)}return P},l.keyword.rgb=function(p){return s[p]},l.rgb.xyz=function(p){let a=p[0]/255,b=p[1]/255,P=p[2]/255;a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92;let M=a*.4124+b*.3576+P*.1805,D=a*.2126+b*.7152+P*.0722,B=a*.0193+b*.1192+P*.9505;return[M*100,D*100,B*100]},l.rgb.lab=function(p){let a=l.rgb.xyz(p),b=a[0],P=a[1],M=a[2];b/=95.047,P/=100,M/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,M=M>.008856?M**(1/3):7.787*M+16/116;let D=116*P-16,B=500*(b-P),U=200*(P-M);return[D,B,U]},l.hsl.rgb=function(p){let a=p[0]/360,b=p[1]/100,P=p[2]/100,M,D,B;if(b===0)return B=P*255,[B,B,B];P<.5?M=P*(1+b):M=P+b-P*b;let U=2*P-M,oe=[0,0,0];for(let le=0;le<3;le++)D=a+1/3*-(le-1),D<0&&D++,D>1&&D--,6*D<1?B=U+(M-U)*6*D:2*D<1?B=M:3*D<2?B=U+(M-U)*(2/3-D)*6:B=U,oe[le]=B*255;return oe},l.hsl.hsv=function(p){let a=p[0],b=p[1]/100,P=p[2]/100,M=b,D=Math.max(P,.01);P*=2,b*=P<=1?P:2-P,M*=D<=1?D:2-D;let B=(P+b)/2,U=P===0?2*M/(D+M):2*b/(P+b);return[a,U*100,B*100]},l.hsv.rgb=function(p){let a=p[0]/60,b=p[1]/100,P=p[2]/100,M=Math.floor(a)%6,D=a-Math.floor(a),B=255*P*(1-b),U=255*P*(1-b*D),oe=255*P*(1-b*(1-D));switch(P*=255,M){case 0:return[P,oe,B];case 1:return[U,P,B];case 2:return[B,P,oe];case 3:return[B,U,P];case 4:return[oe,B,P];case 5:return[P,B,U]}},l.hsv.hsl=function(p){let a=p[0],b=p[1]/100,P=p[2]/100,M=Math.max(P,.01),D,B;B=(2-b)*P;let U=(2-b)*M;return D=b*M,D/=U<=1?U:2-U,D=D||0,B/=2,[a,D*100,B*100]},l.hwb.rgb=function(p){let a=p[0]/360,b=p[1]/100,P=p[2]/100,M=b+P,D;M>1&&(b/=M,P/=M);let B=Math.floor(6*a),U=1-P;D=6*a-B,B&1&&(D=1-D);let oe=b+D*(U-b),le,me,xe;switch(B){default:case 6:case 0:le=U,me=oe,xe=b;break;case 1:le=oe,me=U,xe=b;break;case 2:le=b,me=U,xe=oe;break;case 3:le=b,me=oe,xe=U;break;case 4:le=oe,me=b,xe=U;break;case 5:le=U,me=b,xe=oe;break}return[le*255,me*255,xe*255]},l.cmyk.rgb=function(p){let a=p[0]/100,b=p[1]/100,P=p[2]/100,M=p[3]/100,D=1-Math.min(1,a*(1-M)+M),B=1-Math.min(1,b*(1-M)+M),U=1-Math.min(1,P*(1-M)+M);return[D*255,B*255,U*255]},l.xyz.rgb=function(p){let a=p[0]/100,b=p[1]/100,P=p[2]/100,M,D,B;return M=a*3.2406+b*-1.5372+P*-.4986,D=a*-.9689+b*1.8758+P*.0415,B=a*.0557+b*-.204+P*1.057,M=M>.0031308?1.055*M**(1/2.4)-.055:M*12.92,D=D>.0031308?1.055*D**(1/2.4)-.055:D*12.92,B=B>.0031308?1.055*B**(1/2.4)-.055:B*12.92,M=Math.min(Math.max(0,M),1),D=Math.min(Math.max(0,D),1),B=Math.min(Math.max(0,B),1),[M*255,D*255,B*255]},l.xyz.lab=function(p){let a=p[0],b=p[1],P=p[2];a/=95.047,b/=100,P/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,P=P>.008856?P**(1/3):7.787*P+16/116;let M=116*b-16,D=500*(a-b),B=200*(b-P);return[M,D,B]},l.lab.xyz=function(p){let a=p[0],b=p[1],P=p[2],M,D,B;D=(a+16)/116,M=b/500+D,B=D-P/200;let U=D**3,oe=M**3,le=B**3;return D=U>.008856?U:(D-16/116)/7.787,M=oe>.008856?oe:(M-16/116)/7.787,B=le>.008856?le:(B-16/116)/7.787,M*=95.047,D*=100,B*=108.883,[M,D,B]},l.lab.lch=function(p){let a=p[0],b=p[1],P=p[2],M;M=Math.atan2(P,b)*360/2/Math.PI,M<0&&(M+=360);let D=Math.sqrt(b*b+P*P);return[a,D,M]},l.lch.lab=function(p){let a=p[0],b=p[1],P=p[2]/360*2*Math.PI,M=b*Math.cos(P),D=b*Math.sin(P);return[a,M,D]},l.rgb.ansi16=function(p,a=null){let[b,P,M]=p,D=a===null?l.rgb.hsv(p)[2]:a;if(D=Math.round(D/50),D===0)return 30;let B=30+(Math.round(M/255)<<2|Math.round(P/255)<<1|Math.round(b/255));return D===2&&(B+=60),B},l.hsv.ansi16=function(p){return l.rgb.ansi16(l.hsv.rgb(p),p[2])},l.rgb.ansi256=function(p){let a=p[0],b=p[1],P=p[2];return a===b&&b===P?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(b/255*5)+Math.round(P/255*5)},l.ansi16.rgb=function(p){let a=p%10;if(a===0||a===7)return p>50&&(a+=3.5),a=a/10.5*255,[a,a,a];let b=(~~(p>50)+1)*.5,P=(a&1)*b*255,M=(a>>1&1)*b*255,D=(a>>2&1)*b*255;return[P,M,D]},l.ansi256.rgb=function(p){if(p>=232){let D=(p-232)*10+8;return[D,D,D]}p-=16;let a,b=Math.floor(p/36)/5*255,P=Math.floor((a=p%36)/6)/5*255,M=a%6/5*255;return[b,P,M]},l.rgb.hex=function(p){let a=(((Math.round(p[0])&255)<<16)+((Math.round(p[1])&255)<<8)+(Math.round(p[2])&255)).toString(16).toUpperCase();return"000000".substring(a.length)+a},l.hex.rgb=function(p){let a=p.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];let b=a[0];a[0].length===3&&(b=b.split("").map(U=>U+U).join(""));let P=parseInt(b,16),M=P>>16&255,D=P>>8&255,B=P&255;return[M,D,B]},l.rgb.hcg=function(p){let a=p[0]/255,b=p[1]/255,P=p[2]/255,M=Math.max(Math.max(a,b),P),D=Math.min(Math.min(a,b),P),B=M-D,U,oe;return B<1?U=D/(1-B):U=0,B<=0?oe=0:M===a?oe=(b-P)/B%6:M===b?oe=2+(P-a)/B:oe=4+(a-b)/B,oe/=6,oe%=1,[oe*360,B*100,U*100]},l.hsl.hcg=function(p){let a=p[1]/100,b=p[2]/100,P=b<.5?2*a*b:2*a*(1-b),M=0;return P<1&&(M=(b-.5*P)/(1-P)),[p[0],P*100,M*100]},l.hsv.hcg=function(p){let a=p[1]/100,b=p[2]/100,P=a*b,M=0;return P<1&&(M=(b-P)/(1-P)),[p[0],P*100,M*100]},l.hcg.rgb=function(p){let a=p[0]/360,b=p[1]/100,P=p[2]/100;if(b===0)return[P*255,P*255,P*255];let M=[0,0,0],D=a%1*6,B=D%1,U=1-B,oe=0;switch(Math.floor(D)){case 0:M[0]=1,M[1]=B,M[2]=0;break;case 1:M[0]=U,M[1]=1,M[2]=0;break;case 2:M[0]=0,M[1]=1,M[2]=B;break;case 3:M[0]=0,M[1]=U,M[2]=1;break;case 4:M[0]=B,M[1]=0,M[2]=1;break;default:M[0]=1,M[1]=0,M[2]=U}return oe=(1-b)*P,[(b*M[0]+oe)*255,(b*M[1]+oe)*255,(b*M[2]+oe)*255]},l.hcg.hsv=function(p){let a=p[1]/100,b=p[2]/100,P=a+b*(1-a),M=0;return P>0&&(M=a/P),[p[0],M*100,P*100]},l.hcg.hsl=function(p){let a=p[1]/100,b=p[2]/100*(1-a)+.5*a,P=0;return b>0&&b<.5?P=a/(2*b):b>=.5&&b<1&&(P=a/(2*(1-b))),[p[0],P*100,b*100]},l.hcg.hwb=function(p){let a=p[1]/100,b=p[2]/100,P=a+b*(1-a);return[p[0],(P-a)*100,(1-P)*100]},l.hwb.hcg=function(p){let a=p[1]/100,b=1-p[2]/100,P=b-a,M=0;return P<1&&(M=(b-P)/(1-P)),[p[0],P*100,M*100]},l.apple.rgb=function(p){return[p[0]/65535*255,p[1]/65535*255,p[2]/65535*255]},l.rgb.apple=function(p){return[p[0]/255*65535,p[1]/255*65535,p[2]/255*65535]},l.gray.rgb=function(p){return[p[0]/100*255,p[0]/100*255,p[0]/100*255]},l.gray.hsl=function(p){return[0,0,p[0]]},l.gray.hsv=l.gray.hsl,l.gray.hwb=function(p){return[0,100,p[0]]},l.gray.cmyk=function(p){return[0,0,0,p[0]]},l.gray.lab=function(p){return[p[0],0,0]},l.gray.hex=function(p){let a=Math.round(p[0]/100*255)&255,b=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(b.length)+b},l.rgb.gray=function(p){return[(p[0]+p[1]+p[2])/3/255*100]},vg}var xg,B1;function TP(){if(B1)return xg;B1=1;let s=qx();function i(){let a={},b=Object.keys(s);for(let P=b.length,M=0;M<P;M++)a[b[M]]={distance:-1,parent:null};return a}function l(a){let b=i(),P=[a];for(b[a].distance=0;P.length;){let M=P.pop(),D=Object.keys(s[M]);for(let B=D.length,U=0;U<B;U++){let oe=D[U],le=b[oe];le.distance===-1&&(le.distance=b[M].distance+1,le.parent=M,P.unshift(oe))}}return b}function f(a,b){return function(P){return b(a(P))}}function p(a,b){let P=[b[a].parent,a],M=s[b[a].parent][a],D=b[a].parent;for(;b[D].parent;)P.unshift(b[D].parent),M=f(s[b[D].parent][D],M),D=b[D].parent;return M.conversion=P,M}return xg=function(a){let b=l(a),P={},M=Object.keys(b);for(let D=M.length,B=0;B<D;B++){let U=M[B];b[U].parent!==null&&(P[U]=p(U,b))}return P},xg}var bg,U1;function SP(){if(U1)return bg;U1=1;let s=qx(),i=TP(),l={},f=Object.keys(s);function p(b){let P=function(...M){let D=M[0];return D==null?D:(D.length>1&&(M=D),b(M))};return"conversion"in b&&(P.conversion=b.conversion),P}function a(b){let P=function(...M){let D=M[0];if(D==null)return D;D.length>1&&(M=D);let B=b(M);if(typeof B=="object")for(let U=B.length,oe=0;oe<U;oe++)B[oe]=Math.round(B[oe]);return B};return"conversion"in b&&(P.conversion=b.conversion),P}return f.forEach(b=>{l[b]={},Object.defineProperty(l[b],"channels",{value:s[b].channels}),Object.defineProperty(l[b],"labels",{value:s[b].labels});let P=i(b);Object.keys(P).forEach(M=>{let D=P[M];l[b][M]=a(D),l[b][M].raw=p(D)})}),bg=l,bg}var IP=SP(),PP=bP(IP);function j1({gl:s,type:i,source:l}){let f=s.createShader(i);if(f===null)throw new Error("Cannot create shader");if(s.shaderSource(f,l),s.compileShader(f),!s.getShaderParameter(f,s.COMPILE_STATUS))throw console.error("Shader compilation error:",s.getShaderInfoLog(f)),s.deleteShader(f),new Error("Cannot compile shader");return f}function EP({gl:s,vertexShaderSource:i,fragmentShaderSource:l}){let f=j1({gl:s,type:s.VERTEX_SHADER,source:i}),p=j1({gl:s,type:s.FRAGMENT_SHADER,source:l}),a=s.createProgram();if(s.attachShader(a,f),s.attachShader(a,p),s.linkProgram(a),!s.getProgramParameter(a,s.LINK_STATUS))throw console.error("Error: ",s.getProgramInfoLog(a)),new Error("Cannot link shader program");return a}function AP(s,i,l){let f=s.getUniformLocation(i,l);if(f===null)throw new Error(`Cannot get uniform location for ${l}`);return f}function Zx({gl:s,vertexShaderSource:i,fragmentShaderSource:l,attributesKeys:f,uniformsKeys:p,vertices:a,indices:b}){let P=EP({gl:s,vertexShaderSource:i,fragmentShaderSource:l}),M=f.reduce((le,me)=>(le[me]=s.getAttribLocation(P,`a_${me}`),le),{}),D=p.reduce((le,me)=>(le[me]=AP(s,P,`u_${me}`),le),{}),B=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,B),s.bufferData(s.ARRAY_BUFFER,new Float32Array(a),s.STATIC_DRAW);let U,oe;return b!==void 0&&(U=s.createBuffer(),oe=b.length,s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,U),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),s.STATIC_DRAW)),{shaderProgram:P,programInfo:{attributesLocations:M,uniformsLocations:D},positionBuffer:B,indexBuffer:U,indexBufferLength:oe}}function pp(s){if(!s)return[1,1,1,0];if(s==="transparent")return[1,1,1,0];try{let i=CP(s),l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(i);if(l!=null&&l.length){let p=!!l[4];return[...PP.hex.rgb(i).map(a=>a/255),p?parseInt(l[4],16)/255:1]}let f=i.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(i.includes("rgb")){let p=i.includes("rgba"),a=[...f.map(b=>parseFloat(b)).map((b,P)=>P<3?b/255:b)];return p||a.push(1),a}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${s} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}var ju;function CP(s){return ju=ju??document.createElement("canvas").getContext("2d"),ju?(ju.fillStyle=s,ju.fillStyle):"#000000"}var xy=1,mn=xy/2,gn=xy/2,yn=xy/2,MP=[-.5,-.5,yn,mn,-.5,yn,mn,gn,yn,-.5,gn,yn],kP=[-.5,-.5,-.5,-.5,gn,-.5,mn,gn,-.5,mn,-.5,-.5],RP=[-.5,gn,-.5,-.5,gn,yn,mn,gn,yn,mn,gn,-.5],LP=[-.5,-.5,-.5,mn,-.5,-.5,mn,-.5,yn,-.5,-.5,yn],DP=[mn,-.5,-.5,mn,gn,-.5,mn,gn,yn,mn,-.5,yn],zP=[-.5,-.5,-.5,-.5,-.5,yn,-.5,gn,yn,-.5,gn,-.5],OP=[...MP,...kP,...RP,...LP,...DP,...zP],FP=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],NP=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,V1=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`;var Bs={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}},Ds=(s=>(s.POSITIVE_X="pX",s.NEGATIVE_X="nX",s.POSITIVE_Y="pY",s.NEGATIVE_Y="nY",s.POSITIVE_Z="pZ",s.NEGATIVE_Z="nZ",s))(Ds||{}),sp,$1,G1;function BP({gl:s,faces:i,onReady:l,forceRefresh:f}){sp&&!f&&G1===JSON.stringify(i)&&l(sp,$1),G1=JSON.stringify(i);let p=sp??s.createTexture();if(s.bindTexture(s.TEXTURE_CUBE_MAP,p),!i){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}let a=Object.keys(i).length;if(a!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${a}`);return}let b=Object.entries(i).map(([P,M])=>new Promise((D,B)=>{let U=P;if(M===void 0){B(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${P} is undefined`));return}let oe=new Image;oe.crossOrigin="anonymous";let le=()=>{D({image:oe,key:U})};oe.src=M,oe.complete&&oe.naturalWidth>0?le():oe.onload=le,oe.onerror=()=>{B(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${M}`))}}));Promise.all(b).then(P=>{for(let D=0;D<P.length;D++){let B=s.RGBA,U=s.RGBA,oe=s.UNSIGNED_BYTE,{image:le,key:me}=P[D]??{};if(!le||!me){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}let xe=UP(s,me);s.bindTexture(s.TEXTURE_CUBE_MAP,p),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(xe,0,B,U,oe,le)}s.bindTexture(s.TEXTURE_CUBE_MAP,p),s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);let M=P.map(D=>D.image);l(p,M),$1=M,sp=p}).catch(P=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",P)})}function UP(s,i){if(i===Ds.POSITIVE_X)return s.TEXTURE_CUBE_MAP_POSITIVE_X;if(i===Ds.NEGATIVE_X)return s.TEXTURE_CUBE_MAP_NEGATIVE_X;if(i===Ds.POSITIVE_Y)return s.TEXTURE_CUBE_MAP_POSITIVE_Y;if(i===Ds.NEGATIVE_Y)return s.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(i===Ds.POSITIVE_Z)return s.TEXTURE_CUBE_MAP_POSITIVE_Z;if(i===Ds.NEGATIVE_Z)return s.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${i}`)}function jP(s,i,l){return[Oa(s[0],i[0],l),Oa(s[1],i[1],l),Oa(s[2],i[2],l),Oa(s[3],i[3],l)]}function Oa(s,i,l){return s+(i-s)*l}var pc="https://api.maptiler.com/resources/space",VP=["vertexPosition"],$P=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],q1="%USE_TEXTURE_MACRO_MARKER%",GP="#define USE_TEXTURE",Z1=Bs.stars;function qP(s,i){if(!Wx(s))return{color:"transparent"};if(s===!0)return i;let l={...s};if(s.faces||s.path)return delete l.preset,l;let f=s.preset;if(f!==void 0&&!(f in Bs))throw new Error(`[CubemapLayer]: Invalid preset "${f}". Available presets: ${Object.keys(Bs).join(", ")}`);return{...l,color:l.color??Bs[f].color??"hsl(233,100%,92%)"}}var Xu=class{constructor(i){Ze(this,"id","Cubemap Layer"),Ze(this,"type","custom"),Ze(this,"renderingMode","3d"),Ze(this,"map"),Ze(this,"faces"),Ze(this,"useCubemapTexture",!0),Ze(this,"currentFadeOpacity",0),Ze(this,"cubeMapNeedsUpdate",!1),Ze(this,"bgColor"),Ze(this,"previousBgColor",[0,0,0,0]),Ze(this,"targetBgColor",[0,0,0,0]),Ze(this,"transitionDelta",0),Ze(this,"gl"),Ze(this,"cubemap"),Ze(this,"texture"),Ze(this,"currentFacesDefinitionKey",""),Ze(this,"options"),Ze(this,"animationActive",!0),Ze(this,"imageIsAnimating",!1),Ze(this,"imageFadeInDelta",0);let l=qP(i,Z1);this.options=l,this.currentFacesDefinitionKey=JSON.stringify(l.faces??l.preset??l.path),this.bgColor=[0,0,0,0],this.targetBgColor=pp(l.color),this.faces=W1(l),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:i}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;let l=$P.filter(f=>f==="cubeSampler"||f==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=Zx({gl:this.gl,vertexShaderSource:NP,fragmentShaderSource:this.useCubemapTexture?V1.replace(q1,GP):V1.replace(q1,""),attributesKeys:VP,uniformsKeys:l,vertices:OP,indices:FP}),this.cubeMapNeedsUpdate=i,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(i,l){this.map=i,this.gl=l,this.updateCubemap()}onRemove(i,l){this.cubemap&&(l.deleteProgram(this.cubemap.shaderProgram),l.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(i,l){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;BP({gl:i,faces:l,onReady:f=>{this.texture=f,this.animateIn()}})}}prerender(i,l){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){let i=()=>{this.transitionDelta<1&&(requestAnimationFrame(i),this.bgColor=jP(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(i)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(i=>{this.imageIsAnimating=!0;let l=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Oa(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(l);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,i()};requestAnimationFrame(l)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(i=>{let l=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Oa(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,i();return}requestAnimationFrame(l)};requestAnimationFrame(l)})}setAnimationActive(i){this.animationActive=i}render(i,l){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.DST_ALPHA),i.useProgram(this.cubemap.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,this.cubemap.positionBuffer),i.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);let f=.1,p=1e4,a=i.canvas,b=a.clientWidth/a.clientHeight,P=this.map.transform,M=P.fov*(Math.PI/180),D=Ku();vP(D,M,b,f,p),D1(D,D,P.rollInRadians),L1(D,D,-P.pitchInRadians),D1(D,D,P.bearingInRadians);let B=P.center.lat*Math.PI/180,U=P.center.lng*Math.PI/180;L1(D,D,B),yP(D,D,-U),i.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,D);let oe=Ku();if(i.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,oe),i.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),i.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_CUBE_MAP,this.texture),i.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),i.drawElements(i.TRIANGLES,this.cubemap.indexBufferLength,i.UNSIGNED_SHORT,0)}setBgColor(i){this.targetBgColor=i,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(i){if(await this.animateOut(),!i.faces&&!i.preset&&!i.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=W1(i),this.currentFacesDefinitionKey=JSON.stringify(i.faces??i.preset??i.path)}async setCubemap(i){let l=typeof i=="boolean"?Z1:i;this.options=l;let f=JSON.stringify(l.faces??l.preset??l.path),p=this.currentFacesDefinitionKey!==f;p&&(await this.setCubemapFaces(l),this.cubeMapNeedsUpdate=!0);let a=pp(l.color);if(l.color&&this.targetBgColor.toString()!==a.toString())this.setBgColor(a);else if(!l.color&&l.preset&&l.preset in Bs){let b=Bs[l.preset];this.setBgColor(pp(b.color))}this.updateCubemap({facesNeedUpdate:p})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function Wx(s){return s?typeof s=="boolean"?!0:!(!s.path&&!s.preset&&!s.faces&&!s.color||s.preset&&!(s.preset in Bs)||s.faces&&(!s.faces.pX||!s.faces.nX||!s.faces.pY||!s.faces.nY||!s.faces.pZ||!s.faces.nZ)):!1}function W1(s){if(s.faces)return s.faces;if(s.preset)return{pX:`${pc}/${s.preset}/px.webp`,nX:`${pc}/${s.preset}/nx.webp`,pY:`${pc}/${s.preset}/py.webp`,nY:`${pc}/${s.preset}/ny.webp`,pZ:`${pc}/${s.preset}/pz.webp`,nZ:`${pc}/${s.preset}/nz.webp`};if(s.path){let i=s.path.baseUrl,l=s.path.format??"png";return{pX:`${i}/px.${l}`,nX:`${i}/nx.${l}`,pY:`${i}/py.${l}`,nY:`${i}/ny.${l}`,pZ:`${i}/pz.${l}`,nZ:`${i}/nz.${l}`}}return null}var ZP=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,WP=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,qu=2,HP=["position"],KP=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],XP=[-2,-2,0,qu,-2,0,-2,qu,0,qu,qu,0],As={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},H1=.06,Yu=class{constructor(i){if(Ze(this,"id","Halo Layer"),Ze(this,"type","custom"),Ze(this,"renderingMode","3d"),Ze(this,"gradient"),Ze(this,"scale",0),Ze(this,"animationDelta",0),Ze(this,"map"),Ze(this,"plane"),Ze(this,"animationActive",!0),typeof i=="boolean"){this.gradient=As;return}this.gradient={...As,...i}}onAdd(i,l){this.map=i,this.plane=Zx({gl:l,vertexShaderSource:ZP,fragmentShaderSource:WP,attributesKeys:HP,uniformsKeys:KP,vertices:XP}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(i=>{this.animationDelta=0;let l=()=>{if(this.animationDelta<1){this.scale=Oa(0,this.gradient.scale,this.animationDelta),this.animationDelta+=H1,this.map.triggerRepaint(),requestAnimationFrame(l);return}i()};requestAnimationFrame(l)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(i=>{let l=()=>{if(this.animationDelta<1){this.scale=Oa(this.gradient.scale,0,this.animationDelta),this.animationDelta+=H1,this.map.triggerRepaint(),requestAnimationFrame(l);return}i()};l()})}onRemove(i,l){this.plane!==void 0&&(l.deleteProgram(this.plane.shaderProgram),l.deleteBuffer(this.plane.positionBuffer))}prerender(i,l){}render(i,l){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.useProgram(this.plane.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,this.plane.positionBuffer);let f=this.plane.programInfo.attributesLocations.position;i.enableVertexAttribArray(f),i.vertexAttribPointer(f,3,i.FLOAT,!1,0,0);let p=Ku(),a=this.scale;gP(p,p,[a,a,a]);let b=Ku();mP(b,l.defaultProjectionData.mainMatrix,p);let P=this.plane.programInfo.uniformsLocations.matrix;i.uniformMatrix4fv(P,!1,b);let M=Ku(),D=this.map.transform.cameraPosition,B=_g(dp(),D),U=xP(0,1,0),oe=dp();z1(oe,U,B),_g(oe,oe);let le=dp();z1(le,B,oe),_g(le,le),fP(M,oe[0],oe[1],oe[2],0,le[0],le[1],le[2],0,B[0],B[1],B[2],0,0,0,0,1);let me=this.plane.programInfo.uniformsLocations.rotationMatrix;i.uniformMatrix4fv(me,!1,M);let xe=this.gradient.stops.length,Ce=[],ke=[];for(let Re=0;Re<=xe;Re++)if(Re<xe){Ce[Re]=this.gradient.stops[Re][0];let We=pp(this.gradient.stops[Re][1]);ke.push(...We)}i.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,xe),i.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Ce)),i.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(ke)),i.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,qu),i.uniform1f(this.plane.programInfo.uniformsLocations.scale,a),i.drawArrays(i.TRIANGLE_STRIP,0,4)}async setGradient(i){if(i===!1){await this.animateOut();return}if(await this.animateOut(),!YP(i)){this.gradient.scale=As.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}i===!0?(this.gradient.scale=As.scale,this.gradient.stops=As.stops):(this.gradient.scale=i.scale??As.scale,this.gradient.stops=i.stops??As.stops),await this.animateIn()}setAnimationActive(i){this.animationActive=i}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function YP(s){return typeof s=="boolean"?!0:!(typeof s.scale!="number"||!s.stops||s.stops.length===0||s.stops.some(i=>typeof i[0]!="number"||typeof i[1]!="string"))}var JP={POINT:"POINT",COUNTRY:"COUNTRY"},by=class Hx extends et.default.Map{constructor(i){qT(i.container),i.apiKey&&(li.apiKey=i.apiKey);let{style:l,requiresUrlMonitoring:f,isFallback:p}=M1(i.style);p&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),li.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");let a=location.hash,b={compact:!1};i.customAttribution?b.customAttribution=i.customAttribution:i.attributionControl&&typeof i.attributionControl=="object"&&(b={...b,...i.attributionControl});let P={...i,style:l,maplibreLogo:!1,transformRequest:qv(i.transformRequest),attributionControl:i.forceNoAttributionControl===!0?!1:b};delete P.style,super(P),Ze(this,"telemetry"),Ze(this,"space"),Ze(this,"halo"),Ze(this,"options"),Ze(this,"isTerrainEnabled",!1),Ze(this,"terrainExaggeration",1),Ze(this,"primaryLanguage"),Ze(this,"terrainGrowing",!1),Ze(this,"terrainFlattening",!1),Ze(this,"minimap"),Ze(this,"forceLanguageUpdate"),Ze(this,"languageAlwaysBeenStyle"),Ze(this,"isReady",!1),Ze(this,"terrainAnimationDuration",1e3),Ze(this,"monitoredStyleUrls"),Ze(this,"styleInProcess",!1),Ze(this,"curentProjection"),Ze(this,"originalLabelStyle",new window.Map),Ze(this,"isStyleLocalized",!1),Ze(this,"languageIsUpdated",!1),Ze(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=i,this.setStyle(l),f&&this.monitorStyleUrl(l);let M=()=>{let le="The distant style could not be loaded.";this.getStyle()?le+="Leaving the style as is.":(this.setStyle(Vo.STREETS),le+=`Loading default MapTiler Cloud style "${Vo.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(le)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",le=>{if(le.error instanceof et.default.AJAXError){let me=le.error.url,xe=new URL(me);xe.search="";let Ce=xe.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Ce)&&(this.monitoredStyleUrls.delete(Ce),M());return}if(this.styleInProcess){M();return}}),li.caching&&!Ig&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),li.caching&&Ig&&UT(),typeof i.language>"u")this.primaryLanguage=li.primaryLanguage;else{let le=Yd(i.language,zt);this.primaryLanguage=le??li.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===zt.STYLE||this.primaryLanguage===zt.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===zt.STYLE,this.terrainExaggeration=i.terrainExaggeration??this.terrainExaggeration,this.curentProjection=i.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!i.geolocate||i.center||i.hash&&a)return;try{if(i.geolocate===JP.COUNTRY){await this.fitToIpBounds();return}}catch(me){console.warn(me.message)}let le;try{await this.centerOnIpPoint(i.zoom),le=this.getCameraHash()}catch(me){console.warn(me.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(me=>{le===this.getCameraHash()&&(this.terrain?this.easeTo({center:[me.coords.longitude,me.coords.latitude],zoom:i.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[me.coords.longitude,me.coords.latitude],zoom:i.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let le={logo:null};try{let me=Object.keys(this.style.sourceCaches).map(Ce=>this.getSource(Ce)).filter(Ce=>Ce&&"url"in Ce&&typeof Ce.url=="string"&&Ce.url.includes("tiles.json")),xe=new URL(me[0].url);xe.searchParams.has("key")||xe.searchParams.append("key",li.apiKey),le=await(await fetch(xe.href)).json()}catch{}if(i.customControls){let me="[data-maptiler-control-group]",xe="[data-maptiler-control]",Ce=qe=>{let lt=qe.dataset.maptilerControl;return(lt==="true"||lt==="")&&(lt=void 0),lt},ke=qe=>qe.dataset.maptilerPosition,Re=[...this._container.ownerDocument.querySelectorAll(me)],We=[...this._container.ownerDocument.querySelectorAll(xe)].filter(qe=>qe.closest(me)===null);if(typeof i.customControls=="string"){let qe=i.customControls;Re=Re.filter(lt=>lt.matches(qe)||lt.closest(qe)!==null),We=We.filter(lt=>lt.matches(qe)||lt.closest(qe)!==null)}for(let qe of Re){let lt=new dh(qe);this.addControl(lt,ke(qe));for(let Vi of qe.querySelectorAll(xe))lt.configureGroupItem(Vi,Ce(Vi))}for(let qe of We)this.addControl(new dh(qe,Ce(qe)),ke(qe));let rt=()=>{let{lng:qe,lat:lt}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(qe)),this._container.style.setProperty("--maptiler-center-lat",String(lt)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};rt(),this.on("render",rt)}if(i.forceNoAttributionControl!==!0)if("logo"in le&&le.logo){let me=le.logo;this.addControl(new mp({logoURL:me}),i.logoPosition)}else i.maptilerLogo&&this.addControl(new mp,i.logoPosition);if(i.scaleControl){let me=i.scaleControl===!0||i.scaleControl===void 0?"bottom-right":i.scaleControl,xe=new Cg({unit:li.unit});this.addControl(xe,me),li.on("unit",Ce=>{xe.setUnit(Ce)})}if(i.navigationControl!==!1){let me=i.navigationControl===!0||i.navigationControl===void 0?"top-right":i.navigationControl;this.addControl(new Yg,me)}if(i.geolocateControl!==!1){let me=i.geolocateControl===!0||i.geolocateControl===void 0?"top-right":i.geolocateControl;this.addControl(new Jg({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),me)}if(i.terrainControl){let me=i.terrainControl===!0||i.terrainControl===void 0?"top-right":i.terrainControl;this.addControl(new Xg,me)}if(i.projectionControl){let me=i.projectionControl===!0||i.projectionControl===void 0?"top-right":i.projectionControl;this.addControl(new ey,me)}if(i.fullscreenControl){let me=i.fullscreenControl===!0||i.fullscreenControl===void 0?"top-right":i.fullscreenControl;this.addControl(new Mg({}),me)}this.isReady=!0,this.fire("ready",{target:this})});let D=!1,B=!1,U;this.once("ready",()=>{D=!0,B&&this.fire("loadWithTerrain",U)}),this.once("style.load",()=>{let{minimap:le}=i;if(typeof le=="object"){let{zoom:me,center:xe,style:Ce,language:ke,apiKey:Re,maptilerLogo:We,canvasContextAttributes:rt,refreshExpiredTiles:qe,maxBounds:lt,scrollZoom:Vi,minZoom:zi,maxZoom:pr,boxZoom:Xi,locale:Qr,fadeDuration:mo,crossSourceCollisions:_n,clickTolerance:vn,bounds:xn,fitBoundsOptions:Jo,pixelRatio:Ot,validateStyle:bn}=i;this.minimap=new Hu(le,{zoom:me,center:xe,style:Ce,language:ke,apiKey:Re,container:"null",maptilerLogo:We,canvasContextAttributes:rt,refreshExpiredTiles:qe,maxBounds:lt,scrollZoom:Vi,minZoom:zi,maxZoom:pr,boxZoom:Xi,locale:Qr,fadeDuration:mo,crossSourceCollisions:_n,clickTolerance:vn,bounds:xn,fitBoundsOptions:Jo,pixelRatio:Ot,validateStyle:bn}),this.addControl(this.minimap,le.position??"bottom-left")}else le===!0?(this.minimap=new Hu({},i),this.addControl(this.minimap,"bottom-left")):le!==void 0&&le!==!1&&(this.minimap=new Hu({},i),this.addControl(this.minimap,le))});let oe=le=>{le.terrain&&(B=!0,U={type:"loadWithTerrain",target:this,terrain:le.terrain},this.off("terrain",oe),D&&this.fire("loadWithTerrain",U))};this.on("terrain",oe),i.terrain&&this.enableTerrain(i.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",me=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",me)});let le=this.getLayersOrder()[0];i.space&&this.initSpace({options:i,before:le}),i.halo&&this.initHalo({options:i,before:le})}),this.telemetry=new ty(this)}getSpace(){return this.space}setSpace(i){if(i===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(i),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new Xu(i),this.once("load",()=>{let l=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,l)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(i){this.halo?this.halo.setAnimationActive(i):this.once("load",()=>{var l;(l=this.halo)==null||l.setAnimationActive(i)})}setSpaceAnimationActive(i){this.space?this.space.setAnimationActive(i):this.once("load",()=>{var l;(l=this.space)==null||l.setAnimationActive(i)})}setSpaceFromStyle({style:i}){var l,f,p;if(this.options.space){this.setSpace(this.options.space);return}let a=(f=(l=i.metadata)==null?void 0:l.maptiler)==null?void 0:f.space;if(!a){this.setSpace({color:"transparent"});return}if(!Wx(a)){this.setSpace({color:"transparent"});return}if(JSON.stringify((p=this.space)==null?void 0:p.getConfig())===JSON.stringify(a)){if(this.space&&!this.getLayer(this.space.id)){let b=this.getLayersOrder()[0];this.addLayer(this.space,b)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){let b=this.getLayersOrder()[0];this.addLayer(this.space,b)}this.space.setCubemap(a)}})()}setHaloFromStyle({style:i}){var l,f,p;let a=(l=i.metadata)==null?void 0:l.maptiler;if(JSON.stringify((f=this.halo)==null?void 0:f.getConfig())===JSON.stringify(a?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){let b=this.getLayersOrder().indexOf(((p=this.space)==null?void 0:p.id)??"")+1,P=this.getLayersOrder()[b];this.addLayer(this.halo,P)}return}if(!(a!=null&&a.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var b;if(this.halo){if(!this.getLayer(this.halo.id)){let M=this.getLayersOrder().indexOf(((b=this.space)==null?void 0:b.id)??"")+1,D=this.getLayersOrder()[M];this.addLayer(this.halo,D)}let P=a?.halo??this.options.halo;P&&this.halo.setGradient(P)}})()}initSpace({options:i=this.options,before:l,spec:f}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,l);return}if(i.space===!1)return;let p=f;if(i.space){this.space=new Xu(i.space),this.addLayer(this.space,l);return}p&&(this.space=new Xu(p),this.addLayer(this.space,l))}initHalo({options:i=this.options,before:l,spec:f}){if(this.halo&&this.getLayer(this.halo.id)||i.halo===!1)return;let p=f;if(i.halo){this.halo=new Yu(i.halo),this.addLayer(this.halo,l);return}p&&(this.halo=new Yu(p),this.addLayer(this.halo,l))}getHalo(){return this.halo}setHalo(i){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(i);return}this.halo=new Yu(i),this.once("load",()=>{var l;let f=this.getLayersOrder(),p=f[0],a=f.indexOf(((l=this.space)==null?void 0:l.id)??"")+2,b=f[a];this.halo&&this.addLayer(this.halo,this.space?b:p)})}}recreate(){let i={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new Hx({...this.options})),this.once("load",()=>{this.jumpTo(i)})}setTerrainAnimationDuration(i){this.terrainAnimationDuration=Math.max(i,0)}async onLoadAsync(){return new Promise(i=>{if(this.loaded()){i(this);return}this.once("load",()=>{i(this)})})}async onReadyAsync(){return new Promise(i=>{if(this.isReady){i(this);return}this.once("ready",()=>{i(this)})})}async onLoadWithTerrainAsync(){return new Promise(i=>{if(this.isReady&&this.terrain){i(this);return}this.once("loadWithTerrain",()=>{i(this)})})}monitorStyleUrl(i){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);let l=new URL(i);l.search="",this.monitoredStyleUrls.add(l.href)}setStyle(i,l){var f,p,a,b,P;this.originalLabelStyle.clear(),(f=this.minimap)==null||f.setStyle(i),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});let M=M1(i);if(M.requiresUrlMonitoring&&this.monitorStyleUrl(M.style),M.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}let D=this.getStyle(),B=M.style;try{super.setStyle(M.style,l),this.styleInProcess=!0}catch(le){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",le)}let U=()=>{let le=M.style;if(!le.projection||le.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:M.style}),this.setHaloFromStyle({style:M.style})},oe=le=>{var me,xe,Ce,ke;let Re=le?.target.getStyle()??M.style,We=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Re}):this.initSpace({before:We,spec:(xe=(me=Re.metadata)==null?void 0:me.maptiler)==null?void 0:xe.space}),this.halo?this.setHaloFromStyle({style:Re}):this.initHalo({before:We,spec:(ke=(Ce=Re.metadata)==null?void 0:Ce.maptiler)==null?void 0:ke.halo})};if(typeof M.style=="string"||M.requiresUrlMonitoring)return this.on("styledata",oe),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",oe),this.once("styledata",oe),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((p=D?.terrain)==null?void 0:p.source)!==((a=B?.terrain)==null?void 0:a.source)||((b=D?.terrain)==null?void 0:b.exaggeration)!==((P=B?.terrain)==null?void 0:P.exaggeration))return this.once("terrain",U),this;try{oe()}catch{}return this}addLayer(i,l){var f;return(f=this.minimap)==null||f.addLayer(i,l),super.addLayer(i,l)}moveLayer(i,l){var f;return(f=this.minimap)==null||f.moveLayer(i,l),super.moveLayer(i,l)}removeLayer(i){var l;return(l=this.minimap)==null||l.removeLayer(i),super.removeLayer(i)}setLayerZoomRange(i,l,f){var p;return(p=this.minimap)==null||p.setLayerZoomRange(i,l,f),super.setLayerZoomRange(i,l,f)}setFilter(i,l,f){var p;return(p=this.minimap)==null||p.setFilter(i,l,f),super.setFilter(i,l,f)}setPaintProperty(i,l,f,p){var a;return(a=this.minimap)==null||a.setPaintProperty(i,l,f,p),super.setPaintProperty(i,l,f,p)}setLayoutProperty(i,l,f,p){var a;return(a=this.minimap)==null||a.setLayoutProperty(i,l,f,p),super.setLayoutProperty(i,l,f,p)}setGlyphs(i,l){var f;return(f=this.minimap)==null||f.setGlyphs(i,l),super.setGlyphs(i,l)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Nu(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(i){var l;(l=this.minimap)==null||l.map.setLanguage(i),this.onStyleReady(()=>{this.setPrimaryLanguage(i)})}setPrimaryLanguage(i){let l=this.getStyleLanguage(),f=Yd(i,zt);if(!f){console.warn(`The language "${f}" is not supported.`);return}if(!(f.flag===zt.STYLE.flag&&l&&(l.flag===zt.AUTO.flag||l.flag===zt.VISITOR.flag))&&(f.flag!==zt.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===f&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===zt.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=f;let p=f;if(f.flag===zt.STYLE.flag){if(!l){console.warn("The style has no default languages or has an invalid one.");return}p=l}let a=zt.LOCAL.flag,b=["get",a];p.flag===zt.VISITOR.flag?(a=jv().flag,b=["case",["all",["has",a],["has",zt.LOCAL.flag]],["case",["==",["get",a],["get",zt.LOCAL.flag]],["get",zt.LOCAL.flag],["format",["get",a],{"font-scale":.8},`
`,["get",zt.LOCAL.flag],{"font-scale":1.1}]],["get",zt.LOCAL.flag]]):p.flag===zt.VISITOR_ENGLISH.flag?(a=zt.ENGLISH.flag,b=["case",["all",["has",a],["has",zt.LOCAL.flag]],["case",["==",["get",a],["get",zt.LOCAL.flag]],["get",zt.LOCAL.flag],["format",["get",a],{"font-scale":.8},`
`,["get",zt.LOCAL.flag],{"font-scale":1.1}]],["get",zt.LOCAL.flag]]):p.flag===zt.AUTO.flag?(a=jv().flag,b=["coalesce",["get",a],["get",zt.LOCAL.flag]]):p===zt.LOCAL?(a=zt.LOCAL.flag,b=["get",a]):(a=p.flag,b=["coalesce",["get",a],["get",zt.LOCAL.flag]]);let{layers:P}=this.getStyle(),M=this.originalLabelStyle.size===0;if(M){let D=JT(P,this);this.isStyleLocalized=Object.keys(D.localized).length>0}for(let D of P){if(D.type!=="symbol")continue;let B=D,U=this.getSource(B.source);if(!U||!("url"in U&&typeof U.url=="string")||new URL(U.url).host!==wr.maptilerApiHost)continue;let{id:oe,layout:le}=B;if(!le||!("text-field"in le))continue;let me;if(M?(me=this.getLayoutProperty(oe,"text-field"),this.originalLabelStyle.set(oe,me)):me=this.originalLabelStyle.get(oe),typeof me=="string"){let{contains:xe,exactMatch:Ce}=WT(me,this.isStyleLocalized);if(!xe)continue;if(Ce)this.setLayoutProperty(oe,"text-field",b);else{let ke=HT(me,b,this.isStyleLocalized);this.setLayoutProperty(oe,"text-field",ke)}}else{let xe=ZT(me,b,this.isStyleLocalized);this.setLayoutProperty(oe,"text-field",xe)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(i){if(!this.terrain)return;let l=performance.now(),f=this.terrain.exaggeration,p=i-f,a=()=>{if(!this.terrain||this.terrainFlattening)return;let b=(performance.now()-l)/this.terrainAnimationDuration;if(b<.99){let P=1-(1-b)**4,M=f+P*p;this.terrain.exaggeration=M,requestAnimationFrame(a)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=i,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(a)}enableTerrain(i=this.terrainExaggeration){if(i<0){console.warn("Terrain exaggeration cannot be negative.");return}let l=p=>{!this.terrain||p.type!=="data"||p.dataType!=="source"||!("source"in p)||p.sourceId!=="maptiler-terrain"||p.source.type!=="raster-dem"||p.isSourceLoaded&&(this.off("data",l),this.growTerrain(i))},f=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=i,this.on("data",l),this.addSource(wr.terrainSourceId,{type:"raster-dem",url:wr.terrainSourceURL}),this.setTerrain({source:wr.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(i);return}if(this.loaded()||this.isTerrainEnabled)f();else{let p=()=>{this.getTerrain()&&this.getSource(wr.terrainSourceId)||f()};this.once("load",()=>{p()}),this.once("moveend",()=>{p()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;let i=performance.now(),l=this.terrain.exaggeration,f=()=>{if(!this.terrain||this.terrainGrowing)return;let p=(performance.now()-i)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,p<.99){let a=(1-p)**4,b=l*a;this.terrain.exaggeration=b,requestAnimationFrame(f)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(wr.terrainSourceId)&&this.removeSource(wr.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(f)}setTerrainExaggeration(i,l=!0){!l&&this.terrain?(this.terrainExaggeration=i,this.terrain.exaggeration=i,this.triggerRepaint()):this.enableTerrain(i)}onStyleReady(i){this.isStyleLoaded()?i():this.once("styledata",()=>{i()})}async fitToIpBounds(){let i=await Jd.info();this.fitBounds(i.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(i){let l=await Jd.info();this.jumpTo({center:[l.longitude??0,l.latitude??0],zoom:i||11})}getCameraHash(){let i=new Float32Array(5),l=this.getCenter();return i[0]=l.lng,i[1]=l.lat,i[2]=this.getZoom(),i[3]=this.getPitch(),i[4]=this.getBearing(),Uv.fromUint8Array(new Uint8Array(i.buffer))}getSdkConfig(){return li}getMaptilerSessionId(){return cy}setTransformRequest(i){return super.setTransformRequest(qv(i)),this}isGlobeProjection(){let i=this.getProjection();return i?i.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};var QP=["idle","render","load","remove","idle"],eE=["error"],tE=["resize"],iE=["webglcontextlost","webglcontextrestored"],rE=["moveend","movestart","move","zoomend","zoomstart","zoom","rotatestart","rotateend","rotate","dragstart","dragend","drag","boxzoomcancel","boxzoomend","boxzoomstart"],nE=["click","dblclick","mousedown","mouseup","mousemove","mouseout","mouseover","contextmenu","touchstart","touchend","touchmove","touchcancel"],oE=["cooperativegestureprevented"],aE=["data","dataloading","sourcedata","sourcedataloading","dataabort","sourcedataabort"],EM=[...QP,...eE,...tE,...iE,...rE,...nE,...aE,...oE];var AM=et.default.Evented;function wy(s){if(typeof DOMParser<"u"){let i=new DOMParser().parseFromString(s,"application/xml");if(i.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return i}throw new Error("No XML parser found")}function Kx(s,i){if(!s.hasChildNodes())return!1;for(let l of Array.from(s.childNodes)){let f=l.nodeName;if(typeof f=="string"&&f.trim().toLowerCase()===i.toLowerCase())return!0}return!1}function K1(s){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(s);throw new Error("No XML serializer found")}function Xx(s){let i=typeof s=="string"?wy(s):s;if(!Kx(i,"gpx"))throw new Error("The XML document is not valid GPX");let l=Ki(i,"trk"),f=Ki(i,"rte"),p=Ki(i,"wpt"),a={type:"FeatureCollection",features:[]};for(let b of Array.from(l)){let P=uE(b);P&&a.features.push(P)}for(let b of Array.from(f)){let P=hE(b);P&&a.features.push(P)}for(let b of Array.from(p))a.features.push(dE(b));return a}function Yx(s,i){let l=s;if(typeof l=="string"&&(l=wy(l)),!Kx(l,"kml"))throw new Error("The XML document is not valid KML");let f={type:"FeatureCollection",features:[]},p={},a={},b={},P=Ki(l,"Placemark"),M=Ki(l,"Style"),D=Ki(l,"StyleMap");for(let B of Array.from(M)){let U=Y1(i!==void 0?i(B):K1(B)).toString(16);p[`#${Us(B,"id")}`]=U,a[U]=B}for(let B of Array.from(D)){p[`#${Us(B,"id")}`]=Y1(i!==void 0?i(B):K1(B)).toString(16);let U=Ki(B,"Pair"),oe={};for(let le of Array.from(U))oe[Gt(_t(le,"key"))??""]=Gt(_t(le,"styleUrl"));b[`#${Us(B,"id")}`]=oe}for(let B of Array.from(P))f.features=f.features.concat(cE(B,p,a,b));return f}function X1(s){if(s===null)return["#000000",1];let i="",l=1,f=s;return f.startsWith("#")&&(f=f.substring(1)),(f.length===6||f.length===3)&&(i=f),f.length===8&&(l=Number.parseInt(f.substring(0,2),16)/255,i=`#${f.substring(6,8)}${f.substring(4,6)}${f.substring(2,4)}`),[i??"#000000",l??1]}function sE(s){return eb(s.split(" "))}function lE(s){let i=Ki(s,"coord"),l=[],f=[];i.length===0&&(i=Ki(s,"gx:coord"));for(let a of Array.from(i))l.push(sE(Gt(a)??""));let p=Ki(s,"when");for(let a of Array.from(p))f.push(Gt(a));return{coords:l,times:f}}function fp(s){let i=["Polygon","LineString","Point","Track","gx:Track"],l,f,p,a,b,P=[],M=[];if(_t(s,"MultiGeometry")!==null)return fp(_t(s,"MultiGeometry"));if(_t(s,"MultiTrack")!==null)return fp(_t(s,"MultiTrack"));if(_t(s,"gx:MultiTrack")!==null)return fp(_t(s,"gx:MultiTrack"));for(p=0;p<i.length;p++)if(f=Ki(s,i[p]),f){for(a=0;a<f.length;a++)if(l=f[a],i[p]==="Point")P.push({type:"Point",coordinates:tb(Gt(_t(l,"coordinates"))??"")});else if(i[p]==="LineString")P.push({type:"LineString",coordinates:Q1(Gt(_t(l,"coordinates"))??"")});else if(i[p]==="Polygon"){let D=Ki(l,"LinearRing"),B=[];for(b=0;b<D.length;b++)B.push(Q1(Gt(_t(D[b],"coordinates"))??""));P.push({type:"Polygon",coordinates:B})}else if(i[p]==="Track"||i[p]==="gx:Track"){let D=lE(l);P.push({type:"LineString",coordinates:D.coords}),D.times.length&&M.push(D.times)}}return{geoms:P,coordTimes:M}}function cE(s,i,l,f){let p=fp(s),a={},b=Gt(_t(s,"name")),P=Gt(_t(s,"address")),M=Gt(_t(s,"description")),D=_t(s,"TimeSpan"),B=_t(s,"TimeStamp"),U=_t(s,"ExtendedData"),oe=_t(s,"visibility"),le,me=Gt(_t(s,"styleUrl")),xe=_t(s,"LineStyle"),Ce=_t(s,"PolyStyle");if(!p.geoms.length)return[];if(b&&(a.name=b),P&&(a.address=P),me){me.startsWith("#")||(me=`#${me}`),a.styleUrl=me,i[me]&&(a.styleHash=i[me]),f[me]&&(a.styleMapHash=f[me],a.styleHash=i[f[me].normal??""]);let Re=l[a.styleHash??""];if(Re){xe||(xe=_t(Re,"LineStyle")),Ce||(Ce=_t(Re,"PolyStyle"));let We=_t(Re,"IconStyle");if(We){let rt=_t(We,"Icon");if(rt){let qe=Gt(_t(rt,"href"));qe&&(a.icon=qe)}}}}if(M&&(a.description=M),D){let Re=Gt(_t(D,"begin")),We=Gt(_t(D,"end"));Re&&We&&(a.timespan={begin:Re,end:We})}if(B!==null&&(a.timestamp=Gt(_t(B,"when"))??new Date().toISOString()),xe!==null){let Re=X1(Gt(_t(xe,"color"))),We=Re[0],rt=Re[1],qe=Number.parseFloat(Gt(_t(xe,"width"))??"");We&&(a.stroke=We),Number.isNaN(rt)||(a["stroke-opacity"]=rt),Number.isNaN(qe)||(a["stroke-width"]=qe)}if(Ce){let Re=X1(Gt(_t(Ce,"color"))),We=Re[0],rt=Re[1],qe=Gt(_t(Ce,"fill")),lt=Gt(_t(Ce,"outline"));We&&(a.fill=We),Number.isNaN(rt)||(a["fill-opacity"]=rt),qe&&(a["fill-opacity"]=qe==="1"?a["fill-opacity"]||1:0),lt&&(a["stroke-opacity"]=lt==="1"?a["stroke-opacity"]||1:0)}if(U){let Re=Ki(U,"Data"),We=Ki(U,"SimpleData");for(le=0;le<Re.length;le++)a[Re[le].getAttribute("name")??""]=Gt(_t(Re[le],"value"))??"";for(le=0;le<We.length;le++)a[We[le].getAttribute("name")??""]=Gt(We[le])??""}oe!==null&&(a.visibility=Gt(oe)??""),p.coordTimes.length!==0&&(a.coordTimes=p.coordTimes.length===1?p.coordTimes[0]:p.coordTimes);let ke={type:"Feature",geometry:p.geoms.length===1?p.geoms[0]:{type:"GeometryCollection",geometries:p.geoms},properties:a};return Us(s,"id")&&(ke.id=Us(s,"id")??void 0),[ke]}function Jx(s,i){let l=Ki(s,i),f=[],p=[],a=[],b=l.length;if(!(b<2)){for(let P=0;P<b;P++){let M=ib(l[P]);f.push(M.coordinates),M.time&&p.push(M.time),(M.heartRate||a.length)&&(a.length===0&&(a=new Array(P).fill(null)),a.push(M.heartRate))}return{line:f,times:p,heartRates:a}}}function uE(s){let i=Ki(s,"trkseg"),l=[],f=[],p=[],a;for(let P=0;P<i.length;P++)if(a=Jx(i[P],"trkpt"),a!==void 0&&(a.line&&l.push(a.line),a.times&&a.times.length&&f.push(a.times),p.length||a.heartRates&&a.heartRates.length)){if(!p.length)for(let M=0;M<P;M++)p.push(new Array(l[M].length).fill(null));a.heartRates&&a.heartRates.length?p.push(a.heartRates):p.push(new Array(a.line.length).fill(null))}if(l.length===0)return;let b={...Ty(s),...Qx(_t(s,"extensions"))};return f.length!==0&&(b.coordTimes=l.length===1?f[0]:f),p.length!==0&&(b.heartRates=l.length===1?p[0]:p),l.length===1?{type:"Feature",properties:b,geometry:{type:"LineString",coordinates:l[0]}}:{type:"Feature",properties:b,geometry:{type:"MultiLineString",coordinates:l}}}function hE(s){let i=Jx(s,"rtept");return i===void 0?void 0:{type:"Feature",properties:{...Ty(s),...Qx(_t(s,"extensions"))},geometry:{type:"LineString",coordinates:i.line}}}function dE(s){return{type:"Feature",properties:{...Ty(s),...iy(s,["sym"])},geometry:{type:"Point",coordinates:ib(s).coordinates}}}function Qx(s){let i={};if(s){let l=_t(s,"line");if(l){let f=Gt(_t(l,"color")),p=Number.parseFloat(Gt(_t(l,"opacity"))??"0"),a=Number.parseFloat(Gt(_t(l,"width"))??"0");f&&(i.stroke=f),Number.isNaN(p)||(i["stroke-opacity"]=p),Number.isNaN(a)||(i["stroke-width"]=a*96/25.4)}}return i}function Ty(s){let i=iy(s,["name","cmt","desc","type","time","keywords"]),l=Ki(s,"link");if(l.length!==0){i.links=[];for(let f of Array.from(l)){let p={href:Us(f,"href"),...iy(f,["text","type"])};i.links.push(p)}}return i}function Y1(s){let i=0;if(!s||!s.length)return i;for(let l=0;l<s.length;l++)i=(i<<5)-i+s.charCodeAt(l)|0;return i}function Ki(s,i){return s.getElementsByTagName(i)}function Us(s,i){return s.getAttribute(i)}function J1(s,i){return Number.parseFloat(Us(s,i)??"0")}function _t(s,i){let l=Ki(s,i);return l.length?l[0]:null}function pE(s){return s.normalize&&s.normalize(),s}function eb(s){return s.map(Number.parseFloat).map(i=>Number.isNaN(i)?null:i)}function Gt(s){return s&&pE(s),s&&s.textContent}function iy(s,i){let l={},f,p;for(p=0;p<i.length;p++)f=_t(s,i[p]),f&&(l[i[p]]=Gt(f)??"");return l}function tb(s){return eb(s.replace(/\s*/g,"").split(","))}function Q1(s){let i=s.replace(/^\s*|\s*$/g,"").split(/\s+/),l=[];for(let f of i)l.push(tb(f));return l}function ib(s){let i=[J1(s,"lon"),J1(s,"lat")],l=_t(s,"ele"),f=_t(s,"gpxtpx:hr")||_t(s,"hr"),p=_t(s,"time"),a;return l&&(a=Number.parseFloat(Gt(l)??"0"),Number.isNaN(a)||i.push(a)),{coordinates:i,time:p?Gt(p):null,heartRate:f!==null?Number.parseFloat(Gt(f)??"0"):null}}function fE(s){let i=s;try{typeof i=="string"&&(i=wy(i))}catch{return null}try{return Xx(i)}catch{}try{return Yx(i)}catch{}return null}async function mE(s,i={}){let l=i.download??!1,f=await gE(s);if(l){let p=i.filename??"maptiler_screenshot.png",a=document.createElement("a");a.style.display="none",document.body.appendChild(a),a.href=URL.createObjectURL(f),a.download=p,a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(a.href)},0)}return f}function gE(s){return new Promise((i,l)=>{s.redraw(),s.once("idle",()=>{s.getCanvas().toBlob(f=>{if(!f){l(Error("Screenshot could not be created."));return}i(f)},"image/png")})})}var ry=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function qp(){return ry[~~(Math.random()*ry.length)][~~(Math.random()*4)]}function gh(){return`maptiler_source_${rx()}`}function yh(){return`maptiler_layer_${rx()}`}function ny(s,i){if(i<=s[0].zoom)return s[0].value;if(i>=s[s.length-1].zoom)return s[s.length-1].value;for(let l=0;l<s.length-1;l+=1)if(i>=s[l].zoom&&i<s[l+1].zoom){let f=s[l+1].zoom-s[l].zoom,p=(i-s[l].zoom)/f;return p*s[l+1].value+(1-p)*s[l].value}return 0}function Fa(s){return["interpolate",["linear"],["zoom"],...s.flatMap(i=>[i.zoom,i.value])]}function jt(s){return["interpolate",["linear"],["zoom"],...s.flatMap(i=>[i.zoom,i.value])]}function rb(s,i){if(typeof i=="number"&&typeof s=="number")return 2*i+s;if(typeof i=="number"&&Array.isArray(s))return["interpolate",["linear"],["zoom"],...s.flatMap(l=>[l.zoom,2*i+l.value])];if(typeof s=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(l=>[l.zoom,2*l.value+s])];if(Array.isArray(s)&&Array.isArray(i)){let l=Array.from(new Set([...s.map(f=>f.zoom),...i.map(f=>f.zoom)])).sort((f,p)=>f<p?-1:1);return["interpolate",["linear"],["zoom"],...l.flatMap(f=>[f,2*ny(i,f)+ny(s,f)])]}return 0}function nb(s,i){return["interpolate",["linear"],["get",i],...s.flatMap(l=>[l.propertyValue,l.value])]}function Sy(s){let i=s.trimStart(),l=`${i}${" ".repeat(s.length-i.length)}`,f=Array.from(l);if(!f.every(a=>a===" "||a==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(f.some(a=>a==="_")&&f.some(a=>a===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");let p=[1];for(let a=1;a<f.length;a+=1){let b=f[a-1],P=f[a];b===P?p[p.length-1]+=1:p.push(1)}return p}function oy(s,i){return["interpolate",["linear"],["get",i],...s.flatMap(l=>[l.value,l.color])]}function ay(s,i,l=!0){return l?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius*.025])],2,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius*.05])],4,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius*.1])],8,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius*.25])],16,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius])]]:["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.value,f.pointRadius])]}function ob(s,i,l=!0){return l?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value*.025])],2,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value*.05])],4,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value*.1])],8,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value*.25])],16,["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value])]]:["interpolate",["linear"],["get",i],...s.flatMap(f=>[f.propertyValue,f.value])]}function sy(s,i){return s.every(l=>l.color[3]===s[0].color[3])?s[0].color[3]?s[0].color[3]/255:1:["interpolate",["linear"],["get",i],...s.getRawColorStops().flatMap(l=>{let f=l.value,p=l.color;return[f,p.length===4?p[3]/255:1]})]}function ab(s,i=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:i+1},(l,f)=>{let p=f/i;return[p,s.getColorHex(p)]}).flat()]}function lp(s){let i=s.toString(16);return i.length===1?`0${i}`:i}function yE(s){return`#${lp(s[0])}${lp(s[1])}${lp(s[2])}${s.length===4?lp(s[3]):""}`}var ht=class s extends Array{constructor(i={}){super(),Ze(this,"min",0),Ze(this,"max",1),"min"in i&&(this.min=i.min),"max"in i&&(this.max=i.max),"stops"in i&&this.setStops(i.stops,{clone:!1})}static fromArrayDefinition(i){return new s({stops:i.map(l=>({value:l[0],color:l[1]}))})}setStops(i,l={clone:!0}){let f=l.clone?this.clone():this;f.length=0;let p=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let b=0;b<i.length;b+=1)p=Math.min(p,i[b].value),a=Math.max(a,i[b].value),f.push({value:i[b].value,color:i[b].color.slice()});return f.sort((b,P)=>b.value<P.value?-1:1),this.min=p,this.max=a,f}scale(i,l,f={clone:!0}){let p=f.clone,a=this[0].value,b=this.at(-1).value-a,P=l-i,M=[];for(let D=0;D<this.length;D+=1){let B=(this[D].value-a)/b*P+i;p?M.push({value:B,color:this[D].color.slice()}):this[D].value=B}return p?new s({stops:M}):this}at(i){return i<0?this[this.length+i]:this[i]}clone(){return new s({stops:this.getRawColorStops()})}getRawColorStops(){let i=[];for(let l=0;l<this.length;l+=1)i.push({value:this[l].value,color:this[l].color});return i}reverse(i={clone:!0}){let l=i.clone?this.clone():this;for(let f=0;f<~~(l.length/2);f+=1){let p=l[f].color;l[f].color=l.at(-(f+1)).color,l.at(-(f+1)).color=p}return l}getBounds(){return{min:this.min,max:this.max}}getColor(i,l={smooth:!0}){if(i<=this[0].value)return this[0].color;if(i>=this.at(-1).value)return this.at(-1).color;for(let f=0;f<this.length-1;f+=1){if(i>this[f+1].value)continue;let p=this[f].color;if(!l.smooth)return p.slice();let a=this[f].value,b=this[f+1].value,P=this[f+1].color,M=(b-i)/(b-a);return p.map((D,B)=>Math.round(D*M+P[B]*(1-M)))}return[0,0,0]}getColorHex(i,l={smooth:!0,withAlpha:!1}){return yE(this.getColor(i,l))}getColorRelative(i,l={smooth:!0}){let f=this.getBounds();return this.getColor(f.min+i*(f.max-f.min),l)}getCanvasStrip(i={horizontal:!0,size:512,smooth:!0}){let l=document.createElement("canvas");l.width=i.horizontal?i.size:1,l.height=i.horizontal?1:i.size;let f=l.getContext("2d");if(!f)throw new Error("Canvs context is missing");let p=f.getImageData(0,0,l.width,l.height),a=p.data,b=i.size,P=this[0].value,M=(this.at(-1).value-P)/b;for(let D=0;D<b;D+=1){let B=this.getColor(P+D*M,{smooth:i.smooth});a[D*4]=B[0],a[D*4+1]=B[1],a[D*4+2]=B[2],a[D*4+3]=B.length>3?B[3]:255}return f.putImageData(p,0,0),l}resample(i,l=15){let f=this.getBounds(),p=this.scale(0,1),a=1/(l-1),b;if(i==="ease-in-square")b=Array.from({length:l},(P,M)=>{let D=M*a,B=D**2,U=p.getColor(B);return{value:D,color:U}});else if(i==="ease-out-square")b=Array.from({length:l},(P,M)=>{let D=M*a,B=1-(1-D)**2,U=p.getColor(B);return{value:D,color:U}});else if(i==="ease-out-sqrt")b=Array.from({length:l},(P,M)=>{let D=M*a,B=D**.5,U=p.getColor(B);return{value:D,color:U}});else if(i==="ease-in-sqrt")b=Array.from({length:l},(P,M)=>{let D=M*a,B=1-(1-D)**.5,U=p.getColor(B);return{value:D,color:U}});else if(i==="ease-out-exp")b=Array.from({length:l},(P,M)=>{let D=M*a,B=1-2**(-10*D),U=p.getColor(B);return{value:D,color:U}});else if(i==="ease-in-exp")b=Array.from({length:l},(P,M)=>{let D=M*a,B=2**(10*D-10),U=p.getColor(B);return{value:D,color:U}});else throw new Error("Invalid ressampling method.");return new s({stops:b}).scale(f.min,f.max)}transparentStart(){let i=this.getRawColorStops();i.unshift({value:i[0].value,color:i[0].color.slice()}),i[1].value+=.001;for(let l of i)l.color.length===3&&l.color.push(255);return i[0].color[3]=0,new s({stops:i})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}},sb={NULL:new ht({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new ht({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new ht({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new ht({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new ht({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new ht({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new ht({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new ht({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new ht({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new ht({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new ht({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new ht({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new ht({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new ht({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new ht({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new ht({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new ht({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new ht({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new ht({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new ht({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new ht({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new ht({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new ht({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new ht({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new ht({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new ht({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new ht({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new ht({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new ht({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new ht({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new ht({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new ht({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new ht({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new ht({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new ht({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new ht({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new ht({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new ht({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new ht({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new ht({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new ht({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new ht({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new ht({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new ht({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new ht({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new ht({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new ht({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new ht({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new ht({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function _E(s,i,l={}){var f,p;if(!i.sourceId&&!i.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let a=i.data;if(typeof a=="string"){if(Lp(a))a=`https://api.maptiler.com/data/${i.data}/features.json?key=${li.apiKey}`;else if(((f=a.split(".").pop())==null?void 0:f.toLowerCase().trim())==="gpx"){let b=await(await fetch(a,l)).text();a=Xx(b)}else if(((p=a.split(".").pop())==null?void 0:p.toLowerCase().trim())==="kml"){let b=await(await fetch(a,l)).text();a=Yx(b)}else{let b=$T(a)??fE(a);b&&(a=b)}if(!a)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return vE(s,{...i,data:a})}function vE(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??gh(),f=i.layerId??yh(),p={polylineLayerId:f,polylineOutlineLayerId:"",polylineSourceId:l};i.data&&!s.getSource(l)&&s.addSource(l,{type:"geojson",data:i.data});let a=i.lineWidth??3,b=i.lineColor??qp(),P=i.lineOpacity??1,M=i.lineBlur??0,D=i.lineGapWidth??0,B=i.lineDashArray??null,U=i.outlineWidth??1,oe=i.outlineColor??"#FFFFFF",le=i.outlineOpacity??1,me=i.outlineBlur??0;if(typeof B=="string"&&(B=Sy(B)),i.outline===!0){let xe=`${f}_outline`;p.polylineOutlineLayerId=xe,s.addLayer({id:xe,type:"line",source:l,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof le=="number"?le:jt(le),"line-color":typeof oe=="string"?oe:Fa(oe),"line-width":rb(a,U),"line-blur":typeof me=="number"?me:jt(me)}},i.beforeId)}return s.addLayer({id:f,type:"line",source:l,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof P=="number"?P:jt(P),"line-color":typeof b=="string"?b:Fa(b),"line-width":typeof a=="number"?a:jt(a),"line-blur":typeof M=="number"?M:jt(M),"line-gap-width":typeof D=="number"?D:jt(D),...B&&{"line-dasharray":B}}},i.beforeId),p}function xE(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??gh(),f=i.layerId??yh(),p={polygonLayerId:f,polygonOutlineLayerId:i.outline?`${f}_outline`:"",polygonSourceId:l};if(i.data&&!s.getSource(l)){let xe=i.data;typeof xe=="string"&&Lp(xe)&&(xe=`https://api.maptiler.com/data/${xe}/features.json?key=${li.apiKey}`),s.addSource(l,{type:"geojson",data:xe})}let a=i.outlineDashArray??null,b=i.outlineWidth??1,P=i.outlineColor??"#FFFFFF",M=i.outlineOpacity??1,D=i.outlineBlur??0,B=i.fillColor??qp(),U=i.fillOpacity??1,oe=i.outlinePosition??"center",le=i.pattern??null;typeof a=="string"&&(a=Sy(a));let me=(xe=null)=>{if(s.addLayer({id:f,type:"fill",source:l,minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"fill-color":typeof B=="string"?B:Fa(B),"fill-opacity":typeof U=="number"?U:jt(U),...xe&&{"fill-pattern":xe}}},i.beforeId),i.outline===!0){let Ce;oe==="inside"?typeof b=="number"?Ce=.5*b:Ce=jt(b.map(({zoom:ke,value:Re})=>({zoom:ke,value:.5*Re}))):oe==="outside"?typeof b=="number"?Ce=-.5*b:Ce=jt(b.map(ke=>({zoom:ke.zoom,value:-.5*ke.value}))):Ce=0,s.addLayer({id:p.polygonOutlineLayerId,type:"line",source:l,layout:{"line-join":i.outlineJoin??"round","line-cap":i.outlineCap??"butt"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof M=="number"?M:jt(M),"line-color":typeof P=="string"?P:Fa(P),"line-width":typeof b=="number"?b:jt(b),"line-blur":typeof D=="number"?D:jt(D),"line-offset":Ce,...a&&{"line-dasharray":a}}},i.beforeId)}};return le?s.hasImage(le)?me(le):s.loadImage(le).then(xe=>{s.addImage(le,xe.data),me(le)}).catch(xe=>{console.error("Could not load the pattern image.",xe.message),me()}):me(),p}function bE(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.minPointRadius??10,f=i.maxPointRadius??50,p=i.cluster??!1,a=20,b=Array.isArray(i.pointColor)?i.pointColor:sb.TURBO.scale(10,i.cluster?1e4:1e3).resample("ease-out-square"),P=b.getBounds(),M=i.sourceId??gh(),D=i.layerId??yh(),B=i.showLabel??p,U=i.alignOnViewport??!0,oe=i.outline??!1,le=i.outlineOpacity??1,me=i.outlineWidth??1,xe=i.outlineColor??"#FFFFFF",Ce,ke=i.zoomCompensation??!0,Re=i.minzoom??0,We=i.maxzoom??23;typeof i.pointOpacity=="number"?Ce=i.pointOpacity:Array.isArray(i.pointOpacity)?Ce=jt(i.pointOpacity):i.cluster?Ce=sy(b,"point_count"):i.property?Ce=sy(b,i.property):Ce=jt([{zoom:Re,value:0},{zoom:Re+.25,value:1},{zoom:We-.25,value:1},{zoom:We,value:0}]);let rt={pointLayerId:D,clusterLayerId:"",labelLayerId:"",pointSourceId:M};if(i.data&&!s.getSource(M)){let qe=i.data;typeof qe=="string"&&Lp(qe)&&(qe=`https://api.maptiler.com/data/${qe}/features.json?key=${li.apiKey}`),s.addSource(M,{type:"geojson",data:qe,cluster:p})}if(p){rt.clusterLayerId=`${D}_cluster`;let qe=Array.from({length:a},(lt,Vi)=>{let zi=P.min+Vi*(P.max-P.min)/(a-1);return{value:zi,pointRadius:l+(f-l)*(Vi/(a-1))**.5,color:b.getColorHex(zi)}});s.addLayer({id:rt.clusterLayerId,type:"circle",source:M,filter:["has","point_count"],paint:{"circle-color":typeof i.pointColor=="string"?i.pointColor:oy(qe,"point_count"),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?jt(i.pointRadius):ay(qe,"point_count",!1),"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Ce,...oe&&{"circle-stroke-opacity":typeof le=="number"?le:jt(le),"circle-stroke-width":typeof me=="number"?me:jt(me),"circle-stroke-color":typeof xe=="string"?xe:Fa(xe)}},minzoom:Re,maxzoom:We},i.beforeId),s.addLayer({id:rt.pointLayerId,type:"circle",source:M,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof i.pointColor=="string"?i.pointColor:b.getColorHex(b.getBounds().min),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?jt(i.pointRadius):qe[0].pointRadius*.75,"circle-opacity":Ce,...oe&&{"circle-stroke-opacity":typeof le=="number"?le:jt(le),"circle-stroke-width":typeof me=="number"?me:jt(me),"circle-stroke-color":typeof xe=="string"?xe:Fa(xe)}},minzoom:Re,maxzoom:We},i.beforeId)}else{let qe=typeof i.pointColor=="string"?i.pointColor:Array.isArray(i.pointColor)?i.pointColor.getColorHex(i.pointColor.getBounds().min):qp(),lt=typeof i.pointRadius=="number"?ke?jt([{zoom:0,value:i.pointRadius*.025},{zoom:2,value:i.pointRadius*.05},{zoom:4,value:i.pointRadius*.1},{zoom:8,value:i.pointRadius*.25},{zoom:16,value:i.pointRadius*1}]):i.pointRadius:Array.isArray(i.pointRadius)?jt(i.pointRadius):ke?jt([{zoom:0,value:l*.05},{zoom:2,value:l*.1},{zoom:4,value:l*.2},{zoom:8,value:l*.5},{zoom:16,value:l*1}]):l;if(i.property&&Array.isArray(i.pointColor)){let Vi=Array.from({length:a},(zi,pr)=>{let Xi=P.min+pr*(P.max-P.min)/(a-1);return{value:Xi,pointRadius:typeof i.pointRadius=="number"?i.pointRadius:l+(f-l)*(pr/(a-1))**.5,color:typeof i.pointColor=="string"?i.pointColor:b.getColorHex(Xi)}});qe=oy(Vi,i.property),lt=ay(Vi,i.property,ke)}s.addLayer({id:rt.pointLayerId,type:"circle",source:M,layout:{"circle-sort-key":i.property?["/",1,["get",i.property]]:0},paint:{"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-color":qe,"circle-opacity":Ce,"circle-radius":lt,...oe&&{"circle-stroke-opacity":typeof le=="number"?le:jt(le),"circle-stroke-width":typeof me=="number"?me:jt(me),"circle-stroke-color":typeof xe=="string"?xe:Fa(xe)}},minzoom:Re,maxzoom:We},i.beforeId)}if(B!==!1&&(i.cluster||i.property)){rt.labelLayerId=`${D}_label`;let qe=i.labelColor??"#fff",lt=i.labelSize??12;s.addLayer({id:rt.labelLayerId,type:"symbol",source:M,filter:["has",i.cluster?"point_count":i.property],layout:{"text-field":i.cluster?"{point_count_abbreviated}":`{${i.property}}`,"text-font":["Noto Sans Regular"],"text-size":lt,"text-pitch-alignment":U?"viewport":"map","symbol-sort-key":["/",1,["get",i.cluster?"point_count":i.property]]},paint:{"text-color":qe,"text-opacity":Ce},minzoom:Re,maxzoom:We},i.beforeId)}return rt}function wE(s,i){if(i.layerId&&s.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);let l=i.sourceId??gh(),f=i.layerId??yh(),p=i.minzoom??0,a=i.maxzoom??23,b=i.zoomCompensation??!0,P=i.opacity??[{zoom:p,value:0},{zoom:p+.25,value:1},{zoom:a-.25,value:1},{zoom:a,value:0}],M=Array.isArray(i.colorRamp)?i.colorRamp:sb.TURBO.transparentStart(),D=M.getBounds();(D.min!==0||D.max!==1)&&(M=M.scale(0,1)),M.hasTransparentStart()||(M=M.transparentStart());let B=i.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],U=i.property??null,oe=i.weight??1,le=1;U?typeof oe=="number"?(le=oe,typeof i.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(oe)?le=nb(oe,U):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof oe=="number"?le=oe:Array.isArray(oe)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");let me=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],xe=i.radius??(b?me:10),Ce=1;typeof xe=="number"?Ce=xe:Array.isArray(xe)&&"zoom"in xe[0]?Ce=jt(xe):U&&Array.isArray(xe)&&"propertyValue"in xe[0]?Ce=ob(xe,U,b):!U&&Array.isArray(xe)&&"propertyValue"in xe[0]?(Ce=jt(me),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Ce=jt(me);let ke={heatmapLayerId:f,heatmapSourceId:l};if(i.data&&!s.getSource(l)){let Re=i.data;typeof Re=="string"&&Lp(Re)&&(Re=`https://api.maptiler.com/data/${Re}/features.json?key=${li.apiKey}`),s.addSource(l,{type:"geojson",data:Re})}return s.addLayer({id:f,type:"heatmap",source:l,minzoom:p,maxzoom:a,paint:{"heatmap-weight":le,"heatmap-intensity":typeof B=="number"?B:jt(B),"heatmap-color":ab(M),"heatmap-radius":Ce,"heatmap-opacity":typeof P=="number"?P:jt(P)}},i.beforeId),ke}var lb=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:wE,addPoint:bE,addPolygon:xE,addPolyline:_E,colorDrivenByProperty:oy,colorPalettes:ry,computeRampedOutlineWidth:rb,dashArrayMaker:Sy,generateRandomLayerName:yh,generateRandomSourceName:gh,getRandomColor:qp,heatmapIntensityFromColorRamp:ab,lerpZoomNumberValues:ny,opacityDrivenByProperty:sy,paintColorOptionsToPaintSpec:Fa,radiusDrivenByProperty:ay,radiusDrivenByPropertyHeatmap:ob,rampedOptionsToLayerPaintSpec:jt,rampedPropertyValueWeight:nb,takeScreenshot:mE},Symbol.toStringTag,{value:"Module"}));jT();function TE(){return"3.8.0"}var CM=et.default.Map,MM=et.default.Marker,kM=et.default.Popup,RM=et.default.Style,LM=et.default.CanvasSource,DM=et.default.GeoJSONSource,zM=et.default.ImageSource,OM=et.default.RasterTileSource,FM=et.default.RasterDEMTileSource,NM=et.default.VectorTileSource,BM=et.default.VideoSource,UM=et.default.NavigationControl,jM=et.default.GeolocateControl,VM=et.default.AttributionControl,$M=et.default.LogoControl,GM=et.default.ScaleControl,qM=et.default.FullscreenControl,ZM=et.default.TerrainControl,WM=et.default.BoxZoomHandler,HM=et.default.ScrollZoomHandler,KM=et.default.CooperativeGesturesHandler,XM=et.default.KeyboardHandler,YM=et.default.TwoFingersTouchPitchHandler,JM=et.default.MapWheelEvent,QM=et.default.MapTouchEvent,ek=et.default.MapMouseEvent,tk=et.default.config,ik=et.default.getVersion,{setRTLTextPlugin:rk,getRTLTextPluginStatus:nk,LngLat:_h,LngLatBounds:ok,MercatorCoordinate:ak,Evented:sk,AJAXError:lk,prewarm:ck,clearPrewarmedResources:uk,Hash:hk,Point:dk,EdgeInsets:pk,DragRotateHandler:fk,DragPanHandler:mk,TwoFingersTouchZoomRotateHandler:gk,DoubleClickZoomHandler:yk,TwoFingersTouchZoomHandler:_k,TwoFingersTouchRotateHandler:vk,getWorkerCount:xk,setWorkerCount:bk,getMaxParallelImageRequests:wk,setMaxParallelImageRequests:Tk,getWorkerUrl:Sk,setWorkerUrl:Ik,addSourceType:Pk,importScriptInWorkers:Ek,addProtocol:Ak,removeProtocol:Ck}=et.default;function Eb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Ab=Eb,Cb=new Hd("auth","Firebase",Eb());var Jp=new Q0("@firebase/auth");function SE(s,...i){Jp.logLevel<=qm.WARN&&Jp.warn(`Auth (${ac}): ${s}`,...i)}function Wp(s,...i){Jp.logLevel<=qm.ERROR&&Jp.error(`Auth (${ac}): ${s}`,...i)}function Fn(s,...i){throw Ky(s,...i)}function ho(s,...i){return Ky(s,...i)}function Mb(s,i,l){let f={...Ab(),[i]:l};return new Hd("auth","Firebase",f).create(i,{appName:s.name})}function Va(s){return Mb(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ky(s,...i){if(typeof s!="string"){let l=i[0],f=[...i.slice(1)];return f[0]&&(f[0].appName=s.name),s._errorFactory.create(l,...f)}return Cb.create(s,...i)}function nt(s,i,...l){if(!s)throw Ky(i,...l)}function uo(s){let i="INTERNAL ASSERTION FAILED: "+s;throw Wp(i),new Error(i)}function Xo(s,i){s||uo(i)}function My(){return typeof self<"u"&&self.location?.href||""}function IE(){return cb()==="http:"||cb()==="https:"}function cb(){return typeof self<"u"&&self.location?.protocol||null}function PE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(IE()||H0()||"connection"in navigator)?navigator.onLine:!0}function EE(){if(typeof navigator>"u")return null;let s=navigator;return s.languages&&s.languages[0]||s.language||null}var qs=class{constructor(i,l){this.shortDelay=i,this.longDelay=l,Xo(l>i,"Short delay should be less than long delay!"),this.isMobile=Z0()||K0()}get(){return PE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Xy(s,i){Xo(s.emulator,"Emulator should always be set here");let{url:l}=s.emulator;return i?`${l}${i.startsWith("/")?i.slice(1):i}`:l}var Qp=class{static initialize(i,l,f){this.fetchImpl=i,l&&(this.headersImpl=l),f&&(this.responseImpl=f)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;uo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;uo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;uo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var AE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var CE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ME=new qs(3e4,6e4);function ji(s,i){return s.tenantId&&!i.tenantId?{...i,tenantId:s.tenantId}:i}async function dr(s,i,l,f,p={}){return kb(s,p,async()=>{let a={},b={};f&&(i==="GET"?b=f:a={body:JSON.stringify(f)});let P=rc({key:s.config.apiKey,...b}).slice(1),M=await s._getAdditionalHeaders();M["Content-Type"]="application/json",s.languageCode&&(M["X-Firebase-Locale"]=s.languageCode);let D={method:i,headers:M,...a};return W0()||(D.referrerPolicy="no-referrer"),s.emulatorConfig&&Zd(s.emulatorConfig.host)&&(D.credentials="include"),Qp.fetch()(await Rb(s,s.config.apiHost,l,P),D)})}async function kb(s,i,l){s._canInitEmulator=!1;let f={...AE,...i};try{let p=new ky(s),a=await Promise.race([l(),p.promise]);p.clearNetworkTimeout();let b=await a.json();if("needConfirmation"in b)throw xh(s,"account-exists-with-different-credential",b);if(a.ok&&!("errorMessage"in b))return b;{let P=a.ok?b.errorMessage:b.error.message,[M,D]=P.split(" : ");if(M==="FEDERATED_USER_ID_ALREADY_LINKED")throw xh(s,"credential-already-in-use",b);if(M==="EMAIL_EXISTS")throw xh(s,"email-already-in-use",b);if(M==="USER_DISABLED")throw xh(s,"user-disabled",b);let B=f[M]||M.toLowerCase().replace(/[_\s]+/g,"-");if(D)throw Mb(s,B,D);Fn(s,B)}}catch(p){if(p instanceof Wd)throw p;Fn(s,"network-request-failed",{message:String(p)})}}async function $a(s,i,l,f,p={}){let a=await dr(s,i,l,f,p);return"mfaPendingCredential"in a&&Fn(s,"multi-factor-auth-required",{_serverResponse:a}),a}async function Rb(s,i,l,f){let p=`${i}${l}?${f}`,a=s,b=a.config.emulator?Xy(s.config,p):`${s.config.apiScheme}://${p}`;return CE.includes(l)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(b).toString():b}function kE(s){switch(s){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var ky=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(i){this.auth=i,this.timer=null,this.promise=new Promise((l,f)=>{this.timer=setTimeout(()=>f(ho(this.auth,"network-request-failed")),ME.get())})}};function xh(s,i,l){let f={appName:s.name};l.email&&(f.email=l.email),l.phoneNumber&&(f.phoneNumber=l.phoneNumber);let p=ho(s,i,f);return p.customData._tokenResponse=l,p}function ub(s){return s!==void 0&&s.enterprise!==void 0}var ef=class{constructor(i){if(this.siteKey="",this.recaptchaEnforcementState=[],i.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=i.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=i.recaptchaEnforcementState}getProviderEnforcementState(i){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let l of this.recaptchaEnforcementState)if(l.provider&&l.provider===i)return kE(l.enforcementState);return null}isProviderEnabled(i){return this.getProviderEnforcementState(i)==="ENFORCE"||this.getProviderEnforcementState(i)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};async function Lb(s,i){return dr(s,"GET","/v2/recaptchaConfig",ji(s,i))}async function RE(s,i){return dr(s,"POST","/v1/accounts:delete",i)}async function tf(s,i){return dr(s,"POST","/v1/accounts:lookup",i)}function bh(s){if(s)try{let i=new Date(Number(s));if(!isNaN(i.getTime()))return i.toUTCString()}catch{}}async function Db(s,i=!1){let l=La(s),f=await l.getIdToken(i),p=Yy(f);nt(p&&p.exp&&p.auth_time&&p.iat,l.auth,"internal-error");let a=typeof p.firebase=="object"?p.firebase:void 0,b=a?.sign_in_provider;return{claims:p,token:f,authTime:bh(Iy(p.auth_time)),issuedAtTime:bh(Iy(p.iat)),expirationTime:bh(Iy(p.exp)),signInProvider:b||null,signInSecondFactor:a?.sign_in_second_factor||null}}function Iy(s){return Number(s)*1e3}function Yy(s){let[i,l,f]=s.split(".");if(i===void 0||l===void 0||f===void 0)return Wp("JWT malformed, contained fewer than 3 sections"),null;try{let p=V0(l);return p?JSON.parse(p):(Wp("Failed to decode base64 JWT payload"),null)}catch(p){return Wp("Caught error parsing JWT payload as JSON",p?.toString()),null}}function hb(s){let i=Yy(s);return nt(i,"internal-error"),nt(typeof i.exp<"u","internal-error"),nt(typeof i.iat<"u","internal-error"),Number(i.exp)-Number(i.iat)}async function Ih(s,i,l=!1){if(l)return i;try{return await i}catch(f){throw f instanceof Wd&&LE(f)&&s.auth.currentUser===s&&await s.auth.signOut(),f}}function LE({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}var Ry=class{constructor(i){this.user=i,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(i){if(i){let l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;let f=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,f)}}schedule(i=!1){if(!this.isRunning)return;let l=this.getInterval(i);this.timerId=setTimeout(async()=>{await this.iteration()},l)}async iteration(){try{await this.user.getIdToken(!0)}catch(i){i?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};var Ph=class{constructor(i,l){this.createdAt=i,this.lastLoginAt=l,this._initializeTime()}_initializeTime(){this.lastSignInTime=bh(this.lastLoginAt),this.creationTime=bh(this.createdAt)}_copy(i){this.createdAt=i.createdAt,this.lastLoginAt=i.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function rf(s){let i=s.auth,l=await s.getIdToken(),f=await Ih(s,tf(i,{idToken:l}));nt(f?.users.length,i,"internal-error");let p=f.users[0];s._notifyReloadListener(p);let a=p.providerUserInfo?.length?Ob(p.providerUserInfo):[],b=DE(s.providerData,a),P=s.isAnonymous,M=!(s.email&&p.passwordHash)&&!b?.length,D=P?M:!1,B={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:b,metadata:new Ph(p.createdAt,p.lastLoginAt),isAnonymous:D};Object.assign(s,B)}async function zb(s){let i=La(s);await rf(i),await i.auth._persistUserIfCurrent(i),i.auth._notifyListenersIfCurrent(i)}function DE(s,i){return[...s.filter(f=>!i.some(p=>p.providerId===f.providerId)),...i]}function Ob(s){return s.map(({providerId:i,...l})=>({providerId:i,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}))}async function zE(s,i){let l=await kb(s,{},async()=>{let f=rc({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:p,apiKey:a}=s.config,b=await Rb(s,p,"/v1/token",`key=${a}`),P=await s._getAdditionalHeaders();P["Content-Type"]="application/x-www-form-urlencoded";let M={method:"POST",headers:P,body:f};return s.emulatorConfig&&Zd(s.emulatorConfig.host)&&(M.credentials="include"),Qp.fetch()(b,M)});return{accessToken:l.access_token,expiresIn:l.expires_in,refreshToken:l.refresh_token}}async function OE(s,i){return dr(s,"POST","/v2/accounts:revokeToken",ji(s,i))}var wh=class s{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(i){nt(i.idToken,"internal-error"),nt(typeof i.idToken<"u","internal-error"),nt(typeof i.refreshToken<"u","internal-error");let l="expiresIn"in i&&typeof i.expiresIn<"u"?Number(i.expiresIn):hb(i.idToken);this.updateTokensAndExpiration(i.idToken,i.refreshToken,l)}updateFromIdToken(i){nt(i.length!==0,"internal-error");let l=hb(i);this.updateTokensAndExpiration(i,null,l)}async getToken(i,l=!1){return!l&&this.accessToken&&!this.isExpired?this.accessToken:(nt(this.refreshToken,i,"user-token-expired"),this.refreshToken?(await this.refresh(i,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(i,l){let{accessToken:f,refreshToken:p,expiresIn:a}=await zE(i,l);this.updateTokensAndExpiration(f,p,Number(a))}updateTokensAndExpiration(i,l,f){this.refreshToken=l||null,this.accessToken=i||null,this.expirationTime=Date.now()+f*1e3}static fromJSON(i,l){let{refreshToken:f,accessToken:p,expirationTime:a}=l,b=new s;return f&&(nt(typeof f=="string","internal-error",{appName:i}),b.refreshToken=f),p&&(nt(typeof p=="string","internal-error",{appName:i}),b.accessToken=p),a&&(nt(typeof a=="number","internal-error",{appName:i}),b.expirationTime=a),b}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(i){this.accessToken=i.accessToken,this.refreshToken=i.refreshToken,this.expirationTime=i.expirationTime}_clone(){return Object.assign(new s,this.toJSON())}_performRefresh(){return uo("not implemented")}};function Ua(s,i){nt(typeof s=="string"||typeof s>"u","internal-error",{appName:i})}var ja=class s{constructor({uid:i,auth:l,stsTokenManager:f,...p}){this.providerId="firebase",this.proactiveRefresh=new Ry(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=l,this.stsTokenManager=f,this.accessToken=f.accessToken,this.displayName=p.displayName||null,this.email=p.email||null,this.emailVerified=p.emailVerified||!1,this.phoneNumber=p.phoneNumber||null,this.photoURL=p.photoURL||null,this.isAnonymous=p.isAnonymous||!1,this.tenantId=p.tenantId||null,this.providerData=p.providerData?[...p.providerData]:[],this.metadata=new Ph(p.createdAt||void 0,p.lastLoginAt||void 0)}async getIdToken(i){let l=await Ih(this,this.stsTokenManager.getToken(this.auth,i));return nt(l,this.auth,"internal-error"),this.accessToken!==l&&(this.accessToken=l,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),l}getIdTokenResult(i){return Db(this,i)}reload(){return zb(this)}_assign(i){this!==i&&(nt(this.uid===i.uid,this.auth,"internal-error"),this.displayName=i.displayName,this.photoURL=i.photoURL,this.email=i.email,this.emailVerified=i.emailVerified,this.phoneNumber=i.phoneNumber,this.isAnonymous=i.isAnonymous,this.tenantId=i.tenantId,this.providerData=i.providerData.map(l=>({...l})),this.metadata._copy(i.metadata),this.stsTokenManager._assign(i.stsTokenManager))}_clone(i){let l=new s({...this,auth:i,stsTokenManager:this.stsTokenManager._clone()});return l.metadata._copy(this.metadata),l}_onReload(i){nt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=i,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(i){this.reloadListener?this.reloadListener(i):this.reloadUserInfo=i}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(i,l=!1){let f=!1;i.idToken&&i.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(i),f=!0),l&&await rf(this),await this.auth._persistUserIfCurrent(this),f&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rn(this.auth.app))return Promise.reject(Va(this.auth));let i=await this.getIdToken();return await Ih(this,RE(this.auth,{idToken:i})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(i=>({...i})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(i,l){let f=l.displayName??void 0,p=l.email??void 0,a=l.phoneNumber??void 0,b=l.photoURL??void 0,P=l.tenantId??void 0,M=l._redirectEventId??void 0,D=l.createdAt??void 0,B=l.lastLoginAt??void 0,{uid:U,emailVerified:oe,isAnonymous:le,providerData:me,stsTokenManager:xe}=l;nt(U&&xe,i,"internal-error");let Ce=wh.fromJSON(this.name,xe);nt(typeof U=="string",i,"internal-error"),Ua(f,i.name),Ua(p,i.name),nt(typeof oe=="boolean",i,"internal-error"),nt(typeof le=="boolean",i,"internal-error"),Ua(a,i.name),Ua(b,i.name),Ua(P,i.name),Ua(M,i.name),Ua(D,i.name),Ua(B,i.name);let ke=new s({uid:U,auth:i,email:p,emailVerified:oe,displayName:f,isAnonymous:le,photoURL:b,phoneNumber:a,tenantId:P,stsTokenManager:Ce,createdAt:D,lastLoginAt:B});return me&&Array.isArray(me)&&(ke.providerData=me.map(Re=>({...Re}))),M&&(ke._redirectEventId=M),ke}static async _fromIdTokenResponse(i,l,f=!1){let p=new wh;p.updateFromServerResponse(l);let a=new s({uid:l.localId,auth:i,stsTokenManager:p,isAnonymous:f});return await rf(a),a}static async _fromGetAccountInfoResponse(i,l,f){let p=l.users[0];nt(p.localId!==void 0,"internal-error");let a=p.providerUserInfo!==void 0?Ob(p.providerUserInfo):[],b=!(p.email&&p.passwordHash)&&!a?.length,P=new wh;P.updateFromIdToken(f);let M=new s({uid:p.localId,auth:i,stsTokenManager:P,isAnonymous:b}),D={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:a,metadata:new Ph(p.createdAt,p.lastLoginAt),isAnonymous:!(p.email&&p.passwordHash)&&!a?.length};return Object.assign(M,D),M}};var db=new Map;function Ko(s){Xo(s instanceof Function,"Expected a class definition");let i=db.get(s);return i?(Xo(i instanceof s,"Instance stored in cache mismatched with class"),i):(i=new s,db.set(s,i),i)}var nf=class{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(i,l){this.storage[i]=l}async _get(i){let l=this.storage[i];return l===void 0?null:l}async _remove(i){delete this.storage[i]}_addListener(i,l){}_removeListener(i,l){}};nf.type="NONE";var Ly=nf;function Hp(s,i,l){return`firebase:${s}:${i}:${l}`}var of=class s{constructor(i,l,f){this.persistence=i,this.auth=l,this.userKey=f;let{config:p,name:a}=this.auth;this.fullUserKey=Hp(this.userKey,p.apiKey,a),this.fullPersistenceKey=Hp("persistence",p.apiKey,a),this.boundEventHandler=l._onStorageEvent.bind(l),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(i){return this.persistence._set(this.fullUserKey,i.toJSON())}async getCurrentUser(){let i=await this.persistence._get(this.fullUserKey);if(!i)return null;if(typeof i=="string"){let l=await tf(this.auth,{idToken:i}).catch(()=>{});return l?ja._fromGetAccountInfoResponse(this.auth,l,i):null}return ja._fromJSON(this.auth,i)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(i){if(this.persistence===i)return;let l=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=i,l)return this.setCurrentUser(l)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(i,l,f="authUser"){if(!l.length)return new s(Ko(Ly),i,f);let p=(await Promise.all(l.map(async D=>{if(await D._isAvailable())return D}))).filter(D=>D),a=p[0]||Ko(Ly),b=Hp(f,i.config.apiKey,i.name),P=null;for(let D of l)try{let B=await D._get(b);if(B){let U;if(typeof B=="string"){let oe=await tf(i,{idToken:B}).catch(()=>{});if(!oe)break;U=await ja._fromGetAccountInfoResponse(i,oe,B)}else U=ja._fromJSON(i,B);D!==a&&(P=U),a=D;break}}catch{}let M=p.filter(D=>D._shouldAllowMigration);return!a._shouldAllowMigration||!M.length?new s(a,i,f):(a=M[0],P&&await a._set(b,P.toJSON()),await Promise.all(l.map(async D=>{if(D!==a)try{await D._remove(b)}catch{}})),new s(a,i,f))}};function pb(s){let i=s.toLowerCase();if(i.includes("opera/")||i.includes("opr/")||i.includes("opios/"))return"Opera";if(Ub(i))return"IEMobile";if(i.includes("msie")||i.includes("trident/"))return"IE";if(i.includes("edge/"))return"Edge";if(Fb(i))return"Firefox";if(i.includes("silk/"))return"Silk";if(Vb(i))return"Blackberry";if($b(i))return"Webos";if(Nb(i))return"Safari";if((i.includes("chrome/")||Bb(i))&&!i.includes("edge/"))return"Chrome";if(jb(i))return"Android";{let l=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,f=s.match(l);if(f?.length===2)return f[1]}return"Other"}function Fb(s=Ar()){return/firefox\//i.test(s)}function Nb(s=Ar()){let i=s.toLowerCase();return i.includes("safari/")&&!i.includes("chrome/")&&!i.includes("crios/")&&!i.includes("android")}function Bb(s=Ar()){return/crios\//i.test(s)}function Ub(s=Ar()){return/iemobile/i.test(s)}function jb(s=Ar()){return/android/i.test(s)}function Vb(s=Ar()){return/blackberry/i.test(s)}function $b(s=Ar()){return/webos/i.test(s)}function Jy(s=Ar()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function FE(s=Ar()){return Jy(s)&&!!window.navigator?.standalone}function NE(){return X0()&&document.documentMode===10}function Gb(s=Ar()){return Jy(s)||jb(s)||$b(s)||Vb(s)||/windows phone/i.test(s)||Ub(s)}function qb(s,i=[]){let l;switch(s){case"Browser":l=pb(Ar());break;case"Worker":l=`${pb(Ar())}-${s}`;break;default:l=s}let f=i.length?i.join(","):"FirebaseCore-web";return`${l}/JsCore/${ac}/${f}`}var Dy=class{constructor(i){this.auth=i,this.queue=[]}pushCallback(i,l){let f=a=>new Promise((b,P)=>{try{let M=i(a);b(M)}catch(M){P(M)}});f.onAbort=l,this.queue.push(f);let p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}async runMiddleware(i){if(this.auth.currentUser===i)return;let l=[];try{for(let f of this.queue)await f(i),f.onAbort&&l.push(f.onAbort)}catch(f){l.reverse();for(let p of l)try{p()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:f?.message})}}};async function BE(s,i={}){return dr(s,"GET","/v2/passwordPolicy",ji(s,i))}var UE=6,zy=class{constructor(i){let l=i.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=l.minPasswordLength??UE,l.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=l.maxPasswordLength),l.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=l.containsLowercaseCharacter),l.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=l.containsUppercaseCharacter),l.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=l.containsNumericCharacter),l.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=l.containsNonAlphanumericCharacter),this.enforcementState=i.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=i.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=i.forceUpgradeOnSignin??!1,this.schemaVersion=i.schemaVersion}validatePassword(i){let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(i,l),this.validatePasswordCharacterOptions(i,l),l.isValid&&(l.isValid=l.meetsMinPasswordLength??!0),l.isValid&&(l.isValid=l.meetsMaxPasswordLength??!0),l.isValid&&(l.isValid=l.containsLowercaseLetter??!0),l.isValid&&(l.isValid=l.containsUppercaseLetter??!0),l.isValid&&(l.isValid=l.containsNumericCharacter??!0),l.isValid&&(l.isValid=l.containsNonAlphanumericCharacter??!0),l}validatePasswordLengthOptions(i,l){let f=this.customStrengthOptions.minPasswordLength,p=this.customStrengthOptions.maxPasswordLength;f&&(l.meetsMinPasswordLength=i.length>=f),p&&(l.meetsMaxPasswordLength=i.length<=p)}validatePasswordCharacterOptions(i,l){this.updatePasswordCharacterOptionsStatuses(l,!1,!1,!1,!1);let f;for(let p=0;p<i.length;p++)f=i.charAt(p),this.updatePasswordCharacterOptionsStatuses(l,f>="a"&&f<="z",f>="A"&&f<="Z",f>="0"&&f<="9",this.allowedNonAlphanumericCharacters.includes(f))}updatePasswordCharacterOptionsStatuses(i,l,f,p,a){this.customStrengthOptions.containsLowercaseLetter&&(i.containsLowercaseLetter||(i.containsLowercaseLetter=l)),this.customStrengthOptions.containsUppercaseLetter&&(i.containsUppercaseLetter||(i.containsUppercaseLetter=f)),this.customStrengthOptions.containsNumericCharacter&&(i.containsNumericCharacter||(i.containsNumericCharacter=p)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(i.containsNonAlphanumericCharacter||(i.containsNonAlphanumericCharacter=a))}};var Oy=class{constructor(i,l,f,p){this.app=i,this.heartbeatServiceProvider=l,this.appCheckServiceProvider=f,this.config=p,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new af(this),this.idTokenSubscription=new af(this),this.beforeStateQueue=new Dy(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cb,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=i.name,this.clientVersion=p.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(i,l){return l&&(this._popupRedirectResolver=Ko(l)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await of.create(this,i),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(l),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let i=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!i)){if(this.currentUser&&i&&this.currentUser.uid===i.uid){this._currentUser._assign(i),await this.currentUser.getIdToken();return}await this._updateCurrentUser(i,!0)}}async initializeCurrentUserFromIdToken(i){try{let l=await tf(this,{idToken:i}),f=await ja._fromGetAccountInfoResponse(this,l,i);await this.directlySetCurrentUser(f)}catch(l){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",l),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(i){if(Rn(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(b,b))}):this.directlySetCurrentUser(null)}let l=await this.assertedPersistence.getCurrentUser(),f=l,p=!1;if(i&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let a=this.redirectUser?._redirectEventId,b=f?._redirectEventId,P=await this.tryRedirectSignIn(i);(!a||a===b)&&P?.user&&(f=P.user,p=!0)}if(!f)return this.directlySetCurrentUser(null);if(!f._redirectEventId){if(p)try{await this.beforeStateQueue.runMiddleware(f)}catch(a){f=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return f?this.reloadAndSetCurrentUserOrClear(f):this.directlySetCurrentUser(null)}return nt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===f._redirectEventId?this.directlySetCurrentUser(f):this.reloadAndSetCurrentUserOrClear(f)}async tryRedirectSignIn(i){let l=null;try{l=await this._popupRedirectResolver._completeRedirectFn(this,i,!0)}catch{await this._setRedirectUser(null)}return l}async reloadAndSetCurrentUserOrClear(i){try{await rf(i)}catch(l){if(l?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(i)}useDeviceLanguage(){this.languageCode=EE()}async _delete(){this._deleted=!0}async updateCurrentUser(i){if(Rn(this.app))return Promise.reject(Va(this));let l=i?La(i):null;return l&&nt(l.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(l&&l._clone(this))}async _updateCurrentUser(i,l=!1){if(!this._deleted)return i&&nt(this.tenantId===i.tenantId,this,"tenant-id-mismatch"),l||await this.beforeStateQueue.runMiddleware(i),this.queue(async()=>{await this.directlySetCurrentUser(i),this.notifyAuthListeners()})}async signOut(){return Rn(this.app)?Promise.reject(Va(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(i){return Rn(this.app)?Promise.reject(Va(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ko(i))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(i){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let l=this._getPasswordPolicyInternal();return l.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):l.validatePassword(i)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let i=await BE(this),l=new zy(i);this.tenantId===null?this._projectPasswordPolicy=l:this._tenantPasswordPolicies[this.tenantId]=l}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(i){this._errorFactory=new Hd("auth","Firebase",i())}onAuthStateChanged(i,l,f){return this.registerStateListener(this.authStateSubscription,i,l,f)}beforeAuthStateChanged(i,l){return this.beforeStateQueue.pushCallback(i,l)}onIdTokenChanged(i,l,f){return this.registerStateListener(this.idTokenSubscription,i,l,f)}authStateReady(){return new Promise((i,l)=>{if(this.currentUser)i();else{let f=this.onAuthStateChanged(()=>{f(),i()},l)}})}async revokeAccessToken(i){if(this.currentUser){let l=await this.currentUser.getIdToken(),f={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:i,idToken:l};this.tenantId!=null&&(f.tenantId=this.tenantId),await OE(this,f)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(i,l){let f=await this.getOrInitRedirectPersistenceManager(l);return i===null?f.removeCurrentUser():f.setCurrentUser(i)}async getOrInitRedirectPersistenceManager(i){if(!this.redirectPersistenceManager){let l=i&&Ko(i)||this._popupRedirectResolver;nt(l,this,"argument-error"),this.redirectPersistenceManager=await of.create(this,[Ko(l._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(i){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===i?this._currentUser:this.redirectUser?._redirectEventId===i?this.redirectUser:null}async _persistUserIfCurrent(i){if(i===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(i))}_notifyListenersIfCurrent(i){i===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=this.currentUser?.uid??null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(i,l,f,p){if(this._deleted)return()=>{};let a=typeof l=="function"?l:l.next.bind(l),b=!1,P=this._isInitialized?Promise.resolve():this._initializationPromise;if(nt(P,this,"internal-error"),P.then(()=>{b||a(this.currentUser)}),typeof l=="function"){let M=i.addObserver(l,f,p);return()=>{b=!0,M()}}else{let M=i.addObserver(l);return()=>{b=!0,M()}}}async directlySetCurrentUser(i){this.currentUser&&this.currentUser!==i&&this._currentUser._stopProactiveRefresh(),i&&this.isProactiveRefreshEnabled&&i._startProactiveRefresh(),this.currentUser=i,i?await this.assertedPersistence.setCurrentUser(i):await this.assertedPersistence.removeCurrentUser()}queue(i){return this.operations=this.operations.then(i,i),this.operations}get assertedPersistence(){return nt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(i){!i||this.frameworks.includes(i)||(this.frameworks.push(i),this.frameworks.sort(),this.clientVersion=qb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);let l=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();l&&(i["X-Firebase-Client"]=l);let f=await this._getAppCheckToken();return f&&(i["X-Firebase-AppCheck"]=f),i}async _getAppCheckToken(){if(Rn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let i=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return i?.error&&SE(`Error while retrieving App Check token: ${i.error}`),i?.token}};function Ys(s){return La(s)}var af=class{constructor(i){this.auth=i,this.observer=null,this.addObserver=J0(l=>this.observer=l)}get next(){return nt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Sf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function jE(s){Sf=s}function Zb(s){return Sf.loadJS(s)}function VE(){return Sf.recaptchaEnterpriseScript}function $E(){return Sf.gapiScript}function Wb(s){return`__${s}${Math.floor(Math.random()*1e6)}`}var Fy=class{constructor(){this.enterprise=new Ny}ready(i){i()}execute(i,l){return Promise.resolve("token")}render(i,l){return""}},Ny=class{ready(i){i()}execute(i,l){return Promise.resolve("token")}render(i,l){return""}};var GE="recaptcha-enterprise",Th="NO_RECAPTCHA",sf=class{constructor(i){this.type=GE,this.auth=Ys(i)}async verify(i="verify",l=!1){async function f(a){if(!l){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(b,P)=>{Lb(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(M=>{if(M.recaptchaKey===void 0)P(new Error("recaptcha Enterprise site key undefined"));else{let D=new ef(M);return a.tenantId==null?a._agentRecaptchaConfig=D:a._tenantRecaptchaConfigs[a.tenantId]=D,b(D.siteKey)}}).catch(M=>{P(M)})})}function p(a,b,P){let M=window.grecaptcha;ub(M)?M.enterprise.ready(()=>{M.enterprise.execute(a,{action:i}).then(D=>{b(D)}).catch(()=>{b(Th)})}):P(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Fy().execute("siteKey",{action:"verify"}):new Promise((a,b)=>{f(this.auth).then(P=>{if(!l&&ub(window.grecaptcha))p(P,a,b);else{if(typeof window>"u"){b(new Error("RecaptchaVerifier is only supported in browser"));return}let M=VE();M.length!==0&&(M+=P),Zb(M).then(()=>{p(P,a,b)}).catch(D=>{b(D)})}}).catch(P=>{b(P)})})}};async function vh(s,i,l,f=!1,p=!1){let a=new sf(s),b;if(p)b=Th;else try{b=await a.verify(l)}catch{b=await a.verify(l,!0)}let P={...i};if(l==="mfaSmsEnrollment"||l==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in P){let M=P.phoneEnrollmentInfo.phoneNumber,D=P.phoneEnrollmentInfo.recaptchaToken;Object.assign(P,{phoneEnrollmentInfo:{phoneNumber:M,recaptchaToken:D,captchaResponse:b,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in P){let M=P.phoneSignInInfo.recaptchaToken;Object.assign(P,{phoneSignInInfo:{recaptchaToken:M,captchaResponse:b,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return P}return f?Object.assign(P,{captchaResp:b}):Object.assign(P,{captchaResponse:b}),Object.assign(P,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(P,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),P}async function Sh(s,i,l,f,p){if(p==="EMAIL_PASSWORD_PROVIDER")if(s._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let a=await vh(s,i,l,l==="getOobCode");return f(s,a)}else return f(s,i).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${l} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let b=await vh(s,i,l,l==="getOobCode");return f(s,b)}else return Promise.reject(a)});else if(p==="PHONE_PROVIDER")if(s._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let a=await vh(s,i,l);return f(s,a).catch(async b=>{if(s._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(b.code==="auth/missing-recaptcha-token"||b.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${l} flow.`);let P=await vh(s,i,l,!1,!0);return f(s,P)}return Promise.reject(b)})}else{let a=await vh(s,i,l,!1,!0);return f(s,a)}else return Promise.reject(p+" provider is not supported.")}async function qE(s){let i=Ys(s),l=await Lb(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),f=new ef(l);i.tenantId==null?i._agentRecaptchaConfig=f:i._tenantRecaptchaConfigs[i.tenantId]=f,f.isAnyProviderEnabled()&&new sf(i).verify()}function Hb(s,i){let l=Wm(s,"auth");if(l.isInitialized()){let p=l.getImmediate(),a=l.getOptions();if(Kd(a,i??{}))return p;Fn(p,"already-initialized")}return l.initialize({options:i})}function ZE(s,i){let l=i?.persistence||[],f=(Array.isArray(l)?l:[l]).map(Ko);i?.errorMap&&s._updateErrorMap(i.errorMap),s._initializeWithPersistence(f,i?.popupRedirectResolver)}function Kb(s,i,l){let f=Ys(s);nt(/^https?:\/\//.test(i),f,"invalid-emulator-scheme");let p=!!l?.disableWarnings,a=Xb(i),{host:b,port:P}=WE(i),M=P===null?"":`:${P}`,D={url:`${a}//${b}${M}/`},B=Object.freeze({host:b,port:P,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:p})});if(!f._canInitEmulator){nt(f.config.emulator&&f.emulatorConfig,f,"emulator-config-failed"),nt(Kd(D,f.config.emulator)&&Kd(B,f.emulatorConfig),f,"emulator-config-failed");return}f.config.emulator=D,f.emulatorConfig=B,f.settings.appVerificationDisabledForTesting=!0,Zd(b)?(G0(`${a}//${b}${M}`),q0("Auth",!0)):p||HE()}function Xb(s){let i=s.indexOf(":");return i<0?"":s.substr(0,i+1)}function WE(s){let i=Xb(s),l=/(\/\/)?([^?#/]+)/.exec(s.substr(i.length));if(!l)return{host:"",port:null};let f=l[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(f);if(p){let a=p[1];return{host:a,port:fb(f.substr(a.length+1))}}else{let[a,b]=f.split(":");return{host:a,port:fb(b)}}}function fb(s){if(!s)return null;let i=Number(s);return isNaN(i)?null:i}function HE(){function s(){let i=document.createElement("p"),l=i.style;i.innerText="Running in emulator mode. Do not use with production credentials.",l.position="fixed",l.width="100%",l.backgroundColor="#ffffff",l.border=".1em solid #000000",l.color="#b50000",l.bottom="0px",l.left="0px",l.margin="0px",l.zIndex="10000",l.textAlign="center",i.classList.add("firebase-emulator-warning"),document.body.appendChild(i)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}var Zs=class{constructor(i,l){this.providerId=i,this.signInMethod=l}toJSON(){return uo("not implemented")}_getIdTokenResponse(i){return uo("not implemented")}_linkToIdToken(i,l){return uo("not implemented")}_getReauthenticationResolver(i){return uo("not implemented")}};async function KE(s,i){return dr(s,"POST","/v1/accounts:signUp",i)}async function XE(s,i){return $a(s,"POST","/v1/accounts:signInWithPassword",ji(s,i))}async function YE(s,i){return $a(s,"POST","/v1/accounts:signInWithEmailLink",ji(s,i))}async function JE(s,i){return $a(s,"POST","/v1/accounts:signInWithEmailLink",ji(s,i))}var Eh=class s extends Zs{constructor(i,l,f,p=null){super("password",f),this._email=i,this._password=l,this._tenantId=p}static _fromEmailAndPassword(i,l){return new s(i,l,"password")}static _fromEmailAndCode(i,l,f=null){return new s(i,l,"emailLink",f)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(i){let l=typeof i=="string"?JSON.parse(i):i;if(l?.email&&l?.password){if(l.signInMethod==="password")return this._fromEmailAndPassword(l.email,l.password);if(l.signInMethod==="emailLink")return this._fromEmailAndCode(l.email,l.password,l.tenantId)}return null}async _getIdTokenResponse(i){switch(this.signInMethod){case"password":let l={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sh(i,l,"signInWithPassword",XE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return YE(i,{email:this._email,oobCode:this._password});default:Fn(i,"internal-error")}}async _linkToIdToken(i,l){switch(this.signInMethod){case"password":let f={idToken:l,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Sh(i,f,"signUpPassword",KE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return JE(i,{idToken:l,email:this._email,oobCode:this._password});default:Fn(i,"internal-error")}}_getReauthenticationResolver(i){return this._getIdTokenResponse(i)}};async function bc(s,i){return $a(s,"POST","/v1/accounts:signInWithIdp",ji(s,i))}var QE="http://localhost",Ws=class s extends Zs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(i){let l=new s(i.providerId,i.signInMethod);return i.idToken||i.accessToken?(i.idToken&&(l.idToken=i.idToken),i.accessToken&&(l.accessToken=i.accessToken),i.nonce&&!i.pendingToken&&(l.nonce=i.nonce),i.pendingToken&&(l.pendingToken=i.pendingToken)):i.oauthToken&&i.oauthTokenSecret?(l.accessToken=i.oauthToken,l.secret=i.oauthTokenSecret):Fn("argument-error"),l}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(i){let l=typeof i=="string"?JSON.parse(i):i,{providerId:f,signInMethod:p,...a}=l;if(!f||!p)return null;let b=new s(f,p);return b.idToken=a.idToken||void 0,b.accessToken=a.accessToken||void 0,b.secret=a.secret,b.nonce=a.nonce,b.pendingToken=a.pendingToken||null,b}_getIdTokenResponse(i){let l=this.buildRequest();return bc(i,l)}_linkToIdToken(i,l){let f=this.buildRequest();return f.idToken=l,bc(i,f)}_getReauthenticationResolver(i){let l=this.buildRequest();return l.autoCreate=!1,bc(i,l)}buildRequest(){let i={requestUri:QE,returnSecureToken:!0};if(this.pendingToken)i.pendingToken=this.pendingToken;else{let l={};this.idToken&&(l.id_token=this.idToken),this.accessToken&&(l.access_token=this.accessToken),this.secret&&(l.oauth_token_secret=this.secret),l.providerId=this.providerId,this.nonce&&!this.pendingToken&&(l.nonce=this.nonce),i.postBody=rc(l)}return i}};async function mb(s,i){return dr(s,"POST","/v1/accounts:sendVerificationCode",ji(s,i))}async function eA(s,i){return $a(s,"POST","/v1/accounts:signInWithPhoneNumber",ji(s,i))}async function tA(s,i){let l=await $a(s,"POST","/v1/accounts:signInWithPhoneNumber",ji(s,i));if(l.temporaryProof)throw xh(s,"account-exists-with-different-credential",l);return l}var iA={USER_NOT_FOUND:"user-not-found"};async function rA(s,i){let l={...i,operation:"REAUTH"};return $a(s,"POST","/v1/accounts:signInWithPhoneNumber",ji(s,l),iA)}var Ah=class s extends Zs{constructor(i){super("phone","phone"),this.params=i}static _fromVerification(i,l){return new s({verificationId:i,verificationCode:l})}static _fromTokenResponse(i,l){return new s({phoneNumber:i,temporaryProof:l})}_getIdTokenResponse(i){return eA(i,this._makeVerificationRequest())}_linkToIdToken(i,l){return tA(i,{idToken:l,...this._makeVerificationRequest()})}_getReauthenticationResolver(i){return rA(i,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:i,phoneNumber:l,verificationId:f,verificationCode:p}=this.params;return i&&l?{temporaryProof:i,phoneNumber:l}:{sessionInfo:f,code:p}}toJSON(){let i={providerId:this.providerId};return this.params.phoneNumber&&(i.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(i.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(i.verificationCode=this.params.verificationCode),this.params.verificationId&&(i.verificationId=this.params.verificationId),i}static fromJSON(i){typeof i=="string"&&(i=JSON.parse(i));let{verificationId:l,verificationCode:f,phoneNumber:p,temporaryProof:a}=i;return!f&&!l&&!p&&!a?null:new s({verificationId:l,verificationCode:f,phoneNumber:p,temporaryProof:a})}};function nA(s){switch(s){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function oA(s){let i=nc(oc(s)).link,l=i?nc(oc(i)).deep_link_id:null,f=nc(oc(s)).deep_link_id;return(f?nc(oc(f)).link:null)||f||l||i||s}var lf=class s{constructor(i){let l=nc(oc(i)),f=l.apiKey??null,p=l.oobCode??null,a=nA(l.mode??null);nt(f&&p&&a,"argument-error"),this.apiKey=f,this.operation=a,this.code=p,this.continueUrl=l.continueUrl??null,this.languageCode=l.lang??null,this.tenantId=l.tenantId??null}static parseLink(i){let l=oA(i);try{return new s(l)}catch{return null}}};var wc=class s{constructor(){this.providerId=s.PROVIDER_ID}static credential(i,l){return Eh._fromEmailAndPassword(i,l)}static credentialWithLink(i,l){let f=lf.parseLink(l);return nt(f,"argument-error"),Eh._fromEmailAndCode(i,f.code,f.tenantId)}};wc.PROVIDER_ID="password";wc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";wc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var cf=class{constructor(i){this.providerId=i,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(i){this.defaultLanguageCode=i}setCustomParameters(i){return this.customParameters=i,this}getCustomParameters(){return this.customParameters}};var Hs=class extends cf{constructor(){super(...arguments),this.scopes=[]}addScope(i){return this.scopes.includes(i)||this.scopes.push(i),this}getScopes(){return[...this.scopes]}};var Ch=class s extends Hs{constructor(){super("facebook.com")}static credential(i){return Ws._fromParams({providerId:s.PROVIDER_ID,signInMethod:s.FACEBOOK_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return s.credentialFromTaggedObject(i)}static credentialFromError(i){return s.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return s.credential(i.oauthAccessToken)}catch{return null}}};Ch.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ch.PROVIDER_ID="facebook.com";var Mh=class s extends Hs{constructor(){super("google.com"),this.addScope("profile")}static credential(i,l){return Ws._fromParams({providerId:s.PROVIDER_ID,signInMethod:s.GOOGLE_SIGN_IN_METHOD,idToken:i,accessToken:l})}static credentialFromResult(i){return s.credentialFromTaggedObject(i)}static credentialFromError(i){return s.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;let{oauthIdToken:l,oauthAccessToken:f}=i;if(!l&&!f)return null;try{return s.credential(l,f)}catch{return null}}};Mh.GOOGLE_SIGN_IN_METHOD="google.com";Mh.PROVIDER_ID="google.com";var kh=class s extends Hs{constructor(){super("github.com")}static credential(i){return Ws._fromParams({providerId:s.PROVIDER_ID,signInMethod:s.GITHUB_SIGN_IN_METHOD,accessToken:i})}static credentialFromResult(i){return s.credentialFromTaggedObject(i)}static credentialFromError(i){return s.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i||!("oauthAccessToken"in i)||!i.oauthAccessToken)return null;try{return s.credential(i.oauthAccessToken)}catch{return null}}};kh.GITHUB_SIGN_IN_METHOD="github.com";kh.PROVIDER_ID="github.com";var Rh=class s extends Hs{constructor(){super("twitter.com")}static credential(i,l){return Ws._fromParams({providerId:s.PROVIDER_ID,signInMethod:s.TWITTER_SIGN_IN_METHOD,oauthToken:i,oauthTokenSecret:l})}static credentialFromResult(i){return s.credentialFromTaggedObject(i)}static credentialFromError(i){return s.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;let{oauthAccessToken:l,oauthTokenSecret:f}=i;if(!l||!f)return null;try{return s.credential(l,f)}catch{return null}}};Rh.TWITTER_SIGN_IN_METHOD="twitter.com";Rh.PROVIDER_ID="twitter.com";async function aA(s,i){return $a(s,"POST","/v1/accounts:signUp",ji(s,i))}var Ks=class s{constructor(i){this.user=i.user,this.providerId=i.providerId,this._tokenResponse=i._tokenResponse,this.operationType=i.operationType}static async _fromIdTokenResponse(i,l,f,p=!1){let a=await ja._fromIdTokenResponse(i,f,p),b=gb(f);return new s({user:a,providerId:b,_tokenResponse:f,operationType:l})}static async _forOperation(i,l,f){await i._updateTokensIfNecessary(f,!0);let p=gb(f);return new s({user:i,providerId:p,_tokenResponse:f,operationType:l})}};function gb(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}async function Qy(s){if(Rn(s.app))return Promise.reject(Va(s));let i=Ys(s);if(await i._initializationPromise,i.currentUser?.isAnonymous)return new Ks({user:i.currentUser,providerId:null,operationType:"signIn"});let l=await aA(i,{returnSecureToken:!0}),f=await Ks._fromIdTokenResponse(i,"signIn",l,!0);return await i._updateCurrentUser(f.user),f}var By=class s extends Wd{constructor(i,l,f,p){super(l.code,l.message),this.operationType=f,this.user=p,Object.setPrototypeOf(this,s.prototype),this.customData={appName:i.name,tenantId:i.tenantId??void 0,_serverResponse:l.customData._serverResponse,operationType:f}}static _fromErrorAndOperation(i,l,f,p){return new s(i,l,f,p)}};function Yb(s,i,l,f){return(i==="reauthenticate"?l._getReauthenticationResolver(s):l._getIdTokenResponse(s)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?By._fromErrorAndOperation(s,a,i,f):a})}async function sA(s,i,l=!1){let f=await Ih(s,i._linkToIdToken(s.auth,await s.getIdToken()),l);return Ks._forOperation(s,"link",f)}async function lA(s,i,l=!1){let{auth:f}=s;if(Rn(f.app))return Promise.reject(Va(f));let p="reauthenticate";try{let a=await Ih(s,Yb(f,p,i,s),l);nt(a.idToken,f,"internal-error");let b=Yy(a.idToken);nt(b,f,"internal-error");let{sub:P}=b;return nt(s.uid===P,f,"user-mismatch"),Ks._forOperation(s,p,a)}catch(a){throw a?.code==="auth/user-not-found"&&Fn(f,"user-mismatch"),a}}async function cA(s,i,l=!1){if(Rn(s.app))return Promise.reject(Va(s));let f="signIn",p=await Yb(s,f,i),a=await Ks._fromIdTokenResponse(s,f,p);return l||await s._updateCurrentUser(a.user),a}function Jb(s,i,l,f){return La(s).onIdTokenChanged(i,l,f)}function Qb(s,i,l){return La(s).beforeAuthStateChanged(i,l)}function yb(s,i){return dr(s,"POST","/v2/accounts/mfaEnrollment:start",ji(s,i))}function uA(s,i){return dr(s,"POST","/v2/accounts/mfaEnrollment:finalize",ji(s,i))}function hA(s,i){return dr(s,"POST","/v2/accounts/mfaEnrollment:start",ji(s,i))}function dA(s,i){return dr(s,"POST","/v2/accounts/mfaEnrollment:finalize",ji(s,i))}var uf="__sak";var hf=class{constructor(i,l){this.storageRetriever=i,this.type=l}_isAvailable(){try{return this.storage?(this.storage.setItem(uf,"1"),this.storage.removeItem(uf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(i,l){return this.storage.setItem(i,JSON.stringify(l)),Promise.resolve()}_get(i){let l=this.storage.getItem(i);return Promise.resolve(l?JSON.parse(l):null)}_remove(i){return this.storage.removeItem(i),Promise.resolve()}get storage(){return this.storageRetriever()}};var pA=1e3,fA=10,df=class extends hf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(i,l)=>this.onStorageEvent(i,l),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Gb(),this._shouldAllowMigration=!0}forAllChangedKeys(i){for(let l of Object.keys(this.listeners)){let f=this.storage.getItem(l),p=this.localCache[l];f!==p&&i(l,p,f)}}onStorageEvent(i,l=!1){if(!i.key){this.forAllChangedKeys((b,P,M)=>{this.notifyListeners(b,M)});return}let f=i.key;l?this.detachListener():this.stopPolling();let p=()=>{let b=this.storage.getItem(f);!l&&this.localCache[f]===b||this.notifyListeners(f,b)},a=this.storage.getItem(f);NE()&&a!==i.newValue&&i.newValue!==i.oldValue?setTimeout(p,fA):p()}notifyListeners(i,l){this.localCache[i]=l;let f=this.listeners[i];if(f)for(let p of Array.from(f))p(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((i,l,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:i,oldValue:l,newValue:f}),!0)})},pA)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(i,l){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[i]||(this.listeners[i]=new Set,this.localCache[i]=this.storage.getItem(i)),this.listeners[i].add(l)}_removeListener(i,l){this.listeners[i]&&(this.listeners[i].delete(l),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(i,l){await super._set(i,l),this.localCache[i]=JSON.stringify(l)}async _get(i){let l=await super._get(i);return this.localCache[i]=JSON.stringify(l),l}async _remove(i){await super._remove(i),delete this.localCache[i]}};df.type="LOCAL";var ew=df;var mA=1e3;function Py(s){let i=s.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),l=RegExp(`${i}=([^;]+)`);return document.cookie.match(l)?.[1]??null}function Ey(s){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${s.split(":")[3]}`}var Uy=class{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(i){if(typeof window===void 0)return i;let l=new URL(`${window.location.origin}/__cookies__`);return l.searchParams.set("finalTarget",i),l}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(i,l){}async _get(i){if(!this._isAvailable())return null;let l=Ey(i);return window.cookieStore?(await window.cookieStore.get(l))?.value:Py(l)}async _remove(i){if(!this._isAvailable()||!await this._get(i))return;let f=Ey(i);document.cookie=`${f}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(i,l){if(!this._isAvailable())return;let f=Ey(i);if(window.cookieStore){let P=(D=>{let B=D.changed.find(oe=>oe.name===f);B&&l(B.value),D.deleted.find(oe=>oe.name===f)&&l(null)}),M=()=>window.cookieStore.removeEventListener("change",P);return this.listenerUnsubscribes.set(l,M),window.cookieStore.addEventListener("change",P)}let p=Py(f),a=setInterval(()=>{let P=Py(f);P!==p&&(l(P),p=P)},mA),b=()=>clearInterval(a);this.listenerUnsubscribes.set(l,b)}_removeListener(i,l){let f=this.listenerUnsubscribes.get(l);f&&(f(),this.listenerUnsubscribes.delete(l))}};Uy.type="COOKIE";var pf=class extends hf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(i,l){}_removeListener(i,l){}};pf.type="SESSION";var e_=pf;function gA(s){return Promise.all(s.map(async i=>{try{return{fulfilled:!0,value:await i}}catch(l){return{fulfilled:!1,reason:l}}}))}var ff=class s{constructor(i){this.eventTarget=i,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(i){let l=this.receivers.find(p=>p.isListeningto(i));if(l)return l;let f=new s(i);return this.receivers.push(f),f}isListeningto(i){return this.eventTarget===i}async handleEvent(i){let l=i,{eventId:f,eventType:p,data:a}=l.data,b=this.handlersMap[p];if(!b?.size)return;l.ports[0].postMessage({status:"ack",eventId:f,eventType:p});let P=Array.from(b).map(async D=>D(l.origin,a)),M=await gA(P);l.ports[0].postMessage({status:"done",eventId:f,eventType:p,response:M})}_subscribe(i,l){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[i]||(this.handlersMap[i]=new Set),this.handlersMap[i].add(l)}_unsubscribe(i,l){this.handlersMap[i]&&l&&this.handlersMap[i].delete(l),(!l||this.handlersMap[i].size===0)&&delete this.handlersMap[i],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}};ff.receivers=[];function t_(s="",i=10){let l="";for(let f=0;f<i;f++)l+=Math.floor(Math.random()*10);return s+l}var jy=class{constructor(i){this.target=i,this.handlers=new Set}removeMessageHandler(i){i.messageChannel&&(i.messageChannel.port1.removeEventListener("message",i.onMessage),i.messageChannel.port1.close()),this.handlers.delete(i)}async _send(i,l,f=50){let p=typeof MessageChannel<"u"?new MessageChannel:null;if(!p)throw new Error("connection_unavailable");let a,b;return new Promise((P,M)=>{let D=t_("",20);p.port1.start();let B=setTimeout(()=>{M(new Error("unsupported_event"))},f);b={messageChannel:p,onMessage(U){let oe=U;if(oe.data.eventId===D)switch(oe.data.status){case"ack":clearTimeout(B),a=setTimeout(()=>{M(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),P(oe.data.response);break;default:clearTimeout(B),clearTimeout(a),M(new Error("invalid_response"));break}}},this.handlers.add(b),p.port1.addEventListener("message",b.onMessage),this.target.postMessage({eventType:i,eventId:D,data:l},[p.port2])}).finally(()=>{b&&this.removeMessageHandler(b)})}};function po(){return window}function yA(s){po().location.href=s}function tw(){return typeof po().WorkerGlobalScope<"u"&&typeof po().importScripts=="function"}async function _A(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function vA(){return navigator?.serviceWorker?.controller||null}function xA(){return tw()?self:null}var iw="firebaseLocalStorageDb",bA=1,mf="firebaseLocalStorage",rw="fbase_key",Xs=class{constructor(i){this.request=i}toPromise(){return new Promise((i,l)=>{this.request.addEventListener("success",()=>{i(this.request.result)}),this.request.addEventListener("error",()=>{l(this.request.error)})})}};function If(s,i){return s.transaction([mf],i?"readwrite":"readonly").objectStore(mf)}function wA(){let s=indexedDB.deleteDatabase(iw);return new Xs(s).toPromise()}function Vy(){let s=indexedDB.open(iw,bA);return new Promise((i,l)=>{s.addEventListener("error",()=>{l(s.error)}),s.addEventListener("upgradeneeded",()=>{let f=s.result;try{f.createObjectStore(mf,{keyPath:rw})}catch(p){l(p)}}),s.addEventListener("success",async()=>{let f=s.result;f.objectStoreNames.contains(mf)?i(f):(f.close(),await wA(),i(await Vy()))})})}async function _b(s,i,l){let f=If(s,!0).put({[rw]:i,value:l});return new Xs(f).toPromise()}async function TA(s,i){let l=If(s,!1).get(i),f=await new Xs(l).toPromise();return f===void 0?null:f.value}function vb(s,i){let l=If(s,!0).delete(i);return new Xs(l).toPromise()}var SA=800,IA=3,gf=class{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Vy(),this.db)}async _withRetries(i){let l=0;for(;;)try{let f=await this._openDb();return await i(f)}catch(f){if(l++>IA)throw f;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ff._getInstance(xA()),this.receiver._subscribe("keyChanged",async(i,l)=>({keyProcessed:(await this._poll()).includes(l.key)})),this.receiver._subscribe("ping",async(i,l)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await _A(),!this.activeServiceWorker)return;this.sender=new jy(this.activeServiceWorker);let i=await this.sender._send("ping",{},800);i&&i[0]?.fulfilled&&i[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(i){if(!(!this.sender||!this.activeServiceWorker||vA()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:i},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let i=await Vy();return await _b(i,uf,"1"),await vb(i,uf),!0}catch{}return!1}async _withPendingWrite(i){this.pendingWrites++;try{await i()}finally{this.pendingWrites--}}async _set(i,l){return this._withPendingWrite(async()=>(await this._withRetries(f=>_b(f,i,l)),this.localCache[i]=l,this.notifyServiceWorker(i)))}async _get(i){let l=await this._withRetries(f=>TA(f,i));return this.localCache[i]=l,l}async _remove(i){return this._withPendingWrite(async()=>(await this._withRetries(l=>vb(l,i)),delete this.localCache[i],this.notifyServiceWorker(i)))}async _poll(){let i=await this._withRetries(p=>{let a=If(p,!1).getAll();return new Xs(a).toPromise()});if(!i)return[];if(this.pendingWrites!==0)return[];let l=[],f=new Set;if(i.length!==0)for(let{fbase_key:p,value:a}of i)f.add(p),JSON.stringify(this.localCache[p])!==JSON.stringify(a)&&(this.notifyListeners(p,a),l.push(p));for(let p of Object.keys(this.localCache))this.localCache[p]&&!f.has(p)&&(this.notifyListeners(p,null),l.push(p));return l}notifyListeners(i,l){this.localCache[i]=l;let f=this.listeners[i];if(f)for(let p of Array.from(f))p(l)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SA)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(i,l){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[i]||(this.listeners[i]=new Set,this._get(i)),this.listeners[i].add(l)}_removeListener(i,l){this.listeners[i]&&(this.listeners[i].delete(l),this.listeners[i].size===0&&delete this.listeners[i]),Object.keys(this.listeners).length===0&&this.stopPolling()}};gf.type="LOCAL";var nw=gf;function xb(s,i){return dr(s,"POST","/v2/accounts/mfaSignIn:start",ji(s,i))}function PA(s,i){return dr(s,"POST","/v2/accounts/mfaSignIn:finalize",ji(s,i))}function EA(s,i){return dr(s,"POST","/v2/accounts/mfaSignIn:finalize",ji(s,i))}var Ok=Wb("rcb"),Fk=new qs(3e4,6e4);var Kp="recaptcha";async function AA(s,i,l){if(!s._getRecaptchaConfig())try{await qE(s)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let f;if(typeof i=="string"?f={phoneNumber:i}:f=i,"session"in f){let p=f.session;if("phoneNumber"in f){nt(p.type==="enroll",s,"internal-error");let a={idToken:p.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Sh(s,a,"mfaSmsEnrollment",async(D,B)=>{if(B.phoneEnrollmentInfo.captchaResponse===Th){nt(l?.type===Kp,D,"argument-error");let U=await Ay(D,B,l);return yb(D,U)}return yb(D,B)},"PHONE_PROVIDER").catch(D=>Promise.reject(D))).phoneSessionInfo.sessionInfo}else{nt(p.type==="signin",s,"internal-error");let a=f.multiFactorHint?.uid||f.multiFactorUid;nt(a,s,"missing-multi-factor-info");let b={mfaPendingCredential:p.credential,mfaEnrollmentId:a,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Sh(s,b,"mfaSmsSignIn",async(B,U)=>{if(U.phoneSignInInfo.captchaResponse===Th){nt(l?.type===Kp,B,"argument-error");let oe=await Ay(B,U,l);return xb(B,oe)}return xb(B,U)},"PHONE_PROVIDER").catch(B=>Promise.reject(B))).phoneResponseInfo.sessionInfo}}else{let p={phoneNumber:f.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Sh(s,p,"sendVerificationCode",async(M,D)=>{if(D.captchaResponse===Th){nt(l?.type===Kp,M,"argument-error");let B=await Ay(M,D,l);return mb(M,B)}return mb(M,D)},"PHONE_PROVIDER").catch(M=>Promise.reject(M))).sessionInfo}}finally{l?._reset()}}async function Ay(s,i,l){nt(l.type===Kp,s,"argument-error");let f=await l.verify();nt(typeof f=="string",s,"argument-error");let p={...i};if("phoneEnrollmentInfo"in p){let a=p.phoneEnrollmentInfo.phoneNumber,b=p.phoneEnrollmentInfo.captchaResponse,P=p.phoneEnrollmentInfo.clientType,M=p.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(p,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:f,captchaResponse:b,clientType:P,recaptchaVersion:M}}),p}else if("phoneSignInInfo"in p){let a=p.phoneSignInInfo.captchaResponse,b=p.phoneSignInInfo.clientType,P=p.phoneSignInInfo.recaptchaVersion;return Object.assign(p,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:a,clientType:b,recaptchaVersion:P}}),p}else return Object.assign(p,{recaptchaToken:f}),p}var Lh=class s{constructor(i){this.providerId=s.PROVIDER_ID,this.auth=Ys(i)}verifyPhoneNumber(i,l){return AA(this.auth,i,La(l))}static credential(i,l){return Ah._fromVerification(i,l)}static credentialFromResult(i){let l=i;return s.credentialFromTaggedObject(l)}static credentialFromError(i){return s.credentialFromTaggedObject(i.customData||{})}static credentialFromTaggedObject({_tokenResponse:i}){if(!i)return null;let{phoneNumber:l,temporaryProof:f}=i;return l&&f?Ah._fromTokenResponse(l,f):null}};Lh.PROVIDER_ID="phone";Lh.PHONE_SIGN_IN_METHOD="phone";function CA(s,i){return i?Ko(i):(nt(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}var Dh=class extends Zs{constructor(i){super("custom","custom"),this.params=i}_getIdTokenResponse(i){return bc(i,this._buildIdpRequest())}_linkToIdToken(i,l){return bc(i,this._buildIdpRequest(l))}_getReauthenticationResolver(i){return bc(i,this._buildIdpRequest())}_buildIdpRequest(i){let l={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return i&&(l.idToken=i),l}};function MA(s){return cA(s.auth,new Dh(s),s.bypassAuthState)}function kA(s){let{auth:i,user:l}=s;return nt(l,i,"internal-error"),lA(l,new Dh(s),s.bypassAuthState)}async function RA(s){let{auth:i,user:l}=s;return nt(l,i,"internal-error"),sA(l,new Dh(s),s.bypassAuthState)}var yf=class{constructor(i,l,f,p,a=!1){this.auth=i,this.resolver=f,this.user=p,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(l)?l:[l]}execute(){return new Promise(async(i,l)=>{this.pendingPromise={resolve:i,reject:l};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(f){this.reject(f)}})}async onAuthEvent(i){let{urlResponse:l,sessionId:f,postBody:p,tenantId:a,error:b,type:P}=i;if(b){this.reject(b);return}let M={auth:this.auth,requestUri:l,sessionId:f,tenantId:a||void 0,postBody:p||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(P)(M))}catch(D){this.reject(D)}}onError(i){this.reject(i)}getIdpTask(i){switch(i){case"signInViaPopup":case"signInViaRedirect":return MA;case"linkViaPopup":case"linkViaRedirect":return RA;case"reauthViaPopup":case"reauthViaRedirect":return kA;default:Fn(this.auth,"internal-error")}}resolve(i){Xo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(i),this.unregisterAndCleanUp()}reject(i){Xo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(i),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var LA=new qs(2e3,1e4);var $y=class s extends yf{constructor(i,l,f,p,a){super(i,l,p,a),this.provider=f,this.authWindow=null,this.pollId=null,s.currentPopupAction&&s.currentPopupAction.cancel(),s.currentPopupAction=this}async executeNotNull(){let i=await this.execute();return nt(i,this.auth,"internal-error"),i}async onExecution(){Xo(this.filter.length===1,"Popup operations only handle one event");let i=t_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],i),this.authWindow.associatedEvent=i,this.resolver._originValidation(this.auth).catch(l=>{this.reject(l)}),this.resolver._isIframeWebStorageSupported(this.auth,l=>{l||this.reject(ho(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ho(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,s.currentPopupAction=null}pollUserCancellation(){let i=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ho(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(i,LA.get())};i()}};$y.currentPopupAction=null;var DA="pendingRedirect",Xp=new Map,Gy=class extends yf{constructor(i,l,f=!1){super(i,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],l,void 0,f),this.eventId=null}async execute(){let i=Xp.get(this.auth._key());if(!i){try{let f=await zA(this.resolver,this.auth)?await super.execute():null;i=()=>Promise.resolve(f)}catch(l){i=()=>Promise.reject(l)}Xp.set(this.auth._key(),i)}return this.bypassAuthState||Xp.set(this.auth._key(),()=>Promise.resolve(null)),i()}async onAuthEvent(i){if(i.type==="signInViaRedirect")return super.onAuthEvent(i);if(i.type==="unknown"){this.resolve(null);return}if(i.eventId){let l=await this.auth._redirectUserForId(i.eventId);if(l)return this.user=l,super.onAuthEvent(i);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function zA(s,i){let l=NA(i),f=FA(s);if(!await f._isAvailable())return!1;let p=await f._get(l)==="true";return await f._remove(l),p}function OA(s,i){Xp.set(s._key(),i)}function FA(s){return Ko(s._redirectPersistence)}function NA(s){return Hp(DA,s.config.apiKey,s.name)}async function BA(s,i,l=!1){if(Rn(s.app))return Promise.reject(Va(s));let f=Ys(s),p=CA(f,i),b=await new Gy(f,p,l).execute();return b&&!l&&(delete b.user._redirectEventId,await f._persistUserIfCurrent(b.user),await f._setRedirectUser(null,i)),b}var UA=600*1e3,qy=class{constructor(i){this.auth=i,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(i){this.consumers.add(i),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,i)&&(this.sendToConsumer(this.queuedRedirectEvent,i),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(i){this.consumers.delete(i)}onEvent(i){if(this.hasEventBeenHandled(i))return!1;let l=!1;return this.consumers.forEach(f=>{this.isEventForConsumer(i,f)&&(l=!0,this.sendToConsumer(i,f),this.saveEventToCache(i))}),this.hasHandledPotentialRedirect||!jA(i)||(this.hasHandledPotentialRedirect=!0,l||(this.queuedRedirectEvent=i,l=!0)),l}sendToConsumer(i,l){if(i.error&&!ow(i)){let f=i.error.code?.split("auth/")[1]||"internal-error";l.onError(ho(this.auth,f))}else l.onAuthEvent(i)}isEventForConsumer(i,l){let f=l.eventId===null||!!i.eventId&&i.eventId===l.eventId;return l.filter.includes(i.type)&&f}hasEventBeenHandled(i){return Date.now()-this.lastProcessedEventTime>=UA&&this.cachedEventUids.clear(),this.cachedEventUids.has(bb(i))}saveEventToCache(i){this.cachedEventUids.add(bb(i)),this.lastProcessedEventTime=Date.now()}};function bb(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(i=>i).join("-")}function ow({type:s,error:i}){return s==="unknown"&&i?.code==="auth/no-auth-event"}function jA(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ow(s);default:return!1}}async function VA(s,i={}){return dr(s,"GET","/v1/projects",i)}var $A=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,GA=/^https?/;async function qA(s){if(s.config.emulator)return;let{authorizedDomains:i}=await VA(s);for(let l of i)try{if(ZA(l))return}catch{}Fn(s,"unauthorized-domain")}function ZA(s){let i=My(),{protocol:l,hostname:f}=new URL(i);if(s.startsWith("chrome-extension://")){let b=new URL(s);return b.hostname===""&&f===""?l==="chrome-extension:"&&s.replace("chrome-extension://","")===i.replace("chrome-extension://",""):l==="chrome-extension:"&&b.hostname===f}if(!GA.test(l))return!1;if($A.test(s))return f===s;let p=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(f)}var WA=new qs(3e4,6e4);function wb(){let s=po().___jsl;if(s?.H){for(let i of Object.keys(s.H))if(s.H[i].r=s.H[i].r||[],s.H[i].L=s.H[i].L||[],s.H[i].r=[...s.H[i].L],s.CP)for(let l=0;l<s.CP.length;l++)s.CP[l]=null}}function HA(s){return new Promise((i,l)=>{function f(){wb(),gapi.load("gapi.iframes",{callback:()=>{i(gapi.iframes.getContext())},ontimeout:()=>{wb(),l(ho(s,"network-request-failed"))},timeout:WA.get()})}if(po().gapi?.iframes?.Iframe)i(gapi.iframes.getContext());else if(po().gapi?.load)f();else{let p=Wb("iframefcb");return po()[p]=()=>{gapi.load?f():l(ho(s,"network-request-failed"))},Zb(`${$E()}?onload=${p}`).catch(a=>l(a))}}).catch(i=>{throw Yp=null,i})}var Yp=null;function KA(s){return Yp=Yp||HA(s),Yp}var XA=new qs(5e3,15e3),YA="__/auth/iframe",JA="emulator/auth/iframe",QA={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},eC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tC(s){let i=s.config;nt(i.authDomain,s,"auth-domain-config-required");let l=i.emulator?Xy(i,JA):`https://${s.config.authDomain}/${YA}`,f={apiKey:i.apiKey,appName:s.name,v:ac},p=eC.get(s.config.apiHost);p&&(f.eid=p);let a=s._getFrameworks();return a.length&&(f.fw=a.join(",")),`${l}?${rc(f).slice(1)}`}async function iC(s){let i=await KA(s),l=po().gapi;return nt(l,s,"internal-error"),i.open({where:document.body,url:tC(s),messageHandlersFilter:l.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:QA,dontclear:!0},f=>new Promise(async(p,a)=>{await f.restyle({setHideOnLeave:!1});let b=ho(s,"network-request-failed"),P=po().setTimeout(()=>{a(b)},XA.get());function M(){po().clearTimeout(P),p(f)}f.ping(M).then(M,()=>{a(b)})}))}var rC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},nC=500,oC=600,aC="_blank",sC="http://localhost",_f=class{constructor(i){this.window=i,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function lC(s,i,l,f=nC,p=oC){let a=Math.max((window.screen.availHeight-p)/2,0).toString(),b=Math.max((window.screen.availWidth-f)/2,0).toString(),P="",M={...rC,width:f.toString(),height:p.toString(),top:a,left:b},D=Ar().toLowerCase();l&&(P=Bb(D)?aC:l),Fb(D)&&(i=i||sC,M.scrollbars="yes");let B=Object.entries(M).reduce((oe,[le,me])=>`${oe}${le}=${me},`,"");if(FE(D)&&P!=="_self")return cC(i||"",P),new _f(null);let U=window.open(i||"",P,B);nt(U,s,"popup-blocked");try{U.focus()}catch{}return new _f(U)}function cC(s,i){let l=document.createElement("a");l.href=s,l.target=i;let f=document.createEvent("MouseEvent");f.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),l.dispatchEvent(f)}var uC="__/auth/handler",hC="emulator/auth/handler",dC=encodeURIComponent("fac");async function Tb(s,i,l,f,p,a){nt(s.config.authDomain,s,"auth-domain-config-required"),nt(s.config.apiKey,s,"invalid-api-key");let b={apiKey:s.config.apiKey,appName:s.name,authType:l,redirectUrl:f,v:ac,eventId:p};if(i instanceof cf){i.setDefaultLanguage(s.languageCode),b.providerId=i.providerId||"",Y0(i.getCustomParameters())||(b.customParameters=JSON.stringify(i.getCustomParameters()));for(let[B,U]of Object.entries(a||{}))b[B]=U}if(i instanceof Hs){let B=i.getScopes().filter(U=>U!=="");B.length>0&&(b.scopes=B.join(","))}s.tenantId&&(b.tid=s.tenantId);let P=b;for(let B of Object.keys(P))P[B]===void 0&&delete P[B];let M=await s._getAppCheckToken(),D=M?`#${dC}=${encodeURIComponent(M)}`:"";return`${pC(s)}?${rc(P).slice(1)}${D}`}function pC({config:s}){return s.emulator?Xy(s,hC):`https://${s.authDomain}/${uC}`}var Cy="webStorageSupport",Zy=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=e_,this._completeRedirectFn=BA,this._overrideRedirectResult=OA}async _openPopup(i,l,f,p){Xo(this.eventManagers[i._key()]?.manager,"_initialize() not called before _openPopup()");let a=await Tb(i,l,f,My(),p);return lC(i,a,t_())}async _openRedirect(i,l,f,p){await this._originValidation(i);let a=await Tb(i,l,f,My(),p);return yA(a),new Promise(()=>{})}_initialize(i){let l=i._key();if(this.eventManagers[l]){let{manager:p,promise:a}=this.eventManagers[l];return p?Promise.resolve(p):(Xo(a,"If manager is not set, promise should be"),a)}let f=this.initAndGetManager(i);return this.eventManagers[l]={promise:f},f.catch(()=>{delete this.eventManagers[l]}),f}async initAndGetManager(i){let l=await iC(i),f=new qy(i);return l.register("authEvent",p=>(nt(p?.authEvent,i,"invalid-auth-event"),{status:f.onEvent(p.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[i._key()]={manager:f},this.iframes[i._key()]=l,f}_isIframeWebStorageSupported(i,l){this.iframes[i._key()].send(Cy,{type:Cy},p=>{let a=p?.[0]?.[Cy];a!==void 0&&l(!!a),Fn(i,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(i){let l=i._key();return this.originValidationPromises[l]||(this.originValidationPromises[l]=qA(i)),this.originValidationPromises[l]}get _shouldInitProactively(){return Gb()||Nb()||Jy()}},aw=Zy,vf=class{constructor(i){this.factorId=i}_process(i,l,f){switch(l.type){case"enroll":return this._finalizeEnroll(i,l.credential,f);case"signin":return this._finalizeSignIn(i,l.credential);default:return uo("unexpected MultiFactorSessionType")}}},Wy=class s extends vf{constructor(i){super("phone"),this.credential=i}static _fromCredential(i){return new s(i)}_finalizeEnroll(i,l,f){return uA(i,{idToken:l,displayName:f,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(i,l){return PA(i,{mfaPendingCredential:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},xf=class{constructor(){}static assertion(i){return Wy._fromCredential(i)}};xf.FACTOR_ID="phone";var bf=class{static assertionForEnrollment(i,l){return wf._fromSecret(i,l)}static assertionForSignIn(i,l){return wf._fromEnrollmentId(i,l)}static async generateSecret(i){let l=i;nt(typeof l.user?.auth<"u","internal-error");let f=await hA(l.user.auth,{idToken:l.credential,totpEnrollmentInfo:{}});return Tf._fromStartTotpMfaEnrollmentResponse(f,l.user.auth)}};bf.FACTOR_ID="totp";var wf=class s extends vf{constructor(i,l,f){super("totp"),this.otp=i,this.enrollmentId=l,this.secret=f}static _fromSecret(i,l){return new s(l,void 0,i)}static _fromEnrollmentId(i,l){return new s(l,i)}async _finalizeEnroll(i,l,f){return nt(typeof this.secret<"u",i,"argument-error"),dA(i,{idToken:l,displayName:f,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(i,l){nt(this.enrollmentId!==void 0&&this.otp!==void 0,i,"argument-error");let f={verificationCode:this.otp};return EA(i,{mfaPendingCredential:l,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:f})}},Tf=class s{constructor(i,l,f,p,a,b,P){this.sessionInfo=b,this.auth=P,this.secretKey=i,this.hashingAlgorithm=l,this.codeLength=f,this.codeIntervalSeconds=p,this.enrollmentCompletionDeadline=a}static _fromStartTotpMfaEnrollmentResponse(i,l){return new s(i.totpSessionInfo.sharedSecretKey,i.totpSessionInfo.hashingAlgorithm,i.totpSessionInfo.verificationCodeLength,i.totpSessionInfo.periodSec,new Date(i.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),i.totpSessionInfo.sessionInfo,l)}_makeTotpVerificationInfo(i){return{sessionInfo:this.sessionInfo,verificationCode:i}}generateQrCodeUrl(i,l){let f=!1;return(Zp(i)||Zp(l))&&(f=!0),f&&(Zp(i)&&(i=this.auth.currentUser?.email||"unknownuser"),Zp(l)&&(l=this.auth.name)),`otpauth://totp/${l}:${i}?secret=${this.secretKey}&issuer=${l}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}};function Zp(s){return typeof s>"u"||s?.length===0}var Sb="@firebase/auth",Ib="1.11.0";var Hy=class{constructor(i){this.auth=i,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(i){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(i)}:null}addAuthTokenListener(i){if(this.assertAuthConfigured(),this.internalListeners.has(i))return;let l=this.auth.onIdTokenChanged(f=>{i(f?.stsTokenManager.accessToken||null)});this.internalListeners.set(i,l),this.updateProactiveRefresh()}removeAuthTokenListener(i){this.assertAuthConfigured();let l=this.internalListeners.get(i);l&&(this.internalListeners.delete(i),l(),this.updateProactiveRefresh())}assertAuthConfigured(){nt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function fC(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function mC(s){Zm(new Gm("auth",(i,{options:l})=>{let f=i.getProvider("app").getImmediate(),p=i.getProvider("heartbeat"),a=i.getProvider("app-check-internal"),{apiKey:b,authDomain:P}=f.options;nt(b&&!b.includes(":"),"invalid-api-key",{appName:f.name});let M={apiKey:b,authDomain:P,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qb(s)},D=new Oy(f,p,a,M);return ZE(D,l),D},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,l,f)=>{i.getProvider("auth-internal").initialize()})),Zm(new Gm("auth-internal",i=>{let l=Ys(i.getProvider("auth").getImmediate());return(f=>new Hy(f))(l)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hm(Sb,Ib,fC(s)),Hm(Sb,Ib,"esm2020")}var gC=300,yC=$m("authIdTokenMaxAge")||gC,Pb=null,_C=s=>async i=>{let l=i&&await i.getIdTokenResult(),f=l&&(new Date().getTime()-Date.parse(l.issuedAtTime))/1e3;if(f&&f>yC)return;let p=l?.token;Pb!==p&&(Pb=p,await fetch(s,{method:p?"POST":"DELETE",headers:p?{Authorization:`Bearer ${p}`}:{}}))};function i_(s=tv()){let i=Wm(s,"auth");if(i.isInitialized())return i.getImmediate();let l=Hb(s,{popupRedirectResolver:aw,persistence:[nw,ew,e_]}),f=$m("authTokenSyncURL");if(f&&typeof isSecureContext=="boolean"&&isSecureContext){let a=new URL(f,location.origin);if(location.origin===a.origin){let b=_C(a.toString());Qb(l,b,()=>b(l.currentUser)),Jb(l,P=>b(P))}}let p=$0("auth");return p&&Kb(l,`http://${p}`),l}function vC(){return document.getElementsByTagName("head")?.[0]??document}jE({loadJS(s){return new Promise((i,l)=>{let f=document.createElement("script");f.setAttribute("src",s),f.onload=i,f.onerror=p=>{let a=ho("internal-error");a.customData=p,l(a)},f.type="text/javascript",f.charset="UTF-8",vC().appendChild(f)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});mC("Browser");var n_=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent),[xC,sw,r_]=await Promise.all([fetch("https://data.busrouter.sg/v1/routes.min.geojson").then(s=>s.json()),fetch("https://data.busrouter.sg/v1/services.min.json").then(s=>s.json()),fetch("https://data.busrouter.sg/v1/stops.min.geojson").then(s=>s.json())]);ev(rv);var Ef=iv();li.apiKey="iBKpu3YshpPXQzg7ZH1Y";var bC=i_(),Sc=new by({container:"map",style:Vo.DATAVIZ.DARK,center:[103.8198,1.3521],zoom:n_?9:11});Sc.on("ready",s=>{Sc.setProjection({type:"globe"})});var el=document.getElementById("popup"),Js=el.querySelector("h1"),Ic=el.querySelector("span"),Pc=el.querySelector("button"),o_=[],fo;function cw(){o_.forEach(s=>{Nn.includes(s)||s.removemarker(),s.removelistener()})}var zh=class{id;name;lnglatcoords;services;color;marker;constructor(i,l,f){let p=r_.features.find(a=>a.id==i);this.id=i,this.name=f||p.properties.name,this.lnglatcoords=p.geometry.coordinates,this.services=p.properties.services,this.onclicked=this.onclicked.bind(this),this.color=l,o_.push(this)}onclicked(){Nn.push(this),Tc.push(this),Js.textContent=this.name;let i=this.opposite()?"<button>Opp</button>":"";Ic.innerHTML=`${i}<button>${this.services.join("</button><button>")}</button>`,el.style.bottom="0",cw(),Ic.querySelectorAll("button").forEach(l=>{let f;l.addEventListener("click",p=>{if(n_){f=new Af(l.textContent),f.addroute(),tl.includes(fo)||fo?.removeroute(),Pc.style.display="inline";return}fo=f,hw()}),!n_&&(l.addEventListener("mouseover",p=>{f=new Af(l.textContent),f.addroute()}),l.addEventListener("mouseout",p=>{tl.includes(f)||f.removeroute()}))}),fo&&fo.croproute(Nn.at(-2).lnglatcoords,this.lnglatcoords)}addmarker(){this.marker=new nx({color:this.color}).setLngLat(this.lnglatcoords).addTo(Sc),this.marker.getElement().addEventListener("click",this.onclicked),this.color=="hsl(76, 59%, 53%)"&&(this.marker.getElement().style.zIndex="1")}removemarker(){this.marker?.remove()}removelistener(){this.marker.getElement().removeEventListener("click",this.onclicked)}opposite(){if(this.id.at(-1)=="1")return r_.features.find(i=>i.id.slice(0,4)==this.id.slice(0,4)&&i.id[4]=="9");if(this.id.at(-1)=="9")return r_.features.find(i=>i.id.slice(0,4)==this.id.slice(0,4)&&i.id[4]=="1")}},Af=class{num;lnglatpoints;stops;routeonmap;constructor(i){if(i=="Opp"){this.num=i,this.lnglatpoints=[Nn.at(-1).lnglatcoords,Nn.at(-1).opposite().geometry.coordinates],this.stops=[[Nn.at(-1).id,Nn.at(-1).opposite().id]];return}let l=xC.features.filter(f=>f.properties.number==i);this.num=i,l.length==1||sw[i].routes[0].includes(Nn.at(-1).id)?this.lnglatpoints=l[0].geometry.coordinates:this.lnglatpoints=l[1].geometry.coordinates,this.stops=sw[i].routes}async addroute(){let i={type:"FeatureCollection",features:[{type:"Feature",properties:null,geometry:{type:"LineString",coordinates:this.lnglatpoints}}]};this.routeonmap=await lb.addPolyline(Sc,{data:i,lineColor:`hsl(${Math.random()*360}, 59%, 53%)`})}async croproute(i,l){let f=Sc.getSource(this.routeonmap.polylineSourceId),p=this.closestindexonpolyline(i,this.lnglatpoints),a=this.closestindexonpolyline(l,this.lnglatpoints);await f.setData({type:"FeatureCollection",features:[{type:"Feature",properties:null,geometry:{type:"LineString",coordinates:p>a?this.lnglatpoints.slice(a,p+1):this.lnglatpoints.slice(p,a+1)}}]})}closestindexonpolyline(i,l){let f=0,p=1/0;return l.forEach((a,b)=>{let P=new _h(...i),M=new _h(...a),D=P.distanceTo(M);D<p&&(p=D,f=b)}),f}removeroute(){Sc.removeLayer(this.routeonmap.polylineLayerId)}distance(){let i=0;for(let l=0;l<this.lnglatpoints.length-1;l++){let f=new _h(...this.lnglatpoints[l]),p=new _h(...this.lnglatpoints[l+1]);i+=f.distanceTo(p)}return i}};function uw(s){let i=s.slice(-6,-1),l=s.split("(")[0].trim();return[i,"hsl(76, 59%, 53%)",l]}function hw(){Pc.style.display="none",el.style.bottom=`-${el.scrollHeight}px`,tl.push(fo);let s=Nn.at(-1)==Yo?o_[0]:Nn.at(-1),i=fo?.stops.length==1||fo?.stops[0].find(l=>l==s?.id)?0:1;fo?.stops[i].forEach(l=>{if(l==Qs.id){Ga.start=!0,Ga.start&&Ga.end&&lw();return}if(l==Yo.id){Ga.end=!0,Ga.start&&Ga.end&&lw();return}Ga.start&&Ga.end||new zh(l,"hsl(256, 59%, 53%)").addmarker()})}var Pf;function lw(){let s=[],i=Tc[0]==Yo?Qs:Yo;Tc.push(i),fo?.croproute(Nn.at(-1).lnglatcoords,i.lnglatcoords);for(let l=0;l<Tc.length;l++)s.push(Tc[l].name),tl[l]&&s.push(tl[l].num);Js.style.fontFamily="sans-serif",Js.style.fontWeight="lighter",Js.textContent="You win! Your route: ",Ic.textContent=s.join(" \u2192 "),Pc.style.display="inline",Pc.textContent="Add to Leaderboard",Pc.onclick=async()=>{Pf=await Qy(bC);let l=(await Xm(Fu(Ef,`users/${Pf.user.uid}/name`))).val(),f=Ic.querySelector("input")?.value;if(f||l){l||await Km(Fu(Ef,`users/${Pf.user.uid}/name`),f),await wC();return}Js.textContent="Set name:",Ic.innerHTML="<input><br>"},el.style.bottom="0",cw()}async function wC(){let i=(await Xm(Fu(Ef,`leaderboard/${Yo.id} \u2192 ${Qs.id}`)))?.val()?`${Yo.id} \u2192 ${Qs.id}`:`${Qs.id} \u2192 ${Yo.id}`,l=0;tl.forEach(p=>{l+=p.distance()});let f={stops:Tc.map(p=>p.id),buses:tl.map(p=>p.num),time:Date.now(),distance:l};try{await Km(Fu(Ef,`leaderboard/${i}/${Pf.user.uid}`),f),Js.textContent="Success!"}catch(p){console.log(p),Js.textContent="Shorter distance found."}finally{Pc.remove(),Ic.innerHTML="<a href='leaderboard.html'><button>Check Leaderboard</button></a>"}}window.confirmbus=hw;var[TC,SC]=JSON.parse(localStorage.getItem("busstops")),Qs=new zh(...uw(TC)),Yo=new zh(...uw(SC));Qs.addmarker();Yo.addmarker();var Nn=[Qs,Yo],tl=[],Ga={start:!1,end:!1},Tc=[];
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-9ccb475d.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
